import{S as gt}from"./sortable.esm-DE-Xb16W.js";import"./dialog-bdBi4zz3.js";import{C as ue,t as he}from"./tippy.esm-DBDhGERe.js";import{d as U,o as Ae,c as m,a as f,b as a,t as g,n as Y,e as q,r as x,f as w,F as I,g as R,h as O,i as W,w as oe,j as vt,k as ve,v as Ee,l as re,m as ye,p as Fe,q as yt}from"./vue.esm-bundler-CSDHRrjm.js";import{v as bt}from"./v-click-outside.umd-BCtVgRUL.js";import{_ as ln}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as an}from"./Browser.vue_vue_type_script_setup_true_lang-BbqD9HTD.js";import"./_commonjsHelpers-CqkleIqs.js";const wt="kanka.default";window.triggerEvent=function(t){t=t||wt;const e=new Event(t);document.dispatchEvent(e)};window.onEvent=function(t,e){e=e||wt,document.addEventListener(e,t)};window.onReady=function(t){document.readyState==="complete"||document.readyState==="interactive"?setTimeout(t,1):document.addEventListener("DOMContentLoaded",t)};window.initTags=function(){document.querySelectorAll(".form-tags")?.forEach(function(t){t.classList.contains("select2-hidden-accessible")||t.dataset.loaded!==1&&(t.dataset.loaded=1,$(t).select2({tags:t.dataset.allowNew==="true",allowClear:t.dataset.allowClear==="true",dropdownParent:t.dataset.dropdownParent||"",minimumInputLength:0,ajax:{quietMillis:500,delay:500,url:t.dataset.url,dataType:"json",data:function(e){return{q:e.term?.trim()}},processResults:function(e){return{results:e}},cache:!0},escapeMarkup:function(e){return e},createTag:function(e){const n=e.term?.trim();return n===""?null:{id:n,text:n,newTag:!0}},templateResult:function(e){const n=document.createElement("span");return n.classList.add("block","grow","text-left"),n.innerHTML=e.text,e.colour&&(n.classList.add("flex","gap-2","items-center","text-left"),n.innerHTML="<span class='rounded-full flex-none w-6 h-6 "+e.colour+"' /></span><span class='grow'>"+e.text+"</span>"),n},templateSelection:function(e,n){if(e.newTag){const o=document.createElement("span");return o.classList.add("new-tag"),o.title=t.dataset.newTag,o.innerHTML=e.text+' <i class="fa-solid fa-flag" aria-hidden="true"></i>',o}let i=e.element,r=[];return e.colour?r=e.colour.trim().split(" "):i.dataset.colour&&(r=i.dataset.colour.trim().split(" ")),r.length>0&&r.forEach(o=>{o.trim().length!==0&&n[0].classList.add(o)}),n[0].classList.add("text-left"),e.text}}))}),document.querySelectorAll(".position-dropdown")?.forEach(function(t){t.classList.contains("select2-hidden-accessible")||t.dataset.loaded!==1&&(t.dataset.loaded=1,$(t).select2({tags:!0,allowClear:!0,dropdownParent:t.dataset.dropdownParent||"",placeholder:t.dataset.placeholder,minimumInputLength:0,createTag:function(e){const n=e.term?.trim();return n===""?null:{id:n,text:n,newTag:!0}}}))})};window.initTags();var Qe={};var ze;function cn(){return ze||(ze=1,function(){if(jQuery&&jQuery.fn&&jQuery.fn.select2&&jQuery.fn.select2.amd)var t=jQuery.fn.select2.amd;t.define("select2/i18n/de",[],function(){return{errorLoading:function(){return"Die Ergebnisse konnten nicht geladen werden."},inputTooLong:function(e){return"Bitte "+(e.input.length-e.maximum)+" Zeichen weniger eingeben"},inputTooShort:function(e){return"Bitte "+(e.minimum-e.input.length)+" Zeichen mehr eingeben"},loadingMore:function(){return"Lade mehr Ergebnisse…"},maximumSelected:function(e){var n="Sie können nur "+e.maximum+" Element";return e.maximum!=1&&(n+="e"),n+=" auswählen"},noResults:function(){return"Keine Übereinstimmungen gefunden"},searching:function(){return"Suche…"},removeAllItems:function(){return"Entferne alle Elemente"}}}),t.define,t.require}()),Qe}cn();var Ue={};var Ke;function un(){return Ke||(Ke=1,function(){if(jQuery&&jQuery.fn&&jQuery.fn.select2&&jQuery.fn.select2.amd)var t=jQuery.fn.select2.amd;t.define("select2/i18n/en",[],function(){return{errorLoading:function(){return"The results could not be loaded."},inputTooLong:function(e){var n=e.input.length-e.maximum,i="Please delete "+n+" character";return n!=1&&(i+="s"),i},inputTooShort:function(e){return"Please enter "+(e.minimum-e.input.length)+" or more characters"},loadingMore:function(){return"Loading more results…"},maximumSelected:function(e){var n="You can only select "+e.maximum+" item";return e.maximum!=1&&(n+="s"),n},noResults:function(){return"No results found"},searching:function(){return"Searching…"},removeAllItems:function(){return"Remove all items"}}}),t.define,t.require}()),Ue}un();var We={};var Ve;function dn(){return Ve||(Ve=1,function(){if(jQuery&&jQuery.fn&&jQuery.fn.select2&&jQuery.fn.select2.amd)var t=jQuery.fn.select2.amd;t.define("select2/i18n/es",[],function(){return{errorLoading:function(){return"No se pudieron cargar los resultados"},inputTooLong:function(e){var n=e.input.length-e.maximum,i="Por favor, elimine "+n+" car";return i+=n==1?"ácter":"acteres"},inputTooShort:function(e){var n=e.minimum-e.input.length,i="Por favor, introduzca "+n+" car";return i+=n==1?"ácter":"acteres"},loadingMore:function(){return"Cargando más resultados…"},maximumSelected:function(e){var n="Sólo puede seleccionar "+e.maximum+" elemento";return e.maximum!=1&&(n+="s"),n},noResults:function(){return"No se encontraron resultados"},searching:function(){return"Buscando…"},removeAllItems:function(){return"Eliminar todos los elementos"}}}),t.define,t.require}()),We}dn();var Ye={};var Xe;function fn(){return Xe||(Xe=1,function(){if(jQuery&&jQuery.fn&&jQuery.fn.select2&&jQuery.fn.select2.amd)var t=jQuery.fn.select2.amd;t.define("select2/i18n/fr",[],function(){return{errorLoading:function(){return"Les résultats ne peuvent pas être chargés."},inputTooLong:function(e){var n=e.input.length-e.maximum;return"Supprimez "+n+" caractère"+(n>1?"s":"")},inputTooShort:function(e){var n=e.minimum-e.input.length;return"Saisissez au moins "+n+" caractère"+(n>1?"s":"")},loadingMore:function(){return"Chargement de résultats supplémentaires…"},maximumSelected:function(e){return"Vous pouvez seulement sélectionner "+e.maximum+" élément"+(e.maximum>1?"s":"")},noResults:function(){return"Aucun résultat trouvé"},searching:function(){return"Recherche en cours…"},removeAllItems:function(){return"Supprimer tous les éléments"}}}),t.define,t.require}()),Ye}fn();var Ge={};var Ze;function mn(){return Ze||(Ze=1,function(){if(jQuery&&jQuery.fn&&jQuery.fn.select2&&jQuery.fn.select2.amd)var t=jQuery.fn.select2.amd;t.define("select2/i18n/it",[],function(){return{errorLoading:function(){return"I risultati non possono essere caricati."},inputTooLong:function(e){var n=e.input.length-e.maximum,i="Per favore cancella "+n+" caratter";return i+=n!==1?"i":"e"},inputTooShort:function(e){return"Per favore inserisci "+(e.minimum-e.input.length)+" o più caratteri"},loadingMore:function(){return"Caricando più risultati…"},maximumSelected:function(e){var n="Puoi selezionare solo "+e.maximum+" element";return e.maximum!==1?n+="i":n+="o",n},noResults:function(){return"Nessun risultato trovato"},searching:function(){return"Sto cercando…"},removeAllItems:function(){return"Rimuovi tutti gli oggetti"}}}),t.define,t.require}()),Ge}mn();var Je={};var et;function hn(){return et||(et=1,function(){if(jQuery&&jQuery.fn&&jQuery.fn.select2&&jQuery.fn.select2.amd)var t=jQuery.fn.select2.amd;t.define("select2/i18n/nl",[],function(){return{errorLoading:function(){return"De resultaten konden niet worden geladen."},inputTooLong:function(e){return"Gelieve "+(e.input.length-e.maximum)+" karakters te verwijderen"},inputTooShort:function(e){return"Gelieve "+(e.minimum-e.input.length)+" of meer karakters in te voeren"},loadingMore:function(){return"Meer resultaten laden…"},maximumSelected:function(e){var n=e.maximum==1?"kan":"kunnen",i="Er "+n+" maar "+e.maximum+" item";return e.maximum!=1&&(i+="s"),i+=" worden geselecteerd"},noResults:function(){return"Geen resultaten gevonden…"},searching:function(){return"Zoeken…"},removeAllItems:function(){return"Verwijder alle items"}}}),t.define,t.require}()),Je}hn();var tt={};var nt;function pn(){return nt||(nt=1,function(){if(jQuery&&jQuery.fn&&jQuery.fn.select2&&jQuery.fn.select2.amd)var t=jQuery.fn.select2.amd;t.define("select2/i18n/pl",[],function(){var e=["znak","znaki","znaków"],n=["element","elementy","elementów"],i=function(r,o){return r===1?o[0]:r>1&&r<=4?o[1]:r>=5?o[2]:void 0};return{errorLoading:function(){return"Nie można załadować wyników."},inputTooLong:function(r){var o=r.input.length-r.maximum;return"Usuń "+o+" "+i(o,e)},inputTooShort:function(r){var o=r.minimum-r.input.length;return"Podaj przynajmniej "+o+" "+i(o,e)},loadingMore:function(){return"Trwa ładowanie…"},maximumSelected:function(r){return"Możesz zaznaczyć tylko "+r.maximum+" "+i(r.maximum,n)},noResults:function(){return"Brak wyników"},searching:function(){return"Trwa wyszukiwanie…"},removeAllItems:function(){return"Usuń wszystkie przedmioty"}}}),t.define,t.require}()),tt}pn();var it={};var rt;function gn(){return rt||(rt=1,function(){if(jQuery&&jQuery.fn&&jQuery.fn.select2&&jQuery.fn.select2.amd)var t=jQuery.fn.select2.amd;t.define("select2/i18n/pt-BR",[],function(){return{errorLoading:function(){return"Os resultados não puderam ser carregados."},inputTooLong:function(e){var n=e.input.length-e.maximum,i="Apague "+n+" caracter";return n!=1&&(i+="es"),i},inputTooShort:function(e){return"Digite "+(e.minimum-e.input.length)+" ou mais caracteres"},loadingMore:function(){return"Carregando mais resultados…"},maximumSelected:function(e){var n="Você só pode selecionar "+e.maximum+" ite";return e.maximum==1?n+="m":n+="ns",n},noResults:function(){return"Nenhum resultado encontrado"},searching:function(){return"Buscando…"},removeAllItems:function(){return"Remover todos os itens"}}}),t.define,t.require}()),it}gn();var ot={};var st;function vn(){return st||(st=1,function(){if(jQuery&&jQuery.fn&&jQuery.fn.select2&&jQuery.fn.select2.amd)var t=jQuery.fn.select2.amd;t.define("select2/i18n/ru",[],function(){function e(n,i,r,o){return n%10<5&&n%10>0&&n%100<5||n%100>20?n%10>1?r:i:o}return{errorLoading:function(){return"Невозможно загрузить результаты"},inputTooLong:function(n){var i=n.input.length-n.maximum,r="Пожалуйста, введите на "+i+" символ";return r+=e(i,"","a","ов"),r+=" меньше"},inputTooShort:function(n){var i=n.minimum-n.input.length,r="Пожалуйста, введите ещё хотя бы "+i+" символ";return r+=e(i,"","a","ов")},loadingMore:function(){return"Загрузка данных…"},maximumSelected:function(n){var i="Вы можете выбрать не более "+n.maximum+" элемент";return i+=e(n.maximum,"","a","ов")},noResults:function(){return"Совпадений не найдено"},searching:function(){return"Поиск…"},removeAllItems:function(){return"Удалить все элементы"}}}),t.define,t.require}()),ot}vn();var lt={};var at;function yn(){return at||(at=1,function(){if(jQuery&&jQuery.fn&&jQuery.fn.select2&&jQuery.fn.select2.amd)var t=jQuery.fn.select2.amd;t.define("select2/i18n/sk",[],function(){var e={2:function(n){return n?"dva":"dve"},3:function(){return"tri"},4:function(){return"štyri"}};return{errorLoading:function(){return"Výsledky sa nepodarilo načítať."},inputTooLong:function(n){var i=n.input.length-n.maximum;return i==1?"Prosím, zadajte o jeden znak menej":i>=2&&i<=4?"Prosím, zadajte o "+e[i](!0)+" znaky menej":"Prosím, zadajte o "+i+" znakov menej"},inputTooShort:function(n){var i=n.minimum-n.input.length;return i==1?"Prosím, zadajte ešte jeden znak":i<=4?"Prosím, zadajte ešte ďalšie "+e[i](!0)+" znaky":"Prosím, zadajte ešte ďalších "+i+" znakov"},loadingMore:function(){return"Načítanie ďalších výsledkov…"},maximumSelected:function(n){return n.maximum==1?"Môžete zvoliť len jednu položku":n.maximum>=2&&n.maximum<=4?"Môžete zvoliť najviac "+e[n.maximum](!1)+" položky":"Môžete zvoliť najviac "+n.maximum+" položiek"},noResults:function(){return"Nenašli sa žiadne položky"},searching:function(){return"Vyhľadávanie…"},removeAllItems:function(){return"Odstráňte všetky položky"}}}),t.define,t.require}()),lt}yn();window.initForeignSelect=function(){const t=document.querySelectorAll("select.select2");t.length!==0&&(t.forEach(e=>{if(e.classList.contains("select2-hidden-accessible"))return;if(e.classList.contains("campaign-genres")){$(e).select2({tags:!1,allowClear:!0,dropdownParent:"",width:"100%",maximumSelectionLength:3});return}const n=e.dataset.url,i=e.dataset.allowClear,r=e.dataset.dropdownParent||"",o=e.dataset.placeholder;if(!n){$(e).select2({tags:!1,placeholder:o,allowClear:i??!1,language:e.dataset.language,minimumInputLength:0,dropdownParent:r,width:"100%"});return}$(e).select2({tags:e.dataset.allowNew==="true",placeholder:o,allowClear:i||!0,language:e.dataset.language,minimumInputLength:0,dropdownParent:r,width:"100%",ajax:{delay:500,quietMillis:500,url:n,dataType:"json",data:function(s){return{q:s.term?.trim()}},processResults:function(s){return{results:s}},error:function(s){return s.status===503&&window.showToast(s.responseJSON.message,"error"),{results:[]}},cache:!0},templateResult:bn,templateSelection:wn,escapeMarkup:function(s){return s},createTag:function(s){if(e.dataset.allowNew!=="true")return null;let l=s.term?.trim();return l===""?null:{id:l,text:l+" ("+e.dataset.newTag+")",newTag:!0}}})}),xn(),kn())};const bn=t=>{const e=document.createElement("span");return t.image?(e.classList.add("flex","gap-2","items-center","text-left"),e.innerHTML="<img src='"+t.image+"' class='rounded-full flex-none w-6 h-6'/><span class='grow'>"+t.text+"</span>"):e.innerHTML=t.text,e},wn=t=>{if(!t.id)return t.text;const e=document.createElement("span");return e.innerHTML=t.text,e},xn=()=>{const t=document.querySelectorAll("select.select2-local");t.length!==0&&t.forEach(e=>{$(e).select2({placeholder:e.dataset.placeholder,language:e.dataset.language,allowClear:!0})})},kn=()=>{const t=document.querySelectorAll("select.select2-colour");t.length!==0&&t.forEach(e=>{$(e).select2({placeholder:e.dataset.placeholder,language:e.dataset.language,allowClear:!1,templateResult:ct,templateSelection:ct})})},ct=t=>{if(t.id==="none")return t.text;const e=document.createElement("span");return e.innerHTML='<div class="badge label bg-'+t.id+'"> </div>'+t.text,e};Array.prototype.find||(Array.prototype.find=function(t){if(this===null)throw new TypeError("Array.prototype.find called on null or undefined");if(typeof t!="function")throw new TypeError("predicate must be a function");for(var e=Object(this),n=e.length>>>0,i=arguments[1],r,o=0;o<n;o++)if(r=e[o],t.call(i,r,o,e))return r});if(window&&typeof window.CustomEvent!="function"){let t=function(e,n){n=n||{bubbles:!1,cancelable:!1,detail:void 0};var i=document.createEvent("CustomEvent");return i.initCustomEvent(e,n.bubbles,n.cancelable,n.detail),i};typeof window.Event<"u"&&(t.prototype=window.Event.prototype),window.CustomEvent=t}class de{constructor(e){this.tribute=e,this.tribute.events=this}static keys(){return[{key:9,value:"TAB"},{key:8,value:"DELETE"},{key:13,value:"ENTER"},{key:27,value:"ESCAPE"},{key:32,value:"SPACE"},{key:38,value:"UP"},{key:40,value:"DOWN"}]}bind(e){e.boundKeydown=this.keydown.bind(e,this),e.boundKeyup=this.keyup.bind(e,this),e.boundInput=this.input.bind(e,this),e.addEventListener("keydown",e.boundKeydown,!1),e.addEventListener("keyup",e.boundKeyup,!1),e.addEventListener("input",e.boundInput,!1)}unbind(e){e.removeEventListener("keydown",e.boundKeydown,!1),e.removeEventListener("keyup",e.boundKeyup,!1),e.removeEventListener("input",e.boundInput,!1),delete e.boundKeydown,delete e.boundKeyup,delete e.boundInput}keydown(e,n){e.shouldDeactivate(n)&&(e.tribute.isActive=!1,e.tribute.hideMenu());let i=this;e.commandEvent=!1,de.keys().forEach(r=>{r.key===n.keyCode&&(e.commandEvent=!0,e.callbacks()[r.value.toLowerCase()](n,i))})}input(e,n){e.inputEvent=!0,e.keyup.call(this,e,n)}click(e,n){let i=e.tribute;if(i.menu&&i.menu.contains(n.target)){let r=n.target;for(n.preventDefault(),n.stopPropagation();r.nodeName.toLowerCase()!=="li";)if(r=r.parentNode,!r||r===i.menu)throw new Error("cannot find the <li> container for the click");i.selectItemAtIndex(r.getAttribute("data-index"),n),i.hideMenu()}else i.current.element&&!i.current.externalTrigger&&(i.current.externalTrigger=!1,setTimeout(()=>i.hideMenu()))}keyup(e,n){if(e.inputEvent&&(e.inputEvent=!1),e.updateSelection(this),n.keyCode!==27){if(!e.tribute.allowSpaces&&e.tribute.hasTrailingSpace){e.tribute.hasTrailingSpace=!1,e.commandEvent=!0,e.callbacks().space(n,this);return}if(!e.tribute.isActive)if(e.tribute.autocompleteMode)e.callbacks().triggerChar(n,this,"");else{let i=e.getKeyCode(e,this,n);if(isNaN(i)||!i)return;let r=e.tribute.triggers().find(o=>o.charCodeAt(0)===i);typeof r<"u"&&e.callbacks().triggerChar(n,this,r)}e.tribute.current.mentionText.length<e.tribute.current.collection.menuShowMinLength||((e.tribute.current.trigger||e.tribute.autocompleteMode)&&e.commandEvent===!1||e.tribute.isActive&&n.keyCode===8)&&e.tribute.showMenuFor(this,!0)}}shouldDeactivate(e){if(!this.tribute.isActive)return!1;if(this.tribute.current.mentionText.length===0){let n=!1;return de.keys().forEach(i=>{e.keyCode===i.key&&(n=!0)}),!n}return!1}getKeyCode(e,n,i){let r=e.tribute,o=r.range.getTriggerInfo(!1,r.hasTrailingSpace,!0,r.allowSpaces,r.autocompleteMode);return o?o.mentionTriggerChar.charCodeAt(0):!1}updateSelection(e){this.tribute.current.element=e;let n=this.tribute.range.getTriggerInfo(!1,this.tribute.hasTrailingSpace,!0,this.tribute.allowSpaces,this.tribute.autocompleteMode);n&&(this.tribute.current.selectedPath=n.mentionSelectedPath,this.tribute.current.mentionText=n.mentionText,this.tribute.current.selectedOffset=n.mentionSelectedOffset)}callbacks(){return{triggerChar:(e,n,i)=>{let r=this.tribute;r.current.trigger=i;let o=r.collection.find(s=>s.trigger===i);r.current.collection=o,r.current.mentionText.length>=r.current.collection.menuShowMinLength&&r.inputEvent&&r.showMenuFor(n,!0)},enter:(e,n)=>{this.tribute.isActive&&this.tribute.current.filteredItems&&(e.preventDefault(),e.stopPropagation(),setTimeout(()=>{this.tribute.selectItemAtIndex(this.tribute.menuSelected,e),this.tribute.hideMenu()},0))},escape:(e,n)=>{this.tribute.isActive&&(e.preventDefault(),e.stopPropagation(),this.tribute.isActive=!1,this.tribute.hideMenu())},tab:(e,n)=>{this.callbacks().enter(e,n)},space:(e,n)=>{this.tribute.isActive&&(this.tribute.spaceSelectsMatch?this.callbacks().enter(e,n):this.tribute.allowSpaces||(e.stopPropagation(),setTimeout(()=>{this.tribute.hideMenu(),this.tribute.isActive=!1},0)))},up:(e,n)=>{if(this.tribute.isActive&&this.tribute.current.filteredItems){e.preventDefault(),e.stopPropagation();let i=this.tribute.current.filteredItems.length,r=this.tribute.menuSelected;i>r&&r>0?(this.tribute.menuSelected--,this.setActiveLi()):r===0&&(this.tribute.menuSelected=i-1,this.setActiveLi(),this.tribute.menu.scrollTop=this.tribute.menu.scrollHeight)}},down:(e,n)=>{if(this.tribute.isActive&&this.tribute.current.filteredItems){e.preventDefault(),e.stopPropagation();let i=this.tribute.current.filteredItems.length-1,r=this.tribute.menuSelected;i>r?(this.tribute.menuSelected++,this.setActiveLi()):i===r&&(this.tribute.menuSelected=0,this.setActiveLi(),this.tribute.menu.scrollTop=0)}},delete:(e,n)=>{this.tribute.isActive&&this.tribute.current.mentionText.length<1?this.tribute.hideMenu():this.tribute.isActive&&this.tribute.showMenuFor(n)}}}setActiveLi(e){let n=this.tribute.menu.querySelectorAll("li"),i=n.length>>>0;e&&(this.tribute.menuSelected=parseInt(e));for(let r=0;r<i;r++){let o=n[r];if(r===this.tribute.menuSelected){o.classList.add(this.tribute.current.collection.selectClass);let s=o.getBoundingClientRect(),l=this.tribute.menu.getBoundingClientRect();if(s.bottom>l.bottom){let c=s.bottom-l.bottom;this.tribute.menu.scrollTop+=c}else if(s.top<l.top){let c=l.top-s.top;this.tribute.menu.scrollTop-=c}}else o.classList.remove(this.tribute.current.collection.selectClass)}}getFullHeight(e,n){let i=e.getBoundingClientRect().height;if(n){let r=e.currentStyle||window.getComputedStyle(e);return i+parseFloat(r.marginTop)+parseFloat(r.marginBottom)}return i}}class Ln{constructor(e){this.tribute=e,this.tribute.menuEvents=this,this.menu=this.tribute.menu}bind(e){this.menuClickEvent=this.tribute.events.click.bind(null,this),this.menuContainerScrollEvent=this.debounce(()=>{this.tribute.isActive&&this.tribute.showMenuFor(this.tribute.current.element,!1)},300,!1),this.windowResizeEvent=this.debounce(()=>{this.tribute.isActive&&this.tribute.range.positionMenuAtCaret(!0)},300,!1),this.tribute.range.getDocument().addEventListener("MSPointerDown",this.menuClickEvent,!1),this.tribute.range.getDocument().addEventListener("mousedown",this.menuClickEvent,!1),window.addEventListener("resize",this.windowResizeEvent),this.menuContainer?this.menuContainer.addEventListener("scroll",this.menuContainerScrollEvent,!1):window.addEventListener("scroll",this.menuContainerScrollEvent)}unbind(e){this.tribute.range.getDocument().removeEventListener("mousedown",this.menuClickEvent,!1),this.tribute.range.getDocument().removeEventListener("MSPointerDown",this.menuClickEvent,!1),window.removeEventListener("resize",this.windowResizeEvent),this.menuContainer?this.menuContainer.removeEventListener("scroll",this.menuContainerScrollEvent,!1):window.removeEventListener("scroll",this.menuContainerScrollEvent)}debounce(e,n,i){var r;return()=>{var o=this,s=arguments,l=()=>{r=null,i||e.apply(o,s)},c=i&&!r;clearTimeout(r),r=setTimeout(l,n),c&&e.apply(o,s)}}}class Sn{constructor(e){this.tribute=e,this.tribute.range=this}getDocument(){let e;return this.tribute.current.collection&&(e=this.tribute.current.collection.iframe),e?e.contentWindow.document:document}positionMenuAtCaret(e){let n=this.tribute.current,i,r=this.getTriggerInfo(!1,this.tribute.hasTrailingSpace,!0,this.tribute.allowSpaces,this.tribute.autocompleteMode);if(typeof r<"u"){if(!this.tribute.positionMenu){this.tribute.menu.style.cssText="display: block;";return}this.isContentEditable(n.element)?i=this.getContentEditableCaretPosition(r.mentionPosition):i=this.getTextAreaOrInputUnderlinePosition(this.tribute.current.element,r.mentionPosition),this.tribute.menu.style.cssText=`top: ${i.top}px;
                                     left: ${i.left}px;
                                     right: ${i.right}px;
                                     bottom: ${i.bottom}px;
                                     position: absolute;
                                     display: block;`,i.left==="auto"&&(this.tribute.menu.style.left="auto"),i.top==="auto"&&(this.tribute.menu.style.top="auto"),e&&this.scrollIntoView(),window.setTimeout(()=>{let o={width:this.tribute.menu.offsetWidth,height:this.tribute.menu.offsetHeight},s=this.isMenuOffScreen(i,o),l=window.innerWidth>o.width&&(s.left||s.right),c=window.innerHeight>o.height&&(s.top||s.bottom);(l||c)&&(this.tribute.menu.style.cssText="display: none",this.positionMenuAtCaret(e))},0)}else this.tribute.menu.style.cssText="display: none"}get menuContainerIsBody(){return this.tribute.menuContainer===document.body||!this.tribute.menuContainer}selectElement(e,n,i){let r,o=e;if(n)for(var s=0;s<n.length;s++){if(o=o.childNodes[n[s]],o===void 0)return;for(;o.length<i;)i-=o.length,o=o.nextSibling;o.childNodes.length===0&&!o.length&&(o=o.previousSibling)}let l=this.getWindowSelection();r=this.getDocument().createRange(),r.setStart(o,i),r.setEnd(o,i),r.collapse(!0);try{l.removeAllRanges()}catch{}l.addRange(r),e.focus()}replaceTriggerText(e,n,i,r,o){let s=this.getTriggerInfo(!0,i,n,this.tribute.allowSpaces,this.tribute.autocompleteMode);if(s!==void 0){let l=this.tribute.current,c=new CustomEvent("tribute-replaced",{detail:{item:o,instance:l,context:s,event:r}});if(this.isContentEditable(l.element)){let d=typeof this.tribute.replaceTextSuffix=="string"?this.tribute.replaceTextSuffix:" ";e+=d;let u=s.mentionPosition+s.mentionText.length;this.tribute.autocompleteMode||(u+=s.mentionTriggerChar.length),this.pasteHtml(e,s.mentionPosition,u)}else{let d=this.tribute.current.element,u=typeof this.tribute.replaceTextSuffix=="string"?this.tribute.replaceTextSuffix:" ";e+=u;let h=s.mentionPosition,p=s.mentionPosition+s.mentionText.length+u.length;this.tribute.autocompleteMode||(p+=s.mentionTriggerChar.length-1),d.value=d.value.substring(0,h)+e+d.value.substring(p,d.value.length),d.selectionStart=h+e.length,d.selectionEnd=h+e.length}l.element.dispatchEvent(new CustomEvent("input",{bubbles:!0})),l.element.dispatchEvent(c)}}pasteHtml(e,n,i){let r,o;o=this.getWindowSelection(),r=this.getDocument().createRange(),r.setStart(o.anchorNode,n),r.setEnd(o.anchorNode,i),r.deleteContents();let s=this.getDocument().createElement("div");s.innerHTML=e;let l=this.getDocument().createDocumentFragment(),c,d;for(;c=s.firstChild;)d=l.appendChild(c);r.insertNode(l),d&&(r=r.cloneRange(),r.setStartAfter(d),r.collapse(!0),o.removeAllRanges(),o.addRange(r))}getWindowSelection(){return this.tribute.collection.iframe?this.tribute.collection.iframe.contentWindow.getSelection():window.getSelection()}getNodePositionInParent(e){if(e.parentNode===null)return 0;for(var n=0;n<e.parentNode.childNodes.length;n++)if(e.parentNode.childNodes[n]===e)return n}getContentEditableSelectedPath(e){let n=this.getWindowSelection(),i=n.anchorNode,r=[],o;if(i!=null){let s,l=i.contentEditable;for(;i!==null&&l!=="true";)s=this.getNodePositionInParent(i),r.push(s),i=i.parentNode,i!==null&&(l=i.contentEditable);return r.reverse(),o=n.getRangeAt(0).startOffset,{selected:i,path:r,offset:o}}}getTextPrecedingCurrentSelection(){let e=this.tribute.current,n="";if(this.isContentEditable(e.element)){let i=this.getWindowSelection().anchorNode;if(i!=null){let r=i.textContent,o=this.getWindowSelection().getRangeAt(0).startOffset;r&&o>=0&&(n=r.substring(0,o))}}else{let i=this.tribute.current.element;if(i){let r=i.selectionStart;i.value&&r>=0&&(n=i.value.substring(0,r))}}return n}getLastWordInText(e){e=e.replace(/\u00A0/g," ");let n=e.split(/\s+/),i=n.length-1;return n[i].trim()}getTriggerInfo(e,n,i,r,o){let s=this.tribute.current,l,c,d;if(!this.isContentEditable(s.element))l=this.tribute.current.element;else{let p=this.getContentEditableSelectedPath(s);p&&(l=p.selected,c=p.path,d=p.offset)}let u=this.getTextPrecedingCurrentSelection(),h=this.getLastWordInText(u);if(o)return{mentionPosition:u.length-h.length,mentionText:h,mentionSelectedElement:l,mentionSelectedPath:c,mentionSelectedOffset:d};if(u!=null){let p=-1,v;if(this.tribute.collection.forEach(L=>{let T=L.trigger,S=L.requireLeadingSpace?this.lastIndexWithLeadingSpace(u,T):u.lastIndexOf(T);S>p&&(p=S,v=T,i=L.requireLeadingSpace)}),p>=0&&(p===0||!i||/[\xA0\s]/g.test(u.substring(p-1,p)))){let L=u.substring(p+v.length,u.length);v=u.substring(p,p+v.length);let T=L.substring(0,1),S=L.length>0&&(T===" "||T===" ");n&&(L=L.trim());let M=r?/[^\S ]/g:/[\xA0\s]/g;if(this.tribute.hasTrailingSpace=M.test(L),!S&&(e||!M.test(L)))return{mentionPosition:p,mentionText:L,mentionSelectedElement:l,mentionSelectedPath:c,mentionSelectedOffset:d,mentionTriggerChar:v}}}}lastIndexWithLeadingSpace(e,n){let i=e.split("").reverse().join(""),r=-1;for(let o=0,s=e.length;o<s;o++){let l=o===e.length-1,c=/\s/.test(i[o+1]),d=!0;for(let u=n.length-1;u>=0;u--)if(n[u]!==i[o-u]){d=!1;break}if(d&&(l||c)){r=e.length-1-o;break}}return r}isContentEditable(e){return e.nodeName!=="INPUT"&&e.nodeName!=="TEXTAREA"}isMenuOffScreen(e,n){let i=window.innerWidth,r=window.innerHeight,o=document.documentElement,s=(window.pageXOffset||o.scrollLeft)-(o.clientLeft||0),l=(window.pageYOffset||o.scrollTop)-(o.clientTop||0),c=typeof e.top=="number"?e.top:l+r-e.bottom-n.height,d=typeof e.right=="number"?e.right:e.left+n.width,u=typeof e.bottom=="number"?e.bottom:e.top+n.height,h=typeof e.left=="number"?e.left:s+i-e.right-n.width;return{top:c<Math.floor(l),right:d>Math.ceil(s+i),bottom:u>Math.ceil(l+r),left:h<Math.floor(s)}}getMenuDimensions(){let e={width:null,height:null};return this.tribute.menu.style.cssText=`top: 0px;
                                 left: 0px;
                                 position: fixed;
                                 display: block;
                                 visibility; hidden;`,e.width=this.tribute.menu.offsetWidth,e.height=this.tribute.menu.offsetHeight,this.tribute.menu.style.cssText="display: none;",e}getTextAreaOrInputUnderlinePosition(e,n,i){let r=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing"],o=window.mozInnerScreenX!==null,s=this.getDocument().createElement("div");s.id="input-textarea-caret-position-mirror-div",this.getDocument().body.appendChild(s);let l=s.style,c=window.getComputedStyle?getComputedStyle(e):e.currentStyle;l.whiteSpace="pre-wrap",e.nodeName!=="INPUT"&&(l.wordWrap="break-word"),l.position="absolute",l.visibility="hidden",r.forEach(N=>{l[N]=c[N]}),o?(l.width=`${parseInt(c.width)-2}px`,e.scrollHeight>parseInt(c.height)&&(l.overflowY="scroll")):l.overflow="hidden",s.textContent=e.value.substring(0,n),e.nodeName==="INPUT"&&(s.textContent=s.textContent.replace(/\s/g," "));let d=this.getDocument().createElement("span");d.textContent=e.value.substring(n)||".",s.appendChild(d);let u=e.getBoundingClientRect(),h=document.documentElement,p=(window.pageXOffset||h.scrollLeft)-(h.clientLeft||0),v=(window.pageYOffset||h.scrollTop)-(h.clientTop||0),L=0,T=0;this.menuContainerIsBody&&(L=u.top,T=u.left);let S={top:L+v+d.offsetTop+parseInt(c.borderTopWidth)+parseInt(c.fontSize)-e.scrollTop,left:T+p+d.offsetLeft+parseInt(c.borderLeftWidth)},M=window.innerWidth,C=window.innerHeight,P=this.getMenuDimensions(),j=this.isMenuOffScreen(S,P);j.right&&(S.right=M-S.left,S.left="auto");let K=this.tribute.menuContainer?this.tribute.menuContainer.offsetHeight:this.getDocument().body.offsetHeight;if(j.bottom){let N=this.tribute.menuContainer?this.tribute.menuContainer.getBoundingClientRect():this.getDocument().body.getBoundingClientRect(),E=K-(C-N.top);S.bottom=E+(C-u.top-d.offsetTop),S.top="auto"}return j=this.isMenuOffScreen(S,P),j.left&&(S.left=M>P.width?p+M-P.width:p,delete S.right),j.top&&(S.top=C>P.height?v+C-P.height:v,delete S.bottom),this.getDocument().body.removeChild(s),S}getContentEditableCaretPosition(e){let n,i=this.getWindowSelection();n=this.getDocument().createRange(),n.setStart(i.anchorNode,e),n.setEnd(i.anchorNode,e),n.collapse(!1);let r=n.getBoundingClientRect(),o=document.documentElement,s=(window.pageXOffset||o.scrollLeft)-(o.clientLeft||0),l=(window.pageYOffset||o.scrollTop)-(o.clientTop||0),c=r.left,d=r.top,u={left:c+s,top:d+r.height+l},h=window.innerWidth,p=window.innerHeight,v=this.getMenuDimensions(),L=this.isMenuOffScreen(u,v);L.right&&(u.left="auto",u.right=h-r.left-s);let T=this.tribute.menuContainer?this.tribute.menuContainer.offsetHeight:this.getDocument().body.offsetHeight;if(L.bottom){let S=this.tribute.menuContainer?this.tribute.menuContainer.getBoundingClientRect():this.getDocument().body.getBoundingClientRect(),M=T-(p-S.top);u.top="auto",u.bottom=M+(p-r.top)}return L=this.isMenuOffScreen(u,v),L.left&&(u.left=h>v.width?s+h-v.width:s,delete u.right),L.top&&(u.top=p>v.height?l+p-v.height:l,delete u.bottom),this.menuContainerIsBody||(u.left=u.left?u.left-this.tribute.menuContainer.offsetLeft:u.left,u.top=u.top?u.top-this.tribute.menuContainer.offsetTop:u.top),u}scrollIntoView(e){let n=20,i,r=100,o=this.menu;if(typeof o>"u")return;for(;i===void 0||i.height===0;)if(i=o.getBoundingClientRect(),i.height===0&&(o=o.childNodes[0],o===void 0||!o.getBoundingClientRect))return;let s=i.top,l=s+i.height;if(s<0)window.scrollTo(0,window.pageYOffset+i.top-n);else if(l>window.innerHeight){let c=window.pageYOffset+i.top-n;c-window.pageYOffset>r&&(c=window.pageYOffset+r);let d=window.pageYOffset-(window.innerHeight-l);d>c&&(d=c),window.scrollTo(0,d)}}}class En{constructor(e){this.tribute=e,this.tribute.search=this}simpleFilter(e,n){return n.filter(i=>this.test(e,i))}test(e,n){return this.match(e,n)!==null}match(e,n,i){i=i||{},n.length;let r=i.pre||"",o=i.post||"",s=i.caseSensitive&&n||n.toLowerCase();if(i.skip)return{rendered:n,score:0};e=i.caseSensitive&&e||e.toLowerCase();let l=this.traverse(s,e,0,0,[]);return l?{rendered:this.render(n,l.cache,r,o),score:l.score}:null}traverse(e,n,i,r,o){if(n.length===r)return{score:this.calculateScore(o),cache:o.slice()};if(e.length===i||n.length-r>e.length-i)return;let s=n[r],l=e.indexOf(s,i),c,d;for(;l>-1;){if(o.push(l),d=this.traverse(e,n,l+1,r+1,o),o.pop(),!d)return c;(!c||c.score<d.score)&&(c=d),l=e.indexOf(s,l+1)}return c}calculateScore(e){let n=0,i=1;return e.forEach((r,o)=>{o>0&&(e[o-1]+1===r?i+=i+1:i=1),n+=i}),n}render(e,n,i,r){var o=e.substring(0,n[0]);return n.forEach((s,l)=>{o+=i+e[s]+r+e.substring(s+1,n[l+1]?n[l+1]:e.length)}),o}filter(e,n,i){return i=i||{},n.reduce((r,o,s,l)=>{let c=o;i.extract&&(c=i.extract(o),c||(c=""));let d=this.match(e,c,i);return d!=null&&(r[r.length]={string:d.rendered,score:d.score,index:s,original:o}),r},[]).sort((r,o)=>{let s=o.score-r.score;return s||r.index-o.index})}}class G{constructor({values:e=null,iframe:n=null,selectClass:i="highlight",containerClass:r="tribute-container",itemClass:o="",trigger:s="@",autocompleteMode:l=!1,selectTemplate:c=null,menuItemTemplate:d=null,lookup:u="key",fillAttr:h="value",collection:p=null,menuContainer:v=null,noMatchTemplate:L=null,requireLeadingSpace:T=!0,allowSpaces:S=!1,replaceTextSuffix:M=null,positionMenu:C=!0,spaceSelectsMatch:P=!1,searchOpts:j={},menuItemLimit:K=null,menuShowMinLength:N=0}){if(this.autocompleteMode=l,this.menuSelected=0,this.current={},this.inputEvent=!1,this.isActive=!1,this.menuContainer=v,this.allowSpaces=S,this.replaceTextSuffix=M,this.positionMenu=C,this.hasTrailingSpace=!1,this.spaceSelectsMatch=P,this.autocompleteMode&&(s="",S=!1),e)this.collection=[{trigger:s,iframe:n,selectClass:i,containerClass:r,itemClass:o,selectTemplate:(c||G.defaultSelectTemplate).bind(this),menuItemTemplate:(d||G.defaultMenuItemTemplate).bind(this),noMatchTemplate:(E=>typeof E=="string"?E.trim()===""?null:E:typeof E=="function"?E.bind(this):L||(function(){return"<li>No Match Found!</li>"}).bind(this))(L),lookup:u,fillAttr:h,values:e,requireLeadingSpace:T,searchOpts:j,menuItemLimit:K,menuShowMinLength:N}];else if(p)this.autocompleteMode&&console.warn("Tribute in autocomplete mode does not work for collections"),this.collection=p.map(E=>({trigger:E.trigger||s,iframe:E.iframe||n,selectClass:E.selectClass||i,containerClass:E.containerClass||r,itemClass:E.itemClass||o,selectTemplate:(E.selectTemplate||G.defaultSelectTemplate).bind(this),menuItemTemplate:(E.menuItemTemplate||G.defaultMenuItemTemplate).bind(this),noMatchTemplate:(B=>typeof B=="string"?B.trim()===""?null:B:typeof B=="function"?B.bind(this):L||(function(){return"<li>No Match Found!</li>"}).bind(this))(L),lookup:E.lookup||u,fillAttr:E.fillAttr||h,values:E.values,requireLeadingSpace:E.requireLeadingSpace,searchOpts:E.searchOpts||j,menuItemLimit:E.menuItemLimit||K,menuShowMinLength:E.menuShowMinLength||N}));else throw new Error("[Tribute] No collection specified.");new Sn(this),new de(this),new Ln(this),new En(this)}get isActive(){return this._isActive}set isActive(e){if(this._isActive!=e&&(this._isActive=e,this.current.element)){let n=new CustomEvent(`tribute-active-${e}`);this.current.element.dispatchEvent(n)}}static defaultSelectTemplate(e){return typeof e>"u"?`${this.current.collection.trigger}${this.current.mentionText}`:this.range.isContentEditable(this.current.element)?'<span class="tribute-mention">'+(this.current.collection.trigger+e.original[this.current.collection.fillAttr])+"</span>":this.current.collection.trigger+e.original[this.current.collection.fillAttr]}static defaultMenuItemTemplate(e){return e.string}static inputTypes(){return["TEXTAREA","INPUT"]}triggers(){return this.collection.map(e=>e.trigger)}attach(e){if(!e)throw new Error("[Tribute] Must pass in a DOM node or NodeList.");if(typeof jQuery<"u"&&e instanceof jQuery&&(e=e.get()),e.constructor===NodeList||e.constructor===HTMLCollection||e.constructor===Array){let i=e.length;for(var n=0;n<i;++n)this._attach(e[n])}else this._attach(e)}_attach(e){e.hasAttribute("data-tribute")&&console.warn("Tribute was already bound to "+e.nodeName),this.ensureEditable(e),this.events.bind(e),e.setAttribute("data-tribute",!0)}ensureEditable(e){if(G.inputTypes().indexOf(e.nodeName)===-1)if(e.contentEditable)e.contentEditable=!0;else throw new Error("[Tribute] Cannot bind to "+e.nodeName)}createMenu(e){let n=this.range.getDocument().createElement("div"),i=this.range.getDocument().createElement("ul");return n.className=e,n.appendChild(i),this.menuContainer?this.menuContainer.appendChild(n):this.range.getDocument().body.appendChild(n)}showMenuFor(e,n){if(this.isActive&&this.current.element===e&&this.current.mentionText===this.currentMentionTextSnapshot)return;this.currentMentionTextSnapshot=this.current.mentionText,this.menu||(this.menu=this.createMenu(this.current.collection.containerClass),e.tributeMenu=this.menu,this.menuEvents.bind(this.menu)),this.isActive=!0,this.menuSelected=0,this.current.mentionText||(this.current.mentionText="");const i=r=>{if(!this.isActive)return;let o=this.search.filter(this.current.mentionText,r,{pre:this.current.collection.searchOpts.pre||"<span>",post:this.current.collection.searchOpts.post||"</span>",skip:this.current.collection.searchOpts.skip,extract:c=>{if(typeof this.current.collection.lookup=="string")return c[this.current.collection.lookup];if(typeof this.current.collection.lookup=="function")return this.current.collection.lookup(c,this.current.mentionText);throw new Error("Invalid lookup attribute, lookup must be string or function.")}});this.current.collection.menuItemLimit&&(o=o.slice(0,this.current.collection.menuItemLimit)),this.current.filteredItems=o;let s=this.menu.querySelector("ul");if(this.range.positionMenuAtCaret(n),!o.length){let c=new CustomEvent("tribute-no-match",{detail:this.menu});this.current.element.dispatchEvent(c),typeof this.current.collection.noMatchTemplate=="function"&&!this.current.collection.noMatchTemplate()||!this.current.collection.noMatchTemplate?this.hideMenu():typeof this.current.collection.noMatchTemplate=="function"?s.innerHTML=this.current.collection.noMatchTemplate():s.innerHTML=this.current.collection.noMatchTemplate;return}s.innerHTML="";let l=this.range.getDocument().createDocumentFragment();o.forEach((c,d)=>{let u=this.range.getDocument().createElement("li");u.setAttribute("data-index",d),u.className=this.current.collection.itemClass,u.addEventListener("mousemove",h=>{let[p,v]=this._findLiTarget(h.target);h.movementY!==0&&this.events.setActiveLi(v)}),this.menuSelected===d&&u.classList.add(this.current.collection.selectClass),u.innerHTML=this.current.collection.menuItemTemplate(c),l.appendChild(u)}),s.appendChild(l)};typeof this.current.collection.values=="function"?this.current.collection.values(this.current.mentionText,i):i(this.current.collection.values)}_findLiTarget(e){if(!e)return[];const n=e.getAttribute("data-index");return n?[e,n]:this._findLiTarget(e.parentNode)}showMenuForCollection(e,n){e!==document.activeElement&&this.placeCaretAtEnd(e),this.current.collection=this.collection[n||0],this.current.externalTrigger=!0,this.current.element=e,e.isContentEditable?this.insertTextAtCursor(this.current.collection.trigger):this.insertAtCaret(e,this.current.collection.trigger),this.showMenuFor(e)}placeCaretAtEnd(e){if(e.focus(),typeof window.getSelection<"u"&&typeof document.createRange<"u"){var n=document.createRange();n.selectNodeContents(e),n.collapse(!1);var i=window.getSelection();i.removeAllRanges(),i.addRange(n)}else if(typeof document.body.createTextRange<"u"){var r=document.body.createTextRange();r.moveToElementText(e),r.collapse(!1),r.select()}}insertTextAtCursor(e){var n,i;n=window.getSelection(),i=n.getRangeAt(0),i.deleteContents();var r=document.createTextNode(e);i.insertNode(r),i.selectNodeContents(r),i.collapse(!1),n.removeAllRanges(),n.addRange(i)}insertAtCaret(e,n){var i=e.scrollTop,r=e.selectionStart,o=e.value.substring(0,r),s=e.value.substring(e.selectionEnd,e.value.length);e.value=o+n+s,r=r+n.length,e.selectionStart=r,e.selectionEnd=r,e.focus(),e.scrollTop=i}hideMenu(){this.menu&&(this.menu.style.cssText="display: none;",this.isActive=!1,this.menuSelected=0,this.current={})}selectItemAtIndex(e,n){if(e=parseInt(e),typeof e!="number"||isNaN(e))return;let i=this.current.filteredItems[e],r=this.current.collection.selectTemplate(i);r!==null&&this.replaceText(r,n,i)}replaceText(e,n,i){this.range.replaceTriggerText(e,!0,!0,n,i)}_append(e,n,i){if(typeof e.values=="function")throw new Error("Unable to append to values, as it is a function.");i?e.values=n:e.values=e.values.concat(n)}append(e,n,i){let r=parseInt(e);if(typeof r!="number")throw new Error("please provide an index for the collection to update.");let o=this.collection[r];this._append(o,n,i)}appendCurrent(e,n){if(this.isActive)this._append(this.current.collection,e,n);else throw new Error("No active state. Please use append instead and pass an index.")}detach(e){if(!e)throw new Error("[Tribute] Must pass in a DOM node or NodeList.");if(typeof jQuery<"u"&&e instanceof jQuery&&(e=e.get()),e.constructor===NodeList||e.constructor===HTMLCollection||e.constructor===Array){let i=e.length;for(var n=0;n<i;++n)this._detach(e[n])}else this._detach(e)}_detach(e){this.events.unbind(e),e.tributeMenu&&this.menuEvents.unbind(e.tributeMenu),setTimeout(()=>{e.removeAttribute("data-tribute"),this.isActive=!1,e.tributeMenu&&e.tributeMenu.remove()})}}function _n(){const t=".kanka-mentions",e=document.querySelector(t);if(!e)return;const n=e.dataset.remote,i=new G({values:function(s,l){o(s,c=>l(c))},lookup:"name",menuShowMinLength:3,selectTemplate:function(s){return"["+s.original.model_type+":"+s.original.id+"]"},noMatchTemplate:function(){return null}});document.querySelectorAll(t).forEach(s=>{s.dataset.mentions!=="1"&&(s.dataset.mentions=1,i.attach(s))});function o(s,l){let c=new XMLHttpRequest;c.onreadystatechange=function(){if(c.readyState===4)if(c.status===200){let u=JSON.parse(c.responseText);l(u)}else c.status===403&&l([])};let d=n+"?q="+s;c.open("GET",d,!0),c.send()}}const xt=()=>{document.querySelectorAll("form[data-shortcut]").forEach(function(e){Tn(e)})},kt=()=>{document.addEventListener("keydown",function(t){const e=t.target,n=document.getElementById("primary-dialog"),i=document.querySelector(".quick-creator-button");let r=document.querySelector('[data-keyboard="edit"]');if(t.key==="]"){if(ce(e))return;t.preventDefault();const o=document.querySelector(".sidebar-toggle");o.click(),o.blur()}else if(t.key==="k"){if(ce(e))return;t.preventDefault(),document.getElementById("entity-lookup").focus()}else if(t.key==="n"&&!(t.ctrlKey||t.metaKey)&&!t.altKey&&i){if(ce(e)||n?.open)return;i.click()}else if(t.key==="e"&&!(t.ctrlKey||t.metaKey)&&r){if(ce(e)||n?.open)return;r.click()}else t.key==="Escape"&&n?.classList.contains("qq-modal-selection").length===1&&window.closeDialog(n)})},ce=t=>!t||t.length===0?!1:["input","textarea","select"].includes(t.tagName.toLowerCase())||t.getAttribute("contentEditable")==="true"?!0:!!t.classList.contains("CodeMirror"),Tn=t=>{t.dataset.shortcutInit||(t.dataset.shortcutInit=1,document.addEventListener("keydown",function(e){if((e.ctrlKey||e.metaKey)&&e.key.toLowerCase()==="s")return e.preventDefault(),t.dataset.unload&&(window.entityFormHasUnsavedChanges=!1),e.shiftKey?be("submit-update"):e.altKey&&be("submit-new"),t.requestSubmit(),console.log("requested tos ubmit",t),!1;if((e.ctrlKey||e.metaKey)&&e.altKey&&e.key==="c")return t.dataset.unload&&(window.entityFormHasUnsavedChanges=!1),be("submit-copy"),t.submit(),!1}))},be=t=>{const e=document.getElementById("form-submit-main");e&&(e.name=t,document.getElementById("submit-mode").name=t)},Lt=()=>{document.querySelectorAll('input[data-paste="fontawesome"]').forEach(function(e){e.addEventListener("paste",function(n){n.preventDefault();const i=(n.clipboardData||window.clipboardData).getData("text");if(i.startsWith('<i class="fa')||i.startsWith('<i class="ra')){const r=document.createElement("div");r.innerHTML=i;let s=r.querySelector("i").getAttribute("class");if(s){e.value=s;return}}e.value=i})})};xt();kt();Lt();window.onEvent(function(){Lt(),kt(),xt()});function qn(){window.onEvent(function(){St()})}function Cn(){const t=document.querySelector('#form-entry input[name="name"]');t&&(t.dataset.liveDisabled||t.addEventListener("focusout",function(e){if(!t.value)return;const n=this.dataset.duplicate,i=document.querySelector(n);if(!i)return;const r=this.dataset.live+"?q="+encodeURIComponent(this.value)+"&exclude="+this.dataset.id;i.classList.add("hidden");const o=i.querySelector(".duplicates");fetch(r).then(s=>s.json()).then(s=>{o.innerHTML="",s.forEach(l=>{const c=document.createElement("a");c.href=l.url,c.text=l.name,o.appendChild(c)}),s.length>0&&i.classList.remove("hidden")})}))}const St=()=>{const t=document.querySelectorAll(".form-submit-actions");if(t.length===0)return;let e=document.getElementById("form-submit-main"),n=document.getElementById("submit-mode");if(n===void 0)throw new Error("No submit mode hidden input found");t.forEach(i=>{i.addEventListener("click",function(r){return r.preventDefault(),n.name=i.dataset.action,e.click(),!1})})};function Mn(){if(document.querySelectorAll('form[data-unload="1"]').length===0)return;const e=document.querySelector("#form-submit-main");document.querySelectorAll('form[data-unload="1"] input, form[data-unload="1"] select, form[data-unload="1"] textarea').forEach(i=>{i.dataset.skipUnsaved||i.classList.contains("form-control")||(i.addEventListener("change",function(){window.entityFormHasUnsavedChanges=!0}),i.classList.contains("select2")&&(i.onchange=()=>{window.entityFormHasUnsavedChanges=!0}))}),e&&window.addEventListener("beforeunload",function(i){window.entityFormHasUnsavedChanges&&(i.preventDefault(),i.returnValue="Unsaved data warning")})}const An=()=>{document.querySelectorAll(".dynamic-row-add").forEach(e=>{e.addEventListener("click",function(n){n.preventDefault();const i=e.dataset.target,r=e.dataset.template,o=document.createElement("div");return o.innerHTML=document.querySelector("#"+r).innerHTML,document.querySelector("."+i).append(o),ut(),window.triggerEvent(),!1})}),ut()},ut=()=>{document.querySelectorAll(".dynamic-row-delete").forEach(e=>{e.dataset.init!==1&&(e.dataset.init=1,e.addEventListener("click",function(n){n.preventDefault(),e.closest(".parent-delete-row").remove()}),e.addEventListener("keydown",function(n){n.key==="Enter"&&e.click()}))})};An();St();Mn();qn();Cn();const Et=()=>{document.querySelector(".btn-post-collapse")?.addEventListener("click",function(n){n.preventDefault(),document.querySelectorAll(".element-toggle").forEach(r=>{r.classList.add("animate-collapsed"),document.querySelector(r.dataset.target).classList.add("hidden")})}),document.querySelector(".btn-post-expand")?.addEventListener("click",function(n){n.preventDefault(),document.querySelectorAll(".element-toggle").forEach(r=>{r.classList.remove("animate-collapsed"),document.querySelector(r.dataset.target).classList.remove("hidden")})})},_t=()=>{const t=document.querySelector(".story-load-more");t?.addEventListener("click",function(e){return e.preventDefault(),this.classList.add("loading"),axios.get(this.dataset.url).then(n=>{t.parentNode.remove(),console.log(n),document.querySelector(".entity-posts").insertAdjacentHTML("beforeend",n.data),_t(),Et(),window.triggerEvent()}).catch(()=>{t.classList.remove("loading")}),!1})},In=()=>{const t=document.querySelector(".domain-trust");t&&t.addEventListener("click",function(e){const n="kanka_trusted_domains";let i=document.cookie.match("(^|;) ?"+n+"=([^;]*)(;|$)");i=i?i[2]:"";const r=t.dataset.domain;i.includes(r)||(i&&(i+="|"),i+=r);let o=new Date;o.setTime(o.getTime()+30*24*60*60*1e3),document.cookie=n+"="+i+";path=/;expires="+o.toUTCString()+";sameSite=Strict"})},Dn=()=>{let t=window.location.hash.substring(1);if(!t)return;let e=document.getElementById(t);if(e)return;let n=document.getElementById("post-anchor-loader");if(!n)return;let i=t.match(/\d+$/),r=n.dataset.url.replace("/0","/"+i);axios.get(r).then(o=>{n.insertAdjacentHTML("afterbegin",o.data),e=document.getElementById(t),window.scrollTo({top:e.offsetTop,behavior:"smooth"})})};Et();_t();In();Dn();const Tt=document.querySelectorAll(".post-perm-add"),Hn=()=>{window.onEvent(function(){$n()}),Tt.length!==0&&(Pn(),qt())},Pn=()=>{Tt.forEach(t=>{t.addEventListener("click",function(e){e.preventDefault();let n=this.dataset.type,i=document.querySelector('select[name="'+n+'"]');if(!i||!i.selectedOptions)return!1;let r=document.getElementById(this.dataset.template);for(const s of i.selectedOptions){const l=r.cloneNode(!0);l.classList.remove("hidden"),l.removeAttribute("id"),l.innerHTML=l.innerHTML.replace(/\$SELECTEDID\$/g,s.value).replace(/\$SELECTEDNAME\$/g,s.text),document.getElementById("post-perm-target").insertAdjacentElement("beforebegin",l)}document.getElementById(this.dataset.dialog).close(),qt();for(const s of i.options)s.selected=!1;return i.value=null,i.dispatchEvent(new Event("change")),!1})})},qt=()=>{document.querySelectorAll(".post-delete-perm").forEach(e=>{e.closest(".hidden")||e.dataset.init!=="1"&&(e.dataset.init="1",e.addEventListener("click",function(n){console.log("clicking",e,e.closest(".perm-row")),e.closest(".perm-row").remove(),n.preventDefault()}))})},$n=()=>{const t=document.querySelector("form.post-visibility");t&&(t.onsubmit=function(e){return e.preventDefault(),axios.post(this.getAttribute("action"),{visibility_id:this.querySelector('[name="visibility_id"]').value}).then(n=>{document.getElementById("primary-dialog").close(),document.getElementById("visibility-icon-"+n.data.post_id).firstElementChild.className=n.data.icon.class,window.showToast(n.data.toast)}),!1})};Hn();const jn=()=>{let t=document.getElementById("post-layout-selector");if(!t)return;const e=document.querySelector(".field-entry"),n=document.querySelector(".field-location"),i=document.querySelector(".field-display"),r=document.querySelector("#post-layout-subform");t.addEventListener("change",function(o){o.preventDefault(),this.value===""?(e.style.removeProperty("display"),e.style.removeProperty("display"),i.style.removeProperty("display"),r.style.display="none"):(e.style.display="none",n.style.display="none",i.style.display="none",r.style.removeProperty("display"))})};jn();const Rn=()=>{if(!document.querySelector("#calendar-year-switcher"))return;document.querySelectorAll(".calendar-event-block").forEach(e=>{e.dataset.toggle!=="dialog"&&e.dataset.url&&e.addEventListener("click",function(){window.location=e.dataset.url})}),document.querySelectorAll("[data-dbclick]").forEach(function(e){e.addEventListener("dblclick",function(){window.openDialog("primary-dialog",e.dataset.url)})})},Ct=()=>{const t=document.querySelector('select[name="recurring_periodicity"]');t&&(t.onchange=function(){const e=document.querySelector(".field-recurring-until");t.value?e.classList.remove("hidden"):e.classList.add("hidden")})},Nn=()=>{document.querySelector('[data-shortcut="previous"]')&&document.addEventListener("keydown",function(t){if((t.ctrlKey||t.metaKey)&&t.which===37){const e=document.querySelector('[data-shortcut="previous"]');e.classList.add("loading"),e.click()}else if((t.ctrlKey||t.metaKey)&&t.which===39){const e=document.querySelector('[data-shortcut="next"]');e.classList.add("loading"),e.click()}})};Rn();Nn();document.querySelector('select[name="recurring_periodicity"]')&&Ct();window.onEvent(function(){Ct()});let ie,H,we,X,V,F,dt,fe,Z;window.onEvent(function(){On()});const Bn=()=>{ie=document.querySelector("#entity-calendar-form-add"),H=document.querySelector('select[name="calendar_id"]'),we=document.querySelector('[name="calendar_id"]'),document.querySelector(".entity-calendar-modal-form"),Z=document.querySelector(".entity-calendar-subform"),dt=document.querySelector("#entity-calendar-form-cancel"),document.querySelector(".entity-calendar-form"),V=document.querySelector('input[name="calendar_year"]'),X=document.querySelector('[name="calendar_month"]'),F=document.querySelector("#reminder_day"),fe=document.querySelector(".entity-calendar-loading"),ie&&(ie.addEventListener("click",function(t){t.preventDefault();let e=ie.dataset.defaultCalendar;return e&&(we.value=e,Z.classList.remove("hidden"),me(e)),!1}),dt.addEventListener("click",function(t){t.preventDefault(),H&&(H.value=null),we.value=null})),H&&(H.onchange=t=>{if(console.log("hello mlord"),!H.value)return Z.classList.add("hidden"),!1;Z.classList.remove("hidden"),V=document.querySelector('input[name="calendar_year"]'),X=document.querySelector('[name="calendar_month"]'),F=document.querySelector("#reminder_day"),!V&&document.querySelector('input[name="year"]')&&(V=document.querySelector('input[name="year"]'),X=document.querySelector('select[name="month"]'),F=document.querySelector("#reminder_day")),me(H.value)}),Mt()},On=()=>{if(!document.getElementById("entity-calendar-modal-add"))return;ie=document.querySelector("input[name=calendar-data-url]"),H=document.querySelector('[name="calendar_id"]'),V=document.querySelector('input[name="year"]'),X=document.querySelector('select[name="month"]'),F=document.querySelector("#reminder_day"),fe=document.querySelector(".entity-calendar-loading"),Z=document.querySelector(".entity-calendar-subform"),H&&(H.onchange=e=>{if(!H.value){Z.classList.add("hidden");return}me(H.value),Z.classList.remove("hidden")},H?.value&&me(H.value));const t=document.querySelector('.entity-calendar-subform input[name="length"]');t&&t.addEventListener("focusout",function(){if(!this.value)return;const e=this.dataset.url.replace("/0/","/"+H.value+"/"),n={day:F.value,month:X.value,year:V.value,length:this.value};axios.get(e,{data:n}).then(i=>{const r=document.querySelector(".length-warning");i.data.overflow==!0?r.classList.remove("hidden"):r.classList.add("hidden")})}),Mt()},me=t=>{fe.classList.remove("hidden"),t=parseInt(t);const e=document.querySelector('input[name="calendar-data-url"]').dataset.url.replace("/0/","/"+t+"/");fetch(e).then(n=>n.json()).then(n=>{let i=F.value;V.innerHTML="",X.innerHTML="",F.innerHTML="";let r=1,o=1;i||(i=n.current.day);let s=parseInt(n.current.month);Object.entries(n.months).forEach((u,h)=>{const p=document.createElement("option");p.text=u[1].name,p.value=h+1,u[0]===s&&(p.selected=!0),p.dataset.length=u[1].length,X.appendChild(p),r===s&&(o=u[1].length),r++});for(let u=1;u<=o;u++){const h=document.createElement("option");h.text=u,h.value=u,u==i&&(h.selected=!0),F.appendChild(h)}fe.classList.add("hidden"),V.value=n.current.year;const c=document.querySelector("select.reminder-periodicity");for(;c.options.length>0;)c.options.remove(0);Object.entries(n.recurring).forEach((u,h)=>{const p=document.createElement("option");p.value=u[0],p.text=u[1],c.appendChild(p)}),document.querySelector("#reminder_length").value=1,n.length===1&&(X.value=n[0].id)})},Mt=()=>{const t=document.querySelector("#reminder_month");t&&t.addEventListener("change",function(e){const i=t.options[t.selectedIndex].dataset.length;Fn(i)})},Fn=t=>{let e=parseInt(F.value);t=parseInt(t),e>t&&(e=t),F.innerHTML="";for(let n=1;n<=t;n++){const i=document.createElement("option");i.text=n,i.value=n,n===e&&(i.selected=!0),F.appendChild(i)}};Bn();const At=document.querySelector("dialog#edit-warning"),_e=300*1e3;let Qn=document.querySelector('input[name="edit-warning"]'),It,Te=!0;const zn=()=>{At&&(window.openDialog("edit-warning",Qn.dataset.url),window.onEvent(function(){Un()}),Kn())};function Un(){Te=!1;const t=document.getElementById("entity-edit-warning-ignore");t.addEventListener("click",function(e){e.preventDefault(),Te=!0,axios.post(t.dataset.url).then(()=>{At.close()})})}const Kn=()=>{const t=document.getElementById("editing-keep-alive");t&&(It=t.dataset.url,setTimeout(qe,_e))},qe=()=>{if(!Te){setTimeout(qe,_e);return}axios.post(It).then(()=>{setTimeout(qe,_e)})};window.onReady(()=>{zn()});let ne,Dt,Ht,se;const Ie=()=>{Dt=document.querySelector("#qq-modal-loading"),Ht=document.querySelector("#qq-modal-selection"),se=document.querySelector("#qq-modal-form"),document.querySelectorAll('[data-toggle="entity-creator"]').forEach(t=>{t.addEventListener("click",Wn)})},Wn=t=>{t.preventDefault();const e=t.currentTarget;return e.dataset.type==="inline"?(document.querySelector(".quick-creator-body").classList.add("hidden"),document.querySelector(".quick-creator-footer")?.classList.add("hidden"),document.querySelector(".quick-creator-loading").classList.remove("!hidden")):Vn(),axios.get(e.dataset.url).then(i=>{Dt.classList.add("!hidden"),Ht.classList.add("!hidden"),se.innerHTML=i.data,se.classList.remove("!hidden"),De(),He(),window.triggerEvent()}),!1},Pt=()=>{const t=document.querySelector("#qq-name-field");!t||t.dataset.init==="1"||(t.dataset.init="1",t.addEventListener("focusout",function(){if(!this.value)return;const e=this.parentNode.querySelector(".duplicate-entity-warning");if(!e)return;e.classList.add("hidden");const n=this.dataset.live+"?q="+this.value+"&type="+this.dataset.type;axios.get(n).then(i=>{if(i.data.length===0){e.classList.add("hidden");return}const r=Object.keys(i.data).map(function(o){return'<a href="'+i.data[o].url+'">'+i.data[o].name+"</a>"}).join(", ");t.parentNode.querySelector(".duplicate-entities").innerHTML=r,e.classList.remove("hidden")})}))},Vn=()=>{document.querySelector("#qq-modal-form").classList.add("!hidden"),document.querySelector("#qq-modal-selection").classList.add("!hidden"),document.querySelector("#qq-modal-loading").classList.remove("!hidden")},De=()=>{ne=document.querySelectorAll(".quick-creator-submit"),ne.length!==0&&(Pt(),He(),ne.forEach(t=>{t.addEventListener("click",function(e){let n=this.value;return n&&(document.querySelector('#entity-creator-form [name="action"]').value=n),!0})}),document.getElementById("entity-creator-form").onsubmit=function(t){const e=t.target;t.preventDefault(),ne.forEach(r=>r.classList.add("btn-disabled","loading")),document.querySelectorAll("div.text-error").forEach(r=>r.remove());const i=new FormData(e);axios.post(e.getAttribute("action"),i).then(r=>{if(typeof r.data=="object"){if(r.data.redirect){window.location.replace(r.data.redirect);return}let s=new Option(r.data._name,r.data._id,!0,!0),l=document.querySelector("#"+r.data._target);l.appendChild(s),l.dispatchEvent(new Event("change"));const c=document.querySelector("#qq-modal-form");c&&(c.innerHTML="",c.classList.remove("!hidden")),document.querySelector("#qq-modal-loading")?.classList.add("!hidden"),document.querySelector("#qq-modal-selection")?.classList.remove("!hidden"),document.getElementById("primary-dialog").close(),Ce();return}let o=document.getElementById("qq-modal-form");o.innerHTML=r.data,window.triggerEvent(),Ie(),Ce()}).catch(r=>{r.response&&window.formErrorHandler(r.response,e),ne.forEach(o=>o.classList.remove("btn-disabled","loading")),document.querySelector('#entity-creator-form [name="action"]').value=""})})},He=()=>{document.querySelectorAll(".qq-mode-toggle").forEach(t=>{t.addEventListener("click",function(e){e.preventDefault(),!this.classList.contains("active")&&(document.querySelector(".qq-mode-toggle").classList.remove("active"),this.classList.add("active"),document.querySelector(".quick-creator-body").classList.add("hidden"),document.querySelector(".quick-creator-footer")?.classList.add("hidden"),document.querySelector(".quick-creator-loading").classList.remove("!hidden"),axios.get(this.dataset.url).then(n=>{se.innerHTML=n.data,se.classList.remove("!hidden"),Ce(),window.triggerEvent()}))})}),document.querySelector(".qq-action-more")?.addEventListener("click",function(t){t.preventDefault(),this.classList.add("hidden"),document.querySelector(".qq-more-fields").classList.remove("hidden")}),Ie()},Ce=()=>{He(),Pt(),De()},Yn=()=>{document.querySelectorAll(".quick-creator-subform").forEach(e=>{e.addEventListener("click",n=>{window.openDialog("primary-dialog",e.dataset.url)})})};window.onEvent(function(){Ie(),De()});Yn();const $t=()=>{document.querySelectorAll("[data-bulk-action]")?.forEach(n=>{n.addEventListener("click",i=>{i.preventDefault(),Gn(n.dataset.bulkAction)})}),document.querySelectorAll(".bulk-print")?.forEach(n=>{n.addEventListener("click",i=>{i.preventDefault(),n.closest("form").requestSubmit()})})},jt=()=>{Xn(),document.querySelectorAll("input[name='model[]']")?.forEach(e=>{e.dataset.initiated!=="1"&&(e.dataset.initiated="1",e.addEventListener("change",n=>{console.log("change"),n.preventDefault(),Pe()}))})},Xn=()=>{const t=document.querySelector("#datagrid-select-all");t&&t.dataset.loaded!=="1"&&(t.dataset.loaded="1",t.addEventListener("click",function(e){const n=document.querySelectorAll("input[name='model[]']");t.checked?n?.forEach(i=>{i.checked=!0}):n?.forEach(i=>{i.checked=!1}),Pe()}))},Gn=t=>{let e=[];document.querySelectorAll("input[name='model[]']")?.forEach(i=>{i.checked&&e.push(i.value)}),t==="ajax"?window.onEvent(function(){document.querySelector('#primary-dialog input[name="models"]').value=e.toString()}):document.querySelector("#datagrid-bulk-"+t+"-models").value=e.toString()},Pe=()=>{let t=!0;document.querySelectorAll("input[name='model[]']")?.forEach(i=>{i.checked&&(t=!1)}),document.querySelectorAll(".datagrid-bulk-actions .btn2")?.forEach(i=>{t?(i.disabled=!0,i.classList.add("btn-disabled")):(i.disabled=!1,i.classList.remove("btn-disabled","disabled"))})},Zn=()=>{const t=document.querySelector(".list-treeview");if(!t)return;let e=t.dataset.url;document.querySelectorAll(".table-nested > tbody > tr").forEach(function(i){let r=i.dataset.children;parseInt(r)>0&&(i.classList.add("tr-hover"),i.classList.add("cursor-pointer"),i.addEventListener("click",function(o){const s=o.target;o.target.type!=="checkbox"&&s.dataset.tree!=="escape"&&(window.location=e+"?parent_id="+i.dataset.id+"&m=table")}))})};jt();$t();Pe();Zn();window.onEvent(function(){$t(),jt()});let ee;const Jn=new IntersectionObserver(function(t){t.forEach(e=>{e.isIntersecting===!0&&$e(e.target)})},{threshold:[0]}),Rt=()=>{document.querySelectorAll('table[data-render="datagrid2"]')?.forEach(e=>{$e(e)})},$e=t=>{ni(t),t.dataset.initiated!=="1"&&(t.dataset.initiated="1",ei(t),t.dataset.url&&Me(t,t))},ei=t=>{t.querySelectorAll("thead a")?.forEach(e=>{e.dataset.loaded!=="1"&&(e.dataset.loaded="1",e.addEventListener("click",function(n){n.preventDefault(),Me(e,t)}))}),t.parentNode.querySelectorAll('nav[role="navigation"] a')?.forEach(e=>{e.dataset.loaded!=="1"&&(e.dataset.loaded="1",e.addEventListener("click",n=>{n.preventDefault(),Me(e,t)}))})},ti=()=>{const t=document.querySelectorAll('[data-render="datagrid2-onload"]');t.length!==0&&t.forEach(e=>{Jn.observe(e)})},Me=(t,e)=>{e.querySelector("thead")?.classList.add("hidden"),e.querySelector("tbody")?.classList.add("hidden"),e.querySelector("tfoot")?.classList.remove("hidden");let n=t.getAttribute("href");t.dataset.url&&(n=t.dataset.url),e.parentNode&&axios.get(n).then(i=>{const r=e.parentNode;if(i.data.html&&(r.innerHTML=i.data.html),i.data.deletes){const s=document.querySelector("#datagrid-delete-forms");s&&(s.innerHTML=i.data.deletes)}i.data.url&&window.history.pushState({},"",i.data.url);const o=r.querySelector('[data-render="datagrid2"]');$e(o),window.triggerEvent()}).catch(i=>{})},ni=t=>{const e=t.parentNode;e.querySelectorAll(".datagrid-bulk")?.forEach(r=>{ri(t,r)}),e.querySelectorAll(".datagrid-submit")?.forEach(r=>{ii(t,r)}),document.querySelector("#datagrid-action-confirm")?.addEventListener("click",function(){window.closeDialog("datagrid-bulk-delete"),ee.submit()})},ii=(t,e)=>{e.parentNode.classList.contains("hidden")||e.dataset.loaded!=="1"&&(e.dataset.loaded="1",console.log("register bulk submit",e,e.parentNode),e.addEventListener("click",function(n){n.preventDefault(),ee=e.closest("form");const i=ee.querySelector('input[name="action"]');if(i.value=e.dataset.action,e.dataset.action==="delete")return window.openDialog("datagrid-bulk-delete"),!1;t.parentNode.querySelectorAll(".datagrid-bulk-actions .btn2")?.forEach(r=>r.classList.add("btn-disabled")),t.parentNode.querySelector(".datagrid-bulk-actions .btn2").classList.add("loading"),ee.submit()}))},ri=(t,e)=>{e.parentNode.classList.contains("hidden")||e.dataset.loaded!=="1"&&(e.dataset.loaded="1",e.addEventListener("click",function(n){n.preventDefault(),ee=t.closest("form"),axios.post(ee.getAttribute("action")+"?action=edit",{model:oi(t)}).then(i=>{const r=document.getElementById("primary-dialog");r.innerHTML=i.data,window.openDialog("primary-dialog"),window.triggerEvent()})}))},oi=t=>{let e=[];return t.querySelectorAll("input[name='model[]']")?.forEach(i=>{i.checked&&e.push(i.value)}),e};ti();Rt();window.onEvent(function(){Rt()});const Nt=()=>{document.querySelectorAll('[data-animate="collapse"]').forEach(r=>{r.addEventListener("click",li)}),document.querySelectorAll('[data-animate="reveal"]').forEach(r=>{r.addEventListener("change",ai)}),document.querySelectorAll("[data-pulse]").forEach(r=>{r.addEventListener("click",si)}),document.querySelectorAll("select.permission-control").forEach(r=>{Bt(r),r.addEventListener("change",ci)})},si=t=>{t.preventDefault();let e=document.querySelector(t.currentTarget.dataset.pulse),n=t.currentTarget.dataset.content;window.showTooltip(e,{content:n,theme:"kanka",placement:t.currentTarget.dataset.placement??"bottom",allowHTML:!0,arrow:!0,interactive:!0,trigger:"manual"})};function li(t){t.target.type!=="checkbox"&&t.preventDefault();let e=this.dataset.target;e||(e=this.hash),document.querySelectorAll(e).forEach(i=>{i.classList.toggle("hidden")}),this.classList.toggle("animate-collapsed")}function ai(t){let e=document.querySelector(this.dataset.target);this.value?e.classList.remove("hidden"):e.classList.add("hidden")}function ci(t){Bt(this)}function Bt(t){t.classList.remove("text-red-500","text-green-500"),t.value==="deny"?t.classList.add("text-red-500"):t.value==="allow"&&t.classList.add("text-green-500")}window.onEvent(function(){Nt()});Nt();const ui=()=>{const t=document.getElementById("bookmark-selector");if(!t)return!1;t.addEventListener("change",function(e){e.preventDefault();const n=t.options[t.selectedIndex];document.querySelectorAll(".bookmark-subform").forEach(o=>{o.classList.add("opacity-0","invisible","h-0")});let r=document.querySelector(n.dataset.target);r&&r.classList.remove("opacity-0","invisible","h-0")})};ui();const di=()=>{let t=document.getElementById("webhook-selector");if(!t)return!1;t.addEventListener("change",function(e){e.preventDefault();let n=this.options[this.selectedIndex];document.querySelector(".webhook-subform").classList.add("hidden"),document.querySelector(n.dataset.target)?.classList.remove("hidden")})};di();window.onEvent(function(){Ot()});const Ot=()=>{document.querySelectorAll(".form-members").forEach(e=>{if(e.dataset.loaded===1)return;e.dataset.loaded=1;let n=e.dataset.allowClear;$(e).select2({tags:!0,allowClear:n||!0,minimumInputLength:2,placeholder:e.dataset.placeholder,ajax:{quietMillis:500,delay:500,url:e.dataset.url,dataType:"json",data:function(i){return{q:i.term?.trim()}},processResults:function(i){return{results:i}},cache:!0},createTag:function(){},escapeMarkup:function(i){return i},templateSelection:function(i){return i.text?`<span>${i.text}</span>`:i.text}})})};Ot();const fi=()=>{if(!document.getElementById("campaign-modules"))return;document.querySelectorAll('input[name="enabled"]').forEach(function(n){mi(n)})},mi=t=>{t.addEventListener("change",function(e){e.preventDefault(),t.closest(".toggle").classList.add("!hidden"),t.closest(".box-module").querySelector(".action-loading").classList.remove("hidden"),axios.post(t.dataset.url).then(n=>{t.closest(".toggle").classList.remove("!hidden"),t.closest(".box-module").querySelector(".action-loading").classList.add("hidden"),n.data.success&&(n.data.status?t.closest(".box-module").classList.add("module-enabled"):t.closest(".box-module").classList.remove("module-enabled"),window.showToast(n.data.toast))})})},hi=()=>{document.querySelectorAll(".public-permission").forEach(e=>{e.addEventListener("click",pi)})},pi=t=>{t.preventDefault();let e=t.currentTarget;e.querySelector(".module-icon").classList.add("hidden"),e.querySelector(".loading-animation").classList.remove("hidden"),axios.post(e.dataset.url).then(n=>{e.querySelector(".module-icon").classList.remove("hidden"),e.querySelector(".loading-animation").classList.add("hidden"),n.data.success&&(n.data.status?e.classList.add("enabled"):e.classList.remove("enabled"),window.showToast(n.data.toast))})},gi=()=>{document.querySelectorAll(".codemirror").forEach(function(e){CodeMirror.fromTextArea(document.getElementById(e.id),{extraKeys:{"Ctrl-Space":"autocomplete"},lineNumbers:!0,lineWrapping:!0,theme:"dracula"})})},vi=()=>{let t=[].slice.call(document.querySelectorAll(".nested-sortable"));for(let e=0;e<t.length;e++)new gt(t[e],{group:"nested",handle:".dnd-handle",animation:150,fallbackOnBody:!0,swapThreshold:.65,onMove:function(n,i){let r=n.dragged,s=n.related.parentNode.closest(".fixed-position")!=null;return!(r.classList.contains("fixed-position")&&s)}})},yi=()=>{const t=document.querySelector("form#campaign-style");t&&t.addEventListener("submit",function(e){let n=document.querySelector(t.dataset.error);return document.querySelector('textarea[name="content"]').value.length<t.dataset.maxContent?(n.classList.add("hidden"),!0):(n.classList.remove("hidden"),e.preventDefault(),!1)})},bi=()=>{const t=document.querySelector('input[name="vanity"]');t&&t.addEventListener("focusout",function(e){let n=this.value,i=document.getElementById("vanity-error"),r=document.getElementById("vanity-success"),o=document.getElementById("vanity-loading");if(i.innerHTML="",i.classList.add("hidden"),r.classList.add("hidden"),!n)return;r.classList.remove("hidden");let s={};s.vanity=n,axios.post(this.dataset.url,s).then(l=>{t.value=l.data.vanity,r.querySelector("code").innerHTML=l.data.vanity,i.classList.add("hidden"),o.classList.add("hidden"),r.classList.remove("hidden")}).catch(l=>{let c="";l.response.data.errors.vanity.forEach(d=>c+=d+" "),i.innerHTML=c,i.classList.remove("hidden"),r.classList.add("hidden"),o.classList.add("hidden")})})},wi=()=>{document.querySelectorAll(".permission-toggle").forEach(e=>{e.addEventListener("click",function(n){n.preventDefault();let i=this.dataset.action,r=document.querySelectorAll('input[data-action="'+i+'"]'),o=this.dataset.checked!=="1";this.dataset.checked=o?1:0,r.forEach(s=>{o?s.checked=!0:s.checked=!1})})})};fi();gi();vi();hi();yi();bi();wi();const Ft=()=>{document.querySelectorAll("[data-clipboard]").forEach(e=>{e.addEventListener("click",xi,!1)})};function xi(t){t.preventDefault(),ki(this.dataset.clipboard,this);let e=this.dataset.toast;return e&&window.showToast(e),!1}async function ki(t,e){if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(t);else{const n=document.createElement("textarea");n.value=t,n.style.position="absolute",n.style.left="-999999px",e.append(n),n.select();try{document.execCommand("copy")}catch(i){console.error(i)}finally{n.remove()}}}Ft();window.onEvent(function(){Ft()});const Qt=()=>{document.querySelectorAll('.toast-container [data-toggle="dismiss"]').forEach(e=>{e.dataset.init!=="1"&&(e.dataset.init="1",e.addEventListener("click",function(n){n.preventDefault();let i=e.closest(".toast-message");i.classList.remove("opacity-100"),i.classList.add("opacity-0"),setTimeout(function(){i.remove()},150)}))})};window.showToast=function(t,e){e=e||"bg-success text-success-content",e==="error"&&(e="bg-error text-error-content");const n=document.createElement("div");n.classList.add("opacity-100","duration-150","transition-opacity","rounded"),e&&e.split(" ").forEach(r=>{n.classList.add(r)}),n.innerHTML='<div class="toast-message p-2 flex gap-2 items-center"><span class="grow"> '+t+'</span><span class="flex-none"><i class="fa-regular fa-circle-xmark cursor-pointer " data-toggle="dismiss"></i></span></div>',document.querySelector(".toast-container").appendChild(n),setTimeout(function(){n.classList.remove("opacity-100"),n.classList.add("opacity-0"),setTimeout(function(){n.remove()},150)},3e3),Qt()};Qt();const Li=()=>{document.querySelectorAll(".banner-notification-dismiss").forEach(t=>{t.addEventListener("click",Si,!1)}),document.querySelectorAll('[data-dismiss="tutorial"]').forEach(t=>{t.addEventListener("click",Ei,!1)})};function Si(t){t.preventDefault();let e=this.dataset.dismiss;axios.post(this.dataset.url).then(()=>{if(!e)return;let n=document.querySelector(e);n&&n.classList.add("hidden")})}function Ei(t){t.preventDefault();let e=this.dataset.target,n=t.currentTarget;n.classList.add("loading"),n.disabled=!0,n.querySelector("i")?.remove(),axios.post(this.dataset.url).then(()=>{if(!e)return;let i=document.querySelector(e);i&&i.classList.add("hidden")})}Li();let zt;const _i=()=>{const t=document.getElementById("element-era-id");t&&(zt=t.value,t.addEventListener("change",function(){Ti(t.value)}))},Ti=t=>{t=parseInt(t);let e=document.querySelector('input[name="era-data-url"]').dataset.url.replace("/0/","/"+t+"/"),n=document.querySelector('input[name="oldPosition"]').dataset.url;axios.get(e).then(i=>{let r=document.querySelector('select[name="position"]');r.innerHTML="";let o=1;Object.entries(i.data.positions).forEach(function(l,c){const d=document.createElement("option");d.text=l[1],n&&!c&&zt==t&&(d.value=1,r.appendChild(d)),c&&(d.value=o,r.appendChild(d)),o++})})};_i();window.initSortable=function(){let t=document.querySelectorAll(".sortable-elements");t.length!==0&&t.forEach(e=>{let n={},i=e.dataset.handle;i&&(n.handle=i),gt.create(e,n)})};window.initSortable();window.formErrorHandler=function(t,e){document.querySelectorAll(".input-error").forEach(u=>{u.classList.remove("input-error")});const i=document.querySelector(".text-error");i&&i.remove();const r=e.querySelector(".btn-primary");if(r&&(r.disabled=!1,r.classList.remove("loading")),t.status===503){window.showToast(t.data.message,"error");return}if(t.status===403){document.querySelector("#entity-form-403-error").classList.remove("hidden");return}if(!t.data.errors){window.showToast("Backend error","error");return}const o=t.data.errors;let s=[];const l=Object.keys(o);let c=!0;l.forEach(function(u){let h=document.querySelector('[name="'+u+'"]');if(h){h.classList.add("input-error");const p=document.createElement("div");p.classList.add("text-error"),p.innerHTML=o[u][0],h.parentNode.append(p)}else c=!1,s.push(o[u][0]);window.showToast(o[u][0],"error")});const d=document.querySelector("#entity-form-generic-error .error-logs");!c&&d&&(d.innerHTML="",s.forEach(function(u){d.append(u)}),document.querySelector("#entity-form-generic-error").classList.remove("hidden")),qi(e,o)};const qi=(t,e)=>{const n=Object.keys(e)[0],i=t.querySelector('[name="'+n+'"]');if(!i)return;if(!t.querySelector(".tab-content")){ft(i);return}document.querySelector(".tab-content .active").classList.remove("active"),document.querySelector(".nav-tabs li.active").classList.remove("active");const r=document.querySelector('[name="'+n+'"').closest(".tab-pane");r&&(r.classList.add("active"),document.querySelector('a[href="#'+r.id+'"]').closest("li").classList.add("active")),ft(i)},ft=t=>{t.focus(),t.scrollIntoView({behavior:"smooth"})},xe="recent_colors",mt=10;function Ci(){return document.cookie.split(";").reduce((t,e)=>{const[n,i]=e.split("=").map(r=>r.trim());return n&&i&&(t[n]=decodeURIComponent(i)),t},{})}function Mi(t,e,n=30){const i=new Date;i.setTime(i.getTime()+n*24*60*60*1e3),document.cookie=`${t}=${encodeURIComponent(e)}; expires=${i.toUTCString()}; path=/`}function Ai(t){ue({swatches:t})}function Ut(){const t=Ci();let e=t[xe]?JSON.parse(t[xe]):[];ue.init(),ue({el:".spectrum",format:"hex",alpha:!1,theme:"pill",clearButton:!0,closeButton:!0,swatches:e}),document.querySelectorAll(".spectrum").forEach(n=>{n.dataset.init!=="1"&&(n.dataset.init=1,n.addEventListener("click",function(i){ue({parent:n.dataset.appendTo??".container"})}),n.addEventListener("change",function(i){const r=event.target.value;e=[r,...e.filter(o=>o!==r)],e.length>mt&&(e=e.slice(0,mt)),Mi(xe,JSON.stringify(e)),Ai(e)}),n.addEventListener("close",i=>{i.stopPropagation()}))})}window.onEvent(function(){Ut()});Ut();window.onEvent(function(){Kt()});const Kt=()=>{document.querySelectorAll('[data-toggle="private"]').forEach(e=>{Ii(e)})},Ii=t=>{t.dataset.togglerinit!=="1"&&(t.dataset.togglerinit="1",t.addEventListener("click",function(e){const n=t.previousElementSibling;t.classList.contains("fa-lock-keyhole")?(t.classList.remove("fa-lock-keyhole","fa-solid"),t.classList.add("fa-unlock-keyhole","fa-regular"),t.setAttribute("title",t.dataset.public),n.value=0):(t.classList.remove("fa-unlock-keyhole","fa-regular"),t.classList.add("fa-lock-keyhole","fa-solid"),t.setAttribute("title",t.dataset.private),n.value=1)}))},Di=()=>{const t=document.querySelector('input[data-toggle="entity-privacy"]');t&&t.addEventListener("change",function(){let e=document.getElementById("entity-is-private");e&&(this.checked?e.classList.remove("hidden"):e.classList.add("hidden"))})};Kt();Di();const Hi={class:""},Pi=["data-title"],$i={class:"sr-only"},ji=U({__name:"NavToggler",props:{text:{},title:{}},setup(t){const e=t,n=()=>{const o=document.querySelector("body");o.classList.contains("sidebar-collapse")?(o.classList.remove("sidebar-collapse"),i(!1)):(o.classList.add("sidebar-collapse"),i(!0))},i=o=>{let s=new Date;s.setTime(s.getTime()+90*24*60*60*1e3);let c=" expires="+s.toGMTString(),d=location.protocol==="https:"?"secure; ":"";document.cookie="toggleState="+(o?"collapsed":"open")+"; path=/; "+d+"samesite=lax; "+c},r=()=>{let s=new RegExp("toggleState=([^;]+)").exec(document.cookie);(s!=null?decodeURI(s[1]):null)==="collapsed"&&document.querySelector("body").classList.add("sidebar-collapse")};return Ae(()=>{r()}),(o,s)=>(f(),m("div",Hi,[a("span",{role:"button",class:"sidebar-toggle text-center cursor-pointer fill-current hover:text-primary-focus","data-toggle":"tooltip","data-title":e.title,"data-placement":"right","data-html":"true",tabindex:"",onClick:s[0]||(s[0]=l=>n())},[s[1]||(s[1]=a("svg",{class:"h-6 w-6 transition-all duration-150 hover:rotate-45","data-sidebar":"collapse",xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",viewBox:"0 0 50 50"},[a("path",{d:"M 7.71875 6.28125 L 6.28125 7.71875 L 23.5625 25 L 6.28125 42.28125 L 7.71875 43.71875 L 25 26.4375 L 42.28125 43.71875 L 43.71875 42.28125 L 26.4375 25 L 43.71875 7.71875 L 42.28125 6.28125 L 25 23.5625 Z"})],-1)),s[2]||(s[2]=a("svg",{class:"h-6 w-6 transition-all duration-150 hover:rotate-90","data-sidebar":"expand",xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",viewBox:"0 0 50 50"},[a("path",{d:"M 0 9 L 0 11 L 50 11 L 50 9 Z M 0 24 L 0 26 L 50 26 L 50 24 Z M 0 39 L 0 41 L 50 41 L 50 39 Z"})],-1)),a("span",$i,g(e.text),1)],8,Pi)]))}}),Ri=["data-id","href"],Ni={class:"flex-none"},Bi=["title"],Oi=["title","innerHTML"],Fi=["innerHTML"],Wt=U({__name:"LookupEntity",props:{entity:{}},emits:["preview"],setup(t,{emit:e}){const n=e,i=t,r=l=>"url('"+l.image+"')",o=l=>{l.stopPropagation(),l.preventDefault(),n("preview",i.entity)},s=()=>"flex justify-center gap-1 cursor-pointer hover:bg-base-200 rounded w-full focus:bg-base-200";return(l,c)=>(f(),m("a",{class:q(s()),"data-id":l.entity.id,href:l.entity.link},[a("div",Ni,[a("div",{style:Y({backgroundImage:r(l.entity)}),title:l.entity.name,class:"rounded cover-background block h-16 w-16"},null,12,Bi)]),a("div",{class:"flex-grow truncate pl-1 text-base-content",onClick:o},[a("div",{class:"font-extrabold entity-name truncate",title:l.entity.name,innerHTML:l.entity.name},null,8,Oi),a("div",{class:"entity-type text-xs",innerHTML:l.entity.type},null,8,Fi)])],10,Ri))}}),Qi=["href"],zi={class:"flex-grow truncate"},Ui=["title","innerHTML"],Ki=U({__name:"LookupPage",props:{page:{}},setup(t){const e=()=>"flex justify-center gap-2 cursor-pointer w-full";return(n,i)=>(f(),m("a",{class:q(e()),href:n.page.url,tabindex:"0"},[i[0]||(i[0]=a("div",{class:"flex-none h-4 w-4"},[a("i",{class:"fa-solid fa-angles-right","aria-hidden":"true"})],-1)),a("div",zi,[a("div",{class:"entity-name truncate",title:n.page.name,innerHTML:n.page.name},null,8,Ui)])],10,Qi))}}),Wi={class:"entity-header p-3 bg-entity-focus"},Vi={class:"w-full flex items-center"},Yi=["href","title","innerHTML"],Xi={key:0,class:"fa-regular fa-skull mx-2","aria-hidden":"true"},Gi=["href"],Zi=["innerHTML"],Ji={key:1,class:"my-1 w-full flex flex-wrap gap-1"},er=["href","data-tag-id","data-tag-slug","innerHTML"],tr=["href","data-tag"],nr=["href","title"],ir={class:"entity-sections"},rr={class:"tabs flex my-2 justify-center items-center border-solid border-slate-600 border-b-2 border-r-0 border-t-0 border-l-0"},or={key:0,class:"tab-profile p-5 flex flex-col gap-5"},sr={key:0,class:"entity-pinned-attributes flex flex-col gap-3"},lr=["data-attribute","data-target"],ar=["innerHTML"],cr=["innerHTML"],ur={key:1},dr={class:"flex flex-col gap-3"},fr=["innerHTML"],mr=["innerHTML"],hr={key:1,class:"tab-links p-3"},pr={key:0,class:"text-center italic"},gr=U({__name:"EntityPreview",props:{entity:{}},setup(t){const e=t,n=x(!0),i=x(!1),r=x(!1),o=()=>e.entity.title,s=h=>{let p="inline-block rounded-xl px-3 py-1 bg-base-100 text-base-content text-xs";return h.colour&&(p+=" bg-"+h.colour,h.colour==="black"&&(p+=" text-white")),p},l=()=>"url('"+e.entity.image+"')",c=h=>{let p="p-1 px-1 mx-1 pt-2 select-none text-center truncate border-b-2 border-solid border-r-0 border-t-0 border-l-0";return h==="profile"&&n.value||h==="links"&&i.value||h==="access"&&r.value?p+=" font-black border-slate-600":p+=" cursor-pointer border-base-100",p},d=h=>{n.value=!1,i.value=!1,r.value=!1,h==="profile"?n.value=!0:h==="links"?i.value=!0:h==="access"&&(r.value=!0)},u=h=>"entity-profile-"+h.slug;return(h,p)=>(f(),m(I,null,[a("div",Wi,[a("div",Vi,[a("a",{class:"text-2xl font-extrabold entity-name",href:h.entity.link,title:h.entity.name,innerHTML:h.entity.name},null,8,Yi),h.entity.is_dead?(f(),m("i",Xi)):w("",!0),a("a",{class:"ml-2 text-xs",target:"_blank",href:h.entity.link},p[3]||(p[3]=[a("i",{class:"fa-regular fa-external-link","aria-hidden":"true","aria-label":"Open in a new window"},null,-1)]),8,Gi)]),o()?(f(),m("div",{key:0,class:"block w-full",innerHTML:h.entity.title},null,8,Zi)):w("",!0),h.entity.tags.length>0?(f(),m("div",Ji,[(f(!0),m(I,null,R(h.entity.tags,v=>(f(),m("a",{class:q(s(v)),href:v.link,"data-tag-id":v.id,"data-tag-slug":v.slug,innerHTML:v.name},null,10,er))),256))])):w("",!0),h.entity.location?(f(),m("a",{key:2,class:"block w-full cursor-pointer my-2",href:h.entity.location.link,"data-tag":h.entity.id},[p[4]||(p[4]=a("i",{class:"fa-duotone circle-location-arrow","aria-hidden":"true","aria-label":"Location"},null,-1)),O(" "+g(h.entity.location.name),1)],8,tr)):w("",!0),h.entity.image?(f(),m("a",{key:3,href:h.entity.link,style:Y({backgroundImage:l()}),title:h.entity.name,class:"rounded cover-background block w-full aspect-square"},null,12,nr)):w("",!0)]),a("div",ir,[a("div",rr,[a("div",{class:q(c("profile")),onClick:p[0]||(p[0]=v=>d("profile"))},g(h.entity.texts.profile),3),a("div",{class:q(c("links")),onClick:p[1]||(p[1]=v=>d("links"))},g(h.entity.texts.connections),3),a("div",{class:q(c("access")),onClick:p[2]||(p[2]=v=>d("access"))},null,2)]),n.value?(f(),m("div",or,[h.entity.attributes.length>0?(f(),m("div",sr,[(f(!0),m(I,null,R(h.entity.attributes,v=>(f(),m("div",{class:"","data-attribute":v.name,"data-target":v.id},[a("span",{class:"inline-block uppercase font-extrabold mr-1",innerHTML:v.name},null,8,ar),a("span",{innerHTML:v.value},null,8,cr)],8,lr))),256))])):w("",!0),h.entity.attributes.length>0?(f(),m("hr",ur)):w("",!0),a("div",dr,[(f(!0),m(I,null,R(h.entity.profile,v=>(f(),m("div",{class:q(["",u(v)])},[a("div",{class:"uppercase font-extrabold truncate",innerHTML:v.field},null,8,fr),a("div",{innerHTML:v.value},null,8,mr)],2))),256))])])):w("",!0),i.value?(f(),m("div",hr,[(f(!0),m(I,null,R(h.entity.connections,v=>(f(),W(Wt,{entity:v},null,8,["entity"]))),256)),h.entity.connections.length===0?(f(),m("p",pr,g(h.entity.texts["no-connections"]),1)):w("",!0)])):w("",!0)])],64))}}),vr={directives:{clickOutside:bt.directive},props:{api_lookup:String,api_recent:String,placeholder:String,keyboard_tooltip:String},components:{LookupEntity:Wt,EntityPreview:gr,LookupPage:Ki},data(){return{has_drawer:!1,term:null,show_loading:!1,show_recent:!1,show_preview:!1,show_results:!1,show_bookmarks:!1,recent:[],bookmarks:[],indexes:[],results:[],pages:[],cached:{},cachedPages:{},has_recent:!1,texts:{},timeout_id:null,preview_entity:null}},watch:{term(t,e){this.termChanged()}},methods:{termChanged(){this.term.trim().length<3||(this.timeout_id!==void 0&&clearTimeout(this.timeout_id),this.show_loading=!0,this.timeout_id=setTimeout(()=>this.lookup(),500))},lookup(){let t=this.term.trim(),e=t.toLowerCase().replace(/ /g,"-").replace(/ [^\w-]+/g,"");if(this.cached[e])return this.displayCached(e);fetch(this.api_lookup+"?"+new URLSearchParams({q:t,v2:!0})).then(n=>n.json()).then(n=>this.parseLookupResponse(n,e))},focus(){this.api_recent&&(this.show_preview=!1,this.has_drawer=!0,this.fetch())},escape(){this.timeout_id!==void 0&&clearTimeout(this.timeout_id),this.close()},fetch(){if(this.has_recent){this.show_recent=!0;return}this.show_loading=!0,fetch(this.api_recent).then(t=>t.json()).then(t=>{this.recent=t.recent,this.bookmarks=t.bookmarks,this.indexes=t.indexes,this.texts.recents=t.texts.recents,this.texts.results=t.texts.results,this.texts.hint=t.texts.hint,this.texts.bookmarks=t.texts.bookmarks,this.texts.index=t.texts.index,this.texts.keyboard=t.texts.keyboard,this.texts.empty_results=t.texts.empty_results,this.texts.fulltext=t.texts.fulltext,this.texts.fulltext_route=t.fulltext_route,this.show_loading=!1,this.show_recent=!0,this.has_recent=!0,this.show_bookmarks=this.bookmarks.length>0}).catch(t=>{this.show_loading=!1,this.show_recent=!0,this.has_recent=!1})},parseLookupResponse(t,e){this.results=t.entities,this.pages=t.pages,this.cached[e]=t.entities,this.cachedPages[e]=t.pages,this.showResults()},displayCached(t){this.results=this.cached[t],this.pages=this.cachedPages[t],this.showResults()},showResults(){this.timeout_id=null,this.show_preview=!1,this.show_loading=!1,this.show_results=!0},loadPreview(t){this.show_loading=!0,fetch(t.preview).then(e=>e.json()).then(e=>this.parsePreviewResponse(e))},parsePreviewResponse(t){this.preview_entity=t,this.show_loading=!1,this.show_preview=!0,this.show_recent=!1},onClickOutside(t){this.close()},close(){this.show_recent=!1,this.show_loading=!1,this.show_preview=!1,this.$refs.searchField.blur()},showBookmarks(){this.show_bookmarks=!0},searchFullTextUrl(){return`${this.texts.fulltext_route}?term=${this.term}`},showIndexes(){this.show_bookmarks=!1},modeClass(t){return t&&this.show_bookmarks||!t&&!this.show_bookmarks?" underline":""}}},yr={class:"flex grow mr-2"},br={class:"relative grow field flex items-center"},wr=["placeholder"],xr={class:"absolute right-1 hidden md:inline"},kr=["data-title"],Lr={key:0,class:"search-drawer absolute top-0 left-0 mt-12 h-sidebar w-sidebar bg-navbar bg-base-100 shadow-r overflow-y-auto",tabindex:"-1"},Sr={key:0,class:"text-center"},Er={key:1,class:"search-recent bg-lookup p-2 min-h-full shadow-r flex flex-col items-stretch"},_r={key:0,class:"flex-none"},Tr={class:"italic text-xs text-center"},qr={class:"grow flex flex-col gap-5 p-2"},Cr={key:0,class:"search-results flex flex-col gap-2"},Mr={class:"text-sm uppercase"},Ar={key:0,class:"text-neutral-content text-sm"},Ir={key:1,class:"flex flex-col gap-2"},Dr=["href"],Hr={key:1,class:"recent-searches flex flex-col gap-2"},Pr={class:"text-sm uppercase"},$r={key:2,class:"flex gap-5 justify-center"},jr={key:3,class:"flex flex-col gap-4"},Rr=["href","title"],Nr=["innerHTML"],Br={key:4,class:"flex flex-col gap-4"},Or=["href","title"],Fr=["innerHTML"],Qr={key:1,class:"flex-none text-xs text-center"},zr=["innerHTML"],Ur={key:2,class:"search-preview bg-lookup min-h-full shadow-r"};function Kr(t,e,n,i,r,o){const s=ye("LookupEntity"),l=ye("LookupPage"),c=ye("EntityPreview"),d=vt("click-outside");return oe((f(),m("div",yr,[a("div",br,[oe(a("input",{type:"text",class:"leading-4 w-20 md:w-full",maxlength:"25",ref:"searchField",id:"entity-lookup","onUpdate:modelValue":e[0]||(e[0]=u=>r.term=u),onClick:e[1]||(e[1]=u=>o.focus()),onFocus:e[2]||(e[2]=u=>o.focus()),onKeydown:e[3]||(e[3]=ve(u=>o.escape(),["esc"])),placeholder:n.placeholder},null,40,wr),[[Ee,r.term]]),a("span",xr,[a("span",{class:"flex-none keyboard-shortcut py-1",id:"lookup-kb-shortcut","data-toggle":"tooltip","data-title":n.keyboard_tooltip,"data-html":"true","data-placement":"bottom"}," K ",8,kr)])]),r.show_recent||r.show_loading||r.show_preview?(f(),m("aside",Lr,[r.show_loading?(f(),m("div",Sr,e[10]||(e[10]=[a("i",{class:"fa-solid fa-spinner fa-spin","aria-hidden":"true","aria-label":"Loading"},null,-1)]))):w("",!0),r.show_recent?(f(),m("div",Er,[r.show_results?w("",!0):(f(),m("div",_r,[a("p",Tr,g(r.texts.hint),1)])),a("div",qr,[r.show_results?(f(),m("div",Cr,[a("div",Mr,g(r.texts.results),1),r.results.length===0&&r.pages.length===0?(f(),m("div",Ar,g(r.texts.empty_results),1)):(f(),m("div",Ir,[(f(!0),m(I,null,R(r.results,u=>(f(),W(s,{entity:u,onKeydown:e[4]||(e[4]=ve(h=>o.escape(),["esc"])),onPreview:o.loadPreview},null,8,["entity","onPreview"]))),256)),(f(!0),m(I,null,R(r.pages,u=>(f(),W(l,{page:u},null,8,["page"]))),256))])),a("a",{class:"grow text-sm uppercase hover:underline",href:o.searchFullTextUrl()},g(r.texts.fulltext),9,Dr)])):w("",!0),r.recent.length>0?(f(),m("div",Hr,[a("div",Pr,g(r.texts.recents),1),(f(!0),m(I,null,R(r.recent,u=>(f(),W(s,{entity:u,onPreview:o.loadPreview,onKeydown:e[5]||(e[5]=ve(h=>o.escape(),["esc"]))},null,8,["entity","onPreview"]))),256))])):w("",!0),r.bookmarks.length>0?(f(),m("div",$r,[r.bookmarks.length>0?(f(),m("button",{key:0,class:q(["grow text-sm uppercase hover:underline",this.modeClass(!0)]),onClick:e[6]||(e[6]=u=>o.showBookmarks())},g(r.texts.bookmarks),3)):w("",!0),a("button",{class:q(["grow text-sm uppercase hover:underline",this.modeClass(!1)]),onClick:e[7]||(e[7]=u=>o.showIndexes())},g(r.texts.index),3)])):w("",!0),r.show_bookmarks?(f(),m("div",jr,[(f(!0),m(I,null,R(r.bookmarks,u=>(f(),m("a",{href:u.url,onClick:e[8]||(e[8]=Fe(()=>{},["stop"])),title:u.text,class:"flex gap-2 items-center"},[a("i",{class:q(["w-4",u.icon]),"aria-hidden":"true"},null,2),a("span",{innerHTML:u.text},null,8,Nr)],8,Rr))),256))])):(f(),m("div",Br,[(f(!0),m(I,null,R(r.indexes,u=>(f(),m("a",{href:u.url,onClick:e[9]||(e[9]=Fe(()=>{},["stop"])),title:u.name,class:"flex gap-2 items-center"},[a("i",{class:q(["w-4 text-center",u.icon]),"aria-hidden":"true"},null,2),a("span",{innerHTML:u.name},null,8,Fr)],8,Or))),256))]))]),r.show_loading?w("",!0):(f(),m("div",Qr,[e[11]||(e[11]=a("hr",null,null,-1)),a("p",{class:"italic text-xs text-center",innerHTML:r.texts.keyboard},null,8,zr)]))])):w("",!0),r.show_preview?(f(),m("div",Ur,[re(c,{entity:r.preview_entity},null,8,["entity"])])):w("",!0)])):w("",!0)])),[[d,o.onClickOutside]])}const Wr=ln(vr,[["render",Kr]]),Vr=["href","title"],Yr={key:0,class:"absolute top-2 right-2 text-sm text-boost"},Xr=["innerHTML"],ht=U({__name:"Campaign",props:{campaign:{}},setup(t){const e=t,n=()=>e.campaign.image?"url("+e.campaign.image+")":"",i=()=>"campaign flex items-end border border-solid rounded-lg cover-background relative h-24 overflow-hidden text-break shadow-xs hover:shadow-md border-0";return(r,o)=>(f(),m("a",{class:q(i()),href:r.campaign.url,style:Y({backgroundImage:n()}),title:r.campaign.name},[r.campaign.is_boosted?(f(),m("div",Yr,o[0]||(o[0]=[a("i",{class:"fa-regular fa-gem","aria-label":"Premium campaign"},null,-1)]))):w("",!0),a("div",{class:"flex items-end justify-center name w-full text-xs p-2 pt-6 text-center",innerHTML:r.campaign.name},null,8,Xr)],14,Vr))}}),Gr=["data-id"],Zr={class:"flex-none p-2"},Jr=["innerHTML","href"],eo=["title"],to={key:1,class:"flex-none p-2"},no=["data-id"],io={class:"flex-none p-2"},ro=["innerHTML"],oo=["title"],so={key:1,class:"flex-none p-2"},lo=U({__name:"Notification",props:{notification:{}},emits:["read"],setup(t,{emit:e}){const n=e,i=x(!1),r=x(!1),o=c=>{let d="notification bg-base-200 flex justify-center items-center p-2 rounded-md";return c.is_read?d:d+" unread"},s=c=>{let d="fa-regular fa-"+c.icon;return c.colour==="red"&&(d+=" text-red"),d},l=c=>{r.value=!0,axios.post(c.dismiss).then(()=>{i.value=!0,n("read",c)})};return(c,d)=>c.notification.url&&!i.value?(f(),m("div",{key:0,class:q(o(c.notification)),"data-id":c.notification.id},[a("div",Zr,[a("i",{class:q(s(c.notification)),"aria-hidden":"true"},null,2)]),a("a",{class:"flex-grow p-2 break-all",innerHTML:c.notification.text,href:c.notification.url},null,8,Jr),r.value?(f(),m("div",to,d[3]||(d[3]=[a("i",{class:"fa-solid fa-spinner fa-spin","aria-hidden":"true"},null,-1)]))):(f(),m("div",{key:0,class:"flex-none p-2 cursor-pointer dismissable",onClick:d[0]||(d[0]=u=>l(c.notification)),title:c.notification.dismiss_text},d[2]||(d[2]=[a("i",{class:"fa-solid fa-times","aria-hidden":"true"},null,-1)]),8,eo))],10,Gr)):i.value?w("",!0):(f(),m("div",{key:1,class:q(o(c.notification)),"data-id":c.notification.id},[a("div",io,[a("i",{class:q(s(c.notification)),"aria-hidden":"true"},null,2)]),a("div",{class:"flex-grow p-2",innerHTML:c.notification.text},null,8,ro),r.value?(f(),m("div",so,d[5]||(d[5]=[a("i",{class:"fa-solid fa-spinner fa-spin","aria-hidden":"true"},null,-1)]))):(f(),m("div",{key:0,class:"flex-none p-2 cursor-pointer dismissable",onClick:d[1]||(d[1]=u=>l(c.notification)),title:c.notification.dismiss_text},d[4]||(d[4]=[a("i",{class:"fa-regular fa-times","aria-hidden":"true"},null,-1)]),8,oo))],10,no))}}),ao=["data-id"],co={class:"flex-grow p-2"},uo=["innerHTML","href"],fo=["innerHTML"],mo=["title"],ho={key:1,class:"flex-none p-2"},po=U({__name:"Release",props:{release:{}},emits:["read"],setup(t,{emit:e}){const n=e,i=x(!1),r=x(!1),o=l=>"release bg-base-200 flex justify-center items-center p-2  rounded-md",s=l=>{r.value=!0,axios.post(l.dismiss).then(()=>{i.value=!0,n("read",l)})};return(l,c)=>i.value?w("",!0):(f(),m("div",{key:0,class:q(o(l.release)),"data-id":l.release.id},[a("div",co,[a("a",{innerHTML:l.release.title,class:"font-bold cursor-pointer block w-full",href:l.release.url,target:"_blank"},null,8,uo),a("p",{innerHTML:l.release.text},null,8,fo)]),r.value?(f(),m("div",ho,c[2]||(c[2]=[a("i",{class:"fa-solid fa-spinner fa-spin","aria-hidden":"true"},null,-1)]))):(f(),m("div",{key:0,class:"flex-none p-2 cursor-pointer dismissable",onClick:c[0]||(c[0]=d=>s(l.release)),title:l.release.dismiss_text},c[1]||(c[1]=[a("i",{class:"fa-solid fa-times","aria-hidden":"true"},null,-1)]),8,mo))],10,ao))}}),ke={__name:"GridSvg",props:{size:Number},setup(t){const e=t;function n(){return"w-"+e.size+" h-"+e.size}return(i,r)=>(f(),m("svg",{class:q(n()),viewBox:"0 -0.5 21 21",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","aria-hidden":"true"},r[0]||(r[0]=[a("g",{stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"},[a("g",{transform:"translate(-219.000000, -200.000000)",fill:"currentcolor"},[a("g",{id:"icons",transform:"translate(56.000000, 160.000000)"},[a("path",{d:"M181.9,54 L179.8,54 C178.63975,54 177.7,54.895 177.7,56 L177.7,58 C177.7,59.105 178.63975,60 179.8,60 L181.9,60 C183.06025,60 184,59.105 184,58 L184,56 C184,54.895 183.06025,54 181.9,54 M174.55,54 L172.45,54 C171.28975,54 170.35,54.895 170.35,56 L170.35,58 C170.35,59.105 171.28975,60 172.45,60 L174.55,60 C175.71025,60 176.65,59.105 176.65,58 L176.65,56 C176.65,54.895 175.71025,54 174.55,54 M167.2,54 L165.1,54 C163.93975,54 163,54.895 163,56 L163,58 C163,59.105 163.93975,60 165.1,60 L167.2,60 C168.36025,60 169.3,59.105 169.3,58 L169.3,56 C169.3,54.895 168.36025,54 167.2,54 M181.9,47 L179.8,47 C178.63975,47 177.7,47.895 177.7,49 L177.7,51 C177.7,52.105 178.63975,53 179.8,53 L181.9,53 C183.06025,53 184,52.105 184,51 L184,49 C184,47.895 183.06025,47 181.9,47 M174.55,47 L172.45,47 C171.28975,47 170.35,47.895 170.35,49 L170.35,51 C170.35,52.105 171.28975,53 172.45,53 L174.55,53 C175.71025,53 176.65,52.105 176.65,51 L176.65,49 C176.65,47.895 175.71025,47 174.55,47 M167.2,47 L165.1,47 C163.93975,47 163,47.895 163,49 L163,51 C163,52.105 163.93975,53 165.1,53 L167.2,53 C168.36025,53 169.3,52.105 169.3,51 L169.3,49 C169.3,47.895 168.36025,47 167.2,47 M181.9,40 L179.8,40 C178.63975,40 177.7,40.895 177.7,42 L177.7,44 C177.7,45.105 178.63975,46 179.8,46 L181.9,46 C183.06025,46 184,45.105 184,44 L184,42 C184,40.895 183.06025,40 181.9,40 M174.55,40 L172.45,40 C171.28975,40 170.35,40.895 170.35,42 L170.35,44 C170.35,45.105 171.28975,46 172.45,46 L174.55,46 C175.71025,46 176.65,45.105 176.65,44 L176.65,42 C176.65,40.895 175.71025,40 174.55,40 M169.3,42 L169.3,44 C169.3,45.105 168.36025,46 167.2,46 L165.1,46 C163.93975,46 163,45.105 163,44 L163,42 C163,40.895 163.93975,40 165.1,40 L167.2,40 C168.36025,40 169.3,40.895 169.3,42"})])])],-1)]),2))}},go={class:"nav-switcher flex items-center justify-center align-middle h-12 gap-2"},vo={class:"indicator relative inline-flex w-max"},yo={key:0,class:"notification-badge left-auto top-auto w-fit inline-flex absolute content-center items-center z-10"},bo={key:1,class:"profile-box rounded-lg p-2 text-center font-bold"},wo={key:0,class:"navigation-drawer bg-base-100 h-full overflow-y-auto fixed top-0 right-0 rounded-l-2xl shadow-lg"},xo={key:0,class:"temporary p-8 text-center"},ko={key:1,class:""},Lo={class:"header flex"},So={key:0,class:"full flex items-center gap-4"},Eo={class:"flex-none"},_o={class:"flex-grow"},To={class:"font-bold"},qo=["title"],Co={key:0,class:"full flex items-center gap-4"},Mo={key:0,class:"flex-none profile-box rounded-lg p-2 text-center uppercase font-bold"},Ao={class:"flex-grow"},Io={class:"font-bold"},Do=["title"],Ho={key:0,class:"flex-none profile-box rounded-lg p-2 text-center uppercase font-bold"},Po={key:0,class:"profile p-5 flex flex-col gap-5"},$o={key:0,class:"notifications"},jo={class:"flex w-full py-2"},Ro={class:"flex-grow uppercase font-bold"},No={class:"flex-grow text-right"},Bo=["href"],Oo={class:"flex flex-col gap-2"},Fo={key:0,class:"no-notifications help-block text-neutral-content italic"},Qo={key:1,class:"releases"},zo={class:"flex w-full py-2"},Uo={class:"flex-grow uppercase font-bold"},Ko={class:"flex flex-col gap-2"},Wo={key:2,class:"marketplace"},Vo={class:"flex w-full py-2"},Yo={class:"flex-grow uppercase font-bold"},Xo={class:"flex-grow text-right"},Go=["href"],Zo={class:"grid grid-cols-3 gap-2"},Jo=["href"],es={class:"text-muted text-xs"},ts=["href"],ns={class:"text-muted text-xs"},is=["href"],rs={class:"text-muted text-xs"},os={key:3,class:"subscription"},ss={class:"uppercase font-bold py-2"},ls=["href"],as={class:"flex-none p-2"},cs=["src","alt"],us={class:"flex-grow p-2"},ds={class:"font-bold text-lg"},fs={key:0,class:"more"},ms={key:1,class:"more"},hs={class:"link flex gap-1 items-center"},ps={key:0,class:"fa-duotone fa-credit-card","aria-hidden":"true"},gs={key:1,class:"fa-regular fa-credit-card","aria-hidden":"true"},vs={key:4,class:"m-0 p-0 list-none flex flex-col gap-2"},ys=["href"],bs=["href"],ws=["href"],xs={key:5,class:"m-0 p-0 list-none flex flex-col gap-2"},ks=["href"],Ls={key:1,class:"campaigns p-5"},Ss={key:0,class:"campaigns flex flex-col gap-5"},Es={class:"flex flex-col gap-2"},_s={class:"flex w-full"},Ts={class:"flex-grow uppercase font-bold"},qs={key:0,class:"flex-grow text-right"},Cs=["href"],Ms={class:"grid grid-cols-2 md:grid-cols-3 gap-5"},As=["href"],Is={class:"text-xs text-break uppercase"},Ds={key:0},Hs={class:"flex flex-col gap-2"},Ps={key:0,class:"uppercase"},$s={key:1,class:"grid grid-cols-2 md:grid-cols-3 gap-5 following"},js=["href"],Rs={class:"text-xs uppercase text-break"},Ns=U({__name:"NavSwitcher",props:{user_id:{},api:{},fetch:{},initials:{},avatar:{},campaign_id:{},has_alerts:{}},setup(t){const e=t;x(60*1e3);const n=x(!1),i=x(!1),r=x(!1),o=x(!1),s=x(!1),l=x({}),c=x({}),d=x({}),u=x({}),h=x({}),p=x(!1),v=x(!1),L=x(!1),T=()=>{o.value=!0,s.value=!1,M()},S=()=>{s.value=!0,o.value=!1,M()},M=()=>{i.value=!0,!r.value&&(n.value=!0,axios.get(e.api).then(_=>{l.value=_.data.profile,c.value=_.data.campaigns,d.value=_.data.notifications,u.value=_.data.marketplace,h.value=_.data.releases,p.value=_.data.has_unread,r.value=!0,n.value=!1,v.value=!0,L.value=_.data.fontawesome_pro}))},C=_=>_?"block p-4 flex-grow items-center focus:box-shadow":"block p-4  items-center bg-base-200 cursor-pointer flex-none focus:box-shadow",P=()=>{document.getElementById("logout-form").submit()},j=_=>{i.value=!1},K=_=>{let y=h.value.releases.findIndex(z=>z.id===_.id);h.value.releases.slice(y,1),E()},N=_=>{let y=d.value.messages.findIndex(z=>z.id==_.id);d.value.messages.slice(y,1),E()},E=()=>{d.value.messages.length===0&&h.value.releases.length===0&&(p.value=!1)},B=()=>{let _=localStorage.getItem("last_notification-"+e.user_id),z=new Date().getTime()-60*5e3;if(!_||_<z)pe();else if(p.value=localStorage.getItem("notification-has-alerts-"+e.user_id)==="true",ae(),!v.value)return},pe=()=>{let _=new Date().getTime();localStorage.setItem("last_notification-"+e.user_id,_),axios.get(e.fetch).then(y=>{localStorage.setItem("notification-has-alerts-"+e.user_id,y.data.has_alerts),B()})},ae=()=>{setTimeout(function(){B()},e.alert_delta)},J=()=>e.avatar.startsWith("/images/"),te=()=>"url("+e.avatar+")";return Ae(()=>{p.value=e.has_alerts,ae()}),(_,y)=>{const z=vt("click-outside");return f(),m(I,null,[a("div",go,[a("div",{class:"campaigns inline cursor-pointer text-center text-2xl hover:text-primary-focus",onClick:y[0]||(y[0]=D=>T()),"aria-label":"Switch campaigns",tabindex:"0",role:"button"},[re(ke,{size:7}),y[5]||(y[5]=a("span",{class:"sr-only"},"Campaigns",-1))]),a("div",{class:"profile flex items-center cursor-pointer text-center uppercase",onClick:y[1]||(y[1]=D=>S()),"aria-label":"Profile settings",tabindex:"0",role:"button"},[a("div",vo,[p.value?(f(),m("span",yo)):w("",!0),J()?(f(),m("div",bo,g(_.initials),1)):(f(),m("div",{key:2,class:"w-9 h-9 rounded-lg cover-background",style:Y({backgroundImage:te()})},null,4))])])]),i.value?oe((f(),m("div",wo,[n.value?(f(),m("div",xo,y[6]||(y[6]=[a("i",{class:"fa-solid fa-spinner fa-spin","aria-hidden":"true"},null,-1)]))):(f(),m("div",ko,[a("div",Lo,[a("div",{class:q(C(o.value)),onClick:y[2]||(y[2]=D=>T()),tabindex:"0",role:"button","aria-label":"Campaign list"},[o.value?(f(),m("div",So,[a("div",Eo,[re(ke,{size:6})]),a("div",_o,[a("div",To,g(c.value.texts.campaigns),1),a("div",null,g(c.value.texts.count),1)])])):(f(),m("div",{key:1,class:"flex items-center justify-center h-full",title:c.value.texts.campaigns},[re(ke,{size:6})],8,qo))],2),a("div",{class:q(C(s.value)),onClick:y[3]||(y[3]=D=>S()),tabindex:"0",role:"button","aria-label":"Profile pane"},[s.value?(f(),m("div",Co,[J()?(f(),m("div",Mo,g(_.initials),1)):(f(),m("div",{key:1,class:"flex-none w-9 h-9 rounded-lg cover-background",style:Y({backgroundImage:te()})},null,4)),a("div",Ao,[a("div",Io,g(l.value.name),1),a("div",null,g(l.value.created),1)])])):(f(),m("div",{key:1,class:"",title:l.value.your_profile},[J()?(f(),m("div",Ho,g(_.initials),1)):(f(),m("div",{key:1,class:"flex-none w-9 h-9 rounded-lg cover-background",style:Y({backgroundImage:te()})},null,4))],8,Do))],2)]),s.value?(f(),m("div",Po,[d.value.title?(f(),m("div",$o,[a("div",jo,[a("div",Ro,g(d.value.title),1),a("div",No,[a("a",{href:d.value.all.url},g(d.value.all.text),9,Bo)])]),a("div",Oo,[(f(!0),m(I,null,R(d.value.messages,D=>(f(),W(lo,{notification:D,onRead:N},null,8,["notification"]))),256))]),d.value.messages.length===0?(f(),m("div",Fo,g(d.value.none),1)):w("",!0)])):w("",!0),h.value.title&&h.value.releases.length>0?(f(),m("div",Qo,[a("div",zo,[a("div",Uo,g(h.value.title),1)]),a("div",Ko,[(f(!0),m(I,null,R(h.value.releases,D=>(f(),W(po,{release:D,onRead:K},null,8,["release"]))),256))])])):w("",!0),!l.value.is_impersonating&&u.value.title?(f(),m("div",Wo,[a("div",Vo,[a("div",Yo,g(u.value.title),1),a("div",Xo,[a("a",{href:u.value.explore.url,target:"_blank"},g(u.value.explore.text),9,Go)])]),a("div",Zo,[a("a",{href:u.value.themes.url,class:"border py-2 items-center justify-center rounded-md hover:shadow-md flex flex-col gap-1",target:"_blank"},[y[7]||(y[7]=a("div",{class:"icon bg-base-200 rounded-full w-14 h-14 text-3xl aspect-square flex justify-center items-center"},[a("i",{class:"fa-duotone fa-palette","aria-hidden":"true"})],-1)),a("div",null,g(u.value.themes.title),1),a("div",es,g(u.value.themes.number),1)],8,Jo),a("a",{href:u.value.sheets.url,class:"border py-2 items-center justify-center rounded-md hover:shadow-md flex flex-col gap-1",target:"_blank"},[y[8]||(y[8]=a("div",{class:"icon bg-base-200 rounded-full w-14 h-14 text-3xl aspect-square flex justify-center items-center"},[a("i",{class:"fa-duotone fa-table-cells","aria-hidden":"true"})],-1)),a("div",null,g(u.value.sheets.title),1),a("div",ns,g(u.value.sheets.number),1)],8,ts),a("a",{href:u.value.content.url,class:"border py-2 items-center justify-center rounded-md hover:shadow-md flex flex-col gap-1",target:"_blank"},[y[9]||(y[9]=a("div",{class:"icon bg-base-200 rounded-full w-14 h-14 text-3xl aspect-square flex justify-center items-center"},[a("i",{class:"fa-duotone fa-dice-d20","aria-hidden":"true"})],-1)),a("div",null,g(u.value.content.title),1),a("div",rs,g(u.value.content.number),1)],8,is)])])):w("",!0),!l.value.is_impersonating&&l.value.subscription?(f(),m("div",os,[a("div",ss,g(l.value.subscription.title),1),a("a",{class:"border rounded-lg flex justify-center items-center hover:shadow-md",href:l.value.urls.subscription},[a("div",as,[a("img",{class:"w-16 h-16",src:l.value.subscription.image,alt:l.value.subscription.tier},null,8,cs)]),a("div",us,[a("div",ds,g(l.value.subscription.tier),1),l.value.subscription.tier!=="Kobold"?(f(),m("div",fs,[O(g(l.value.subscription.created),1),y[10]||(y[10]=a("br",null,null,-1)),O(" "+g(l.value.subscription.boosters),1)])):(f(),m("div",ms,[O(g(l.value.subscription.call_to_action)+" ",1),a("div",hs,[O(g(l.value.subscription.call_to_action_2)+" ",1),L.value?(f(),m("i",ps)):(f(),m("i",gs)),y[11]||(y[11]=a("i",{class:"fa-brands fa-paypal","aria-hidden":"true"},null,-1))])]))])],8,ls)])):w("",!0),l.value.is_impersonating?(f(),m("ul",xs,[a("li",null,[a("a",{href:l.value.return.url,class:""},[y[16]||(y[16]=a("i",{class:"fa-regular fa-sign-out-alt mr-3","aria-hidden":"true"},null,-1)),O(" "+g(l.value.return.name),1)],8,ks)])])):(f(),m("ul",vs,[a("li",null,[a("a",{href:l.value.urls.settings.url,class:"p-2 block"},[y[12]||(y[12]=a("i",{class:"fa-regular fa-cog mr-3","aria-hidden":"true"},null,-1)),O(" "+g(l.value.urls.settings.name),1)],8,ys)]),a("li",null,[a("a",{href:l.value.urls.profile.url,class:"p-2 block"},[y[13]||(y[13]=a("i",{class:"fa-regular fa-user mr-3","aria-hidden":"true"},null,-1)),O(" "+g(l.value.urls.profile.name),1)],8,bs)]),a("li",null,[a("a",{href:l.value.urls.help.url,class:"p-2 block",target:"_blank"},[y[14]||(y[14]=a("i",{class:"fa-regular fa-question-circle mr-3","aria-hidden":"true"},null,-1)),O(" "+g(l.value.urls.help.name),1)],8,ws)]),a("li",null,[a("a",{href:"#",onClick:y[4]||(y[4]=D=>P()),class:"p-2 block"},[y[15]||(y[15]=a("i",{class:"fa-regular fa-sign-out mr-3","aria-hidden":"true"},null,-1)),O(" "+g(l.value.urls.logout.name),1)])])]))])):(f(),m("div",Ls,[l.value.is_impersonating?w("",!0):(f(),m("div",Ss,[a("div",Es,[a("div",_s,[a("div",Ts,g(c.value.texts.campaigns),1),c.value.member.length>0?(f(),m("div",qs,[a("a",{href:c.value.urls.reorder},g(c.value.texts.reorder),9,Cs)])):w("",!0)]),a("div",Ms,[(f(!0),m(I,null,R(c.value.member,D=>(f(),W(ht,{campaign:D},null,8,["campaign"]))),256)),a("a",{href:c.value.urls.new,class:"new-campaign flex items-center text-center border-dashed border rounded-lg h-24 p-2 overflow-hidden"},[a("span",Is,[y[17]||(y[17]=a("i",{class:"fa-regular fa-plus","aria-hidden":"true",style:{display:"none"}},null,-1)),O(" "+g(c.value.texts.new),1)])],8,As)])]),l.value.is_impersonating?w("",!0):(f(),m("hr",Ds)),a("div",Hs,[l.value.is_impersonating?w("",!0):(f(),m("p",Ps,g(c.value.texts.followed),1)),l.value.is_impersonating?w("",!0):(f(),m("div",$s,[(f(!0),m(I,null,R(c.value.following,D=>(f(),W(ht,{campaign:D},null,8,["campaign"]))),256)),a("a",{href:c.value.urls.follow,class:"new-campaign flex items-center text-center border-dashed border rounded-lg h-24 p-2 overflow-hidden"},[a("span",Rs,g(c.value.texts.follow),1)],8,js)]))])]))]))]))])),[[z,j]]):w("",!0)],64)}}}),le=yt({});le.component("nav-toggler",ji);le.component("nav-search",Wr);le.component("nav-switcher",Ns);le.use(bt);le.mount("header");const Bs={key:0},Os=["innerHTML"],Fs={key:1,class:"flex items-center gap-1"},Qs=["accept"],zs={key:2,class:"flex items-center gap-1"},Us=["placeholder"],Ks={key:0,class:"fa-solid fa-spin fa-spinner","aria-label":"Downloading"},Ws={key:3,class:"flex items-center gap-1"},Vs=["innerHTML"],Ys={key:0,class:"flex gap-2 flex-col w-full"},Xs={class:"progress h-1 w-full"},Gs=["innerHTML"],Zs=["innerHTML"],Js=["name"],el={key:2,type:"hidden",name:"remove-image",value:"1"},tl={class:"flex gap-6 items-center p-4 md:p-6 justify-between"},nl=["innerHTML"],il={class:"max-w-4xl flex flex-col gap-2 text-left p-4 md:px-6"},rl={class:"flex flex-col gap-1 w-full"},ol=["innerHTML"],sl=["innerHTML"],ll={key:0,class:"p-4 md:px-6"},al={class:""},cl=["href"],ul=["innerHTML"],dl=U({__name:"Selection",props:{file:{},url:{},accepts:{},uuid:{},thumbnail:{},browse:{},field:{},old:{},i18n:{},cta:{},premium:{}},setup(t){const e=t,n=x(!0),i=x(!1),r=x(!1),o=x(),s=x(),l=x(),c=x(),d=x(),u=x(!1),h=x(0),p=x(null);let v;const L=x(null),T=x(!1),S=x(!1),M=x(!1),C=x(null),P=x(),j=x();Ae(()=>{n.value=!1,c.value=e.thumbnail,d.value=e.uuid,e.old==="true"&&(T.value=!0),e.premium==="true"&&(S.value=!0),C.value=JSON.parse(e.i18n)});const K=()=>{let b="relative flex items-end align-middle rounded overflow-hidden bg-no-repeat ";return B()?b+=" cover-background preview-bg w-48 h-36 p-2 ":b+="w-full",b},N=()=>r.value?"hidden":"flex gap-2 flex-col w-full",E=()=>T.value||d.value!==null&&d.value!=="",B=()=>p.value||T.value?!0:d.value!==null&&d.value!=="",pe=()=>{d.value=null,c.value=null,T.value&&(T.value=!1,M.value=!0)},ae=()=>p.value?"url('"+p.value+"')":c.value?"url('"+c.value+"')":"",J=()=>h.value+"%",te=()=>{u.value=!0},_=b=>{o.value=b.clipboardData.getData("text"),y()},y=()=>{!o.value||o.value==v||(v=o.value,i.value=!0,s.value.disabled=!0,axios.post(e.url,{url:o.value}).then(b=>{s.value.disabled=!1,i.value=!1,o.value=null,c.value=b.data.thumbnail,d.value=b.data.uuid}).catch(b=>{s.value.disabled=!1,i.value=!1,s.value.focus(),D(b)}))},z=async b=>{const k=b.target.files[0];if(!k){r.value=!1;return}const A=new FileReader;A.onload=Q=>{p.value=Q.target.result},A.readAsDataURL(k),r.value=!0,document.addEventListener("keydown",ge),L.value=axios.CancelToken.source(),l.value.disabled=!0;const Oe=new FormData;Oe.append("file",k),axios.post(e.file,Oe,{headers:{"Content-Type":"multipart/form-data"},cancelToken:L.value.token,onUploadProgress:function(Q){h.value=Math.round(Q.loaded*100/Q.total)}}).then(Q=>{r.value=!1,l.value.disabled=!1,l.value=null,c.value=Q.data.thumbnail,d.value=Q.data.uuid,p.value=null,document.removeEventListener("keydown",ge)}).catch(Q=>{r.value=!1,l.value.disabled=!1,p.value=null,axios.isCancel(Q)?l.value=null:D(Q),document.removeEventListener("keydown",ge)})},D=b=>{if(!b.response)return;if(b.response.data.error){window.showToast(b.response.data.error,"error");return}if(b.response&&b.response.status===403&&b.response.data.message){window.showToast(C.value.unauthorized,"error");return}Object.keys(b.response.data.errors).forEach(A=>{if(b.response.data.errors[A][0].includes("(storage_full)")){j.value=b.response.data.errors[A][0].replace("(storage_full)",""),sn(P.value);return}window.showToast(b.response.data.errors[A][0],"error")})},rn=b=>{d.value=b.uuid,c.value=b.thumbnail},on=()=>{u.value=!1},ge=b=>{b.key==="Escape"&&r.value&&Re()},Re=b=>{L.value.cancel("Upload canceled by user.")},sn=b=>{b.showModal(),b.addEventListener("click",Be)},Ne=b=>{b.removeEventListener("click",Be),b.close()},Be=b=>{let k=b.target.getBoundingClientRect();!(k.top<=b.clientY&&b.clientY<=k.top+k.height&&k.left<=b.clientX&&b.clientX<=k.left+k.width)&&b.target.tagName==="DIALOG"&&Ne(b.target)};return(b,k)=>(f(),m(I,null,[n.value?(f(),m("div",Bs,k[7]||(k[7]=[a("i",{class:"fa-solid fa-spin fa-spinner2","aria-label":"Loading"},null,-1)]))):(f(),m("div",{key:1,class:q(K()),style:Y({backgroundImage:ae()})},[a("div",{class:q(N())},[B()?(f(),m("div",{key:0,class:"rounded p-2 cursor-pointer backdrop-blur backdrop-opacity-30 bg-red-700/50 text-white hover:backdrop-opacity-100 transition",onClick:k[0]||(k[0]=A=>pe()),innerHTML:C.value.remove},null,8,Os)):w("",!0),E()?w("",!0):(f(),m("div",Fs,[a("input",{type:"file",accept:e.accepts,class:"w-full",onChange:z,ref_key:"fileField",ref:l},null,40,Qs)])),E()?w("",!0):(f(),m("div",zs,[oe(a("input",{ref_key:"urlField",ref:s,type:"text",class:"w-full","onUpdate:modelValue":k[1]||(k[1]=A=>o.value=A),onBlur:k[2]||(k[2]=A=>y()),onPaste:_,placeholder:C.value.url},null,40,Us),[[Ee,o.value]]),i.value?(f(),m("i",Ks)):w("",!0)])),E()?w("",!0):(f(),m("div",Ws,[a("span",{role:"button",class:"btn2 btn-default btn-sm",onClick:k[3]||(k[3]=A=>te()),innerHTML:C.value.gallery},null,8,Vs)]))],2),r.value?(f(),m("div",Ys,[a("div",Xs,[a("div",{class:"h-1 bg-accent shadow-xs",role:"progressbar","aria-valuenow":"0","aria-valuemin":"0","aria-valuemax":"100",style:Y({width:J()})},k[8]||(k[8]=[a("span",{class:"sr-only"},null,-1)]),4)]),a("div",{class:"rounded p-2 cursor-pointer backdrop-blur backdrop-opacity-30 bg-red-700/50 text-white hover:backdrop-opacity-100 transition flex items-center gap-2",onClick:k[4]||(k[4]=A=>Re())},[a("span",{class:"grow",innerHTML:C.value.cancel},null,8,Gs),a("span",{class:"text-xs flex-none",innerHTML:J()},null,8,Zs)])])):w("",!0)],6)),oe(a("input",{type:"hidden",name:e.field,"onUpdate:modelValue":k[5]||(k[5]=A=>d.value=A)},null,8,Js),[[Ee,d.value]]),M.value?(f(),m("input",el)):w("",!0),re(an,{api:e.browse,opened:u.value,i18n:b.i18n,onSelected:rn,onClosed:on},null,8,["api","opened","i18n"]),n.value?w("",!0):(f(),m("dialog",{key:3,ref_key:"cta",ref:P,class:"dialog rounded-2xl text-center"},[a("header",tl,[a("h4",{innerHTML:C.value.cta_title,class:"text-lg font-normal"},null,8,nl),a("button",{type:"button",class:"text-base-content",onClick:k[6]||(k[6]=A=>Ne(P.value)),title:"Close"},k[9]||(k[9]=[a("i",{class:"fa-regular fa-circle-xmark","aria-hidden":"true"},null,-1),a("span",{class:"sr-only"},"Close",-1)]))]),a("article",il,[a("div",rl,[a("p",{innerHTML:j.value},null,8,ol),S.value?w("",!0):(f(),m("p",{key:0,innerHTML:C.value.cta_helper},null,8,sl))])]),S.value?w("",!0):(f(),m("footer",ll,[a("menu",al,[a("a",{href:e.cta,class:"btn2 btn-primary"},[k[10]||(k[10]=a("i",{class:"fa-regular fa-gem","aria-hidden":"true"},null,-1)),a("span",{innerHTML:C.value.cta_action},null,8,ul)],8,cl)])]))],512))],64))}}),Vt=()=>{document.querySelectorAll(".gallery-selection").forEach(e=>{if(e.dataset.init==="1")return;e.dataset.init="1";const n=yt({});n.component("gallery-selection",dl),n.mount(e)})};Vt();window.onEvent(function(){Vt()});const Le=Array(),Yt=()=>{document.querySelectorAll('[data-toggle="tooltip-ajax"]').forEach(e=>{e._tippy||he(e,{theme:"entity-tooltip",placement:e.dataset.direction??"bottom",allowHTML:!0,interactive:!0,delay:500,appendTo:e.dataset.append??document.body,content:'<i class="fa-solid fa-spin fa-spinner" aria-hidden="true" aria-label="loading..." />',arrow:!0,onShow(n){let i=e.dataset.id;if(i&&i in Le){n.setContent(Le[i]);return}fetch(e.dataset.url).then(r=>r.json()).then(r=>{n.setContent(r[0]),Le[i]=r[0]}).catch(r=>{n.setContent(`Failed loading tooltip. ${r}`)})}})})},Xt=()=>{let t=document.querySelectorAll('[data-toggle="tooltip"]');t.forEach(e=>{pt(e)}),t=document.querySelectorAll("[data-tooltip]"),t.forEach(e=>{pt(e)})},pt=t=>{t._tippy||he(t,{content:t.dataset.title??t.title,theme:"kanka",delay:250,placement:t.dataset.direction??"bottom",allowHTML:t.dataset.html??!1,appendTo:t.dataset.append??document.body,arrow:!0})},Gt=()=>{document.querySelectorAll("[data-dropdown]").forEach(e=>{if(e._tippy)return;let n=e.parentNode.querySelectorAll(".dropdown-menu")[0];he(e,{content:'<div class="dd-menu flex flex-col max-w-2xl">'+n.innerHTML+"</div>",theme:"kanka-dropdown",placement:e.dataset.direction??"bottom",zIndex:890,allowHTML:!0,arrow:!0,interactive:!0,trigger:"click",onShown(i){window.triggerEvent()}})})},fl=(t,e)=>{he(t,e).show()};Xt();Yt();Gt();window.initTooltips=Xt;window.ajaxTooltip=Yt;window.showTooltip=fl;window.initDropdowns=Gt;const Zt=()=>{document.querySelectorAll('form[data-maintenance="1"]').forEach(function(e){e.addEventListener("submit",ml)})},ml=t=>{window.entityFormHasUnsavedChanges=!1,t.preventDefault();const e=t.target;hl(e);let n=new FormData(e);axios.post(e.getAttribute("action"),n).then(()=>{e.submit()}).catch(i=>{i.response&&window.formErrorHandler(i.response,e),pl(e)})},hl=t=>{t.querySelectorAll(".btn-primary").forEach((n,i)=>{i===0&&n.classList.add("loading"),n.classList.add("btn-disabled")})},pl=t=>{t.querySelectorAll(".btn-primary").forEach(n=>{n.classList.remove("btn-disabled","loading")})};Zt();window.onEvent(function(){Zt()});window.onEvent(function(){window.initForeignSelect(),window.initTags(),window.initDialogs(),window.initTooltips(),window.ajaxTooltip(),window.initDropdowns(),window.initSortable(),je(),en(),Jt(),tn(),nn(),xl()});function gl(){let t=document.getElementById("ad-client");t&&fetch(t.src,{}).catch(()=>{let e=document.getElementById("adblock-plea");e&&e.classList.remove("hidden")})}const vl=()=>{document.querySelectorAll(".nav-tabs li a")?.forEach(function(e){e.addEventListener("click",function(n){n.preventDefault();const i=e.closest(".nav-tabs-custom");i.querySelectorAll(".nav-tabs li").forEach(function(o){o.classList.remove("active")}),e.parentNode.classList.add("active"),i.querySelectorAll(".tab-pane").forEach(function(o){o.classList.remove("active")}),document.querySelector(e.getAttribute("href")).classList.add("active")})})},Jt=()=>{document.querySelectorAll('[data-img="delete"]')?.forEach(function(t){t.addEventListener("click",function(e){e.preventDefault(),document.querySelector("input[name="+t.dataset.target+"]").value=1,t.closest(".preview").classList.add("hidden")})})},je=()=>{document.querySelectorAll(".pagination-ajax-links a").forEach(function(t){t.dataset.loaded!=="1"&&(t.dataset.loaded="1",t.addEventListener("click",function(e){e.preventDefault();const n=document.querySelector(".pagination-ajax-body");n.querySelector(".modal-loading").classList.remove("hidden"),n.querySelector(".pagination-ajax-content").classList.add("hidden"),fetch(t.getAttribute("href")).then(i=>i.text()).then(i=>{n.parentNode.innerHTML=i,je(),window.triggerEvent()})}))})},en=()=>{document.querySelectorAll('[data-toggle="confirm-delete"]')?.forEach(function(t){t.dataset.loaded!=="1"&&(t.dataset.loaded="1",t.addEventListener("click",function(e){if(e.preventDefault(),t.dataset.confirming==="1"){t.classList.add("loading"),t.innerHTML="";const n=document.querySelector(t.dataset.target);n?n.requestSubmit():console.error("Unknown target",n);return}t.dataset.confirming="1",t.querySelector("span").classList.add("md:inline"),t.querySelector("span").innerHTML=t.dataset.confirm}))}),document.querySelectorAll('a[data-toggle="delete-form"]')?.forEach(function(t){t.dataset.loaded!=="1"&&(t.dataset.loaded="1",t.addEventListener("click",function(e){e.preventDefault(),document.querySelector(t.dataset.target).requestSubmit()}))})},yl=()=>{document.querySelector(".submenu-switcher")?.addEventListener("change",function(t){t.preventDefault();const e=t.target,n=e.options[e.selectedIndex];window.location.href=n.dataset.route})},bl=()=>{const e={window:window.innerHeight,header:document.querySelector("header")?Se(document.querySelector("header")):0,footer:document.querySelector(".main-footer")?Se(document.querySelector(".main-footer")):0,sidebar:document.querySelector(".main-sidebar .sidebar")?Se(document.querySelector(".main-sidebar .sidebar")):0,controlSidebar:0},n=wl(e),i=document.querySelector(".content-wrapper");n===e.controlSidebar?i.style.minHeight=n:n===e.window?i.style.minHeight=n-e.header-e.footer:i.style.minHeight=n-e.header},Se=(t,e=!1)=>{let n=t.getBoundingClientRect().height;if(e){const i=getComputedStyle(t);n+=parseInt(i.marginTop)+parseInt(i.marginBottom)}return n},wl=t=>{let e=0;return Object.keys(t).forEach(n=>{t[n]>e&&(e=t[n])}),e},tn=()=>{document.querySelectorAll(".btn-feedback").forEach(e=>{e.dataset.feedback||(e.dataset.feedback=1,e.addEventListener("click",i=>{i.target.classList.add("loading")},!1))});const t=document.getElementById("quick-privacy-select");t&&t.addEventListener("change",function(){const e=this.dataset.url;axios.post(e).then(n=>{window.showToast(n.data.toast);let i=document.querySelector("body");n.data.status?i.classList.add("kanka-entity-private"):i.classList.remove("kanka-entity-private")})})},nn=()=>{document.querySelectorAll("[data-dismisses]").forEach(e=>{e.addEventListener("click",function(n){n.preventDefault();let i=document.querySelector(this.dataset.dismisses);i.classList.remove("opacity-100"),i.classList.add("opacity-0"),setTimeout(function(){i.remove()},150)})})},xl=()=>{const t=document.querySelector(".btn-manage-perm");t&&t.addEventListener("click",function(e){e.preventDefault(),window.closeDialog("primary-dialog");let n=t.dataset.target;document.querySelector(n).click()})};bl();window.initForeignSelect();window.initDialogs();yl();vl();_n();je();en();Jt();tn();nn();gl();

import{d as M,D as P,o as V,E as $,a as s,c as n,b as l,p as u,w as z,v as K,f as _,g as x,F as y,r as B,t as C,e as q,h as d}from"./vendor-tiptap-BMQcrX0l.js";import{a as D}from"./index-D5GkNzM3.js";import{_ as A}from"./_plugin-vue_export-helper-DlAUqK2U.js";const H={class:"gallery-container w-[800px] max-w-[90vw] max-h-[80vh] flex flex-col"},J={class:"gallery-header flex items-center justify-between p-4"},O={class:"p-4 space-y-3"},Q={class:"flex gap-2"},W={class:"relative flex-1"},X={key:0,class:"flex items-center gap-2 text-sm"},Y={class:"text-base-content/70"},Z={class:"gallery-content flex-1 overflow-y-auto p-4"},ee={key:0,class:"flex items-center justify-center py-12"},te={key:1,class:"flex items-center justify-center py-12 text-base-content/50"},le={key:2,class:"grid grid-cols-4 gap-4"},ae=["onClick"],se={key:0,class:"absolute inset-0 flex flex-col items-center justify-center gap-2"},ne={class:"text-sm text-neutral-content truncate max-w-full px-2"},re=["src","alt"],oe={class:"absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/70 to-transparent p-2 opacity-0 group-hover:opacity-100 transition-opacity"},ie={class:"text-white text-xs truncate block"},ue={key:0,class:"gallery-footer flex items-center justify-center gap-2 p-4 border-t border-base-300"},de=["disabled"],ce=["disabled"],ve=M({__name:"GalleryDialog",setup(fe){const h=d(null),b=d([]),m=d(!1),c=d(""),o=d(""),k=d(""),f=d({first:null,last:null,prev:null,next:null}),v=d([]),T=d(null);let i=null,r=null;const S=t=>{T.value=t.detail.editor,k.value=t.detail.galleryUrl,o.value=`${t.detail.galleryUrl}?setup`,v.value=[],c.value="",p(o.value),h.value?.showModal()},w=()=>{r&&(clearTimeout(r),r=null),i&&(i.abort(),i=null),h.value?.close()},p=async t=>{i&&i.abort(),i=new AbortController,m.value=!0;try{const e=await D.get(t,{signal:i.signal});b.value=e.data.data||[],f.value={first:e.data.links?.first||null,last:e.data.links?.last||null,prev:e.data.links?.prev||null,next:e.data.links?.next||null}}catch(e){if(D.isCancel(e))return;console.error("Failed to load gallery images:",e),b.value=[]}finally{m.value=!1}},g=()=>{r&&(clearTimeout(r),r=null),v.value=[];const t=new URL(k.value);t.searchParams.set("setup",""),c.value&&t.searchParams.set("term",c.value),o.value=t.toString(),p(o.value)},R=()=>{r&&clearTimeout(r),r=setTimeout(()=>{g()},500)},E=t=>{t.key==="Enter"&&(t.preventDefault(),g())},G=()=>{c.value="",g()};P(c,(t,e)=>{t!==e&&R()});const L=t=>{!t.folder||!t.url||(v.value.push({url:o.value,name:t.name}),o.value=t.url,p(t.url))},N=()=>{if(v.value.length===0)return;const t=v.value.pop();t&&(o.value=t.url,p(t.url))},F=()=>{v.value=[];const t=new URL(k.value);o.value=t.toString(),p(o.value)},U=t=>{t&&(o.value=t,p(t))},I=t=>{if(t.folder){L(t);return}T.value?.chain().focus().setImage({src:t.src,alt:t.name,"data-gallery-uuid":t.uuid}).run(),w()};return V(()=>{window.addEventListener("tiptap:open-gallery",S)}),$(()=>{window.removeEventListener("tiptap:open-gallery",S),r&&clearTimeout(r),i&&i.abort()}),(t,e)=>(s(),n("dialog",{ref_key:"dialogRef",ref:h,class:"gallery-dialog rounded-2xl bg-base-100 p-0 backdrop:bg-black/50",onClick:u(w,["self"])},[l("div",H,[l("div",J,[e[4]||(e[4]=l("h2",{class:""},"Gallery",-1)),l("button",{onClick:u(w,["prevent"]),class:"btn2 btn-ghost"},[...e[3]||(e[3]=[l("i",{class:"fa-regular fa-times","aria-hidden":"true"},null,-1)])])]),l("div",O,[l("div",Q,[l("div",W,[z(l("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>c.value=a),type:"text",placeholder:"Search images...",class:"input input-bordered w-full pr-10",onKeydown:E},null,544),[[K,c.value]]),c.value?(s(),n("button",{key:0,onClick:u(G,["prevent"]),class:"absolute right-3 top-1/2 -translate-y-1/2 text-base-content/50 hover:text-base-content"},[...e[5]||(e[5]=[l("i",{class:"fa-regular fa-times","aria-hidden":"true"},null,-1)])])):_("",!0)]),l("button",{onClick:u(g,["prevent"]),class:"btn2 btn-primary"},[...e[6]||(e[6]=[l("i",{class:"fa-regular fa-search","aria-hidden":"true"},null,-1),x(" Search ",-1)])])]),v.value.length>0?(s(),n("div",X,[l("button",{onClick:u(F,["prevent"]),class:"btn2 btn-ghost btn-xs"},[...e[7]||(e[7]=[l("i",{class:"fa-regular fa-home","aria-hidden":"true"},null,-1)])]),e[10]||(e[10]=l("span",{class:"text-base-content/50"},"/",-1)),(s(!0),n(y,null,B(v.value,(a,j)=>(s(),n(y,{key:j},[l("span",Y,C(a.name),1),e[8]||(e[8]=l("span",{class:"text-base-content/50"},"/",-1))],64))),128)),l("button",{onClick:u(N,["prevent"]),class:"btn2 btn-ghost btn-xs"},[...e[9]||(e[9]=[l("i",{class:"fa-regular fa-arrow-left","aria-hidden":"true"},null,-1),x(" Back ",-1)])])])):_("",!0)]),l("div",Z,[m.value?(s(),n("div",ee,[...e[11]||(e[11]=[l("i",{class:"fa-solid fa-spinner fa-spin text-2xl","aria-hidden":"true"},null,-1)])])):b.value.length===0?(s(),n("div",te," No images found ")):(s(),n("div",le,[(s(!0),n(y,null,B(b.value,a=>(s(),n("button",{key:a.uuid,onClick:u(j=>I(a),["prevent"]),class:"gallery-item group relative aspect-square rounded-lg overflow-hidden border border-base-300 hover:border-primary transition-colors cursor-pointer bg-base-200"},[a.folder?(s(),n("div",se,[l("i",{class:q([a.icon,"text-4xl text-neutral-content"]),"aria-hidden":"true"},null,2),l("span",ne,C(a.name),1)])):(s(),n(y,{key:1},[l("img",{src:a.thumbnail,alt:a.name,class:"absolute inset-0 w-full h-full object-cover",loading:"lazy"},null,8,re),l("div",oe,[l("span",ie,C(a.name),1)])],64))],8,ae))),128))]))]),f.value.prev||f.value.next?(s(),n("div",ue,[l("button",{onClick:e[1]||(e[1]=u(a=>U(f.value.prev),["prevent"])),disabled:!f.value.prev,class:"btn2 btn-ghost btn-xs"},[...e[12]||(e[12]=[l("i",{class:"fa-regular fa-chevron-left","aria-hidden":"true"},null,-1),x(" Previous ",-1)])],8,de),l("button",{onClick:e[2]||(e[2]=u(a=>U(f.value.next),["prevent"])),disabled:!f.value.next,class:"btn2 btn-ghost btn-xs"},[...e[13]||(e[13]=[x(" Next ",-1),l("i",{class:"fa-regular fa-chevron-right","aria-hidden":"true"},null,-1)])],8,ce)])):_("",!0)])],512))}}),xe=A(ve,[["__scopeId","data-v-9a3bf134"]]);export{xe as default};

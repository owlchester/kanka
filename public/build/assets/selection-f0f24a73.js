import{d as N,y as s,z as Y,c as t,e as g,a as l,g as $,F as H,r as q,b as n,n as V,o as J,j as A,v as G,l as Q,p as W}from"./vue.esm-bundler-bbd25308.js";const Z={key:0},ee=l("i",{class:"fa-solid fa-spin fa-spinner2","aria-label":"Loading"},null,-1),le=[ee],ae={class:"bg-base-200 sm:rounded-t"},se=l("h4",null," Gallery ",-1),te=l("i",{class:"fa-regular fa-circle-xmark","aria-hidden":"true"},null,-1),ne=l("span",{class:"sr-only"},"Close",-1),oe=[te,ne],re={class:"max-w-4xl"},ue={key:0,class:"flex gap-1 w-full"},ie={class:"grow"},de=l("i",{class:"fa-solid fa-grid-2","aria-label":"Large images"},null,-1),ce=[de],ve=l("i",{class:"fa-solid fa-grid-4","aria-label":"Small images"},null,-1),pe=[ve],fe={key:1,class:"md:h-36 md:w-80 text-center flex items-center justify-center w-full"},ge=l("i",{class:"fa-solid fa-spinner fa-spin","aria-label":"Loading"},null,-1),me=[ge],he=["onClick"],_e=["title"],ye=["innerHTML"],be=["innerHTML"],we=N({__name:"Browser",props:{api:null,opened:{type:Boolean}},emits:["selected","closed"],setup(T,{emit:i}){const C=T,d=s(!0),m=s(!1),v=s(),_=s([]),y=s(""),h=s(""),u=s(null),w=s(null),I=300,c=s("large"),D=()=>{d.value=!0,v.value.showModal(),v.value.addEventListener("click",function(e){let o=this.getBoundingClientRect();!(o.top<=e.clientY&&e.clientY<=o.top+o.height&&o.left<=e.clientX&&e.clientX<=o.left+o.width)&&e.target.tagName==="DIALOG"&&x()}),axios.get(C.api).then(e=>{_.value=e.data.images,d.value=!1}).catch(e=>{d.value=!1,e.response.status===403&&(w.value=e.response.data.message)})},x=()=>{v.value.close(),i("closed")},k=e=>(e=e??"",c.value==="large"?"w-48 h-36 "+e:"w-20 h-16 "+e),U=e=>(e=e??"",c.value==="large"?"w-48 "+e:"w-20 text-xs "+e),E=()=>c.value==="small"?"flex flex-wrap gap-2 md:gap-3":"flex flex-wrap gap-2 md:gap-5",S=e=>{if(e.folder){d.value=!0,axios.get(e.url).then(o=>{_.value=o.data.images,d.value=!1});return}i("selected",e),x()};Y(()=>C.opened,(e,o)=>{e&&D()});const L=e=>{y.value=e.target.value,u.value&&clearTimeout(u.value),u.value=setTimeout(()=>{F()},I)},F=()=>{h.value!=y.value&&(h.value=y.value,m.value=!0,axios.get(C.api+"?term="+h.value).then(e=>{_.value=e.data.images,m.value=!1}))},M=e=>{c.value=e};return(e,o)=>(n(),t(H,null,[d.value?(n(),t("div",Z,le)):g("",!0),l("dialog",{class:"dialog rounded-2xl text-center",id:"gallery-dialog",ref_key:"galleryDialog",ref:v,"aria-modal":"true","aria-labelledby":"modal-card-label"},[l("header",ae,[se,l("button",{type:"button",class:"text-base-content",onClick:o[0]||(o[0]=p=>x()),title:"Close"},oe)]),l("article",re,[!d.value&&!w.value?(n(),t("div",ue,[l("div",ie,[l("input",{type:"text",class:"w-full",placeholder:"Search for an image in the gallery",onInput:L},null,32)]),c.value!=="large"?(n(),t("div",{key:0,class:"flex-none cursor-pointer btn2 btn-ghost btn-sm",onClick:o[1]||(o[1]=p=>M("large"))},ce)):g("",!0),c.value!=="small"?(n(),t("div",{key:1,class:"flex-none cursor-pointer btn2 btn-ghost btn-sm",onClick:o[2]||(o[2]=p=>M("small"))},pe)):g("",!0)])):g("",!0),d.value||m.value?(n(),t("div",fe,me)):(n(),t("div",{key:2,class:$(E())},[(n(!0),t(H,null,q(_.value,p=>(n(),t("div",{class:"cursor-pointer shadow rounded overflow-hidden hover:shadow-lg",onClick:z=>S(p)},[p.folder?(n(),t("div",{key:1,class:$(k("flex items-center align-middle justify-center text-4xl"))},[l("i",{class:$(p.icon),"aria-label":"Folder"},null,2)],2)):(n(),t("div",{key:0,class:$(k("cover-background")),style:V({backgroundImage:"url("+p.thumbnail+")"})},null,6)),l("div",{class:$(U("truncate p-2")),title:p.name},[l("span",{innerHTML:p.name},null,8,ye)],10,_e)],8,he))),256)),w.value?(n(),t("div",{key:0,class:"alert alert-error p-2 rounded",innerHTML:w.value},null,8,be)):g("",!0)],2))])],512)],64))}}),ke={key:0},xe=l("i",{class:"fa-solid fa-spin fa-spinner2","aria-label":"Loading"},null,-1),$e=[xe],Ce={key:1,class:"flex items-center gap-1"},Te=["accept"],Le={key:2,class:"flex items-center gap-1"},Ie={key:0,class:"fa-solid fa-spin fa-spinner","aria-label":"Downloading"},De={key:3,class:"flex items-center gap-1"},Ue={key:0,class:"flex gap-2 flex-col w-full"},Fe={class:"progress h-1 w-full"},Me=l("span",{class:"sr-only"},null,-1),Ee=[Me],Se=l("span",{class:"grow"},"Cancel",-1),Be=["innerHTML"],He=["name"],Ve={key:2,type:"hidden",name:"remove-image",value:"1"},ze=N({__name:"Selection",props:{file:null,url:null,accepts:null,uuid:null,thumbnail:null,browse:null,field:null,old:null},setup(T){const i=T,C=s(!0),d=s(!1),m=s(!1),v=s(),_=s(),y=s(),h=s(),u=s(),w=s(!1),I=s(0),c=s(null);let D;const x=s(null),k=s(!1),U=s(!1);J(()=>{C.value=!1,h.value=i.thumbnail,u.value=i.uuid,i.old==="true"&&(k.value=!0)});const E=()=>{let a="relative flex items-end align-middle rounded overflow-hidden";return F()?a+=" cover-background preview-bg w-48 h-36 p-2 ":a+="w-full",a},S=()=>m.value?"hidden":"flex gap-2 flex-col w-full",L=()=>k.value||u.value!==null&&u.value!=="",F=()=>c.value||k.value?!0:u.value!==null&&u.value!=="",M=()=>{u.value=null,h.value=null,k.value&&(k.value=!1,U.value=!0)},e=()=>c.value?"url("+c.value+")":h.value?"url("+h.value+")":"",o=()=>I.value+"%",p=()=>{w.value=!0},z=()=>{!v.value||v.value==D||(d.value=!0,_.value.disabled=!0,D=v.value,axios.post(i.url,{url:v.value}).then(a=>{_.value.disabled=!1,d.value=!1,v.value=null,h.value=a.data.thumbnail,u.value=a.data.uuid}).catch(a=>{_.value.disabled=!1,d.value=!1,_.value.focus(),O(a)}))},P=async a=>{const r=a.target.files[0];if(!r){m.value=!1;return}const f=new FileReader;f.onload=b=>{c.value=b.target.result},f.readAsDataURL(r),m.value=!0,document.addEventListener("keydown",B),x.value=axios.CancelToken.source(),y.value.disabled=!0;const j=new FormData;j.append("file",r),axios.post(i.file,j,{headers:{"Content-Type":"multipart/form-data"},cancelToken:x.value.token,onUploadProgress:function(b){I.value=Math.round(b.loaded*100/b.total)}}).then(b=>{m.value=!1,y.value.disabled=!1,y.value=null,h.value=b.data.thumbnail,u.value=b.data.uuid,c.value=null,document.removeEventListener("keydown",B)}).catch(b=>{m.value=!1,y.value.disabled=!1,c.value=null,axios.isCancel(b)?y.value=null:O(b),document.removeEventListener("keydown",B)})},O=a=>{if(!a.response)return;if(a.response.data.error){window.showToast(a.response.data.error,"error");return}if(a.response&&a.response.status===403&&a.response.data.message){window.showToast(a.response.data.message,"error");return}Object.keys(a.response.data.errors).forEach(f=>{window.showToast(a.response.data.errors[f][0],"error")})},K=a=>{u.value=a.uuid,h.value=a.thumbnail},X=()=>{w.value=!1},B=a=>{a.key==="Escape"&&m.value&&R()},R=a=>{x.value.cancel("Upload canceled by user.")};return(a,r)=>(n(),t(H,null,[C.value?(n(),t("div",ke,$e)):(n(),t("div",{key:1,class:$(E()),style:V({backgroundImage:e()})},[l("div",{class:$(S())},[F()?(n(),t("div",{key:0,class:"rounded p-2 cursor-pointer backdrop-blur backdrop-opacity-30 bg-red-700/50 text-white hover:backdrop-opacity-100 transition",onClick:r[0]||(r[0]=f=>M())}," Remove ")):g("",!0),L()?g("",!0):(n(),t("div",Ce,[l("input",{type:"file",accept:i.accepts,class:"w-full",onChange:P,ref_key:"fileField",ref:y},null,40,Te)])),L()?g("",!0):(n(),t("div",Le,[A(l("input",{ref_key:"urlField",ref:_,type:"text",class:"w-full","onUpdate:modelValue":r[1]||(r[1]=f=>v.value=f),onBlur:r[2]||(r[2]=f=>z()),placeholder:"Upload an image from a URL"},null,544),[[G,v.value]]),d.value?(n(),t("i",Ie)):g("",!0)])),L()?g("",!0):(n(),t("div",De,[l("span",{role:"button",class:"btn2 btn-default btn-sm",onClick:r[3]||(r[3]=f=>p())},"From gallery")]))],2),m.value?(n(),t("div",Ue,[l("div",Fe,[l("div",{class:"h-1 bg-accent shadow-sm",role:"progressbar","aria-valuenow":"0","aria-valuemin":"0","aria-valuemax":"100",style:V({width:o()})},Ee,4)]),l("div",{class:"rounded p-2 cursor-pointer backdrop-blur backdrop-opacity-30 bg-red-700/50 text-white hover:backdrop-opacity-100 transition flex items-center gap-2",onClick:r[4]||(r[4]=f=>R())},[Se,l("span",{class:"text-xs flex-none",innerHTML:o()},null,8,Be)])])):g("",!0)],6)),A(l("input",{type:"hidden",name:i.field,"onUpdate:modelValue":r[5]||(r[5]=f=>u.value=f)},null,8,He),[[G,u.value]]),U.value?(n(),t("input",Ve)):g("",!0),Q(we,{api:i.browse,opened:w.value,onSelected:K,onClosed:X},null,8,["api","opened"])],64))}}),Oe=document.querySelectorAll(".gallery-selection");Oe.forEach(T=>{const i=W({});i.component("gallery-selection",ze),i.mount(T)});

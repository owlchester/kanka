import{d as A,b as d,c,e as O,a as s,w as N,A as Z,f as m,F as E,r as p,o as ee,g as te,m as se,i as le,q as ne}from"./vue.esm-bundler-613eae9f.js";import{v as ie}from"./v-click-outside.umd-1708c20a.js";import"./_commonjsHelpers-725317a4.js";const oe={class:"flex gap-2 items-center"},ae={class:"flex-none flex items-center"},re=["innerHTML"],de=["innerHTML"],ue={class:"flex items-center gap-2 md:gap-4"},ce={class:"grow text-neutral-content"},pe=["innerHTML"],ve={key:0,class:"flex-none"},fe=["innerHTML"],me={key:1,class:"rounded shadow p-4 flex gap-2 items-center bg-base-200 hover:shadow-lg"},_e=["innerHTML"],ge=["innerHTML"],he=A({__name:"Element",props:{model:{},i18n:{}},emits:["recover"],setup(T,{emit:H}){const y=H,a=T,x=()=>{a.model.url||(a.model.is_selected=!a.model.is_selected)},_=()=>{let n="rounded shadow bg-base-100 flex flex-col gap-2 md:gap-4 p-4 hover:shadow-lg";return a.model.url||(n=n+" cursor-pointer"),a.model.is_selected?n+" bg-base-200":n+"  "},h=(n,r=[])=>{if(!a.i18n[n])return console.error("Missing trans",n,a.i18n),"MISSING";let v=a.i18n[n];return r.forEach(L=>{v=v.replace("placeholder",L)}),v},k=()=>{let n="btn2 btn-default btn-sm";return a.model.is_recovering&&(n+=" loading btn-disabled"),n},o=()=>{y("recover",a.model)};return(n,r)=>(d(),c(E,null,[!n.model.is_hidden&&!n.model.url?(d(),c("div",{key:0,class:O(_()),onClick:x},[s("div",oe,[s("div",ae,[n.model.url?m("",!0):N((d(),c("input",{key:0,type:"checkbox","onUpdate:modelValue":r[0]||(r[0]=v=>n.model.is_selected=v),onClick:r[1]||(r[1]=(...v)=>n.startBulking&&n.startBulking(...v))},null,512)),[[Z,n.model.is_selected]])]),s("div",{class:"grow font-extrabold truncate",innerHTML:n.model.name},null,8,re),s("div",{class:"rounded-xl px-3 py-1 text-xs bg-base-200",innerHTML:n.model.type_name},null,8,de)]),r[3]||(r[3]=s("hr",null,null,-1)),s("div",ue,[s("div",ce,[s("span",{class:"text-xs",innerHTML:h("deleted_at",[n.model.date,n.model.deleted_name])},null,8,pe)]),n.model.url?m("",!0):(d(),c("div",ve,[s("button",{class:O(k()),onClick:r[2]||(r[2]=v=>o()),innerHTML:h("recover")},null,10,fe)]))])],2)):m("",!0),!n.model.is_hidden&&n.model.url?(d(),c("div",me,[r[4]||(r[4]=s("div",{class:"flex-none"},[s("i",{class:"fa-solid text-green-500 fa-circle-check","aria-hidden":"true"})],-1)),s("div",{class:"grow",innerHTML:h("recovery_success",[n.model.url,n.model.name])},null,8,_e),s("div",{class:"rounded-xl px-3 py-1 text-xs bg-base-300",innerHTML:n.model.type_name},null,8,ge)])):m("",!0)],64))}}),be={key:0,class:"text-center text-4xl p-4"},ye={key:1,class:"flex flex-col gap-4 md:gap-5"},xe={class:"flex gap-4 flex-wrap sticky top-14 z-50"},ke={class:"flex gap-2 grow"},Le={class:"flex gap-0.5"},Me={class:"relative"},Te=["innerHTML"],He={key:0,class:"border shadow rounded bg-base-100 p-4 absolute right-0 flex flex-col gap-5 w-60"},we=["innerHTML"],Ce=["innerHTML"],Ee=["innerHTML"],$e={class:"flex gap-2 self-end flex-wrap"},Ie=["innerHTML"],Be=["innerHTML"],Se=["innerHTML"],De=["innerHTML"],Oe={key:0,class:"text-center text-4xl p-4"},Ae={key:1,class:"flex flex-col gap-4"},Ne={class:"flex gap-2 flex-row"},Re={class:"grid grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-4 md:gap-5"},Fe={class:"bg-base-200 sm:rounded-t"},Ge=["innerHTML"],Ve={class:"max-w-4xl flex flex-col gap-2 text-left"},je={class:"flex flex-col gap-1 w-full"},ze=["innerHTML"],Xe={class:"bg-base-200 p-2"},Ye={class:""},qe=["href","innerHTML"],Ue=A({__name:"Recovery",props:{api:{}},setup(T){const H=T,y=p(!1),a=p(!1),x=p(!1),_=p(),h=p(),k=p(null),o=p([]),n=p("newest"),r=p(),v=p(),L=p(),b=p(!1),g=p(!1),I=p();ee(()=>{axios.get(H.api).then(e=>{y.value=!0,o.value=e.data.elements,r.value=e.data.i18n,L.value=e.data.api.recovery,x.value=e.data.acl.premium,I.value=e.data.upgrade})});const f=e=>r.value[e]?r.value[e]:(console.error("Missing trans",e,r),"MISSING"),R=e=>{let t=o.value.find(u=>u.id===e.id);!t.url&&!t.is_hidden&&(t.is_selected=!0)},F=e=>{let t=o.value.find(u=>u.id===e.id);t.is_selected=!1},G=e=>{if(!x.value){B(v.value);return}let t=o.value.find(i=>i.id===e.id);if(t.is_recovering=!0,b.value)return;b.value=!0;let u={};t.type_code==="post"?(u.posts=[t.id],u.entities=[]):(u.entities=[t.id],u.posts=[]),axios.post(L.value,u).then(i=>{b.value=!1,Object.keys(i.data.entities).map(l=>i.data.entities[l]);let M=o.value.filter(l=>l.is_recovering&&l.type=="entity"),C=o.value.filter(l=>l.is_recovering&&l.type=="post");M.forEach(l=>{l.is_selected=!1,l.is_recovering=!1,i.data.entities[l.id]&&(l.url=i.data.entities[l.id])}),C.forEach(l=>{l.is_selected=!1,l.is_recovering=!1,i.data.posts[l.id]&&(l.url=i.data.posts[l.id])}),window.showToast(i.data.toast)})},V=()=>{o.value.forEach(R)},j=()=>{o.value.forEach(F)},z=e=>{_.value=e.target.value.toLowerCase(),k.value&&clearTimeout(k.value),k.value=setTimeout(()=>{X()},300)},X=()=>{if(h.value!=_.value){if(h.value=_.value,!_.value){o.value.forEach(e=>{e.is_hidden=!1});return}a.value=!0,K()}},w=()=>o.value.filter(t=>t.is_selected).length!==0,Y=()=>{if(!x.value){B(v.value);return}if(b.value)return;let e=o.value.filter(i=>i.is_selected&&i.type=="entity").map(i=>i.id),t=o.value.filter(i=>i.is_selected&&i.type=="post").map(i=>i.id);if(e.length===0&&t.length===0)return;b.value=!0;let u={};u.entities=e,u.posts=t,axios.post(L.value,u).then(i=>{b.value=!1,Object.keys(i.data.entities).map(l=>i.data.entities[l]);let M=o.value.filter(l=>l.is_selected&&l.type=="entity"),C=o.value.filter(l=>l.is_selected&&l.type=="post");M.forEach(l=>{l.is_selected=!1,i.data.entities[l.id]&&(l.url=i.data.entities[l.id])}),C.forEach(l=>{l.is_selected=!1,i.data.posts[l.id]&&(l.url=i.data.posts[l.id])}),window.showToast(i.data.toast)})},q=()=>{let e=o.value.filter(t=>t.is_selected).length;if(e!==0)return"("+e+")"},U=()=>{g.value=!g.value},J=()=>{g.value=!1},K=()=>{o.value.forEach(e=>{e.name.toLowerCase().includes(_.value)?e.is_hidden=!1:e.is_hidden=!0}),a.value=!1},P=()=>{a.value=!0,o.value.sort(function(e,t){return e.position-t.position}),a.value=!1,g.value=!1,n.value="newest"},Q=()=>{a.value=!0,o.value.sort(function(e,t){return t.position-e.position}),a.value=!1,g.value=!1,n.value="oldest"},W=()=>{a.value=!0,o.value.sort(function(e,t){return e.type_name.localeCompare(t.type_name)}),a.value=!1,g.value=!1,n.value="type"},B=e=>{e.showModal(),e.addEventListener("click",S)},S=e=>{let t=e.target.getBoundingClientRect();!(t.top<=e.clientY&&e.clientY<=t.top+t.height&&t.left<=e.clientX&&e.clientX<=t.left+t.width)&&e.target.tagName==="DIALOG"&&D(e.target)},D=e=>{e.removeEventListener("click",S),e.close()};return(e,t)=>{const u=se("click-outside");return d(),c(E,null,[y.value?(d(),c("div",ye,[s("div",xe,[s("div",ke,[s("div",Le,[s("input",{type:"text",placeholder:"Search",onInput:z},null,32)]),s("div",Me,[s("button",{class:"btn2 btn-default btn-sm",onClick:U},[t[2]||(t[2]=s("i",{class:"fa-solid fa-filter","aria-hidden":"true"},null,-1)),s("span",{innerHTML:f("order_by_"+n.value),class:"hidden md:inline"},null,8,Te)]),g.value?N((d(),c("div",He,[s("label",{onClick:P,class:"cursor-pointer",innerHTML:f("newest")},null,8,we),s("label",{onClick:Q,class:"cursor-pointer",innerHTML:f("oldest")},null,8,Ce),s("label",{onClick:W,class:"cursor-pointer",innerHTML:f("type")},null,8,Ee)])),[[u,J]]):m("",!0)])]),s("div",$e,[w()?m("",!0):(d(),c("button",{key:0,class:"btn2 btn-default btn-sm",onClick:V},[t[3]||(t[3]=s("i",{class:"fa-solid fa-list-check","aria-hidden":"true"},null,-1)),s("span",{innerHTML:f("select_all")},null,8,Ie)])),w()?(d(),c("button",{key:1,class:"btn2 btn-default btn-sm",onClick:j},[t[4]||(t[4]=s("i",{class:"fa-solid fa-xmark","aria-hidden":"true"},null,-1)),s("span",{innerHTML:f("deselect_all")},null,8,Be)])):m("",!0),w()?(d(),c("button",{key:2,class:"btn2 btn-primary btn-sm",onClick:Y},[t[5]||(t[5]=s("i",{class:"fa-solid fa-plus","aria-hidden":"true"},null,-1)),s("span",{innerHTML:f("restore_selected")},null,8,Se),s("span",{innerHTML:q()},null,8,De)])):m("",!0)])]),a.value?(d(),c("div",Oe,t[6]||(t[6]=[s("i",{class:"fa-solid fa-spinner fa-spin","aria-label":"Loading"},null,-1)]))):(d(),c("div",Ae,[s("div",Ne,[s("div",Re,[(d(!0),c(E,null,te(o.value,i=>(d(),le(he,{model:i,i18n:r.value,onRecover:M=>G(i)},null,8,["model","i18n","onRecover"]))),256))])])]))])):(d(),c("div",be,t[1]||(t[1]=[s("i",{class:"fa-solid fa-spinner fa-spin","aria-label":"Loading"},null,-1)]))),y.value?(d(),c("dialog",{key:2,ref_key:"premiumDialog",ref:v,class:"dialog rounded-2xl text-center"},[s("header",Fe,[s("h4",{innerHTML:f("premium_title")},null,8,Ge),s("button",{type:"button",class:"text-base-content",onClick:t[0]||(t[0]=i=>D(v.value)),title:"Close"},t[7]||(t[7]=[s("i",{class:"fa-regular fa-circle-xmark","aria-hidden":"true"},null,-1),s("span",{class:"sr-only"},"Close",-1)]))]),s("article",Ve,[s("div",je,[s("label",{innerHTML:f("premium")},null,8,ze)])]),s("footer",Xe,[s("menu",Ye,[s("a",{href:I.value,innerHTML:f("upgrade"),class:"btn2 btn-default"},null,8,qe)])])],512)):m("",!0)],64)}}}),$=ne({});$.component("recovery",Ue);$.use(ie);$.mount("#recovery");

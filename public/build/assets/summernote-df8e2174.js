const n=document.querySelector("#summernote-config");let i=!1;window.initSummernote=function(){var e;(e=document.querySelectorAll(".html-editor"))==null||e.forEach(function(t){f(t)})};const f=e=>{$(e).summernote({height:"300px",maximumImageFileSize:parseInt(n.dataset.filesize)*1024,lang:p(n.dataset.locale),hintSelect:"next",placeholder:n.dataset.placeholder,dialogsInBody:n.dataset.dialogs===1,toolbar:[["style",["style"]],["font",["bold","italic","underline","strikethrough","clear"]],["color",["color"]],["kanka",["aroba",n.dataset.bragi!==void 0?"bragi":null]],["para",["ul","ol","kanka-indent","kanka-outdent","paragraph"]],["table",["table","tableofcontent"]],["insert",["link","picture","video","embed","hr"]],["view",["fullscreen","codeview","prettify"]],n.dataset.gallery?["extensions",["summernoteGallery","help"]]:null],popover:{table:[["add",["addRowDown","addRowUp","addColLeft","addColRight"]],["delete",["deleteRow","deleteCol","deleteTable"]],["custom",["tableHeaders"]],["custom",["tableStyles"]]],image:[["image",["resizeFull","resizeHalf","resizeQuarter","resizeNone"]],["float",["floatLeft","floatRight","floatNone"]],["remove",["removeMedia"]],["custom",["imageAttributes"]]]},callbacks:{onImageUpload:function(t){g($(e),t[0])},onChange:function(){window.entityFormHasUnsavedChanges=!0},onChangeCodeview:function(t,a){$(e).summernote("code",t)}},summernoteGallery:{source:{url:n.dataset.gallery,responseDataKey:"data",nextPageKey:"links.next"},modal:{loadOnScroll:!0,maxHeight:350,title:n.dataset.galleryTitle,close_text:n.dataset.galleryClose,ok_text:n.dataset.galleryAdd,selectAll_text:n.dataset.gallerySelectAll,deselectAll_text:n.dataset.galleryDeselectAll,noImageSelected_msg:n.dataset.galleryError}},bragi:{source:{url:n.dataset.bragi},buttonLabel:'<i class="fa-brands fa-pied-piper-hat"></i>'},hint:[{match:/\B@(\S*)$/,search:function(t,a){return t.length<3?[]:c(t,a)},template:function(t){return s(t)},content:function(t){return i=!1,d(t)}},{match:/\B\[(\S[^:]*)$/,search:function(t,a){return t.length<3?[]:c(t,a)},template:function(t){return s(t)},content:function(t){return i=!0,d(t)}},{match:/\B\#(\S*)$/,search:function(t,a){return m(t,a)},template:function(t){return s(t)},content:function(t){return i=!1,d(t)}},{match:/\B{(\S[^:]*)$/,search:function(t,a){return C(t,a)},template:function(t){return h(t)},content:function(t){return T(t)}}],keyMap:{pc:{ESC:"escape",ENTER:"insertParagraph","CTRL+Z":"undo","CTRL+Y":"redo",TAB:"tab","SHIFT+TAB":"untab","CTRL+B":"bold","CTRL+I":"italic","CTRL+U":"underline","CTRL+SHIFT+I":"strikethrough","CTRL+BACKSLASH":"removeFormat","CTRL+SHIFT+L":"justifyLeft","CTRL+SHIFT+E":"justifyCenter","CTRL+SHIFT+R":"justifyRight","CTRL+SHIFT+J":"justifyFull","CTRL+SHIFT+NUM7":"insertUnorderedList","CTRL+SHIFT+NUM8":"insertOrderedList","CTRL+LEFTBRACKET":"outdent","CTRL+RIGHTBRACKET":"indent","CTRL+NUM0":"formatPara","CTRL+NUM1":"formatH1","CTRL+NUM2":"formatH2","CTRL+NUM3":"formatH3","CTRL+NUM4":"formatH4","CTRL+NUM5":"formatH5","CTRL+NUM6":"formatH6","CTRL+ENTER":"insertHorizontalRule","CTRL+K":"linkDialog.show"},mac:{ESC:"escape",ENTER:"insertParagraph","CMD+Z":"undo","CMD+SHIFT+Z":"redo",TAB:"tab","SHIFT+TAB":"untab","CMD+B":"bold","CMD+I":"italic","CMD+U":"underline","CMD+SHIFT+I":"strikethrough","CMD+BACKSLASH":"removeFormat","CMD+SHIFT+L":"justifyLeft","CMD+SHIFT+E":"justifyCenter","CMD+SHIFT+R":"justifyRight","CMD+SHIFT+J":"justifyFull","CMD+SHIFT+NUM7":"insertUnorderedList","CMD+SHIFT+NUM8":"insertOrderedList","CMD+LEFTBRACKET":"outdent","CMD+RIGHTBRACKET":"indent","CMD+NUM0":"formatPara","CMD+NUM1":"formatH1","CMD+NUM2":"formatH2","CMD+NUM3":"formatH3","CMD+NUM4":"formatH4","CMD+NUM5":"formatH5","CMD+NUM6":"formatH6","CMD+ENTER":"insertHorizontalRule","CMD+K":"linkDialog.show"}}})};function c(e,t){axios.get(n.dataset.mention+"?q="+e+"&new=1").then(a=>t(a.data)).catch(a=>{a.resonse.status===503&&window.showToast(a.response.data.message,"error")})}function m(e,t){axios.get(n.dataset.months+"?q="+e).then(a=>t(a.data))}function C(e,t){if(!n.dataset.attributes)return!1;axios.get(n.dataset.attributes+"?q="+e).then(a=>t(a.data))}function s(e){let t=e.type?" ("+e.type+")":"";if(e.image){const a=document.createElement("div");return a.classList.add("entity-hint"),a.innerHTML=e.image+'<div class="entity-hint-name">'+e.fullname+t+"</div>",a}return e.fullname+t}function h(e){return e.name+(e.value?" ("+e.value+")":"")}const d=e=>{if(e.id){const t=document.createElement("span");let a="["+e.model_type+":"+e.id+e.fullname+"]",l="["+e.model_type+":"+e.id+e.advanced_mention+"]";if(e.alias_id)return a="["+e.model_type+":"+e.id+e.advanced_mention+"|alias:"+e.alias_id+e.advanced_mention_alias+"]",t.innerHTML=a,t;if(n.dataset.advancedMention||i)return t.innerHTML=l,t;const r=document.createElement("a");return r.text=e.fullname,r.href="#",r.classList.add("mention"),r.dataset.name=e.fullname,r.dataset.mention="["+e.model_type+":"+e.id+"]",r}else if(e.url){const t=document.createElement("a");return t.text=e.fullname,t.href=e.url,e.tooltip&&(t.title=e.tooltip.replace(/["]/g,"'"),t.dataset.toggle="tooltip",t.dataset.html=!0),t}else if(e.inject)return e.inject;return e.fullname};function T(e){if(n.dataset.advancedMention)return"{attribute:"+e.id+"}";const t=document.createElement("a");return t.href="#",t.classList.add("attribute","attribute-mention"),t.text="{"+e.name+"}",t.dataset.attribute="{attribute:"+e.id+"}",t}function p(e){return e?e=="he"?"he-IL":e=="ca"?"ca-ES":e=="el"?"el-GR":e=="en"?"en-US":e+"-"+e.toUpperCase():"en-US"}const g=(e,t)=>{const a=document.querySelector("#campaign-imageupload-modal");if(!n.dataset.galleryUpload){$(a).modal(),console.warn("Campaign isn't superboosted");return}let l=new FormData;l.append("file[]",t),axios.post(n.dataset.galleryUpload,l).then(r=>{e.summernote("insertImage",r.data.url,function(o){o.attr("src",r.data.url),o.attr("data-gallery-id",r.data.id)})}).catch(r=>{let o=document.querySelector("#campaign-imageupload-error"),u=document.querySelector("#campaign-imageupload-permission");o.classList.add("hidden"),u.classList.add("hidden"),r.response.status===422?(o.innerHTML=L(r.response.data.errors),o.classList.remove("hidden")):r.response.status===403&&u.classList.remove("hidden"),$(a).modal()})},L=e=>{let t="";for(let a in e)e.hasOwnProperty(a)&&(t+=e[a]+`
`);return t};$(document).ready(function(){n&&window.initSummernote()});

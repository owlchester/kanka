import{c as r,j as h,y as c,a as t,F as y,r as g,t as i,f as b,v as f,e as M,g as _,b as m,w as S,q as v}from"./vue.esm-bundler-35c332fe.js";import{_ as P}from"./_plugin-vue_export-helper-c27b6911.js";const w={props:["api_token","trans"],data(){return{stripe:"",elements:"",card:"",intentToken:"",name:"",addPaymentStatus:0,addPaymentStatusError:"",paymentMethods:[],paymentMethodsLoadStatus:0,paymentMethodSelected:0,showNewPaymentMethod:!1,savePaymentMethodStatus:0,deletingPaymentMethodStatus:0,json_trans:[],isLoading:!1}},mounted(){this.includeStripe("js.stripe.com/v3/",(function(){this.configureStripe()}).bind(this)),this.loadIntent(),this.loadPaymentMethods(),this.json_trans=JSON.parse(this.trans)},methods:{includeStripe(s,e){let d=document,l="script",o=d.createElement(l),a=d.getElementsByTagName(l)[0];o.src="https://"+s,e&&o.addEventListener("load",function(n){e(null,n)},!1),a.parentNode.insertBefore(o,a)},configureStripe(){this.stripe=Stripe(this.api_token),this.elements=this.stripe.elements(),this.card=this.elements.create("card",{hidePostalCode:!0}),this.card.mount("#card-element")},loadIntent(){axios.get("/subscription-api/setup-intent").then((function(s){this.intentToken=s.data}).bind(this))},submitPaymentMethod(){this.addPaymentStatus=1,this.savePaymentMethodStatus=1,this.isLoading=!0,console.log("wa"),this.stripe.confirmCardSetup(this.intentToken.client_secret,{payment_method:{card:this.card,billing_details:{name:this.name}}}).then((function(s){this.savePaymentMethodStatus=0,this.isLoading=!1,s.error?(console.log("error",s.error.message),this.addPaymentStatus=3,this.addPaymentStatusError=s.error.message):(this.savePaymentMethod(s.setupIntent.payment_method),this.addPaymentStatus=2,this.addPaymentStatusError="",this.card.clear(),this.name="",this.closeModal("cardModal"))}).bind(this))},savePaymentMethod(s){console.log("save?"),this.paymentMethodsLoadStatus=0,axios.post("/subscription-api/payments",{payment_method:s}).then((function(){console.log("what"),this.loadPaymentMethods()}).bind(this))},loadPaymentMethods(){this.paymentMethodsLoadStatus=1,axios.get("/subscription-api/payment-methods").then((function(s){this.paymentMethods=s.data,this.paymentMethodsLoadStatus=2}).bind(this))},removePaymentMethod(s){this.paymentMethodsLoadStatus=0,axios.post("/subscription-api/remove-payment",{id:s}).then((function(e){this.loadPaymentMethods()}).bind(this))},toggleShowNewPaymentMethod(){this.openModal("cardModal"),this.showNewPaymentMethod=!this.showNewPaymentMethod},translate(s){return this.json_trans[s]??"unknown"},openModal(s){this.$refs[s].showModal(),this.$refs[s].addEventListener("click",function(e){let d=this.getBoundingClientRect();!(d.top<=e.clientY&&e.clientY<=d.top+d.height&&d.left<=e.clientX&&e.clientX<=d.left+d.width)&&e.target.tagName==="DIALOG"&&this.close()})},closeModal(s){this.$refs[s].close()},saveBtnClass(){let s="btn2 btn-primary";return this.isLoading&&(s+=" loading"),s}}},x={class:"text-center"},k={class:"grow"},L={class:"font-extrabold"},C={class:""},N={class:""},E=["onClick"],B={class:"flex gap-2 mb-5"},T={class:"help-block text-neutral-content grow"},j={class:"dialog rounded-2xl text-center",id:"modal-card",ref:"cardModal","aria-modal":"true","aria-labelledby":"modal-card-label"},I={id:"modal-card-label"},D={class:"text-justify"},V={class:"mb-2 w-full field text-left"},A={class:"mb-2 w-full"},R=["innerHTML"],F={class:"help-block text-neutral-content mb-2"},H={class:"grid grid-cols-2 gap-2"};function O(s,e,d,l,o,a){return m(),r("div",null,[h(t("div",x,e[5]||(e[5]=[t("i",{class:"fa-solid fa-spin fa-spinner"},null,-1)]),512),[[c,o.paymentMethodsLoadStatus!=2]]),h(t("div",null,[(m(!0),r(y,null,g(o.paymentMethods,(n,p)=>(m(),r("div",{key:"method-"+p,class:"bg-box shadow-xs mb-5 p-4 rounded flex gap-2 md:gap-4"},[t("div",k,[t("div",L,i(n.brand.charAt(0).toUpperCase())+i(n.brand.slice(1))+" ending in "+i(n.last_four),1),t("div",C," Expires "+i(n.exp_month)+" "+i(n.exp_year),1)]),t("div",N,[t("button",{role:"button",onClick:S(X=>a.removePaymentMethod(n.id),["stop"]),title:"Remove",class:"btn2 btn-outline btn-error btn-sm"}," Remove card ",8,E)])]))),128))],512),[[c,o.paymentMethodsLoadStatus==2&&o.paymentMethods.length>0]]),h(t("div",B,[t("p",T,i(a.translate("add_one")),1),t("a",{href:"#",onClick:e[0]||(e[0]=(...n)=>a.toggleShowNewPaymentMethod&&a.toggleShowNewPaymentMethod(...n)),class:"btn2 btn-secondary btn-sm"},[e[6]||(e[6]=t("i",{class:"far fa-credit-card","aria-hidden":"true"},null,-1)),b(" "+i(a.translate("actions.add_new")),1)])],512),[[c,o.paymentMethodsLoadStatus==2&&o.paymentMethods.length==0]]),t("dialog",j,[t("header",null,[t("h4",I,i(a.translate("new_card")),1),t("button",{type:"button",class:"rounded-full",onClick:e[1]||(e[1]=n=>a.closeModal("cardModal")),title:"Close"},e[7]||(e[7]=[t("i",{class:"fa-solid fa-times","aria-hidden":"true"},null,-1),t("span",{class:"sr-only"},"Close",-1)]))]),t("article",D,[t("div",V,[t("label",null,i(a.translate("card_name")),1),h(t("input",{id:"card-holder-name",type:"text","onUpdate:modelValue":e[2]||(e[2]=n=>o.name=n),class:"w-full"},null,512),[[f,o.name]])]),t("div",A,[t("label",null,i(a.translate("card")),1),e[8]||(e[8]=t("div",{id:"card-element"},null,-1)),o.addPaymentStatusError?(m(),r("p",{key:0,class:"text-red-500 my-2",innerHTML:o.addPaymentStatusError},null,8,R)):M("",!0)]),t("p",F,i(a.translate("helper")),1),t("div",H,[t("button",{type:"button",class:"btn2 btn-ghost",onClick:e[3]||(e[3]=n=>a.closeModal("cardModal"))},"Close"),t("button",{type:"button",class:_(a.saveBtnClass()),onClick:e[4]||(e[4]=(...n)=>a.submitPaymentMethod&&a.submitPaymentMethod(...n)),ref:"formBtn"},i(a.translate("actions.save")),3)])])],512)])}const U=P(w,[["render",O]]),u=v({});u.component("billing-management",U);u.mount("#billing");

import{a as f}from"./index-NIGUFBhG.js";const p=document.querySelector("#gallery-loader"),l=document.querySelector("#gallery-images"),n=document.querySelector("#gallery-search"),u=document.querySelector("#bulk-delete"),y=document.querySelector("form#gallery-bulk"),d=document.getElementById("gallery-form"),c=document.querySelector(".progress"),h=document.querySelector(".gallery-error");let m,L;const S=()=>{const r=document.querySelector("#gallery-config");m=r.dataset.max,L=r.dataset.error,n.addEventListener("blur",function(e){e.preventDefault(),b()}),n.addEventListener("keydown",function(e){e.key==="Enter"&&(e.preventDefault(),b())}),q(),y.onsubmit=function(e){var o;e.preventDefault();const t=new FormData;(o=document.querySelectorAll('li[data-selected="1"]'))==null||o.forEach(s=>{t.append("file[]",s.dataset.id)});const a=document.querySelector('input[name="folder_id"]');return a&&t.append("folder_id",a.value),f.post(y.getAttribute("action"),t).then(s=>{var g;return(g=document.querySelectorAll('li[data-selected="1"]'))==null||g.forEach(E=>E.remove()),document.getElementById("bulk-destroy-dialog").close(),u.classList.add("btn-disabled"),window.showToast(s.data.toast),!1}),!1}},q=()=>{d&&(d.ondrop=r=>{if(r.preventDefault(),r.stopPropagation(),r.dataTransfer.items){let e=new FormData,t=0;if([...r.dataTransfer.items].forEach((o,s)=>{o.kind==="file"&&(e.append("file[]",o.getAsFile()),t++)}),t>m){w();return}let a=document.querySelector('input[name="folder_id"]');a&&e.append("folder_id",a.value),v(e),d.classList.remove("drop-shadow","dropping")}else[...r.dataTransfer.files].forEach((e,t)=>{})},d.ondragover=r=>{r.preventDefault(),d.classList.add("drop-shadow","dropping")},d.ondragleave=r=>{d.classList.remove("drop-shadow","dropping")})};function b(){l.classList.add("hidden"),p.classList.remove("hidden"),f.get(n.dataset.url+"?q="+n.value).then(r=>{p.classList.add("hidden"),l.innerHTML=r.data,l.classList.remove("hidden"),i()})}const A=()=>{d&&(d.onchange=r=>{r.preventDefault();let e=document.getElementById("file-upload");if(e.files.length>m){w();return}let t=new FormData;Array.from(e.files).forEach(o=>{t.append("file[]",o)});let a=document.querySelector('input[name="folder_id"]');a&&t.append("folder_id",a.value),v(t)})},w=()=>{window.showToast(L,"error")},v=r=>{let e={headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(t){let a=Math.round(t.loaded*100/t.total);document.querySelector('[role="progressbar"]').style.width=a+"%"}};c.classList.remove("hidden"),f.post(d.action,r,e).then(function(t){c.classList.add("hidden"),t.data.success&&(t.data.images.forEach(a=>{const o=document.querySelectorAll("li[data-folder]");o.length>1?o[o.length-1].insertAdjacentHTML("afterend",a):l.insertAdjacentHTML("afterbegin",a)}),F(t.data.storage),i())}).catch(function(t){if(c.classList.add("hidden"),t.response&&t.response.data.message){h.innerHTML=t.response.data.message,h.classList.remove("hidden");let a=t.response.data.errors;Object.keys(a).forEach(s=>{window.showToast(a[s],"error")})}i()})},i=()=>{var r;(r=document.querySelectorAll("#gallery-images li"))==null||r.forEach(e=>{e.dataset.binded!=="1"&&(e.dataset.binded="1",e.addEventListener("click",function(t){if(t.shiftKey){if(!e.dataset.id)return;e.classList.toggle("border-2"),e.classList.toggle("border-blue-500"),e.getAttribute("data-selected")==="1"?e.setAttribute("data-selected",""):e.setAttribute("data-selected",1),T();return}let a=e.dataset.folder;if(a){window.location=a;return}window.openDialog("primary-dialog",e.dataset.url)}))})},T=()=>{document.querySelectorAll('li[data-selected="1"]').length===0?u.classList.add("btn-disabled"):u.classList.remove("btn-disabled")},F=r=>{let e=document.getElementById("storage-progress");e.style.width=r.percentage+"%",e.className=r.progress;let t=document.getElementById("storage-used");t.innerHTML=r.used};S();A();i();

const a=document.querySelector("#summernote-config");let l=!1;window.initSummernote=function(){var t;(t=document.querySelectorAll(".html-editor"))==null||t.forEach(function(e){f(e)})};const f=t=>{$(t).summernote({height:"300px",maximumImageFileSize:parseInt(a.dataset.filesize)*1024,lang:L(a.dataset.locale),hintSelect:"next",placeholder:a.dataset.placeholder,dialogsInBody:a.dataset.dialogs===1,toolbar:[["style",["style"]],["font",["bold","italic","underline","strikethrough","clear"]],["color",["color"]],["kanka",["aroba",a.dataset.bragi!==void 0?"bragi":null]],["para",["ul","ol","kanka-indent","kanka-outdent","paragraph"]],["table",["table","tableofcontent"]],["insert",["link","picture","video","embed","hr"]],["view",["fullscreen","codeview","prettify"]],a.dataset.gallery?["extensions",["summernoteGallery","help"]]:null],popover:{table:[["add",["addRowDown","addRowUp","addColLeft","addColRight"]],["delete",["deleteRow","deleteCol","deleteTable"]],["custom",["tableHeaders"]],["custom",["tableStyles"]]],image:[["image",["resizeFull","resizeHalf","resizeQuarter","resizeNone"]],["float",["floatLeft","floatRight","floatNone"]],["remove",["removeMedia"]],["custom",["imageAttributes"]]]},callbacks:{onImageUpload:function(e){M($(t),e[0])},onChange:function(){window.entityFormHasUnsavedChanges=!0},onChangeCodeview:function(e,n){$(t).summernote("code",e)}},summernoteGallery:{source:{url:a.dataset.gallery,responseDataKey:"data",nextPageKey:"links.next"},modal:{loadOnScroll:!0,maxHeight:350,title:a.dataset.galleryTitle,close_text:a.dataset.galleryClose,ok_text:a.dataset.galleryAdd,selectAll_text:a.dataset.gallerySelectAll,deselectAll_text:a.dataset.galleryDeselectAll,noImageSelected_msg:a.dataset.galleryError}},bragi:{source:{url:a.dataset.bragi},buttonLabel:'<i class="fa-brands fa-pied-piper-hat"></i>'},hint:[{match:/\B::(\S*)$/,search:function(e,n){return e.length<3?[]:m(e,n)},template:function(e){return C(e)},content:function(e){return l=!1,s(e)}},{match:/\B@(\S*)$/,search:function(e,n){return e.length<3?[]:c(e,n)},template:function(e){return d(e)},content:function(e){return l=!1,s(e)}},{match:/\B\[(\S[^:]*)$/,search:function(e,n){return e.length<3?[]:c(e,n)},template:function(e){return d(e)},content:function(e){return l=!0,s(e)}},{match:/\B\#(\S*)$/,search:function(e,n){return h(e,n)},template:function(e){return d(e)},content:function(e){return l=!1,s(e)}},{match:/\B{(\S[^:]*)$/,search:function(e,n){return p(e,n)},template:function(e){return g(e)},content:function(e){return T(e)}}],keyMap:{pc:{ESC:"escape",ENTER:"insertParagraph","CTRL+Z":"undo","CTRL+Y":"redo",TAB:"tab","SHIFT+TAB":"untab","CTRL+B":"bold","CTRL+I":"italic","CTRL+U":"underline","CTRL+SHIFT+I":"strikethrough","CTRL+BACKSLASH":"removeFormat","CTRL+SHIFT+L":"justifyLeft","CTRL+SHIFT+E":"justifyCenter","CTRL+SHIFT+R":"justifyRight","CTRL+SHIFT+J":"justifyFull","CTRL+SHIFT+NUM7":"insertUnorderedList","CTRL+SHIFT+NUM8":"insertOrderedList","CTRL+LEFTBRACKET":"outdent","CTRL+RIGHTBRACKET":"indent","CTRL+NUM0":"formatPara","CTRL+NUM1":"formatH1","CTRL+NUM2":"formatH2","CTRL+NUM3":"formatH3","CTRL+NUM4":"formatH4","CTRL+NUM5":"formatH5","CTRL+NUM6":"formatH6","CTRL+ENTER":"insertHorizontalRule","CTRL+K":"linkDialog.show"},mac:{ESC:"escape",ENTER:"insertParagraph","CMD+Z":"undo","CMD+SHIFT+Z":"redo",TAB:"tab","SHIFT+TAB":"untab","CMD+B":"bold","CMD+I":"italic","CMD+U":"underline","CMD+SHIFT+I":"strikethrough","CMD+BACKSLASH":"removeFormat","CMD+SHIFT+L":"justifyLeft","CMD+SHIFT+E":"justifyCenter","CMD+SHIFT+R":"justifyRight","CMD+SHIFT+J":"justifyFull","CMD+SHIFT+NUM7":"insertUnorderedList","CMD+SHIFT+NUM8":"insertOrderedList","CMD+LEFTBRACKET":"outdent","CMD+RIGHTBRACKET":"indent","CMD+NUM0":"formatPara","CMD+NUM1":"formatH1","CMD+NUM2":"formatH2","CMD+NUM3":"formatH3","CMD+NUM4":"formatH4","CMD+NUM5":"formatH5","CMD+NUM6":"formatH6","CMD+ENTER":"insertHorizontalRule","CMD+K":"linkDialog.show"}}})};function c(t,e){axios.get(a.dataset.mention+"?q="+t+"&new=1").then(n=>e(n.data)).catch(n=>{n.resonse.status===503&&window.showToast(n.response.data.message,"error")})}function m(t,e){axios.get(a.dataset.mention+"?q="+t+"&posts=1").then(n=>e(n.data)).catch(n=>{n.resonse.status===503&&window.showToast(n.response.data.message,"error")})}function h(t,e){axios.get(a.dataset.months+"?q="+t).then(n=>e(n.data))}function p(t,e){if(!a.dataset.attributes)return!1;axios.get(a.dataset.attributes+"?q="+t).then(n=>e(n.data))}function d(t){let e=t.type?" ("+t.type+")":"";if(t.image){const n=document.createElement("div");return n.classList.add("entity-hint"),n.innerHTML=t.image+'<div class="entity-hint-name">'+t.fullname+e+"</div>",n}return t.fullname+e}function C(t){return t.type?d(t):'<div class="post flex items-center gap-1"><i class="fa-solid fa-chevron-right" aria-hidden="true"></i>'+t.fullname+"</div>"}function g(t){return t.name+(t.value?" ("+t.value+")":"")}const s=t=>{if(t.id){const e=document.createElement("span");let n="["+t.model_type+":"+t.id+t.fullname+"]",i="["+t.model_type+":"+t.id+t.advanced_mention+"]";if(t.alias_id)return n="["+t.model_type+":"+t.id+t.advanced_mention+"|alias:"+t.alias_id+t.advanced_mention_alias+"]",e.innerHTML=n,e;if(a.dataset.advancedMention||l)return e.innerHTML=i,e;const r=document.createElement("a");return r.text=t.fullname,r.href="#",r.classList.add("mention"),r.dataset.name=t.fullname,r.dataset.mention="["+t.model_type+":"+t.id+"]",r}else if(t.url){const e=document.createElement("a");return e.text=t.fullname,e.href=t.url,t.tooltip&&(e.title=t.tooltip.replace(/["]/g,"'"),e.dataset.toggle="tooltip",e.dataset.html=!0),e}else if(t.inject)return t.inject;return t.fullname};function T(t){if(a.dataset.advancedMention)return"{attribute:"+t.id+"}";const e=document.createElement("a");return e.href="#",e.classList.add("attribute","attribute-mention"),e.text="{"+t.name+"}",e.dataset.attribute="{attribute:"+t.id+"}",e}function L(t){return t?t=="he"?"he-IL":t=="ca"?"ca-ES":t=="el"?"el-GR":t=="en"?"en-US":t+"-"+t.toUpperCase():"en-US"}const M=(t,e)=>{const n=document.querySelector("#campaign-imageupload-modal");if(!a.dataset.galleryUpload){$(n).modal(),console.warn("Campaign isn't superboosted");return}let i=new FormData;i.append("file[]",e),axios.post(a.dataset.galleryUpload,i).then(r=>{t.summernote("insertImage",r.data.url,function(o){o.attr("src",r.data.url),o.attr("data-gallery-id",r.data.id)})}).catch(r=>{let o=document.querySelector("#campaign-imageupload-error"),u=document.querySelector("#campaign-imageupload-permission");o.classList.add("hidden"),u.classList.add("hidden"),r.response.status===422?(o.innerHTML=R(r.response.data.errors),o.classList.remove("hidden")):r.response.status===403&&u.classList.remove("hidden"),$(n).modal()})},R=t=>{let e="";for(let n in t)t.hasOwnProperty(n)&&(e+=t[n]+`
`);return e};$(document).ready(function(){a&&window.initSummernote()});

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/cytoscape-cose-bilkent-DRrwnnKV.js","assets/_commonjsHelpers-Cpj98o6Y.js","assets/cytoscape-panzoom-Del_Rz3u.js","assets/jspdf.es.min-tTe3jQg-.js","assets/preload-helper-I4rgV-VL.js"])))=>i.map(i=>d[i]);
import{d as ie,o as ue,B as de,l as ce,a as p,c as g,b as r,f as w,p as m,w as U,F as pe,h as i,q as ge}from"./vue.esm-bundler-C87APpr1.js";import{v as ve}from"./v-click-outside.umd-Cl-Y_A58.js";import{_ as P}from"./preload-helper-I4rgV-VL.js";import{t as fe}from"./tippy.esm-CnBRltuW.js";import{c as q}from"./colours-Dh8441-n.js";import"./_commonjsHelpers-Cpj98o6Y.js";const me={key:0,class:"fixed bottom-4 left-1/2 -translate-x-1/2 z-700 flex items-center gap-1.5 bg-base-100/80 backdrop-blur rounded-xl shadow-lg px-2 py-1.5"},we=["href","title"],be={key:1,class:"relative"},he=["title"],ye={key:0,class:"absolute bottom-full mb-2 left-0 flex flex-col gap-1 bg-base-100 shadow-lg p-2 rounded-lg z-10 min-w-max",role:"menu"},xe=["innerHTML"],ke=["innerHTML"],Ce=["title"],Ee=["title"],_e={class:"relative"},De=["title"],Le={key:0,class:"absolute bottom-full mb-2 right-0 flex flex-col gap-1 bg-base-100 shadow-lg p-2 rounded-2xl z-10 min-w-max",role:"menu"},Te=["innerHTML"],Pe=["innerHTML"],$e={key:1,class:"w-full h-screen flex items-center justify-center text-4xl gap-2 absolute bg-base-100 transition-all duration-300 top-0 bottom-0 left-0 right-0 z-900"},ze={key:0},Be={key:1},Ie={key:2},Me=ie({__name:"Web",props:{api:{},premium:{},creator:{}},setup(Z){const $=Z,k=i(!1),z=i(!1),B=i(!1),_=i(!1),b=i([]),a=i(null),C=i(null),v=i(null),I=i(),M=i(Array);let E=null;const h=i(!1),y=i(!1),F=i(null),D=i(null);ue(async()=>{await X(),await S(),await G(),k.value=!0,document.addEventListener("submit",V,!0),window.initTooltips(),$.premium||window.openDialog("web-premium")}),de(()=>{a.value&&(a.value.destroy(),a.value=null),document.removeEventListener("submit",V,!0)});const W=e=>{B.value=!0,Object.values(e.entities).forEach(t=>{R(t)}),e.nodes.forEach(t=>{Q(t)}),F.value=e.i18n,D.value=e.urls,B.value=!1},R=e=>{if(b.value.find(o=>o.data.id==e.id))return;const t={group:"nodes",data:{id:e.id,name:e.name,image:e.image,link:e.link,tooltip:e.tooltip}};b.value.push(t),k.value&&a.value&&a.value.add(t)},Q=e=>{let t={group:"edges",data:{id:e.id,source:e.source,target:e.target,name:e.text,colour:e.colour,attitude:e.attitude,shape:e.shape,url:e.url}};t.data.colour||(t.data.colour="#777777"),t.data.attitude||(t.data.attitude=0),t.data.attitude=H(t.data.attitude),b.value.push(t)},H=e=>(e+100)/100*2+2,X=async()=>{const{default:e}=await P(async()=>{const{default:f}=await import("./cytoscape.esm-BJ4qIETX.js");return{default:f}},[]),{default:t}=await P(async()=>{const{default:f}=await import("./cytoscape-cose-bilkent-DRrwnnKV.js").then(N=>N.c);return{default:f}},__vite__mapDeps([0,1])),{default:o}=await P(async()=>{const{default:f}=await import("./cytoscape-panzoom-Del_Rz3u.js").then(N=>N.c);return{default:f}},__vite__mapDeps([2,1]));e.use(t),e.use(o);const n=I.value,s=n.parentNode,l=window.getComputedStyle(n),u=window.getComputedStyle(s);a.value=e({container:I.value,style:e.stylesheet().selector("node").css({label:"data(name)","background-image":"data(image)",height:80,width:80,"background-fit":"cover","border-color":u.color,"border-width":3,color:l.color,"text-wrap":"wrap","text-margin-y":"-8px","text-background-opacity":1,"text-background-color":l.backgroundColor,"text-border-color":l.backgroundColor,"text-border-width":3,"text-border-opacity":1}).selector("edge").css({"line-color":"data(colour)","curve-style":"bezier","control-point-step-size":40,"target-arrow-shape":"data(shape)","target-arrow-color":"data(colour)",width:"data(attitude)","text-background-opacity":1,color:l.color,"text-background-color":l.backgroundColor,"text-border-color":l.backgroundColor,"text-border-width":3,"text-border-opacity":1})});const d=.1,x=1.2;a.value.panzoom({maxZoom:x,minZoom:d}),a.value.minZoom(d),a.value.maxZoom(x)},S=async()=>{z.value=!0;const e=await axios.get($.api);z.value=!1;const t=e.data;W(t)},G=async()=>{a.value&&(_.value=!0,_.value=!0,a.value.add(b.value),a.value.nodes().forEach(function(e){e.connectedEdges().length==0&&j(e)}),L(),A(),await T())},j=e=>{e.hide()},L=()=>{a.value.elements().layout({name:"cose-bilkent",idealEdgeLength:130,nodeDimensionsIncludeLabels:!0}).run()},A=()=>{a.value.on("tap","node",function(e){const t=e.target;J(t)}),a.value.nodes().on("mouseover",function(e){C.value=a.value.getElementById(e.target.id()),C.value.addClass("node-hover")}),a.value.nodes().on("mouseout",function(){C.value&&(C.value.removeClass("node-hover"),C.value=null)}),a.value.on("tap","edge",function(e){let t=e.target.data().url;t&&window.openDialog("primary-dialog",t)}),a.value.edges().on("mouseover",function(e){v.value=a.value.getElementById(e.target.id()),v.value.style("label",v.value._private.data.name),v.value.style("overlay-opacity",.1)}),a.value.edges().on("mouseout",function(){v.value&&(v.value.style("label",""),v.value.style("overlay-opacity",0),v.value=null)})},T=async()=>{let e=!0;for(;e;)a.value.nodes(":backgrounding").length==0?e=!1:await sleep(200);_.value=!1},J=e=>{const t=a.value;if(!t)return;const o=t.container();if(!o)return;const n=e.renderedPosition(),s=o.getBoundingClientRect(),l=()=>{const u=s.left+n.x,d=s.top+n.y;return{x:u,y:d,left:u,top:d,right:u,bottom:d,width:0,height:0}};E&&(E.destroy(),E=null),E=fe(document.body,{trigger:"manual",getReferenceClientRect:l,theme:"entity-tooltip",placement:"bottom",hideOnClick:!0,allowHTML:!0,interactive:!0,content:"Loading...",appendTo:()=>document.body,onShow(u){const d=String(e.id());if(d in M.value){u.setContent(M.value[d]);return}axios.get(e.data().tooltip).then(x=>{const f=x.data;u.setContent(f),M.value[d]=f}).catch(x=>{u.setContent(`Failed loading tooltip. ${x}`)})}}),E.show()},V=async e=>{const t=e.target;if(t){e.preventDefault();try{const o=(t.method||"POST").toUpperCase(),n=t.action,s=new FormData(t),l=await axios({url:n,method:o,data:s,headers:{"X-Requested-With":"XMLHttpRequest"}});l.data.created?ee(l.data):Y(l.data),window.closeDialog&&window.closeDialog("primary-dialog")}catch(o){o.response&&o.response.status===422&&o.response.data?.errors?K(t,o.response.data.errors):console.error(o)}}},K=(e,t)=>{const o=e.closest("article");if(!o)return;o.querySelector(".alert.alert-error.js-web-errors")?.remove();const n=Object.values(t).flat(),s=document.createElement("div");s.className="alert alert-error border-0 rounded-lg p-4 flex shadow-xs gap-2 items-center js-web-errors";const l=document.createElement("ul");n.forEach(u=>{const d=document.createElement("li");d.textContent=u,l.appendChild(d)}),s.appendChild(l),o.prepend(s)},Y=async e=>{if(!a.value||!e||!e.id)return;const t=a.value.edges().filter(`[id = "${e.id}"]`);if(!t||t.length===0){console.warn("Updated unknown edge",e.id);return}e.deleted&&t.remove();const o=H(e.attitude??0);if(t.data().target!=e.target.id){R(e.target),await T();const n={group:"edges",data:{...t.data(),name:e.text,target:e.target.id,colour:e.colour||"#777777",attitude:o}};t.remove(),a.value.add(n)}else t.data({...t.data(),name:e.text,colour:e.colour||"#777777",attitude:o})},ee=async e=>{if(!a.value||!e)return;if(R(e.target),e.source&&a.value.getElementById(e.source).length===0){await te();return}await T();const t=H(e.attitude??0),o={group:"edges",data:{id:e.id,source:e.source,target:e.target.id,name:e.text,colour:e.colour||"#777777",attitude:t,shape:e.shape||"triangle",url:e.url}};a.value.add(o);const n=a.value.getElementById(e.target.id);n.length>0&&n.hidden()&&n.show(),L()},te=async()=>{b.value=[],await S(),a.value.elements().remove(),a.value.add(b.value),a.value.nodes().forEach(function(e){e.connectedEdges().length==0&&j(e)}),L(),A(),await T()},oe=()=>{window.openDialog("primary-dialog",D.value.create)},ae=()=>{window.openDialog("primary-dialog",D.value.creator)},ne=()=>{a.value&&a.value.fit(void 0,30)},re=()=>{a.value&&L()},c=e=>F.value[e]||e,le=()=>{if(h.value=!1,!a.value)return;const e={full:!0,bg:q("--b1")},t=a.value.png(e),o=document.createElement("a");o.href=t,o.download=`${c("campaign")}-web-${Date.now()}.png`,document.body.appendChild(o),o.click(),document.body.removeChild(o)},se=async()=>{if(h.value=!1,!a.value)return;const{jsPDF:e}=await P(async()=>{const{jsPDF:l}=await import("./jspdf.es.min-tTe3jQg-.js").then(u=>u.j);return{jsPDF:l}},__vite__mapDeps([3,4])),t=a.value.png({full:!0,bg:q("--b1")}),o=new Image;o.src=t,await new Promise(l=>{o.onload=l});const n=o.width>o.height,s=new e({orientation:n?"landscape":"portrait",unit:"px",format:[o.width,o.height]});s.addImage(t,"PNG",0,0,o.width,o.height),s.save(`${c("campaign")}-web-${Date.now()}.pdf`)};return(e,t)=>{const o=ce("click-outside");return p(),g(pe,null,[k.value?(p(),g("div",me,[k.value?(p(),g("a",{key:0,href:D.value.back,title:c("back"),class:"btn2 btn-ghost",tabindex:"0"},[...t[8]||(t[8]=[r("i",{class:"fa-regular fa-home","aria-hidden":"true"},null,-1)])],8,we)):w("",!0),$.creator?(p(),g("div",be,[r("button",{onClick:t[0]||(t[0]=m(n=>y.value=!y.value,["prevent"])),class:"btn2 btn-primary",title:c("create")},[...t[9]||(t[9]=[r("i",{class:"fa-regular fa-plus","aria-hidden":"true"},null,-1)])],8,he),y.value?U((p(),g("div",ye,[r("a",{href:"#",onClick:t[1]||(t[1]=m(n=>{y.value=!1,ae()},["prevent"])),class:"flex items-center gap-2 px-3 py-1.5 rounded hover:bg-base-200 cursor-pointer whitespace-nowrap"},[t[10]||(t[10]=r("i",{class:"fa-regular fa-bolt w-5","aria-hidden":"true"},null,-1)),r("span",{innerHTML:c("create")},null,8,xe)]),r("a",{href:"#",onClick:t[2]||(t[2]=m(n=>{y.value=!1,oe()},["prevent"])),class:"flex items-center gap-2 px-3 py-1.5 rounded hover:bg-base-200 cursor-pointer whitespace-nowrap"},[t[11]||(t[11]=r("i",{class:"fa-regular fa-link w-5","aria-hidden":"true"},null,-1)),r("span",{innerHTML:c("add")},null,8,ke)])])),[[o,()=>y.value=!1]]):w("",!0)])):w("",!0),r("button",{onClick:t[3]||(t[3]=m(n=>ne(),["prevent"])),class:"btn2 btn-ghost rounded-lg",title:c("zoom-fit")},[...t[12]||(t[12]=[r("i",{class:"fa-regular fa-arrows-maximize","aria-hidden":"true"},null,-1)])],8,Ce),r("button",{onClick:t[4]||(t[4]=m(n=>re(),["prevent"])),class:"btn2 btn-ghost",title:c("reset-layout")},[...t[13]||(t[13]=[r("i",{class:"fa-regular fa-grid-round","aria-hidden":"true"},null,-1)])],8,Ee),t[17]||(t[17]=r("div",{class:"w-px h-6 bg-base-content/20"},null,-1)),r("div",_e,[r("button",{onClick:t[5]||(t[5]=m(n=>h.value=!h.value,["prevent"])),class:"btn2 btn-ghost",title:c("download")},[...t[14]||(t[14]=[r("i",{class:"fa-regular fa-download","aria-hidden":"true"},null,-1)])],8,De),h.value?U((p(),g("div",Le,[r("a",{onClick:t[6]||(t[6]=m(n=>le(),["prevent"])),class:"flex items-center gap-2 px-3 py-1.5 rounded-xl hover:bg-base-200 cursor-pointer whitespace-nowrap"},[t[15]||(t[15]=r("i",{class:"fa-regular fa-image w-5","aria-hidden":"true"},null,-1)),r("span",{innerHTML:c("download-png")},null,8,Te)]),r("a",{onClick:t[7]||(t[7]=m(n=>se(),["prevent"])),class:"flex items-center gap-2 px-3 py-1.5 rounded-xl hover:bg-base-200 cursor-pointer whitespace-nowrap"},[t[16]||(t[16]=r("i",{class:"fa-regular fa-file-pdf w-5","aria-hidden":"true"},null,-1)),r("span",{innerHTML:c("download-pdf")},null,8,Pe)])])),[[o,()=>h.value=!1]]):w("",!0)])])):w("",!0),k.value?w("",!0):(p(),g("div",$e,[t[18]||(t[18]=r("i",{class:"fa-solid fa-spinner fa-spin","aria-hidden":"true"},null,-1)),z.value?(p(),g("span",ze,"Loading")):B.value?(p(),g("span",Be,"Parsing web")):_.value?(p(),g("span",Ie,"Drawing web")):w("",!0)])),r("div",{ref_key:"cyContainer",ref:I,class:"min-h-screen text-base-content cy-map bg-base-100"},null,512)],64)}}}),O=ge({});O.use(ve);O.component("connections-web",Me);O.mount("#web");

import{d as Te,a as t,c as s,e as re,w as U,z as Ne,f as u,n as S,b as e,A as _l,o as je,v as Ae,u as me,F as z,r as Y,h as n,y as xl,B as bl,C as kl,l as yl,i as Ml,k as Tl,j as wl,q as Ll}from"./vue.esm-bundler-C87APpr1.js";import{v as Hl}from"./v-click-outside.umd-Cl-Y_A58.js";import"./_commonjsHelpers-Cpj98o6Y.js";const $l={key:1,class:"flex-none w-20 md:w-full h-16 md:h-32"},Cl={key:1,class:"w-full h-full flex gap-0.5"},Fl={key:2,class:"w-full h-full flex gap-0.5"},Pl={class:"flex flex-col gap-0.5 w-1/2 h-full"},Il={key:3,class:"h-full w-full flex items-center justify-center align-middle text-6xl text-neutral-content"},Sl={key:3,class:"w-full h-20 md:h-32"},Bl={class:"flex gap-1 md:gap-2 items-center md:p-4 truncate"},Ul={key:0,class:"grow-0 md:hidden"},Dl=["title"],El={class:"grow truncate"},Vl=["innerHTML"],Nl={key:1,class:"hidden md:block grow-0"},jl=["title"],Al=Te({__name:"Preview",props:{file:{},isBulking:{},i18n:{}},emits:["select"],setup(r,{emit:le}){const o=le,h=r,V=()=>h.file.thumbnail!==null,T=$=>"url('"+$+"')",w=()=>{o("select",h.file)},D=()=>{let $="rounded-xl shadow-sm bg-base-100 overflow-hidden sm:w-48 cursor-pointer hover:shadow-lg relative flex flex-row md:flex-col gap-2 md:gap-0";return!h.file.is_selected||!h.isBulking?$+"  ":$+" bg-base-300"},p=()=>{switch(parseInt(h.file.visibility_id)){case 2:return"fa-regular fa-lock";case 3:return"fa-regular fa-user-lock";case 4:return"fa-regular fa-user-secret";case 5:return"fa-regular fa-users";default:return"fa-regular fa-eye"}},B=()=>h.i18n["visibility."+h.file.visibility_id];return($,C)=>(t(),s("div",{class:re(D()),onClick:w},[r.isBulking?U((t(),s("input",{key:0,type:"checkbox","onUpdate:modelValue":C[0]||(C[0]=I=>r.file.is_selected=I),class:"absolute! top-4 left-4"},null,512)),[[Ne,r.file.is_selected]]):u("",!0),r.file.is_folder?(t(),s("div",$l,[r.file.thumbnails.length===1?(t(),s("div",{key:0,class:"w-full h-full",style:S({backgroundImage:T(r.file.thumbnails[0])})},null,4)):r.file.thumbnails.length===2?(t(),s("div",Cl,[e("div",{class:"w-1/2 h-full cover-background",style:S({backgroundImage:T(r.file.thumbnails[0])})},null,4),e("div",{class:"w-1/2 h-full cover-background",style:S({backgroundImage:T(r.file.thumbnails[1])})},null,4)])):r.file.thumbnails.length===3?(t(),s("div",Fl,[e("div",{class:"w-1/2 h-full cover-background",style:S({backgroundImage:T(r.file.thumbnails[0])})},null,4),e("div",Pl,[e("div",{class:"w-full h-1/2 cover-background",style:S({backgroundImage:T(r.file.thumbnails[1])})},null,4),e("div",{class:"w-full h-1/2 cover-background",style:S({backgroundImage:T(r.file.thumbnails[2])})},null,4)])])):(t(),s("div",Il,[...C[1]||(C[1]=[e("i",{class:"fa-regular fa-folder","aria-hidden":"true"},null,-1)])]))])):V()?(t(),s("div",{key:2,class:"flex-none w-20 md:w-full h-16 md:h-32 cover-background",style:S({backgroundImage:T(r.file.thumbnail)})},null,4)):(t(),s("div",Sl)),e("div",Bl,[r.file.visibility_id>1?(t(),s("div",Ul,[e("i",{class:re(p()),"aria-hidden":"true",title:B()},null,10,Dl)])):u("",!0),e("div",El,[e("span",{innerHTML:r.file.name,class:""},null,8,Vl)]),r.file.visibility_id>1?(t(),s("div",Nl,[e("i",{class:re(p()),"aria-hidden":"true",title:B()},null,10,jl)])):u("",!0)])],2))}}),zl={class:"bg-base-100 p-2 md:p-4 rounded flex flex-col gap-2 md:gap-4 md:sticky md:top-24"},Rl={key:0,class:"text-2xl flex items-center justify-center h-32"},Xl={key:1,class:"flex flex-col gap-4"},Yl={class:"flex items-center gap-2"},Kl={class:"flex items-center gap-1 grow"},Ol=["innerHTML"],Wl={class:"flex flex-col gap-1"},Gl=["innerHTML"],ql=["innerHTML"],Jl={key:0,class:"flex flex-col gap-1"},Ql={class:"font-extrabold flex gap-1 items-center"},Zl=["innerHTML"],ea=["value","innerHTML"],la={key:1,class:"flex flex-col gap-1"},aa={class:"grow font-bold flex gap-1 items-center"},ta=["innerHTML"],sa={key:0,class:"fa-solid fa-chevron-up","aria-label":"Hide mentions"},na={key:1,class:"fa-solid fa-chevron-down","aria-label":"Show mentions"},ia={key:0,class:"flex flex-wrap gap-2"},oa=["href"],ua={key:0,class:"fa-regular fa-image","aria-hidden":"true"},ra={key:1,class:"fa-regular fa-pen","aria-hidden":"true"},da=["innerHTML"],ca=["innerHTML"],fa={key:2,class:"grid grid-cols-2 gap-2"},va=["innerHTML"],ga=["innerHTML"],pa=["innerHTML"],ha=["innerHTML"],ma=["innerHTML"],_a=["innerHTML"],xa=["innerHTML"],ba=["href"],ka=["innerHTML"],ya={class:"flex gap-2 items-center justify-between"},Ma={key:0,class:"fa-solid fa-spinner fa-spin text-error","aria-label":"Deleting"},Ta=["innerHTML"],wa=["innerHTML"],La=["innerHTML"],Ha={key:3,class:"grow text-right text-neutral-content"},$a=["innerHTML"],Ca={key:3,class:"text-right text-neutral-content flex gap-1 self-end items-center text-xs"},Fa=["innerHTML"],Pa={key:2,class:"flex flex-col gap-4 overflow-hidden"},Ia={key:0,class:"alert alert-warning p-4 flex flex-col gap-2"},Sa=["innerHTML"],Ba={key:1,class:"max-w-32 flex items-center justify-center"},Ua={class:"relative inline-block"},Da=["src"],Ea={class:"flex gap-2 items-center flex-wrap justify-between"},Va=["innerHTML"],Na=["innerHTML"],ja=Te({__name:"File",props:{file:{},visibilities:{},i18n:{},premium:{},canManage:{}},emits:["updated","deleted","moved","closed"],setup(r,{emit:le}){const o=r,h=le,V=n(),T=n(),w=n(!1),D=n(!1),p=n(),B=n(!0),$=n(!1),C=n(!1),I=n(!0),N=n(!1),k=n(),m=n(),F=n();_l(()=>o.file,(x,i)=>{x&&K()}),je(()=>{K()});const b=x=>o.i18n[x]?o.i18n[x]:"_"+x+"_",K=()=>{B.value=!0,w.value=!1,D.value=!1,T.value=o.file.name,p.value=o.file.visibility_id,m.value=o.file.focus_x,F.value=o.file.focus_y,$.value=!1,C.value=!1,N.value=!1,axios.get(o.file.api.show).then(x=>{V.value=x.data.data.mentions,B.value=!1})},O=()=>{T.value!==o.file.name&&f()},c=()=>{p.value!==o.file.visibility_id&&f()},f=()=>{if(w.value)return;w.value=!0;const x={name:T.value,visibility_id:p.value};axios.post(o.file.api.update,x).then(i=>{o.file.name=T.value,o.file.visibility_id=p.value,o.file.visibility=i.data.data.visibility,w.value=!1,D.value=!0,h("updated",o.file)})},E=()=>{I.value=!I.value},L=()=>V.value.length>0,j=()=>{if(!$.value){if(!C.value){C.value=!0;return}$.value=!0,axios.post(o.file.api.delete,{_method:"delete"}).then(x=>{window.showToast("Removed "+o.file.name),h("deleted",o.file,x.data.used)})}},W=()=>{h("closed")},_e=()=>{N.value=!0},G=()=>{N.value=!1},de=x=>{const i=k.value.naturalWidth,y=k.value.naturalHeight,H=x.clientX-k.value.getBoundingClientRect().left,P=x.clientY-k.value.getBoundingClientRect().top,ae=H/k.value.clientWidth*i,fe=P/k.value.clientHeight*y;m.value=parseInt(String(ae),10),F.value=parseInt(String(fe),10)},q=x=>{if(!m.value||!k.value)return"display: none;";const i=k.value.naturalWidth,y=k.value.naturalHeight,H=m.value/i*100,P=F.value/y*100;return"left: "+H+"%; top: "+P+"%"},J=()=>{m.value=null,F.value=null,R()},ce=()=>{R()},R=()=>{if(w.value)return;w.value=!0,N.value=!1;const x={focus_x:m.value,focus_y:F.value};axios.post(o.file.api.focus,x).then(i=>{w.value=!1,D.value=!0,o.file.focus_x=m.value,o.file.focus_y=F.value,console.log(i.data),o.file.thumbnail=i.data.data.thumbnail,h("updated",o.file)})};return(x,i)=>(t(),s("div",zl,[B.value?(t(),s("div",Rl,[...i[2]||(i[2]=[e("i",{class:"fa-solid fa-spinner fa-spin","aria-label":"Loading"},null,-1)])])):N.value?(t(),s("div",Pa,[o.premium?(t(),s("div",Ba,[e("div",Ua,[e("div",{class:"absolute cursor-pointer text-4xl text-accent",style:S(q()),onClick:J},[...i[13]||(i[13]=[e("i",{class:"fa-duotone fa-arrow-up-left-from-circle hover:text-error","aria-label":"Focus point"},null,-1)])],4),e("img",{class:"cursor-crosshair",src:o.file.original,alt:"img",ref_key:"focusImage",ref:k,onClick:de},null,8,Da)])])):(t(),s("div",Ia,[e("p",{innerHTML:b("focus_locked")},null,8,Sa),i[12]||(i[12]=e("a",{href:"https://kanka.io/premium",class:"text-link"},"Learn more",-1))])),e("div",Ea,[r.premium?(t(),s("button",{key:0,class:"btn2 btn-primary btn-sm",onClick:ce},[e("span",{innerHTML:b("save")},null,8,Va)])):u("",!0),e("button",{class:"btn2 btn-ghost btn-sm",onClick:G,innerHTML:b("cancel")},null,8,Na)])])):(t(),s("div",Xl,[e("div",Yl,[e("div",Kl,[i[3]||(i[3]=e("i",{class:"fa-regular fa-clipboard","aria-hidden":"true"},null,-1)),e("span",{class:"font-extrabold",innerHTML:b("details")},null,8,Ol)]),e("div",{class:"cursor-pointer",onClick:W},[...i[4]||(i[4]=[e("i",{class:"fa-solid fa-xmark","aria-label":"Close"},null,-1)])])]),e("div",Wl,[e("label",{class:"font-extrabold",innerHTML:b("name")},null,8,Gl),r.canManage?U((t(),s("input",{key:0,type:"text",class:"",maxlength:"191","onUpdate:modelValue":i[0]||(i[0]=y=>T.value=y),onChange:O},null,544)),[[Ae,T.value]]):(t(),s("span",{key:1,innerHTML:T.value},null,8,ql))]),r.canManage?(t(),s("div",Jl,[e("label",Ql,[i[5]||(i[5]=e("i",{class:"fa-regular fa-users","aria-hidden":"true"},null,-1)),e("span",{innerHTML:b("visibility")},null,8,Zl)]),U(e("select",{class:"w-full","onUpdate:modelValue":i[1]||(i[1]=y=>p.value=y),onChange:c},[(t(!0),s(z,null,Y(r.visibilities,(y,H)=>(t(),s("option",{value:H,innerHTML:y},null,8,ea))),256))],544),[[me,p.value]])])):u("",!0),o.file.is_folder?u("",!0):(t(),s("div",la,[e("div",{class:"flex gap-2 items-center cursor-pointer",onClick:E},[e("div",aa,[i[6]||(i[6]=e("i",{class:"fa-regular fa-cubes","aria-hidden":"true"},null,-1)),e("span",{innerHTML:b("used_in")},null,8,ta)]),I.value?(t(),s("i",sa)):(t(),s("i",na))]),I.value?(t(),s("div",ia,[(t(!0),s(z,null,Y(V.value,y=>(t(),s("a",{href:y.url,class:"rounded-xl bg-base-200 px-4 py-1 flex gap-1 items-center"},[y.type==="image"?(t(),s("i",ua)):(t(),s("i",ra)),e("span",{class:"truncate",innerHTML:y.name},null,8,da)],8,oa))),256)),L()?u("",!0):(t(),s("span",{key:0,class:"text-neutral-content",innerHTML:b("unused")},null,8,ca))])):u("",!0)])),o.file.is_folder?u("",!0):(t(),s("div",fa,[e("div",{class:"text-neutral-content",innerHTML:b("size")},null,8,va),e("div",{class:"text-right",innerHTML:r.file.size},null,8,ga),e("div",{class:"text-neutral-content",innerHTML:b("uploaded_by")},null,8,pa),e("div",{class:"text-right",innerHTML:r.file.creator},null,8,ha),e("div",{class:"text-neutral-content",innerHTML:b("file_type")},null,8,ma),e("div",{class:"text-right uppercase",innerHTML:r.file.ext},null,8,_a),e("div",{class:"text-neutral-content",innerHTML:b("link")},null,8,xa),e("a",{href:r.file.link,class:"flex gap-1 items-center justify-end text-link",target:"_blank"},[i[7]||(i[7]=e("i",{class:"fa-solid fa-external-link","aria-hidden":"true"},null,-1)),e("span",{innerHTML:b("open")},null,8,ka)],8,ba)])),e("div",ya,[$.value?(t(),s("i",Ma)):r.canManage?(t(),s("span",{key:1,role:"button",class:"text-neutral-content hover:text-error-content hover:bg-error flex items-center gap-1 p-2 rounded",onClick:j},[i[8]||(i[8]=e("i",{class:"fa-regular fa-trash-can","aria-hidden":"true"},null,-1)),C.value?(t(),s("span",{key:1,innerHTML:b("confirm")},null,8,wa)):(t(),s("span",{key:0,innerHTML:b("delete")},null,8,Ta))])):u("",!0),!o.file.is_folder&&r.canManage?(t(),s("button",{key:2,onClick:_e,class:"rounded border p-2 flex gap-1 items-center"},[i[9]||(i[9]=e("i",{class:"fa-regular fa-bullseye","aria-hidden":"true"},null,-1)),e("span",{class:"truncate",innerHTML:b("focus_point")},null,8,La)])):u("",!0),w.value?(t(),s("div",Ha,[i[10]||(i[10]=e("i",{class:"fa-solid fa-spinner fa-spin","aria-hidden":"true"},null,-1)),e("span",{innerHTML:b("saving")},null,8,$a)])):u("",!0)]),D.value?(t(),s("div",Ca,[i[11]||(i[11]=e("i",{class:"fa-regular fa-check-double","aria-hidden":"true"},null,-1)),e("span",{innerHTML:b("saved")},null,8,Fa)])):u("",!0)]))]))}}),Aa={key:0,class:"text-center text-4xl p-4"},za={key:1,class:"flex flex-col gap-4 md:gap-5"},Ra={class:"flex gap-4 items-end"},Xa={class:"flex flex-col gap-1 grow"},Ya={class:"flex gap-1 items-center"},Ka=["innerHTML"],Oa={class:"flex gap-1 items-center"},Wa=["innerHTML"],Ga=["innerHTML"],qa=["innerHTML"],Ja={class:"bg-base-300 rounded h-2 w-full overflow-hidden transition-all duration-300"},Qa={key:0},Za=["href","innerHTML"],et={class:"flex gap-4 flex-wrap sticky top-14 z-50"},lt={class:"flex gap-2 grow"},at={class:"flex gap-0.5"},tt={class:"relative"},st=["innerHTML"],nt={key:0},it={key:0,class:"border shadow-sm rounded bg-base-100 p-4 absolute right-0 flex flex-col gap-5 w-60"},ot={class:"flex gap-2 items-center"},ut=["innerHTML"],rt={class:"relative"},dt=["innerHTML"],ct={key:0},ft={key:0,class:"border shadow-sm rounded bg-base-100 p-4 absolute right-0 top-full mt-2 flex flex-col gap-1 w-60 z-50"},vt={class:"flex flex-col gap-1 list-none m-0 p-0"},gt={key:0,class:"fa-regular fa-check","aria-hidden":"true"},pt=["innerHTML"],ht={key:0,class:"fa-regular fa-check","aria-hidden":"true"},mt=["innerHTML"],_t={key:0,class:"fa-regular fa-check","aria-hidden":"true"},xt=["innerHTML"],bt={class:"flex gap-2 self-end flex-wrap"},kt=["innerHTML"],yt=["innerHTML"],Mt=["innerHTML"],Tt=["innerHTML"],wt=["innerHTML"],Lt=["innerHTML"],Ht=["innerHTML"],$t=["innerHTML"],Ct={key:0,class:"text-center text-4xl p-4"},Ft={key:1,class:"flex flex-col gap-4"},Pt={key:0,class:"flex gap-1 flex-wrap text-xl"},It=["innerHTML"],St={class:"flex gap-1 items-center"},Bt=["onClick","innerHTML"],Ut={class:"flex gap-2 flex-row"},Dt={key:0,class:"flex flex-col gap-4 p-2"},Et={class:"text-center text-xs"},Vt=["innerHTML"],Nt={class:"progress h-1 w-full self-end"},jt={key:0,class:"fixed bottom-0 w-full left-0 right-0 shadow-md md:shadow-none md:relative md:basis-1/4"},At={key:0,class:"text-center text-4xl p-4"},zt={class:"flex gap-6 items-center p-4 md:p-6 justify-between"},Rt=["innerHTML"],Xt={class:"max-w-4xl flex flex-col gap-2 text-left p-4 md:px-6"},Yt={class:"flex flex-col gap-1 w-full"},Kt=["innerHTML"],Ot={class:"flex flex-col gap-1 w-full"},Wt=["innerHTML"],Gt=["value","innerHTML"],qt={class:"bp-4 md:px-6"},Jt={class:""},Qt=["innerHTML"],Zt={class:"flex gap-6 items-center p-4 md:p-6 justify-between"},es=["innerHTML"],ls={class:"max-w-4xl flex flex-col gap-2 text-left p-4 md:px-6"},as={class:"flex flex-col gap-1 w-full"},ts=["innerHTML"],ss=["value","innerHTML"],ns={class:"flex flex-col gap-1 w-full"},is=["innerHTML"],os=["value","innerHTML"],us={class:"bg-base-200 p-2"},rs={class:""},ds=["innerHTML"],cs=Te({__name:"Gallery",props:{api:{}},setup(r){const le=r,o=n(!1),h=n(!1),V=n(),T=n(!1),w=n(!1),D=n(!1),p=n(!1),B=n(!1),$=n(!1),C=n(!1),I=n(!1),N=n(),k=n(),m=n(),F=n(),b=n(),K=n(null),O=n(),c=n([]),f=n([]),E=n([]),L=n(),j=n(),W=n(!0),_e=n(),G=n(!1),de=n(),q=n(),J=n(),ce=n(),R=n(1),x=n(),i=n(),y=n(),H=n(),P=n(),ae=n(),fe=n(),xe=n(!1),Le=n(),X=n(),Q=n(!1),te=n(null),be=n(null),He=n(0),Z=n(!1),se=n(!1),ve=n(!1),ne=n(!1),ie=n(!1),ge=n(!0),ke=n(),ee=n(),$e=n(),oe=n(null);let pe=null;je(()=>{axios.get(le.api).then(l=>{o.value=!0,f.value=l.data.files,E.value=l.data.files,_e.value=l.data.url,j.value=l.data.i18n,O.value=l.data.api.search,V.value=l.data.api.delete,fe.value=l.data.api.update,de.value=l.data.api.create,Le.value=l.data.api.upload,k.value=l.data.next,x.value=l.data.visibilities,i.value=l.data.bulkVisibilities,D.value=l.data.acl.upload,B.value=l.data.acl.premium,$.value=l.data.acl.wyvern,C.value=l.data.acl.elemental,I.value=l.data.acl.manage,ae.value=l.data.folders,ke.value=l.data.space.total,ee.value=l.data.space.used,$e.value=l.data.upgrade,xl(()=>{pe=new IntersectionObserver(a=>{a.forEach(v=>{v.isIntersecting&&qe()})}),oe.value&&pe.observe(oe.value)})}),window.addEventListener("keydown",Ce)}),bl(()=>{pe&&oe.value&&pe.unobserve(oe.value)}),kl(()=>{window.removeEventListener("keydown",Ce)});const Ce=l=>{(l.key==="Escape"||l.key==="Esc")&&(Q.value&&tl(),m.value&&(m.value=null),p.value?p.value=null:Z.value&&(Z.value=!1))},g=l=>j.value[l]?j.value[l]:(console.error("Missing trans",l,j),"MISSING"),ze=()=>{p.value=!0},Re=()=>{p.value=!1},Xe=()=>{Pe(y.value),H.value=null,P.value=null},Ye=()=>{let l="grid grid-cols-2 sm:grid-cols-3 md:flex gap-2 sm:gap-3 md:gap-4 md:flex-wrap";return m.value&&(l+=" basis-2/4 md:basis-3/4"),l},Ke=()=>{let l=f.value.filter(a=>a.is_selected).map(a=>a.id);l.length!==0&&(T.value=!0,axios.post(V.value,{images:l}).then(a=>{f.value=f.value.filter(v=>!v.is_selected),W.value&&(E.value=f.value),ee.value=a.data.used,p.value=!1,window.showToast(a.data.toast)}))},Oe=l=>{if(p.value){let a=f.value.find(v=>v.id===l.id);a.is_selected=!a.is_selected;return}if(l.is_folder){Fe(l);return}m.value&&m.value.id===l.id?m.value=null:m.value=l},Fe=l=>{h.value=!0,axios.get(l.open).then(a=>{L.value=l,N.value=a.data.breadcrumbs,f.value=a.data.files,k.value=a.data.next,h.value=!1,W.value=!1})},he=()=>{h.value=!0,f.value=E.value,m.value=null,L.value=null,h.value=!1,W.value=!0,p.value=!1},We=l=>{F.value=l.target.value,K.value&&clearTimeout(K.value),K.value=setTimeout(()=>{Ge()},300)},Ge=()=>{if(b.value!=F.value){if(b.value=F.value,!F.value){c.value.searchParam="",he();return}h.value=!0,c.value.searchParam="term="+F.value;var l="";c.value.searchParam&&(l+=c.value.searchParam+"&"),c.value.sortParam&&(l+=c.value.sortParam+"&"),c.value.toggleParam&&(l+=c.value.toggleParam+"&"),axios.get(O.value+"/?"+l).then(a=>{De(a.data)})}},qe=()=>{if(!(k.value==null||w.value==!0)){w.value=!0;var l="";c.value.searchParam&&(l+=c.value.searchParam+"&"),c.value.sortParam&&(l+=c.value.sortParam+"&"),c.value.toggleParam&&(l+=c.value.toggleParam+"&"),axios.get(k.value+"&"+l).then(a=>{a.data.files.forEach(v=>{f.value.push(v)}),k.value=a.data.next,w.value=!1})}},Je=()=>{Pe(q.value),ce.value.focus()},Pe=l=>{l.showModal(),l.addEventListener("click",Ie)},Ie=l=>{let a=l.target.getBoundingClientRect();!(a.top<=l.clientY&&l.clientY<=a.top+a.height&&a.left<=l.clientX&&l.clientX<=a.left+a.width)&&l.target.tagName==="DIALOG"&&ue(l.target)},ue=l=>{G.value||(l.removeEventListener("click",Ie),l.close())},Se=()=>{if(G.value)return;let l={};G.value=!0,l.name=J.value,l.visibility_id=R.value,L.value&&(l.folder_id=L.value.id),axios.post(de.value,l).then(a=>{J.value=null,R.value=1,G.value=!1,f.value.unshift(a.data.folder),ae.value[a.data.folder.id]=a.data.folder.name,ue(q.value)})},Qe=()=>{if(xe.value)return;let l=f.value.filter(v=>v.is_selected).map(v=>v.id);if(l.length===0)return;xe.value=!0;let a={};P.value&&(P.value==="0"?a.folder_home=1:a.folder_id=P.value),H.value&&(a.visibility_id=H.value),a.files=l,axios.post(fe.value,a).then(v=>{xe.value=!1,a.folder_home&&(console.log("move home"),f.value.filter(M=>M.is_selected).forEach(M=>{E.value.unshift(M)})),P.value&&(f.value=f.value.filter(_=>!_.is_selected),W.value&&(E.value=E.value.filter(_=>!_.is_selected))),H.value&&f.value.forEach(_=>{l.includes(_.id)&&(_.visibility_id=H.value)}),P.value=null,H.value=null,p.value=!1,E.value.filter(_=>_.is_selected).forEach(_=>{_.is_selected=!1}),window.showToast(v.data.toast),ue(y.value)})},Ze=()=>{X.value.click()},el=async l=>{const a=l.target.files[0],v=l.target.files;if(!v){Q.value=!1;return}const d=new FileReader;d.onload=M=>{te.value=M.target.result},d.readAsDataURL(a),Q.value=!0,be.value=axios.CancelToken.source(),X.value.disabled=!0;const _=new FormData;L.value&&_.append("folder_id",L.value.id),Array.from(v).forEach(M=>{_.append("files[]",M)}),axios.post(Le.value,_,{headers:{"Content-Type":"multipart/form-data"},cancelToken:be.value.token,onUploadProgress:function(M){He.value=Math.round(M.loaded*100/M.total)}}).then(M=>{Q.value=!1,X.value.disabled=!1,X.value=null,te.value=null;const hl=A=>A.is_folder,Ve=f.value.map((A,ml)=>hl(A)?ml:-1).filter(A=>A!==-1).pop();M.data.files.forEach(A=>{Ve!==void 0?f.value.splice(Ve+1,0,A):f.value.push(A)}),ee.value=M.data.used}).catch(M=>{console.error(M),Q.value=!1,X.value.disabled=!1,te.value=null,axios.isCancel(M)?X.value=null:ll(M)})},ll=l=>{if(!l.response)return;if(l.response.data.error){window.showToast(l.response.data.error,"error");return}if(l.response&&l.response.status===403&&l.response.data.message){window.showToast(g.value.unauthorized,"error");return}Object.keys(l.response.data.errors).forEach(v=>{window.showToast(l.response.data.errors[v][0],"error")})},Be=()=>{let l=f.value.filter(a=>a.is_selected).length;if(l!==0)return"("+l+")"},al=()=>He.value+"%",tl=()=>{be.value.cancel("Upload canceled by user.")},sl=l=>{},nl=(l,a)=>{f.value=f.value.filter(v=>v.id!==l.id),m.value=null,l.is_folder&&(l.folder_id||he()),ee.value=a},il=()=>{m.value=null},ol=()=>{if(m.value===L.value){m.value=null;return}m.value=L.value},ul=()=>{Z.value=!Z.value},rl=()=>{ve.value=!ve.value},Ue=()=>{Z.value=!1,ve.value=!1},dl=()=>{if(!se.value){c.value.toggleParam="",he();return}console.log("filter"),h.value=!0,c.value.toggleParam="unused=1";var l="";c.value.searchParam&&(l+=c.value.searchParam+"&"),c.value.sortParam&&(l+=c.value.sortParam+"&"),c.value.toggleParam&&(l+=c.value.toggleParam+"&"),axios.get(O.value+"/?"+l).then(a=>{De(a.data)})},ye=(l="default")=>{l=="asc"?(ie.value=!1,ge.value=!1,ne.value=!0):l=="desc"?(ne.value=!1,ge.value=!1,ie.value=!0):l=="default"&&(ne.value=!1,ie.value=!1,ge.value=!0),h.value=!0,c.value.sortParam="sort="+l;var a="";c.value.searchParam&&(a+=c.value.searchParam+"&"),c.value.sortParam&&(a+=c.value.sortParam+"&"),c.value.toggleParam&&(a+=c.value.toggleParam+"&");let v=O.value;L.value?.open&&(v=L.value.open),axios.get(v+"/?"+a).then(d=>{cl(d.data)})},cl=l=>{f.value=l.files,k.value=l.next,h.value=!1},De=l=>{f.value=l.files,k.value=l.next,L.value=null,h.value=!1},fl=()=>Ee(ee.value),vl=()=>Ee(ke.value),Ee=l=>l==0?"0":l>1e6?(l/(1024*1024)).toFixed(2)+" GiB":l>1e3?(l/1024).toFixed(2)+" MiB":(l*1).toFixed(2)+" KiB",gl=()=>{let l="rounded h-2 transition-all duration-300",a=Me();return a<60?l+" bg-primary":a<90?l+" bg-orange-400":l+" bg-red-500"},Me=()=>Math.round(ee.value/ke.value*100),pl=()=>te.value!==null;return(l,a)=>{const v=yl("click-outside");return t(),s(z,null,[o.value?(t(),s("div",za,[e("div",Ra,[e("div",Xa,[e("div",Ya,[a[11]||(a[11]=e("i",{class:"fa-regular fa-cloud text-xl","aria-hidden":"true"},null,-1)),e("span",{class:"font-extrabold",innerHTML:g("storage")},null,8,Ka)]),e("div",Oa,[e("span",{innerHTML:fl()},null,8,Wa),e("span",{innerHTML:g("of")},null,8,Ga),e("span",{innerHTML:vl()},null,8,qa)]),e("div",Ja,[e("div",{class:re(gl()),style:S({width:Me()+"%"})},null,6)])]),!B.value||Me()>89&&($.value||C.value)?(t(),s("div",Qa,[e("a",{href:$e.value,innerHTML:g("upgrade"),class:"btn2 btn-default"},null,8,Za)])):u("",!0)]),e("div",et,[e("div",lt,[e("div",at,[e("input",{type:"text",placeholder:"Search",onInput:We},null,32)]),e("div",tt,[e("button",{class:"btn2 btn-default btn-sm",onClick:ul},[a[12]||(a[12]=e("i",{class:"fa-regular fa-filter","aria-hidden":"true"},null,-1)),e("span",{innerHTML:g("filters"),class:"hidden md:inline"},null,8,st),se.value?(t(),s("span",nt,"(1)")):u("",!0)]),Z.value?U((t(),s("div",it,[e("div",ot,[U(e("input",{type:"checkbox","onUpdate:modelValue":a[0]||(a[0]=d=>se.value=d),value:"1",id:"_show_unused",onChange:dl},null,544),[[Ne,se.value]]),e("label",{for:"_show_unused",class:"cursor-pointer",innerHTML:g("filter_only_unused")},null,8,ut)])])),[[v,Ue]]):u("",!0)]),e("div",rt,[e("button",{class:"btn2 btn-default btn-sm",onClick:rl},[a[13]||(a[13]=e("i",{class:"fa-regular fa-arrow-up-arrow-down","aria-hidden":"true"},null,-1)),e("span",{innerHTML:g("sort"),class:"hidden md:inline"},null,8,dt),ne.value||ie.value?(t(),s("span",ct,"(1)")):u("",!0)]),ve.value?U((t(),s("div",ft,[e("ul",vt,[e("li",null,[e("span",{class:"cursor-pointer flex items-center gap-2 px-2 py-2 rounded hover:bg-gray-100 transition",onClick:a[1]||(a[1]=d=>ye("default"))},[ge.value?(t(),s("i",gt)):u("",!0),e("span",{innerHTML:g("sort_default"),class:"inline"},null,8,pt)])]),e("li",null,[e("span",{class:"cursor-pointer flex items-center gap-2 px-2 py-2 rounded hover:bg-gray-100 transition",onClick:a[2]||(a[2]=d=>ye("asc"))},[ne.value?(t(),s("i",ht)):u("",!0),e("span",{innerHTML:g("sort_asc"),class:"inline"},null,8,mt)])]),e("li",null,[e("span",{class:"cursor-pointer flex items-center gap-2 px-2 py-2 rounded hover:bg-gray-100 transition",onClick:a[3]||(a[3]=d=>ye("desc"))},[ie.value?(t(),s("i",_t)):u("",!0),e("span",{innerHTML:g("sort_desc"),class:"inline"},null,8,xt)])])])])),[[v,Ue]]):u("",!0)])]),e("div",bt,[!p.value&&L.value?(t(),s("button",{key:0,class:"btn2 btn-default btn-sm",onClick:ol},[a[14]||(a[14]=e("i",{class:"fa-regular fa-clipboard","aria-hidden":"true"},null,-1)),e("span",{innerHTML:g("details")},null,8,kt)])):u("",!0),!p.value&&I.value?(t(),s("button",{key:1,class:"btn2 btn-default btn-sm",onClick:Je},[a[15]||(a[15]=e("i",{class:"fa-regular fa-plus","aria-hidden":"true"},null,-1)),e("span",{innerHTML:g("new_folder")},null,8,yt)])):u("",!0),!p.value&&I.value?(t(),s("button",{key:2,class:"btn2 btn-default btn-sm",onClick:ze},[a[16]||(a[16]=e("i",{class:"fa-regular fa-list-check","aria-hidden":"true"},null,-1)),e("span",{innerHTML:g("select")},null,8,Mt)])):u("",!0),p.value?(t(),s("button",{key:3,class:"btn2 btn-primary btn-sm",onClick:Xe},[a[17]||(a[17]=e("i",{class:"fa-regular fa-pencil","aria-hidden":"true"},null,-1)),e("span",{innerHTML:g("update")},null,8,Tt),e("span",{innerHTML:Be()},null,8,wt)])):u("",!0),p.value?(t(),s("button",{key:4,class:"btn2 btn-error btn-sm",onClick:Ke},[a[18]||(a[18]=e("i",{class:"fa-regular fa-trash-can","aria-hidden":"true"},null,-1)),e("span",{innerHTML:g("remove")},null,8,Lt),e("span",{innerHTML:Be()},null,8,Ht)])):u("",!0),p.value?(t(),s("button",{key:5,class:"btn2 btn-default btn-sm",onClick:Re},[a[19]||(a[19]=e("i",{class:"fa-solid fa-xmark","aria-hidden":"true"},null,-1)),e("span",{innerHTML:g("cancel")},null,8,$t)])):u("",!0)])]),h.value?(t(),s("div",Ct,[...a[20]||(a[20]=[e("i",{class:"fa-solid fa-spinner fa-spin","aria-label":"Loading"},null,-1)])])):(t(),s("div",Ft,[L.value?(t(),s("div",Pt,[e("a",{onClick:he,innerHTML:g("home"),class:"text-base-content cursor-pointer"},null,8,It),(t(!0),s(z,null,Y(N.value,(d,_)=>(t(),s("span",St,[a[21]||(a[21]=e("i",{class:"fa-solid fa-chevron-right text-base","aria-hidden":"true"},null,-1)),e("a",{onClick:M=>Fe(d),innerHTML:d.name,class:"text-base-content cursor-pointer"},null,8,Bt)]))),256))])):u("",!0),e("div",Ut,[e("div",{class:re(Ye())},[D.value&&!se.value?(t(),s("div",{key:0,class:"rounded-xl shadow bg-base-100 overflow-hidden col-span-2 sm:col-span-3 md:w-48 cursor-pointer flex justify-center items-center flex-col gap-4",onClick:Ze},[Q.value?pl()?(t(),s("div",{key:1,class:"cover-background w-full h-full flex p-2",style:S({backgroundImage:"url('"+te.value+"')"})},[e("div",Nt,[e("div",{class:"h-1 bg-accent shadow-xs",role:"progressbar","aria-valuenow":"0","aria-valuemin":"0","aria-valuemax":"100",style:S({width:al()})},[...a[24]||(a[24]=[e("span",{class:"sr-only"},null,-1)])],4)])],4)):u("",!0):(t(),s("div",Dt,[a[23]||(a[23]=e("div",{class:"flex flex-col gap-2 items-center"},[e("i",{class:"fa-regular fa-image text-4xl text-neutral-content","aria-hidden":"true"}),e("span",null,"Upload files")],-1)),e("div",Et,[a[22]||(a[22]=e("i",{class:"fa-regular fa-info-circle mr-1 text-base","aria-hidden":"true"},null,-1)),e("span",{innerHTML:g("upload_hint"),class:"text-neutral-content"},null,8,Vt)])])),e("input",{type:"file",multiple:"",accept:"image/*, .gif, .webp, .woff2",class:"hidden",onChange:el,ref_key:"fileField",ref:X},null,544)])):u("",!0),(t(!0),s(z,null,Y(f.value,d=>(t(),Ml(Al,{file:d,isBulking:p.value,i18n:j.value,onSelect:_=>Oe(d)},null,8,["file","isBulking","i18n","onSelect"]))),256))],2),m.value?(t(),s("div",jt,[Tl(ja,{file:m.value,visibilities:x.value,premium:B.value,canManage:I.value,i18n:j.value,onUpdated:sl,onDeleted:nl,onClosed:il},null,8,["file","visibilities","premium","canManage","i18n"])])):u("",!0)])]))])):(t(),s("div",Aa,[...a[10]||(a[10]=[e("i",{class:"fa-solid fa-spinner fa-spin","aria-label":"Loading"},null,-1)])])),e("div",{ref_key:"infiniteScrollTrigger",ref:oe,class:"h-4"},[w.value?(t(),s("div",At,[...a[25]||(a[25]=[e("i",{class:"fa-solid fa-spinner fa-spin","aria-label":"Loading"},null,-1)])])):u("",!0)],512),o.value?(t(),s("dialog",{key:2,ref_key:"newDialog",ref:q,class:"dialog rounded-2xl text-center bg-base-100 text-base-content"},[e("header",zt,[e("h4",{innerHTML:g("new_folder"),class:"text-lg font-normal"},null,8,Rt),e("button",{type:"button",class:"text-base-content",onClick:a[4]||(a[4]=d=>ue(q.value)),title:"Close"},[...a[26]||(a[26]=[e("i",{class:"fa-regular fa-circle-xmark","aria-hidden":"true"},null,-1),e("span",{class:"sr-only"},"Close",-1)])])]),e("article",Xt,[e("div",Yt,[e("label",{innerHTML:g("name")},null,8,Kt),U(e("input",{type:"text",class:"w-full","onUpdate:modelValue":a[5]||(a[5]=d=>J.value=d),ref_key:"folderNameField",ref:ce,onKeyup:wl(Se,["enter"])},null,544),[[Ae,J.value]])]),e("div",Ot,[e("label",{innerHTML:g("visibility")},null,8,Wt),U(e("select",{class:"w-full","onUpdate:modelValue":a[6]||(a[6]=d=>R.value=d)},[(t(!0),s(z,null,Y(x.value,(d,_)=>(t(),s("option",{value:_,innerHTML:d},null,8,Gt))),256))],512),[[me,R.value]])])]),e("footer",qt,[e("menu",Jt,[e("button",{type:"submit",class:"btn2 btn-primary",onClick:Se,innerHTML:g("create")},null,8,Qt)])])],512)):u("",!0),o.value?(t(),s("dialog",{key:3,ref_key:"updateDialog",ref:y,class:"dialog rounded-2xl text-center bg-base-100 text-base-content"},[e("header",Zt,[e("h4",{innerHTML:g("update"),class:"text-lg font-normal"},null,8,es),e("button",{type:"button",class:"text-base-content",onClick:a[7]||(a[7]=d=>ue(y.value)),title:"Close"},[...a[27]||(a[27]=[e("i",{class:"fa-regular fa-circle-xmark","aria-hidden":"true"},null,-1),e("span",{class:"sr-only"},"Close",-1)])])]),e("article",ls,[e("div",as,[e("label",{innerHTML:g("visibility")},null,8,ts),U(e("select",{class:"w-full","onUpdate:modelValue":a[8]||(a[8]=d=>H.value=d)},[(t(!0),s(z,null,Y(i.value,(d,_)=>(t(),s("option",{value:_,innerHTML:d},null,8,ss))),256))],512),[[me,H.value]])]),e("div",ns,[e("label",{innerHTML:g("folder")},null,8,is),U(e("select",{class:"w-full","onUpdate:modelValue":a[9]||(a[9]=d=>P.value=d)},[(t(!0),s(z,null,Y(ae.value,(d,_)=>(t(),s("option",{value:_,innerHTML:d},null,8,os))),256))],512),[[me,P.value]])])]),e("footer",us,[e("menu",rs,[e("button",{type:"submit",class:"btn2 btn-primary",onClick:Qe,innerHTML:g("change")},null,8,ds)])])],512)):u("",!0)],64)}}}),we=Ll({});we.component("gallery",cs);we.use(Hl);we.mount("#gallery");

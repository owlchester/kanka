import{d as V,E as $,o as z,G as K,a as s,c as n,b as l,p as u,w as q,v as A,f as _,g as y,F as x,r as j,t as C,e as H,h as d}from"./vendor-tiptap-BeM3cQ0c.js";import{a as B}from"./index-D5GkNzM3.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";const O={class:"gallery-container w-[800px] max-w-[90vw] max-h-[80vh] flex flex-col"},Q={class:"gallery-header flex items-center justify-between p-4"},W={class:"p-4 space-y-3"},X={class:"flex gap-2"},Y={class:"relative flex-1"},Z={key:0,class:"flex items-center gap-2 text-sm"},ee={class:"text-base-content/70"},te={class:"gallery-content flex-1 min-h-0 overflow-y-auto p-4"},le={key:0,class:"flex items-center justify-center py-12"},ae={key:1,class:"flex items-center justify-center py-12 text-base-content/50"},se={key:2,class:"grid grid-cols-4 gap-4"},ne=["onClick"],re={key:0,class:"absolute inset-0 flex flex-col items-center justify-center gap-2"},oe={class:"text-sm text-neutral-content truncate max-w-full px-2"},ie=["src","alt"],ue={class:"absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/70 to-transparent p-2 opacity-0 group-hover:opacity-100 transition-opacity"},de={class:"text-white text-xs truncate block"},ce={key:0,class:"gallery-footer flex items-center justify-center gap-2 p-4 border-t border-base-300"},ve=["disabled"],fe=["disabled"],pe=V({__name:"GalleryDialog",props:{galleryId:{}},setup(G){const R=G,h=d(null),b=d([]),m=d(!1),c=d(""),o=d(""),k=d(""),f=d({first:null,last:null,prev:null,next:null}),v=d([]),T=d(null);let i=null,r=null;const S=t=>{t.detail.galleryId===R.galleryId&&(T.value=t.detail.editor,k.value=t.detail.galleryUrl,o.value=`${t.detail.galleryUrl}?setup`,v.value=[],c.value="",p(o.value),h.value?.showModal())},w=()=>{r&&(clearTimeout(r),r=null),i&&(i.abort(),i=null),h.value?.close()},p=async t=>{i&&i.abort(),i=new AbortController,m.value=!0;try{const e=await B.get(t,{signal:i.signal});b.value=e.data.data||[],f.value={first:e.data.links?.first||null,last:e.data.links?.last||null,prev:e.data.links?.prev||null,next:e.data.links?.next||null}}catch(e){if(B.isCancel(e))return;console.error("Failed to load gallery images:",e),b.value=[]}finally{m.value=!1}},g=()=>{r&&(clearTimeout(r),r=null),v.value=[];const t=new URL(k.value);t.searchParams.set("setup",""),c.value&&t.searchParams.set("term",c.value),o.value=t.toString(),p(o.value)},D=()=>{r&&clearTimeout(r),r=setTimeout(()=>{g()},500)},E=t=>{t.key==="Enter"&&(t.preventDefault(),g())},L=()=>{c.value="",g()};$(c,(t,e)=>{t!==e&&D()});const N=t=>{!t.folder||!t.url||(v.value.push({url:o.value,name:t.name}),o.value=t.url,p(t.url))},F=()=>{if(v.value.length===0)return;const t=v.value.pop();t&&(o.value=t.url,p(t.url))},M=()=>{v.value=[];const t=new URL(k.value);o.value=t.toString(),p(o.value)},U=t=>{t&&(o.value=t,p(t))},P=t=>{if(t.folder){N(t);return}T.value?.chain().focus().setImage({src:t.src,alt:t.name,"data-gallery-id":t.uuid}).run(),w()};return z(()=>{window.addEventListener("tiptap:open-gallery",S)}),K(()=>{window.removeEventListener("tiptap:open-gallery",S),r&&clearTimeout(r),i&&i.abort()}),(t,e)=>(s(),n("dialog",{ref_key:"dialogRef",ref:h,class:"gallery-dialog rounded-2xl bg-base-100 p-0 backdrop:bg-black/50",onClick:u(w,["self"])},[l("div",O,[l("div",Q,[e[4]||(e[4]=l("h2",{class:""},"Gallery",-1)),l("button",{onClick:u(w,["prevent"]),class:"btn2 btn-ghost"},[...e[3]||(e[3]=[l("i",{class:"fa-regular fa-times","aria-hidden":"true"},null,-1)])])]),l("div",W,[l("div",X,[l("div",Y,[q(l("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>c.value=a),type:"text",placeholder:"Search images...",class:"input input-bordered w-full pr-10",onKeydown:E},null,544),[[A,c.value]]),c.value?(s(),n("button",{key:0,onClick:u(L,["prevent"]),class:"absolute right-3 top-1/2 -translate-y-1/2 text-base-content/50 hover:text-base-content"},[...e[5]||(e[5]=[l("i",{class:"fa-regular fa-times","aria-hidden":"true"},null,-1)])])):_("",!0)]),l("button",{onClick:u(g,["prevent"]),class:"btn2 btn-primary"},[...e[6]||(e[6]=[l("i",{class:"fa-regular fa-search","aria-hidden":"true"},null,-1),y(" Search ",-1)])])]),v.value.length>0?(s(),n("div",Z,[l("button",{onClick:u(M,["prevent"]),class:"btn2 btn-ghost btn-xs"},[...e[7]||(e[7]=[l("i",{class:"fa-regular fa-home","aria-hidden":"true"},null,-1)])]),e[10]||(e[10]=l("span",{class:"text-base-content/50"},"/",-1)),(s(!0),n(x,null,j(v.value,(a,I)=>(s(),n(x,{key:I},[l("span",ee,C(a.name),1),e[8]||(e[8]=l("span",{class:"text-base-content/50"},"/",-1))],64))),128)),l("button",{onClick:u(F,["prevent"]),class:"btn2 btn-ghost btn-xs"},[...e[9]||(e[9]=[l("i",{class:"fa-regular fa-arrow-left","aria-hidden":"true"},null,-1),y(" Back ",-1)])])])):_("",!0)]),l("div",te,[m.value?(s(),n("div",le,[...e[11]||(e[11]=[l("i",{class:"fa-solid fa-spinner fa-spin text-2xl","aria-hidden":"true"},null,-1)])])):b.value.length===0?(s(),n("div",ae," No images found ")):(s(),n("div",se,[(s(!0),n(x,null,j(b.value,a=>(s(),n("button",{key:a.uuid,onClick:u(I=>P(a),["prevent"]),class:"gallery-item group relative aspect-square rounded-lg overflow-hidden border border-base-300 hover:border-primary transition-colors cursor-pointer bg-base-200"},[a.folder?(s(),n("div",re,[l("i",{class:H([a.icon,"text-4xl text-neutral-content"]),"aria-hidden":"true"},null,2),l("span",oe,C(a.name),1)])):(s(),n(x,{key:1},[l("img",{src:a.thumbnail,alt:a.name,class:"absolute inset-0 w-full h-full object-cover",loading:"lazy"},null,8,ie),l("div",ue,[l("span",de,C(a.name),1)])],64))],8,ne))),128))]))]),f.value.prev||f.value.next?(s(),n("div",ce,[l("button",{onClick:e[1]||(e[1]=u(a=>U(f.value.prev),["prevent"])),disabled:!f.value.prev,class:"btn2 btn-ghost btn-xs"},[...e[12]||(e[12]=[l("i",{class:"fa-regular fa-chevron-left","aria-hidden":"true"},null,-1),y(" Previous ",-1)])],8,ve),l("button",{onClick:e[2]||(e[2]=u(a=>U(f.value.next),["prevent"])),disabled:!f.value.next,class:"btn2 btn-ghost btn-xs"},[...e[13]||(e[13]=[y(" Next ",-1),l("i",{class:"fa-regular fa-chevron-right","aria-hidden":"true"},null,-1)])],8,fe)])):_("",!0)])],512))}}),xe=J(pe,[["__scopeId","data-v-1d30234a"]]);export{xe as default};

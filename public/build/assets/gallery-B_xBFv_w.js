import{a as f}from"./index-B9ygI19o.js";const g=document.querySelector("#gallery-loader"),l=document.querySelector("#gallery-images"),n=document.querySelector("#gallery-search"),u=document.querySelector("#bulk-delete"),p=document.querySelector("form#gallery-bulk"),d=document.getElementById("gallery-form"),c=document.querySelector(".progress"),y=document.querySelector(".gallery-error");let m,b;const E=()=>{const e=document.querySelector("#gallery-config");m=e.dataset.max,b=e.dataset.error,n.addEventListener("blur",function(r){r.preventDefault(),h()}),n.addEventListener("keydown",function(r){r.key==="Enter"&&(r.preventDefault(),h())}),S(),p.onsubmit=function(r){r.preventDefault();const t=new FormData;document.querySelectorAll('li[data-selected="1"]')?.forEach(o=>{t.append("file[]",o.dataset.id)});const a=document.querySelector('input[name="folder_id"]');return a&&t.append("folder_id",a.value),f.post(p.getAttribute("action"),t).then(o=>(document.querySelectorAll('li[data-selected="1"]')?.forEach(v=>v.remove()),document.getElementById("bulk-destroy-dialog").close(),u.classList.add("btn-disabled"),window.showToast(o.data.toast),!1)),!1}},S=()=>{d&&(d.ondrop=e=>{if(e.preventDefault(),e.stopPropagation(),e.dataTransfer.items){let r=new FormData,t=0;if([...e.dataTransfer.items].forEach((o,s)=>{o.kind==="file"&&(r.append("file[]",o.getAsFile()),t++)}),t>m){L();return}let a=document.querySelector('input[name="folder_id"]');a&&r.append("folder_id",a.value),w(r),d.classList.remove("drop-shadow","dropping")}else[...e.dataTransfer.files].forEach((r,t)=>{})},d.ondragover=e=>{e.preventDefault(),d.classList.add("drop-shadow","dropping")},d.ondragleave=e=>{d.classList.remove("drop-shadow","dropping")})};function h(){l.classList.add("hidden"),g.classList.remove("hidden"),f.get(n.dataset.url+"?q="+n.value).then(e=>{g.classList.add("hidden"),l.innerHTML=e.data,l.classList.remove("hidden"),i()})}const q=()=>{d&&(d.onchange=e=>{e.preventDefault();let r=document.getElementById("file-upload");if(r.files.length>m){L();return}let t=new FormData;Array.from(r.files).forEach(o=>{t.append("file[]",o)});let a=document.querySelector('input[name="folder_id"]');a&&t.append("folder_id",a.value),w(t)})},L=()=>{window.showToast(b,"error")},w=e=>{let r={headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(t){let a=Math.round(t.loaded*100/t.total);document.querySelector('[role="progressbar"]').style.width=a+"%"}};c.classList.remove("hidden"),f.post(d.action,e,r).then(function(t){c.classList.add("hidden"),t.data.success&&(t.data.images.forEach(a=>{const o=document.querySelectorAll("li[data-folder]");o.length>1?o[o.length-1].insertAdjacentHTML("afterend",a):l.insertAdjacentHTML("afterbegin",a)}),T(t.data.storage),i())}).catch(function(t){if(c.classList.add("hidden"),t.response&&t.response.data.message){y.innerHTML=t.response.data.message,y.classList.remove("hidden");let a=t.response.data.errors;Object.keys(a).forEach(s=>{window.showToast(a[s],"error")})}i()})},i=()=>{document.querySelectorAll("#gallery-images li")?.forEach(e=>{e.dataset.binded!=="1"&&(e.dataset.binded="1",e.addEventListener("click",function(r){if(r.shiftKey){if(!e.dataset.id)return;e.classList.toggle("border-2"),e.classList.toggle("border-blue-500"),e.getAttribute("data-selected")==="1"?e.setAttribute("data-selected",""):e.setAttribute("data-selected",1),A();return}let t=e.dataset.folder;if(t){window.location=t;return}window.openDialog("primary-dialog",e.dataset.url)}))})},A=()=>{document.querySelectorAll('li[data-selected="1"]').length===0?u.classList.add("btn-disabled"):u.classList.remove("btn-disabled")},T=e=>{let r=document.getElementById("storage-progress");r.style.width=e.percentage+"%",r.className=e.progress;let t=document.getElementById("storage-used");t.innerHTML=e.used};E();q();i();

import{d as N,c as v,a as c,F as E,f as g,e as O,b as l,w as R,z as Z,r as f,o as ee,j as te,g as le,i as se,q as ne}from"./vue.esm-bundler-CwMNFu8m.js";import{v as ie}from"./v-click-outside.umd-E7ZR94gB.js";import"./_commonjsHelpers-CqkleIqs.js";const ae={class:"flex gap-2 items-center"},oe={class:"flex-none flex items-center"},re=["innerHTML"],de=["innerHTML"],ce={class:"flex items-center gap-2 md:gap-4"},ue={class:"grow text-neutral-content"},ve=["innerHTML"],fe={key:0,class:"flex-none"},pe=["innerHTML"],me={key:1,class:"rounded shadow-sm p-4 flex gap-2 items-center bg-base-200 hover:shadow-lg"},ge=["innerHTML"],he=["innerHTML"],_e=N({__name:"Element",props:{model:{},i18n:{}},emits:["recover"],setup(r,{emit:w}){const y=w,a=r,k=()=>{a.model.url||(a.model.is_selected=!a.model.is_selected)},h=()=>{let o="rounded-xl shadow-xs bg-base-100 flex flex-col gap-2 md:gap-4 p-4 hover:shadow";return a.model.url||(o=o+" cursor-pointer"),a.model.is_selected?o+" bg-base-200":o+"  "},x=(o,d=[])=>{if(!a.i18n[o])return console.error("Missing trans",o,a.i18n),"MISSING";let p=a.i18n[o];return d.forEach(M=>{p=p.replace("placeholder",M)}),p},L=()=>{let o="btn2 btn-default btn-sm";return a.model.is_recovering&&(o+=" loading btn-disabled"),o},i=()=>{y("recover",a.model)};return(o,d)=>(c(),v(E,null,[!r.model.is_hidden&&!r.model.url?(c(),v("div",{key:0,class:O(h()),onClick:k},[l("div",ae,[l("div",oe,[r.model.url?g("",!0):R((c(),v("input",{key:0,type:"checkbox","onUpdate:modelValue":d[0]||(d[0]=p=>r.model.is_selected=p),onClick:d[1]||(d[1]=(...p)=>o.startBulking&&o.startBulking(...p))},null,512)),[[Z,r.model.is_selected]])]),l("div",{class:"grow font-extrabold truncate",innerHTML:r.model.name},null,8,re),l("div",{class:"rounded-xl px-3 py-1 text-xs bg-base-200",innerHTML:r.model.type_name},null,8,de)]),d[3]||(d[3]=l("hr",null,null,-1)),l("div",ce,[l("div",ue,[l("span",{class:"text-xs",innerHTML:x("deleted_at",[r.model.date,r.model.deleted_name])},null,8,ve)]),r.model.url?g("",!0):(c(),v("div",fe,[l("button",{class:O(L()),onClick:d[2]||(d[2]=p=>i()),innerHTML:x("recover")},null,10,pe)]))])],2)):g("",!0),!r.model.is_hidden&&r.model.url?(c(),v("div",me,[d[4]||(d[4]=l("div",{class:"flex-none"},[l("i",{class:"fa-solid text-green-500 fa-circle-check","aria-hidden":"true"})],-1)),l("div",{class:"grow",innerHTML:x("recovery_success",[r.model.url,r.model.name])},null,8,ge),l("div",{class:"rounded-xl px-3 py-1 text-xs bg-base-300",innerHTML:r.model.type_name},null,8,he)])):g("",!0)],64))}}),xe={key:0,class:"text-center text-4xl p-4"},be={key:1,class:"flex flex-col gap-4 md:gap-5"},ye={class:"flex gap-4 flex-wrap sticky top-14 z-50"},ke={class:"flex gap-2 grow"},Le={class:"flex gap-0.5"},Me={class:"relative"},Te=["innerHTML"],we={key:0,class:"border shadow-sm rounded bg-base-100 p-4 absolute right-0 flex flex-col gap-5 w-60"},He=["innerHTML"],Ce=["innerHTML"],Ee=["innerHTML"],$e={class:"flex gap-2 self-end flex-wrap"},Ie=["innerHTML"],Be=["innerHTML"],Se=["innerHTML"],De=["innerHTML"],Oe={key:0,class:"text-center text-4xl p-4"},Ne={key:1,class:"flex flex-col gap-4"},Re={class:"flex gap-2 flex-row"},Ae={class:"grid grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-4 md:gap-5"},je={class:"flex gap-6 items-center p-4 md:p-6 justify-between"},Fe=["innerHTML"],ze={class:"max-w-4xl flex flex-col gap-2 text-left p-4 md:px-6"},Ge={class:"flex flex-col gap-1 w-full"},Ve=["innerHTML"],Xe={class:"p-4 md:px-6"},Ye={class:""},qe=["href","innerHTML"],Ue=N({__name:"Recovery",props:{api:{}},setup(r){const w=r,y=f(!1),a=f(!1),k=f(!1),h=f(),x=f(),L=f(null),i=f([]),o=f("newest"),d=f(),p=f(),M=f(),b=f(!1),_=f(!1),I=f();ee(()=>{axios.get(w.api).then(e=>{y.value=!0,i.value=e.data.elements,d.value=e.data.i18n,M.value=e.data.api.recovery,k.value=e.data.acl.premium,I.value=e.data.upgrade})});const m=e=>d.value[e]?d.value[e]:(console.error("Missing trans",e,d),"MISSING"),A=e=>{let t=i.value.find(u=>u.id===e.id);!t.url&&!t.is_hidden&&(t.is_selected=!0)},j=e=>{let t=i.value.find(u=>u.id===e.id);t.is_selected=!1},F=e=>{if(!k.value){B(p.value);return}let t=i.value.find(n=>n.id===e.id);if(t.is_recovering=!0,b.value)return;b.value=!0;let u={};t.type==="post"?(u.posts=[t.id],u.entities=[]):(u.entities=[t.id],u.posts=[]),axios.post(M.value,u).then(n=>{b.value=!1,Object.keys(n.data.entities).map(s=>n.data.entities[s]);let T=i.value.filter(s=>s.is_recovering&&s.type=="entity"),C=i.value.filter(s=>s.is_recovering&&s.type=="post");T.forEach(s=>{s.is_selected=!1,s.is_recovering=!1,n.data.entities[s.id]&&(s.url=n.data.entities[s.id])}),C.forEach(s=>{s.is_selected=!1,s.is_recovering=!1,n.data.posts[s.id]&&(s.url=n.data.posts[s.id])}),window.showToast(n.data.toast)})},z=()=>{i.value.forEach(A)},G=()=>{i.value.forEach(j)},V=e=>{h.value=e.target.value.toLowerCase(),L.value&&clearTimeout(L.value),L.value=setTimeout(()=>{X()},300)},X=()=>{if(x.value!=h.value){if(x.value=h.value,!h.value){i.value.forEach(e=>{e.is_hidden=!1});return}a.value=!0,K()}},H=()=>i.value.filter(t=>t.is_selected).length!==0,Y=()=>{if(!k.value){B(p.value);return}if(b.value)return;let e=i.value.filter(n=>n.is_selected&&n.type=="entity").map(n=>n.id),t=i.value.filter(n=>n.is_selected&&n.type=="post").map(n=>n.id);if(e.length===0&&t.length===0)return;b.value=!0;let u={};u.entities=e,u.posts=t,axios.post(M.value,u).then(n=>{b.value=!1,Object.keys(n.data.entities).map(s=>n.data.entities[s]);let T=i.value.filter(s=>s.is_selected&&s.type=="entity"),C=i.value.filter(s=>s.is_selected&&s.type=="post");T.forEach(s=>{s.is_selected=!1,n.data.entities[s.id]&&(s.url=n.data.entities[s.id])}),C.forEach(s=>{s.is_selected=!1,n.data.posts[s.id]&&(s.url=n.data.posts[s.id])}),window.showToast(n.data.toast)})},q=()=>{let e=i.value.filter(t=>t.is_selected).length;if(e!==0)return"("+e+")"},U=()=>{_.value=!_.value},J=()=>{_.value=!1},K=()=>{i.value.forEach(e=>{e.name.toLowerCase().includes(h.value)?e.is_hidden=!1:e.is_hidden=!0}),a.value=!1},P=()=>{a.value=!0,i.value.sort(function(e,t){return e.position-t.position}),a.value=!1,_.value=!1,o.value="newest"},Q=()=>{a.value=!0,i.value.sort(function(e,t){return t.position-e.position}),a.value=!1,_.value=!1,o.value="oldest"},W=()=>{a.value=!0,i.value.sort(function(e,t){return e.type_name.localeCompare(t.type_name)}),a.value=!1,_.value=!1,o.value="type"},B=e=>{e.showModal(),e.addEventListener("click",S)},S=e=>{let t=e.target.getBoundingClientRect();!(t.top<=e.clientY&&e.clientY<=t.top+t.height&&t.left<=e.clientX&&e.clientX<=t.left+t.width)&&e.target.tagName==="DIALOG"&&D(e.target)},D=e=>{e.removeEventListener("click",S),e.close()};return(e,t)=>{const u=te("click-outside");return c(),v(E,null,[y.value?(c(),v("div",be,[l("div",ye,[l("div",ke,[l("div",Le,[l("input",{type:"text",placeholder:"Search",onInput:V},null,32)]),l("div",Me,[l("button",{class:"btn2 btn-default btn-sm",onClick:U},[t[2]||(t[2]=l("i",{class:"fa-regular fa-filter","aria-hidden":"true"},null,-1)),l("span",{innerHTML:m("order_by_"+o.value),class:"hidden md:inline"},null,8,Te)]),_.value?R((c(),v("div",we,[l("label",{onClick:P,class:"cursor-pointer",innerHTML:m("newest")},null,8,He),l("label",{onClick:Q,class:"cursor-pointer",innerHTML:m("oldest")},null,8,Ce),l("label",{onClick:W,class:"cursor-pointer",innerHTML:m("type")},null,8,Ee)])),[[u,J]]):g("",!0)])]),l("div",$e,[H()?g("",!0):(c(),v("button",{key:0,class:"btn2 btn-default btn-sm",onClick:z},[t[3]||(t[3]=l("i",{class:"fa-regular fa-list-check","aria-hidden":"true"},null,-1)),l("span",{innerHTML:m("select_all")},null,8,Ie)])),H()?(c(),v("button",{key:1,class:"btn2 btn-default btn-sm",onClick:G},[t[4]||(t[4]=l("i",{class:"fa-regular fa-xmark","aria-hidden":"true"},null,-1)),l("span",{innerHTML:m("deselect_all")},null,8,Be)])):g("",!0),H()?(c(),v("button",{key:2,class:"btn2 btn-primary btn-sm",onClick:Y},[t[5]||(t[5]=l("i",{class:"fa-regular fa-plus","aria-hidden":"true"},null,-1)),l("span",{innerHTML:m("restore_selected")},null,8,Se),l("span",{innerHTML:q()},null,8,De)])):g("",!0)])]),a.value?(c(),v("div",Oe,[...t[6]||(t[6]=[l("i",{class:"fa-solid fa-spinner fa-spin","aria-label":"Loading"},null,-1)])])):(c(),v("div",Ne,[l("div",Re,[l("div",Ae,[(c(!0),v(E,null,le(i.value,n=>(c(),se(_e,{model:n,i18n:d.value,onRecover:T=>F(n)},null,8,["model","i18n","onRecover"]))),256))])])]))])):(c(),v("div",xe,[...t[1]||(t[1]=[l("i",{class:"fa-solid fa-spinner fa-spin","aria-label":"Loading"},null,-1)])])),y.value?(c(),v("dialog",{key:2,ref_key:"premiumDialog",ref:p,class:"dialog rounded-2xl text-center"},[l("header",je,[l("h4",{innerHTML:m("premium_title"),class:"text-lg font-normal"},null,8,Fe),l("button",{type:"button",class:"text-base-content",onClick:t[0]||(t[0]=n=>D(p.value)),title:"Close"},[...t[7]||(t[7]=[l("i",{class:"fa-regular fa-circle-xmark","aria-hidden":"true"},null,-1),l("span",{class:"sr-only"},"Close",-1)])])]),l("article",ze,[l("div",Ge,[l("label",{innerHTML:m("premium")},null,8,Ve)])]),l("footer",Xe,[l("menu",Ye,[l("a",{href:I.value,innerHTML:m("upgrade"),class:"btn2 btn-default"},null,8,qe)])])],512)):g("",!0)],64)}}}),$=ne({});$.component("recovery",Ue);$.use(ie);$.mount("#recovery");

import{d as Te,c as s,a as t,e as re,w as U,f as u,b as e,z as Ne,n as S,r as n,A as _l,o as je,v as Ae,u as me,F as z,g as Y,B as xl,C as bl,j as kl,i as yl,l as Ml,k as Tl,q as wl}from"./vue.esm-bundler-9PVW6b4_.js";import{v as Ll}from"./v-click-outside.umd-E7ZR94gB.js";import"./_commonjsHelpers-CqkleIqs.js";const Hl={key:1,class:"flex-none w-20 md:w-full h-16 md:h-32"},$l={key:1,class:"w-full h-full flex gap-0.5"},Cl={key:2,class:"w-full h-full flex gap-0.5"},Fl={class:"flex flex-col gap-0.5 w-1/2 h-full"},Pl={key:3,class:"h-full w-full flex items-center justify-center align-middle text-6xl text-neutral-content"},Il={key:3,class:"w-full h-20 md:h-32"},Sl={class:"flex gap-1 md:gap-2 items-center md:p-4 truncate"},Bl={key:0,class:"grow-0 md:hidden"},Ul=["title"],Dl={class:"grow truncate"},El=["innerHTML"],Vl={key:1,class:"hidden md:block grow-0"},Nl=["title"],jl=Te({__name:"Preview",props:{file:{},isBulking:{},i18n:{}},emits:["select"],setup(r,{emit:le}){const o=le,h=r,V=()=>h.file.thumbnail!==null,T=$=>"url('"+$+"')",w=()=>{o("select",h.file)},D=()=>{let $="rounded-xl shadow-sm bg-base-100 overflow-hidden sm:w-48 cursor-pointer hover:shadow-lg relative flex flex-row md:flex-col gap-2 md:gap-0";return!h.file.is_selected||!h.isBulking?$+"  ":$+" bg-base-300"},g=()=>{switch(parseInt(h.file.visibility_id)){case 2:return"fa-regular fa-lock";case 3:return"fa-regular fa-user-lock";case 4:return"fa-regular fa-user-secret";case 5:return"fa-regular fa-users";default:return"fa-regular fa-eye"}},B=()=>h.i18n["visibility."+h.file.visibility_id];return($,C)=>(t(),s("div",{class:re(D()),onClick:w},[r.isBulking?U((t(),s("input",{key:0,type:"checkbox","onUpdate:modelValue":C[0]||(C[0]=I=>r.file.is_selected=I),class:"absolute! top-4 left-4"},null,512)),[[Ne,r.file.is_selected]]):u("",!0),r.file.is_folder?(t(),s("div",Hl,[r.file.thumbnails.length===1?(t(),s("div",{key:0,class:"w-full h-full",style:S({backgroundImage:T(r.file.thumbnails[0])})},null,4)):r.file.thumbnails.length===2?(t(),s("div",$l,[e("div",{class:"w-1/2 h-full cover-background",style:S({backgroundImage:T(r.file.thumbnails[0])})},null,4),e("div",{class:"w-1/2 h-full cover-background",style:S({backgroundImage:T(r.file.thumbnails[1])})},null,4)])):r.file.thumbnails.length===3?(t(),s("div",Cl,[e("div",{class:"w-1/2 h-full cover-background",style:S({backgroundImage:T(r.file.thumbnails[0])})},null,4),e("div",Fl,[e("div",{class:"w-full h-1/2 cover-background",style:S({backgroundImage:T(r.file.thumbnails[1])})},null,4),e("div",{class:"w-full h-1/2 cover-background",style:S({backgroundImage:T(r.file.thumbnails[2])})},null,4)])])):(t(),s("div",Pl,[...C[1]||(C[1]=[e("i",{class:"fa-regular fa-folder","aria-hidden":"true"},null,-1)])]))])):V()?(t(),s("div",{key:2,class:"flex-none w-20 md:w-full h-16 md:h-32 cover-background",style:S({backgroundImage:T(r.file.thumbnail)})},null,4)):(t(),s("div",Il)),e("div",Sl,[r.file.visibility_id>1?(t(),s("div",Bl,[e("i",{class:re(g()),"aria-hidden":"true",title:B()},null,10,Ul)])):u("",!0),e("div",Dl,[e("span",{innerHTML:r.file.name,class:""},null,8,El)]),r.file.visibility_id>1?(t(),s("div",Vl,[e("i",{class:re(g()),"aria-hidden":"true",title:B()},null,10,Nl)])):u("",!0)])],2))}}),Al={class:"bg-base-100 p-2 md:p-4 rounded flex flex-col gap-2 md:gap-4 md:sticky md:top-24"},zl={key:0,class:"text-2xl flex items-center justify-center h-32"},Rl={key:1,class:"flex flex-col gap-4"},Xl={class:"flex items-center gap-2"},Yl={class:"flex items-center gap-1 grow"},Kl=["innerHTML"],Ol={class:"flex flex-col gap-1"},Wl=["innerHTML"],Gl=["innerHTML"],ql={key:0,class:"flex flex-col gap-1"},Jl={class:"font-extrabold flex gap-1 items-center"},Ql=["innerHTML"],Zl=["value","innerHTML"],ea={key:1,class:"flex flex-col gap-1"},la={class:"grow font-bold flex gap-1 items-center"},aa=["innerHTML"],ta={key:0,class:"fa-solid fa-chevron-up","aria-label":"Hide mentions"},sa={key:1,class:"fa-solid fa-chevron-down","aria-label":"Show mentions"},na={key:0,class:"flex flex-wrap gap-2"},ia=["href"],oa={key:0,class:"fa-regular fa-image","aria-hidden":"true"},ua={key:1,class:"fa-regular fa-pen","aria-hidden":"true"},ra=["innerHTML"],da=["innerHTML"],ca={key:2,class:"grid grid-cols-2 gap-2"},fa=["innerHTML"],va=["innerHTML"],ga=["innerHTML"],pa=["innerHTML"],ha=["innerHTML"],ma=["innerHTML"],_a=["innerHTML"],xa=["href"],ba=["innerHTML"],ka={class:"flex gap-2 items-center justify-between"},ya={key:0,class:"fa-solid fa-spinner fa-spin text-error","aria-label":"Deleting"},Ma=["innerHTML"],Ta=["innerHTML"],wa=["innerHTML"],La={key:3,class:"grow text-right text-neutral-content"},Ha=["innerHTML"],$a={key:3,class:"text-right text-neutral-content flex gap-1 self-end items-center text-xs"},Ca=["innerHTML"],Fa={key:2,class:"flex flex-col gap-4 overflow-hidden"},Pa={key:0,class:"alert alert-warning p-4 flex flex-col gap-2"},Ia=["innerHTML"],Sa={key:1,class:"max-w-32 flex items-center justify-center"},Ba={class:"relative inline-block"},Ua=["src"],Da={class:"flex gap-2 items-center flex-wrap justify-between"},Ea=["innerHTML"],Va=["innerHTML"],Na=Te({__name:"File",props:{file:{},visibilities:{},i18n:{},premium:{},canManage:{}},emits:["updated","deleted","moved","closed"],setup(r,{emit:le}){const o=r,h=le,V=n(),T=n(),w=n(!1),D=n(!1),g=n(),B=n(!0),$=n(!1),C=n(!1),I=n(!0),N=n(!1),k=n(),m=n(),F=n();_l(()=>o.file,(x,i)=>{x&&K()}),je(()=>{K()});const b=x=>o.i18n[x]?o.i18n[x]:"_"+x+"_",K=()=>{B.value=!0,w.value=!1,D.value=!1,T.value=o.file.name,g.value=o.file.visibility_id,m.value=o.file.focus_x,F.value=o.file.focus_y,$.value=!1,C.value=!1,N.value=!1,axios.get(o.file.api.show).then(x=>{V.value=x.data.data.mentions,B.value=!1})},O=()=>{T.value!==o.file.name&&f()},c=()=>{g.value!==o.file.visibility_id&&f()},f=()=>{if(w.value)return;w.value=!0;const x={name:T.value,visibility_id:g.value};axios.post(o.file.api.update,x).then(i=>{o.file.name=T.value,o.file.visibility_id=g.value,o.file.visibility=i.data.data.visibility,w.value=!1,D.value=!0,h("updated",o.file)})},E=()=>{I.value=!I.value},L=()=>V.value.length>0,j=()=>{if(!$.value){if(!C.value){C.value=!0;return}$.value=!0,axios.post(o.file.api.delete,{_method:"delete"}).then(x=>{window.showToast("Removed "+o.file.name),h("deleted",o.file,x.data.used)})}},W=()=>{h("closed")},_e=()=>{N.value=!0},G=()=>{N.value=!1},de=x=>{const i=k.value.naturalWidth,y=k.value.naturalHeight,H=x.clientX-k.value.getBoundingClientRect().left,P=x.clientY-k.value.getBoundingClientRect().top,ae=H/k.value.clientWidth*i,fe=P/k.value.clientHeight*y;m.value=parseInt(String(ae),10),F.value=parseInt(String(fe),10)},q=x=>{if(!m.value||!k.value)return"display: none;";const i=k.value.naturalWidth,y=k.value.naturalHeight,H=m.value/i*100,P=F.value/y*100;return"left: "+H+"%; top: "+P+"%"},J=()=>{m.value=null,F.value=null,R()},ce=()=>{R()},R=()=>{if(w.value)return;w.value=!0,N.value=!1;const x={focus_x:m.value,focus_y:F.value};axios.post(o.file.api.focus,x).then(i=>{w.value=!1,D.value=!0,o.file.focus_x=m.value,o.file.focus_y=F.value,console.log(i.data),o.file.thumbnail=i.data.data.thumbnail,h("updated",o.file)})};return(x,i)=>(t(),s("div",Al,[B.value?(t(),s("div",zl,[...i[2]||(i[2]=[e("i",{class:"fa-solid fa-spinner fa-spin","aria-label":"Loading"},null,-1)])])):N.value?(t(),s("div",Fa,[o.premium?(t(),s("div",Sa,[e("div",Ba,[e("div",{class:"absolute cursor-pointer text-4xl text-accent",style:S(q()),onClick:J},[...i[13]||(i[13]=[e("i",{class:"fa-duotone fa-arrow-up-left-from-circle hover:text-error","aria-label":"Focus point"},null,-1)])],4),e("img",{class:"cursor-crosshair",src:o.file.original,alt:"img",ref_key:"focusImage",ref:k,onClick:de},null,8,Ua)])])):(t(),s("div",Pa,[e("p",{innerHTML:b("focus_locked")},null,8,Ia),i[12]||(i[12]=e("a",{href:"https://kanka.io/premium",class:"text-link"},"Learn more",-1))])),e("div",Da,[r.premium?(t(),s("button",{key:0,class:"btn2 btn-primary btn-sm",onClick:ce},[e("span",{innerHTML:b("save")},null,8,Ea)])):u("",!0),e("button",{class:"btn2 btn-ghost btn-sm",onClick:G,innerHTML:b("cancel")},null,8,Va)])])):(t(),s("div",Rl,[e("div",Xl,[e("div",Yl,[i[3]||(i[3]=e("i",{class:"fa-regular fa-clipboard","aria-hidden":"true"},null,-1)),e("span",{class:"font-extrabold",innerHTML:b("details")},null,8,Kl)]),e("div",{class:"cursor-pointer",onClick:W},[...i[4]||(i[4]=[e("i",{class:"fa-solid fa-xmark","aria-label":"Close"},null,-1)])])]),e("div",Ol,[e("label",{class:"font-extrabold",innerHTML:b("name")},null,8,Wl),r.canManage?U((t(),s("input",{key:0,type:"text",class:"",maxlength:"191","onUpdate:modelValue":i[0]||(i[0]=y=>T.value=y),onChange:O},null,544)),[[Ae,T.value]]):(t(),s("span",{key:1,innerHTML:T.value},null,8,Gl))]),r.canManage?(t(),s("div",ql,[e("label",Jl,[i[5]||(i[5]=e("i",{class:"fa-regular fa-users","aria-hidden":"true"},null,-1)),e("span",{innerHTML:b("visibility")},null,8,Ql)]),U(e("select",{class:"w-full","onUpdate:modelValue":i[1]||(i[1]=y=>g.value=y),onChange:c},[(t(!0),s(z,null,Y(r.visibilities,(y,H)=>(t(),s("option",{value:H,innerHTML:y},null,8,Zl))),256))],544),[[me,g.value]])])):u("",!0),o.file.is_folder?u("",!0):(t(),s("div",ea,[e("div",{class:"flex gap-2 items-center cursor-pointer",onClick:E},[e("div",la,[i[6]||(i[6]=e("i",{class:"fa-regular fa-cubes","aria-hidden":"true"},null,-1)),e("span",{innerHTML:b("used_in")},null,8,aa)]),I.value?(t(),s("i",ta)):(t(),s("i",sa))]),I.value?(t(),s("div",na,[(t(!0),s(z,null,Y(V.value,y=>(t(),s("a",{href:y.url,class:"rounded-xl bg-base-200 px-4 py-1 flex gap-1 items-center"},[y.type==="image"?(t(),s("i",oa)):(t(),s("i",ua)),e("span",{class:"truncate",innerHTML:y.name},null,8,ra)],8,ia))),256)),L()?u("",!0):(t(),s("span",{key:0,class:"text-neutral-content",innerHTML:b("unused")},null,8,da))])):u("",!0)])),o.file.is_folder?u("",!0):(t(),s("div",ca,[e("div",{class:"text-neutral-content",innerHTML:b("size")},null,8,fa),e("div",{class:"text-right",innerHTML:r.file.size},null,8,va),e("div",{class:"text-neutral-content",innerHTML:b("uploaded_by")},null,8,ga),e("div",{class:"text-right",innerHTML:r.file.creator},null,8,pa),e("div",{class:"text-neutral-content",innerHTML:b("file_type")},null,8,ha),e("div",{class:"text-right uppercase",innerHTML:r.file.ext},null,8,ma),e("div",{class:"text-neutral-content",innerHTML:b("link")},null,8,_a),e("a",{href:r.file.link,class:"flex gap-1 items-center justify-end text-link",target:"_blank"},[i[7]||(i[7]=e("i",{class:"fa-solid fa-external-link","aria-hidden":"true"},null,-1)),e("span",{innerHTML:b("open")},null,8,ba)],8,xa)])),e("div",ka,[$.value?(t(),s("i",ya)):r.canManage?(t(),s("span",{key:1,role:"button",class:"text-neutral-content hover:text-error-content hover:bg-error flex items-center gap-1 p-2 rounded",onClick:j},[i[8]||(i[8]=e("i",{class:"fa-regular fa-trash-can","aria-hidden":"true"},null,-1)),C.value?(t(),s("span",{key:1,innerHTML:b("confirm")},null,8,Ta)):(t(),s("span",{key:0,innerHTML:b("delete")},null,8,Ma))])):u("",!0),!o.file.is_folder&&r.canManage?(t(),s("button",{key:2,onClick:_e,class:"rounded border p-2 flex gap-1 items-center"},[i[9]||(i[9]=e("i",{class:"fa-regular fa-bullseye","aria-hidden":"true"},null,-1)),e("span",{class:"truncate",innerHTML:b("focus_point")},null,8,wa)])):u("",!0),w.value?(t(),s("div",La,[i[10]||(i[10]=e("i",{class:"fa-solid fa-spinner fa-spin","aria-hidden":"true"},null,-1)),e("span",{innerHTML:b("saving")},null,8,Ha)])):u("",!0)]),D.value?(t(),s("div",$a,[i[11]||(i[11]=e("i",{class:"fa-regular fa-check-double","aria-hidden":"true"},null,-1)),e("span",{innerHTML:b("saved")},null,8,Ca)])):u("",!0)]))]))}}),ja={key:0,class:"text-center text-4xl p-4"},Aa={key:1,class:"flex flex-col gap-4 md:gap-5"},za={class:"flex gap-4 items-end"},Ra={class:"flex flex-col gap-1 grow"},Xa={class:"flex gap-1 items-center"},Ya=["innerHTML"],Ka={class:"flex gap-1 items-center"},Oa=["innerHTML"],Wa=["innerHTML"],Ga=["innerHTML"],qa={class:"bg-base-300 rounded h-2 w-full overflow-hidden transition-all duration-300"},Ja={key:0},Qa=["href","innerHTML"],Za={class:"flex gap-4 flex-wrap sticky top-14 z-50"},et={class:"flex gap-2 grow"},lt={class:"flex gap-0.5"},at={class:"relative"},tt=["innerHTML"],st={key:0},nt={key:0,class:"border shadow-sm rounded bg-base-100 p-4 absolute right-0 flex flex-col gap-5 w-60"},it={class:"flex gap-2 items-center"},ot=["innerHTML"],ut={class:"relative"},rt=["innerHTML"],dt={key:0},ct={key:0,class:"border shadow-sm rounded bg-base-100 p-4 absolute right-0 top-full mt-2 flex flex-col gap-1 w-60 z-50"},ft={class:"flex flex-col gap-1 list-none m-0 p-0"},vt={key:0,class:"fa-regular fa-check","aria-hidden":"true"},gt=["innerHTML"],pt={key:0,class:"fa-regular fa-check","aria-hidden":"true"},ht=["innerHTML"],mt={key:0,class:"fa-regular fa-check","aria-hidden":"true"},_t=["innerHTML"],xt={class:"flex gap-2 self-end flex-wrap"},bt=["innerHTML"],kt=["innerHTML"],yt=["innerHTML"],Mt=["innerHTML"],Tt=["innerHTML"],wt=["innerHTML"],Lt=["innerHTML"],Ht=["innerHTML"],$t={key:0,class:"text-center text-4xl p-4"},Ct={key:1,class:"flex flex-col gap-4"},Ft={key:0,class:"flex gap-1 flex-wrap text-xl"},Pt=["innerHTML"],It={class:"flex gap-1 items-center"},St=["onClick","innerHTML"],Bt={class:"flex gap-2 flex-row"},Ut={key:0,class:"flex flex-col gap-4 p-2"},Dt={class:"text-center text-xs"},Et=["innerHTML"],Vt={class:"progress h-1 w-full self-end"},Nt={key:0,class:"fixed bottom-0 w-full left-0 right-0 shadow-md md:shadow-none md:relative md:basis-1/4"},jt={key:0,class:"text-center text-4xl p-4"},At={class:"flex gap-6 items-center p-4 md:p-6 justify-between"},zt=["innerHTML"],Rt={class:"max-w-4xl flex flex-col gap-2 text-left p-4 md:px-6"},Xt={class:"flex flex-col gap-1 w-full"},Yt=["innerHTML"],Kt={class:"flex flex-col gap-1 w-full"},Ot=["innerHTML"],Wt=["value","innerHTML"],Gt={class:"bp-4 md:px-6"},qt={class:""},Jt=["innerHTML"],Qt={class:"flex gap-6 items-center p-4 md:p-6 justify-between"},Zt=["innerHTML"],es={class:"max-w-4xl flex flex-col gap-2 text-left p-4 md:px-6"},ls={class:"flex flex-col gap-1 w-full"},as=["innerHTML"],ts=["value","innerHTML"],ss={class:"flex flex-col gap-1 w-full"},ns=["innerHTML"],is=["value","innerHTML"],os={class:"bg-base-200 p-2"},us={class:""},rs=["innerHTML"],ds=Te({__name:"Gallery",props:{api:{}},setup(r){const le=r,o=n(!1),h=n(!1),V=n(),T=n(!1),w=n(!1),D=n(!1),g=n(!1),B=n(!1),$=n(!1),C=n(!1),I=n(!1),N=n(),k=n(),m=n(),F=n(),b=n();n(!1);const K=n(null),O=n(),c=n([]),f=n([]),E=n([]),L=n(),j=n(),W=n(!0),_e=n(),G=n(!1),de=n(),q=n(),J=n(),ce=n(),R=n(1),x=n(),i=n(),y=n(),H=n(),P=n(),ae=n(),fe=n(),xe=n(!1),Le=n(),X=n(),Q=n(!1),te=n(null),be=n(null),He=n(0),Z=n(!1),se=n(!1),ve=n(!1),ne=n(!1),ie=n(!1),ge=n(!0),ke=n(),ee=n(),$e=n(),oe=n(null);let pe=null;je(()=>{axios.get(le.api).then(l=>{o.value=!0,f.value=l.data.files,E.value=l.data.files,_e.value=l.data.url,j.value=l.data.i18n,O.value=l.data.api.search,V.value=l.data.api.delete,fe.value=l.data.api.update,de.value=l.data.api.create,Le.value=l.data.api.upload,k.value=l.data.next,x.value=l.data.visibilities,i.value=l.data.bulkVisibilities,D.value=l.data.acl.upload,B.value=l.data.acl.premium,$.value=l.data.acl.wyvern,C.value=l.data.acl.elemental,I.value=l.data.acl.manage,ae.value=l.data.folders,ke.value=l.data.space.total,ee.value=l.data.space.used,$e.value=l.data.upgrade}),pe=new IntersectionObserver(l=>{l.forEach(a=>{a.isIntersecting&&qe()})}),oe.value&&pe.observe(oe.value),window.addEventListener("keydown",Ce)}),xl(()=>{pe&&oe.value&&pe.unobserve(oe.value)}),bl(()=>{window.removeEventListener("keydown",Ce)});const Ce=l=>{(l.key==="Escape"||l.key==="Esc")&&(Q.value&&tl(),m.value&&(m.value=null),g.value?g.value=null:Z.value&&(Z.value=!1))},v=l=>j.value[l]?j.value[l]:(console.error("Missing trans",l,j),"MISSING"),ze=()=>{g.value=!0},Re=()=>{g.value=!1},Xe=()=>{Pe(y.value),H.value=null,P.value=null},Ye=()=>{let l="grid grid-cols-2 sm:grid-cols-3 md:flex gap-2 sm:gap-3 md:gap-4 md:flex-wrap";return m.value&&(l+=" basis-2/4 md:basis-3/4"),l},Ke=()=>{let l=f.value.filter(a=>a.is_selected).map(a=>a.id);l.length!==0&&(T.value=!0,axios.post(V.value,{images:l}).then(a=>{f.value=f.value.filter(p=>!p.is_selected),W.value&&(E.value=f.value),ee.value=a.data.used,g.value=!1,window.showToast(a.data.toast)}))},Oe=l=>{if(g.value){let a=f.value.find(p=>p.id===l.id);a.is_selected=!a.is_selected;return}if(l.is_folder){Fe(l);return}m.value&&m.value.id===l.id?m.value=null:m.value=l},Fe=l=>{h.value=!0,axios.get(l.open).then(a=>{L.value=l,N.value=a.data.breadcrumbs,f.value=a.data.files,k.value=a.data.next,h.value=!1,W.value=!1})},he=()=>{h.value=!0,f.value=E.value,m.value=null,L.value=null,h.value=!1,W.value=!0,g.value=!1},We=l=>{F.value=l.target.value,K.value&&clearTimeout(K.value),K.value=setTimeout(()=>{Ge()},300)},Ge=()=>{if(b.value!=F.value){if(b.value=F.value,!F.value){c.value.searchParam="",he();return}h.value=!0,c.value.searchParam="term="+F.value;var l="";c.value.searchParam&&(l+=c.value.searchParam+"&"),c.value.sortParam&&(l+=c.value.sortParam+"&"),c.value.toggleParam&&(l+=c.value.toggleParam+"&"),axios.get(O.value+"/?"+l).then(a=>{De(a.data)})}},qe=()=>{if(!(k.value==null||w.value==!0)){w.value=!0;var l="";c.value.searchParam&&(l+=c.value.searchParam+"&"),c.value.sortParam&&(l+=c.value.sortParam+"&"),c.value.toggleParam&&(l+=c.value.toggleParam+"&"),axios.get(k.value+"&"+l).then(a=>{a.data.files.forEach(p=>{f.value.push(p)}),k.value=a.data.next,w.value=!1})}},Je=()=>{Pe(q.value),ce.value.focus()},Pe=l=>{l.showModal(),l.addEventListener("click",Ie)},Ie=l=>{let a=l.target.getBoundingClientRect();!(a.top<=l.clientY&&l.clientY<=a.top+a.height&&a.left<=l.clientX&&l.clientX<=a.left+a.width)&&l.target.tagName==="DIALOG"&&ue(l.target)},ue=l=>{G.value||(l.removeEventListener("click",Ie),l.close())},Se=()=>{if(G.value)return;let l={};G.value=!0,l.name=J.value,l.visibility_id=R.value,L.value&&(l.folder_id=L.value.id),axios.post(de.value,l).then(a=>{J.value=null,R.value=1,G.value=!1,f.value.unshift(a.data.folder),ae.value[a.data.folder.id]=a.data.folder.name,ue(q.value)})},Qe=()=>{if(xe.value)return;let l=f.value.filter(p=>p.is_selected).map(p=>p.id);if(l.length===0)return;xe.value=!0;let a={};P.value&&(P.value==="0"?a.folder_home=1:a.folder_id=P.value),H.value&&(a.visibility_id=H.value),a.files=l,axios.post(fe.value,a).then(p=>{xe.value=!1,a.folder_home&&(console.log("move home"),f.value.filter(M=>M.is_selected).forEach(M=>{E.value.unshift(M)})),P.value&&(f.value=f.value.filter(_=>!_.is_selected),W.value&&(E.value=E.value.filter(_=>!_.is_selected))),H.value&&f.value.forEach(_=>{l.includes(_.id)&&(_.visibility_id=H.value)}),P.value=null,H.value=null,g.value=!1,E.value.filter(_=>_.is_selected).forEach(_=>{_.is_selected=!1}),window.showToast(p.data.toast),ue(y.value)})},Ze=()=>{X.value.click()},el=async l=>{const a=l.target.files[0],p=l.target.files;if(!p){Q.value=!1;return}const d=new FileReader;d.onload=M=>{te.value=M.target.result},d.readAsDataURL(a),Q.value=!0,be.value=axios.CancelToken.source(),X.value.disabled=!0;const _=new FormData;L.value&&_.append("folder_id",L.value.id),Array.from(p).forEach(M=>{_.append("files[]",M)}),axios.post(Le.value,_,{headers:{"Content-Type":"multipart/form-data"},cancelToken:be.value.token,onUploadProgress:function(M){He.value=Math.round(M.loaded*100/M.total)}}).then(M=>{Q.value=!1,X.value.disabled=!1,X.value=null,te.value=null;const hl=A=>A.is_folder,Ve=f.value.map((A,ml)=>hl(A)?ml:-1).filter(A=>A!==-1).pop();M.data.files.forEach(A=>{Ve!==void 0?f.value.splice(Ve+1,0,A):f.value.push(A)}),ee.value=M.data.used}).catch(M=>{console.error(M),Q.value=!1,X.value.disabled=!1,te.value=null,axios.isCancel(M)?X.value=null:ll(M)})},ll=l=>{if(!l.response)return;if(l.response.data.error){window.showToast(l.response.data.error,"error");return}if(l.response&&l.response.status===403&&l.response.data.message){window.showToast(v.value.unauthorized,"error");return}Object.keys(l.response.data.errors).forEach(p=>{window.showToast(l.response.data.errors[p][0],"error")})},Be=()=>{let l=f.value.filter(a=>a.is_selected).length;if(l!==0)return"("+l+")"},al=()=>He.value+"%",tl=()=>{be.value.cancel("Upload canceled by user.")},sl=l=>{},nl=(l,a)=>{f.value=f.value.filter(p=>p.id!==l.id),m.value=null,l.is_folder&&(l.folder_id||he()),ee.value=a},il=()=>{m.value=null},ol=()=>{if(m.value===L.value){m.value=null;return}m.value=L.value},ul=()=>{Z.value=!Z.value},rl=()=>{ve.value=!ve.value},Ue=()=>{Z.value=!1,ve.value=!1},dl=()=>{if(!se.value){c.value.toggleParam="",he();return}console.log("filter"),h.value=!0,c.value.toggleParam="unused=1";var l="";c.value.searchParam&&(l+=c.value.searchParam+"&"),c.value.sortParam&&(l+=c.value.sortParam+"&"),c.value.toggleParam&&(l+=c.value.toggleParam+"&"),axios.get(O.value+"/?"+l).then(a=>{De(a.data)})},ye=(l="default")=>{l=="asc"?(ie.value=!1,ge.value=!1,ne.value=!0):l=="desc"?(ne.value=!1,ge.value=!1,ie.value=!0):l=="default"&&(ne.value=!1,ie.value=!1,ge.value=!0),h.value=!0,c.value.sortParam="sort="+l;var a="";c.value.searchParam&&(a+=c.value.searchParam+"&"),c.value.sortParam&&(a+=c.value.sortParam+"&"),c.value.toggleParam&&(a+=c.value.toggleParam+"&");let p=O.value;L.value?.open&&(p=L.value.open),axios.get(p+"/?"+a).then(d=>{cl(d.data)})},cl=l=>{f.value=l.files,k.value=l.next,h.value=!1},De=l=>{f.value=l.files,k.value=l.next,L.value=null,h.value=!1},fl=()=>Ee(ee.value),vl=()=>Ee(ke.value),Ee=l=>l==0?"0":l>1e6?(l/(1024*1024)).toFixed(2)+" GiB":l>1e3?(l/1024).toFixed(2)+" MiB":(l*1).toFixed(2)+" KiB",gl=()=>{let l="rounded h-2 transition-all duration-300",a=Me();return a<60?l+" bg-primary":a<90?l+" bg-orange-400":l+" bg-red-500"},Me=()=>Math.round(ee.value/ke.value*100),pl=()=>te.value!==null;return(l,a)=>{const p=kl("click-outside");return t(),s(z,null,[o.value?(t(),s("div",Aa,[e("div",za,[e("div",Ra,[e("div",Xa,[a[11]||(a[11]=e("i",{class:"fa-regular fa-cloud text-xl","aria-hidden":"true"},null,-1)),e("span",{class:"font-extrabold",innerHTML:v("storage")},null,8,Ya)]),e("div",Ka,[e("span",{innerHTML:fl()},null,8,Oa),e("span",{innerHTML:v("of")},null,8,Wa),e("span",{innerHTML:vl()},null,8,Ga)]),e("div",qa,[e("div",{class:re(gl()),style:S({width:Me()+"%"})},null,6)])]),!B.value||Me()>89&&($.value||C.value)?(t(),s("div",Ja,[e("a",{href:$e.value,innerHTML:v("upgrade"),class:"btn2 btn-default"},null,8,Qa)])):u("",!0)]),e("div",Za,[e("div",et,[e("div",lt,[e("input",{type:"text",placeholder:"Search",onInput:We},null,32)]),e("div",at,[e("button",{class:"btn2 btn-default btn-sm",onClick:ul},[a[12]||(a[12]=e("i",{class:"fa-regular fa-filter","aria-hidden":"true"},null,-1)),e("span",{innerHTML:v("filters"),class:"hidden md:inline"},null,8,tt),se.value?(t(),s("span",st,"(1)")):u("",!0)]),Z.value?U((t(),s("div",nt,[e("div",it,[U(e("input",{type:"checkbox","onUpdate:modelValue":a[0]||(a[0]=d=>se.value=d),value:"1",id:"_show_unused",onChange:dl},null,544),[[Ne,se.value]]),e("label",{for:"_show_unused",class:"cursor-pointer",innerHTML:v("filter_only_unused")},null,8,ot)])])),[[p,Ue]]):u("",!0)]),e("div",ut,[e("button",{class:"btn2 btn-default btn-sm",onClick:rl},[a[13]||(a[13]=e("i",{class:"fa-regular fa-arrow-up-arrow-down","aria-hidden":"true"},null,-1)),e("span",{innerHTML:v("sort"),class:"hidden md:inline"},null,8,rt),ne.value||ie.value?(t(),s("span",dt,"(1)")):u("",!0)]),ve.value?U((t(),s("div",ct,[e("ul",ft,[e("li",null,[e("span",{class:"cursor-pointer flex items-center gap-2 px-2 py-2 rounded hover:bg-gray-100 transition",onClick:a[1]||(a[1]=d=>ye("default"))},[ge.value?(t(),s("i",vt)):u("",!0),e("span",{innerHTML:v("sort_default"),class:"inline"},null,8,gt)])]),e("li",null,[e("span",{class:"cursor-pointer flex items-center gap-2 px-2 py-2 rounded hover:bg-gray-100 transition",onClick:a[2]||(a[2]=d=>ye("asc"))},[ne.value?(t(),s("i",pt)):u("",!0),e("span",{innerHTML:v("sort_asc"),class:"inline"},null,8,ht)])]),e("li",null,[e("span",{class:"cursor-pointer flex items-center gap-2 px-2 py-2 rounded hover:bg-gray-100 transition",onClick:a[3]||(a[3]=d=>ye("desc"))},[ie.value?(t(),s("i",mt)):u("",!0),e("span",{innerHTML:v("sort_desc"),class:"inline"},null,8,_t)])])])])),[[p,Ue]]):u("",!0)])]),e("div",xt,[!g.value&&L.value?(t(),s("button",{key:0,class:"btn2 btn-default btn-sm",onClick:ol},[a[14]||(a[14]=e("i",{class:"fa-regular fa-clipboard","aria-hidden":"true"},null,-1)),e("span",{innerHTML:v("details")},null,8,bt)])):u("",!0),!g.value&&I.value?(t(),s("button",{key:1,class:"btn2 btn-default btn-sm",onClick:Je},[a[15]||(a[15]=e("i",{class:"fa-regular fa-plus","aria-hidden":"true"},null,-1)),e("span",{innerHTML:v("new_folder")},null,8,kt)])):u("",!0),!g.value&&I.value?(t(),s("button",{key:2,class:"btn2 btn-default btn-sm",onClick:ze},[a[16]||(a[16]=e("i",{class:"fa-regular fa-list-check","aria-hidden":"true"},null,-1)),e("span",{innerHTML:v("select")},null,8,yt)])):u("",!0),g.value?(t(),s("button",{key:3,class:"btn2 btn-primary btn-sm",onClick:Xe},[a[17]||(a[17]=e("i",{class:"fa-regular fa-pencil","aria-hidden":"true"},null,-1)),e("span",{innerHTML:v("update")},null,8,Mt),e("span",{innerHTML:Be()},null,8,Tt)])):u("",!0),g.value?(t(),s("button",{key:4,class:"btn2 btn-error btn-sm",onClick:Ke},[a[18]||(a[18]=e("i",{class:"fa-regular fa-trash-can","aria-hidden":"true"},null,-1)),e("span",{innerHTML:v("remove")},null,8,wt),e("span",{innerHTML:Be()},null,8,Lt)])):u("",!0),g.value?(t(),s("button",{key:5,class:"btn2 btn-default btn-sm",onClick:Re},[a[19]||(a[19]=e("i",{class:"fa-solid fa-xmark","aria-hidden":"true"},null,-1)),e("span",{innerHTML:v("cancel")},null,8,Ht)])):u("",!0)])]),h.value?(t(),s("div",$t,[...a[20]||(a[20]=[e("i",{class:"fa-solid fa-spinner fa-spin","aria-label":"Loading"},null,-1)])])):(t(),s("div",Ct,[L.value?(t(),s("div",Ft,[e("a",{onClick:he,innerHTML:v("home"),class:"text-base-content cursor-pointer"},null,8,Pt),(t(!0),s(z,null,Y(N.value,(d,_)=>(t(),s("span",It,[a[21]||(a[21]=e("i",{class:"fa-solid fa-chevron-right text-base","aria-hidden":"true"},null,-1)),e("a",{onClick:M=>Fe(d),innerHTML:d.name,class:"text-base-content cursor-pointer"},null,8,St)]))),256))])):u("",!0),e("div",Bt,[e("div",{class:re(Ye())},[D.value&&!se.value?(t(),s("div",{key:0,class:"rounded-xl shadow bg-base-100 overflow-hidden col-span-2 sm:col-span-3 md:w-48 cursor-pointer flex justify-center items-center flex-col gap-4",onClick:Ze},[Q.value?pl()?(t(),s("div",{key:1,class:"cover-background w-full h-full flex p-2",style:S({backgroundImage:"url('"+te.value+"')"})},[e("div",Vt,[e("div",{class:"h-1 bg-accent shadow-xs",role:"progressbar","aria-valuenow":"0","aria-valuemin":"0","aria-valuemax":"100",style:S({width:al()})},[...a[24]||(a[24]=[e("span",{class:"sr-only"},null,-1)])],4)])],4)):u("",!0):(t(),s("div",Ut,[a[23]||(a[23]=e("div",{class:"flex flex-col gap-2 items-center"},[e("i",{class:"fa-regular fa-image text-4xl text-neutral-content","aria-hidden":"true"}),e("span",null,"Upload files")],-1)),e("div",Dt,[a[22]||(a[22]=e("i",{class:"fa-regular fa-info-circle mr-1 text-base","aria-hidden":"true"},null,-1)),e("span",{innerHTML:v("upload_hint"),class:"text-neutral-content"},null,8,Et)])])),e("input",{type:"file",multiple:"",accept:"image/*, .gif, .webp, .woff2",class:"hidden",onChange:el,ref_key:"fileField",ref:X},null,544)])):u("",!0),(t(!0),s(z,null,Y(f.value,d=>(t(),yl(jl,{file:d,isBulking:g.value,i18n:j.value,onSelect:_=>Oe(d)},null,8,["file","isBulking","i18n","onSelect"]))),256))],2),m.value?(t(),s("div",Nt,[Ml(Na,{file:m.value,visibilities:x.value,premium:B.value,canManage:I.value,i18n:j.value,onUpdated:sl,onDeleted:nl,onClosed:il},null,8,["file","visibilities","premium","canManage","i18n"])])):u("",!0)])]))])):(t(),s("div",ja,[...a[10]||(a[10]=[e("i",{class:"fa-solid fa-spinner fa-spin","aria-label":"Loading"},null,-1)])])),e("div",{ref_key:"infiniteScrollTrigger",ref:oe,class:"h-4"},[w.value?(t(),s("div",jt,[...a[25]||(a[25]=[e("i",{class:"fa-solid fa-spinner fa-spin","aria-label":"Loading"},null,-1)])])):u("",!0)],512),o.value?(t(),s("dialog",{key:2,ref_key:"newDialog",ref:q,class:"dialog rounded-2xl text-center bg-base-100 text-base-content"},[e("header",At,[e("h4",{innerHTML:v("new_folder"),class:"text-lg font-normal"},null,8,zt),e("button",{type:"button",class:"text-base-content",onClick:a[4]||(a[4]=d=>ue(q.value)),title:"Close"},[...a[26]||(a[26]=[e("i",{class:"fa-regular fa-circle-xmark","aria-hidden":"true"},null,-1),e("span",{class:"sr-only"},"Close",-1)])])]),e("article",Rt,[e("div",Xt,[e("label",{innerHTML:v("name")},null,8,Yt),U(e("input",{type:"text",class:"w-full","onUpdate:modelValue":a[5]||(a[5]=d=>J.value=d),ref_key:"folderNameField",ref:ce,onKeyup:Tl(Se,["enter"])},null,544),[[Ae,J.value]])]),e("div",Kt,[e("label",{innerHTML:v("visibility")},null,8,Ot),U(e("select",{class:"w-full","onUpdate:modelValue":a[6]||(a[6]=d=>R.value=d)},[(t(!0),s(z,null,Y(x.value,(d,_)=>(t(),s("option",{value:_,innerHTML:d},null,8,Wt))),256))],512),[[me,R.value]])])]),e("footer",Gt,[e("menu",qt,[e("button",{type:"submit",class:"btn2 btn-primary",onClick:Se,innerHTML:v("create")},null,8,Jt)])])],512)):u("",!0),o.value?(t(),s("dialog",{key:3,ref_key:"updateDialog",ref:y,class:"dialog rounded-2xl text-center bg-base-100 text-base-content"},[e("header",Qt,[e("h4",{innerHTML:v("update"),class:"text-lg font-normal"},null,8,Zt),e("button",{type:"button",class:"text-base-content",onClick:a[7]||(a[7]=d=>ue(y.value)),title:"Close"},[...a[27]||(a[27]=[e("i",{class:"fa-regular fa-circle-xmark","aria-hidden":"true"},null,-1),e("span",{class:"sr-only"},"Close",-1)])])]),e("article",es,[e("div",ls,[e("label",{innerHTML:v("visibility")},null,8,as),U(e("select",{class:"w-full","onUpdate:modelValue":a[8]||(a[8]=d=>H.value=d)},[(t(!0),s(z,null,Y(i.value,(d,_)=>(t(),s("option",{value:_,innerHTML:d},null,8,ts))),256))],512),[[me,H.value]])]),e("div",ss,[e("label",{innerHTML:v("folder")},null,8,ns),U(e("select",{class:"w-full","onUpdate:modelValue":a[9]||(a[9]=d=>P.value=d)},[(t(!0),s(z,null,Y(ae.value,(d,_)=>(t(),s("option",{value:_,innerHTML:d},null,8,is))),256))],512),[[me,P.value]])])]),e("footer",os,[e("menu",us,[e("button",{type:"submit",class:"btn2 btn-primary",onClick:Qe,innerHTML:v("change")},null,8,rs)])])],512)):u("",!0)],64)}}}),we=wl({});we.component("gallery",ds);we.use(Ll);we.mount("#gallery");

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/cytoscape-cose-bilkent-DF4CVbNw.js","assets/_commonjsHelpers-CqkleIqs.js","assets/cytoscape-panzoom-CwP9w_A0.js"])))=>i.map(i=>d[i]);
import{d as G,r as n,o as J,L as K,c as p,a as m,f as h,b as r,F as Y,q as ee}from"./vue.esm-bundler-CSDHRrjm.js";import{_ as M}from"./preload-helper-I4rgV-VL.js";import{t as te}from"./tippy.esm-CnBRltuW.js";import{c as oe}from"./colours-Dh8441-n.js";const ae={key:0,class:"toolbar fixed w-full p-2 flex items-center justify-between gap-2 z-700"},ne={class:"flex gap-4 items-center"},re=["href","title"],le=["innerHTML"],se={key:0,class:"relative flex gap-2"},ie=["innerHTML"],ue=["data-title"],ce=["innerHTML"],de={key:1,class:"w-full h-screen flex items-center justify-center text-4xl gap-2 absolute bg-base-100 transition-all duration-300 top-0 bottom-0 left-0 right-0 z-900"},pe={key:0},me={key:1},ge={key:2},fe=G({__name:"Web",props:{api:{},premium:{},creator:{}},setup(O){const w=O,k=n(!1),C=n(!1),E=n(!1),x=n(!1),_=n([]),o=n(null),b=n(null),c=n(null),L=n(),D=n(Array);let y=null;const R=n(null),T=n(null);J(async()=>{await F(),await N(),await V(),k.value=!0,document.addEventListener("submit",z,!0),w.premium||window.openDialog("web-premium")}),K(()=>{o.value&&(o.value.destroy(),o.value=null),document.removeEventListener("submit",z,!0)});const P=e=>{E.value=!0,Object.values(e.entities).forEach(t=>{q(t)}),e.nodes.forEach(t=>{A(t)}),R.value=e.i18n,T.value=e.urls,E.value=!1},q=e=>{if(_.value.find(a=>a.data.id==e.id))return;const t={group:"nodes",data:{id:e.id,name:e.name,image:e.image,link:e.link,tooltip:e.tooltip}};_.value.push(t),k.value&&o.value&&o.value.add(t)},A=e=>{let t={group:"edges",data:{id:e.id,source:e.source,target:e.target,name:e.text,colour:e.colour,attitude:e.attitude,shape:e.shape,url:e.url}};t.data.colour||(t.data.colour="#777777"),t.data.attitude||(t.data.attitude=0),t.data.attitude=H(t.data.attitude),_.value.push(t)},H=e=>(e+100)/100*2+2,F=async()=>{const{default:e}=await M(async()=>{const{default:d}=await import("./cytoscape.esm-DC-SVX1T.js");return{default:d}},[]),{default:t}=await M(async()=>{const{default:d}=await import("./cytoscape-cose-bilkent-DF4CVbNw.js").then(B=>B.c);return{default:d}},__vite__mapDeps([0,1])),{default:a}=await M(async()=>{const{default:d}=await import("./cytoscape-panzoom-CwP9w_A0.js").then(B=>B.c);return{default:d}},__vite__mapDeps([2,1]));e.use(t),e.use(a);const i=L.value,f=i.parentNode,l=window.getComputedStyle(i),u=window.getComputedStyle(f);o.value=e({container:L.value,style:e.stylesheet().selector("node").css({label:"data(name)","background-image":"data(image)",height:80,width:80,"background-fit":"cover","border-color":u.color,"border-width":3,color:l.color,"text-wrap":"wrap","text-margin-y":"-8px","text-background-opacity":1,"text-background-color":l.backgroundColor,"text-border-color":l.backgroundColor,"text-border-width":3,"text-border-opacity":1}).selector("edge").css({"line-color":"data(colour)","curve-style":"bezier","control-point-step-size":40,"target-arrow-shape":"data(shape)","target-arrow-color":"data(colour)",width:"data(attitude)","text-background-opacity":1,color:l.color,"text-background-color":l.backgroundColor,"text-border-color":l.backgroundColor,"text-border-width":3,"text-border-opacity":1})});const s=.1,v=1.2;o.value.panzoom({maxZoom:v,minZoom:s}),o.value.minZoom(s),o.value.maxZoom(v)},N=async()=>{C.value=!0;const e=await axios.get(w.api);C.value=!1;const t=e.data;P(t)},V=async()=>{o.value&&(x.value=!0,x.value=!0,o.value.add(_.value),o.value.nodes().forEach(function(e){e.connectedEdges().length==0&&$(e)}),U(),Z(),await S())},$=e=>{e.hide()},U=()=>{o.value.elements().layout({name:"cose-bilkent",idealEdgeLength:130,nodeDimensionsIncludeLabels:!0}).run()},Z=()=>{o.value.on("tap","node",function(e){const t=e.target;j(t)}),o.value.nodes().on("mouseover",function(e){b.value=o.value.getElementById(e.target.id()),b.value.addClass("node-hover")}),o.value.nodes().on("mouseout",function(){b.value&&(b.value.removeClass("node-hover"),b.value=null)}),o.value.on("tap","edge",function(e){let t=e.target.data().url;t&&window.openDialog("primary-dialog",t)}),o.value.edges().on("mouseover",function(e){c.value=o.value.getElementById(e.target.id()),c.value.style("label",c.value._private.data.name),c.value.style("overlay-opacity",.1)}),o.value.edges().on("mouseout",function(){c.value&&(c.value.style("label",""),c.value.style("overlay-opacity",0),c.value=null)})},S=async()=>{let e=!0;for(;e;)o.value.nodes(":backgrounding").length==0?e=!1:await sleep(200);x.value=!1},j=e=>{const t=o.value;if(!t)return;const a=t.container();if(!a)return;const i=e.renderedPosition(),f=a.getBoundingClientRect(),l=()=>{const u=f.left+i.x,s=f.top+i.y;return{x:u,y:s,left:u,top:s,right:u,bottom:s,width:0,height:0}};y&&(y.destroy(),y=null),y=te(document.body,{trigger:"manual",getReferenceClientRect:l,theme:"entity-tooltip",placement:"bottom",hideOnClick:!0,allowHTML:!0,interactive:!0,content:"Loading...",appendTo:()=>document.body,onShow(u){const s=String(e.id());if(s in D.value){u.setContent(D.value[s]);return}axios.get(e.data().tooltip).then(v=>{const d=v.data;u.setContent(d),D.value[s]=d}).catch(v=>{u.setContent(`Failed loading tooltip. ${v}`)})}}),y.show()},z=async e=>{const t=e.target;if(t){e.preventDefault();try{const a=(t.method||"POST").toUpperCase(),i=t.action,f=new FormData(t),l=await axios({url:i,method:a,data:f,headers:{"X-Requested-With":"XMLHttpRequest"}});W(l.data),window.closeDialog&&window.closeDialog("primary-dialog")}catch(a){console.error(a)}}},W=async e=>{if(!o.value||!e||!e.id)return;const t=o.value.edges().filter(`[id = "${e.id}"]`);if(!t||t.length===0){console.warn("Updated unknown edge",e.id);return}e.deleted&&t.remove();const a=H(e.attitude??0);if(t.data().target!=e.target.id){q(e.target),await S();const i={group:"edges",data:{...t.data(),name:e.text,target:e.target.id,colour:e.colour||"#777777",attitude:a}};t.remove(),o.value.add(i)}else t.data({...t.data(),name:e.text,colour:e.colour||"#777777",attitude:a})},Q=()=>{window.openDialog("primary-dialog",T.value.creator)},g=e=>R.value[e]||e,X=()=>{if(!o.value)return;const e={full:!0,bg:oe("--b1")},t=o.value.png(e),a=document.createElement("a");a.href=t,a.download=`${g("campaign")}-web-${Date.now()}.png`,document.body.appendChild(a),a.click(),document.body.removeChild(a)};return(e,t)=>(m(),p(Y,null,[k.value?(m(),p("div",ae,[r("div",ne,[r("a",{href:T.value.back,title:g("back"),class:"flex items-center gap-1 text-link rounded bg-base-100 p-1",tabindex:"0"},[t[2]||(t[2]=r("i",{class:"fa-regular fa-left-to-bracket","aria-hidden":"true"},null,-1)),r("span",{innerHTML:g("back")},null,8,le)],8,re),w.creator?(m(),p("div",se,[w.creator?(m(),p("a",{key:0,href:"#",onClick:t[0]||(t[0]=a=>Q()),class:"quick-creator-button btn2 btn-primary btn-sm",tabindex:"0"},[t[3]||(t[3]=r("i",{class:"flex-none fa-regular fa-plus","aria-hidden":"true"},null,-1)),r("span",{class:"grow hidden sm:inline-block",innerHTML:g("create")},null,8,ie),r("span",{class:"flex-none keyboard-shortcut",id:"qq-kb-shortcut","data-toggle":"tooltip","data-title":g("qq-keyboard-shortcut"),"data-html":"true","data-placement":"bottom"},"N",8,ue)])):h("",!0),r("a",{href:"#",onClick:t[1]||(t[1]=a=>X()),class:"btn2 btn-sm"},[t[4]||(t[4]=r("i",{class:"fa-regular fa-print","aria-hidden":"true"},null,-1)),r("span",{innerHTML:g("print")},null,8,ce)])])):h("",!0)])])):h("",!0),k.value?h("",!0):(m(),p("div",de,[t[5]||(t[5]=r("i",{class:"fa-solid fa-spinner fa-spin","aria-hidden":"true"},null,-1)),C.value?(m(),p("span",pe,"Loading")):E.value?(m(),p("span",me,"Parsing web")):x.value?(m(),p("span",ge,"Drawing web")):h("",!0)])),r("div",{ref_key:"cyContainer",ref:L,class:"min-h-screen text-base-content cy-map bg-base-100"},null,512)],64))}}),I=ee({});I.component("connections-web",fe);I.mount("#web");

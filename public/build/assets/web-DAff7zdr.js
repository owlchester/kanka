const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/cytoscape-cose-bilkent-DRrwnnKV.js","assets/_commonjsHelpers-Cpj98o6Y.js","assets/cytoscape-panzoom-Del_Rz3u.js","assets/jspdf.es.min-tTe3jQg-.js","assets/preload-helper-I4rgV-VL.js"])))=>i.map(i=>d[i]);
import{d as Y,o as ee,B as te,l as oe,a as p,c as g,b as n,f as b,p as ae,w as ne,F as le,h as s,q as re}from"./vue.esm-bundler-C87APpr1.js";import{v as se}from"./v-click-outside.umd-Cl-Y_A58.js";import{_ as D}from"./preload-helper-I4rgV-VL.js";import{t as ie}from"./tippy.esm-CnBRltuW.js";import{c as F}from"./colours-Dh8441-n.js";import"./_commonjsHelpers-Cpj98o6Y.js";const ue={key:0,class:"toolbar fixed w-full p-2 flex items-center justify-between gap-2 z-700"},de={class:"flex gap-4 items-center"},ce=["href","title"],pe=["innerHTML"],ge={key:0,class:"relative flex gap-2"},me=["data-title"],fe=["innerHTML"],ve={class:"relative"},we=["innerHTML"],be={key:0,class:"dropdown-menu absolute mt-2 flex flex-col gap-1 bg-base-200 shadow-sm p-2 rounded z-10",role:"menu"},he=["innerHTML"],ye=["innerHTML"],ke={key:1,class:"w-full h-screen flex items-center justify-center text-4xl gap-2 absolute bg-base-100 transition-all duration-300 top-0 bottom-0 left-0 right-0 z-900"},xe={key:0},_e={key:1},Ce={key:2},De=Y({__name:"Web",props:{api:{},premium:{},creator:{}},setup(S){const k=S,x=s(!1),L=s(!1),E=s(!1),_=s(!1),C=s([]),o=s(null),h=s(null),m=s(null),T=s(),M=s(Array);let y=null;const v=s(!1),I=s(null),P=s(null);ee(async()=>{await j(),await q(),await N(),x.value=!0,document.addEventListener("submit",z,!0),window.initTooltips(),k.premium||window.openDialog("web-premium")}),te(()=>{o.value&&(o.value.destroy(),o.value=null),document.removeEventListener("submit",z,!0)});const A=e=>{E.value=!0,Object.values(e.entities).forEach(t=>{R(t)}),e.nodes.forEach(t=>{V(t)}),I.value=e.i18n,P.value=e.urls,E.value=!1},R=e=>{if(C.value.find(a=>a.data.id==e.id))return;const t={group:"nodes",data:{id:e.id,name:e.name,image:e.image,link:e.link,tooltip:e.tooltip}};C.value.push(t),x.value&&o.value&&o.value.add(t)},V=e=>{let t={group:"edges",data:{id:e.id,source:e.source,target:e.target,name:e.text,colour:e.colour,attitude:e.attitude,shape:e.shape,url:e.url}};t.data.colour||(t.data.colour="#777777"),t.data.attitude||(t.data.attitude=0),t.data.attitude=$(t.data.attitude),C.value.push(t)},$=e=>(e+100)/100*2+2,j=async()=>{const{default:e}=await D(async()=>{const{default:f}=await import("./cytoscape.esm-BJ4qIETX.js");return{default:f}},[]),{default:t}=await D(async()=>{const{default:f}=await import("./cytoscape-cose-bilkent-DRrwnnKV.js").then(H=>H.c);return{default:f}},__vite__mapDeps([0,1])),{default:a}=await D(async()=>{const{default:f}=await import("./cytoscape-panzoom-Del_Rz3u.js").then(H=>H.c);return{default:f}},__vite__mapDeps([2,1]));e.use(t),e.use(a);const l=T.value,c=l.parentNode,r=window.getComputedStyle(l),i=window.getComputedStyle(c);o.value=e({container:T.value,style:e.stylesheet().selector("node").css({label:"data(name)","background-image":"data(image)",height:80,width:80,"background-fit":"cover","border-color":i.color,"border-width":3,color:r.color,"text-wrap":"wrap","text-margin-y":"-8px","text-background-opacity":1,"text-background-color":r.backgroundColor,"text-border-color":r.backgroundColor,"text-border-width":3,"text-border-opacity":1}).selector("edge").css({"line-color":"data(colour)","curve-style":"bezier","control-point-step-size":40,"target-arrow-shape":"data(shape)","target-arrow-color":"data(colour)",width:"data(attitude)","text-background-opacity":1,color:r.color,"text-background-color":r.backgroundColor,"text-border-color":r.backgroundColor,"text-border-width":3,"text-border-opacity":1})});const u=.1,w=1.2;o.value.panzoom({maxZoom:w,minZoom:u}),o.value.minZoom(u),o.value.maxZoom(w)},q=async()=>{L.value=!0;const e=await axios.get(k.api);L.value=!1;const t=e.data;A(t)},N=async()=>{o.value&&(_.value=!0,_.value=!0,o.value.add(C.value),o.value.nodes().forEach(function(e){e.connectedEdges().length==0&&U(e)}),Z(),W(),await O())},U=e=>{e.hide()},Z=()=>{o.value.elements().layout({name:"cose-bilkent",idealEdgeLength:130,nodeDimensionsIncludeLabels:!0}).run()},W=()=>{o.value.on("tap","node",function(e){const t=e.target;Q(t)}),o.value.nodes().on("mouseover",function(e){h.value=o.value.getElementById(e.target.id()),h.value.addClass("node-hover")}),o.value.nodes().on("mouseout",function(){h.value&&(h.value.removeClass("node-hover"),h.value=null)}),o.value.on("tap","edge",function(e){let t=e.target.data().url;t&&window.openDialog("primary-dialog",t)}),o.value.edges().on("mouseover",function(e){m.value=o.value.getElementById(e.target.id()),m.value.style("label",m.value._private.data.name),m.value.style("overlay-opacity",.1)}),o.value.edges().on("mouseout",function(){m.value&&(m.value.style("label",""),m.value.style("overlay-opacity",0),m.value=null)})},O=async()=>{let e=!0;for(;e;)o.value.nodes(":backgrounding").length==0?e=!1:await sleep(200);_.value=!1},Q=e=>{const t=o.value;if(!t)return;const a=t.container();if(!a)return;const l=e.renderedPosition(),c=a.getBoundingClientRect(),r=()=>{const i=c.left+l.x,u=c.top+l.y;return{x:i,y:u,left:i,top:u,right:i,bottom:u,width:0,height:0}};y&&(y.destroy(),y=null),y=ie(document.body,{trigger:"manual",getReferenceClientRect:r,theme:"entity-tooltip",placement:"bottom",hideOnClick:!0,allowHTML:!0,interactive:!0,content:"Loading...",appendTo:()=>document.body,onShow(i){const u=String(e.id());if(u in M.value){i.setContent(M.value[u]);return}axios.get(e.data().tooltip).then(w=>{const f=w.data;i.setContent(f),M.value[u]=f}).catch(w=>{i.setContent(`Failed loading tooltip. ${w}`)})}}),y.show()},z=async e=>{const t=e.target;if(t){e.preventDefault();try{const a=(t.method||"POST").toUpperCase(),l=t.action,c=new FormData(t),r=await axios({url:l,method:a,data:c,headers:{"X-Requested-With":"XMLHttpRequest"}});X(r.data),window.closeDialog&&window.closeDialog("primary-dialog")}catch(a){console.error(a)}}},X=async e=>{if(!o.value||!e||!e.id)return;const t=o.value.edges().filter(`[id = "${e.id}"]`);if(!t||t.length===0){console.warn("Updated unknown edge",e.id);return}e.deleted&&t.remove();const a=$(e.attitude??0);if(t.data().target!=e.target.id){R(e.target),await O();const l={group:"edges",data:{...t.data(),name:e.text,target:e.target.id,colour:e.colour||"#777777",attitude:a}};t.remove(),o.value.add(l)}else t.data({...t.data(),name:e.text,colour:e.colour||"#777777",attitude:a})},G=()=>{window.openDialog("primary-dialog",P.value.creator)},d=e=>I.value[e]||e,J=()=>{if(v.value=!1,!o.value)return;const e={full:!0,bg:F("--b1")},t=o.value.png(e),a=document.createElement("a");a.href=t,a.download=`${d("campaign")}-web-${Date.now()}.png`,document.body.appendChild(a),a.click(),document.body.removeChild(a)},K=async()=>{if(v.value=!1,!o.value)return;const{jsPDF:e}=await D(async()=>{const{jsPDF:r}=await import("./jspdf.es.min-tTe3jQg-.js").then(i=>i.j);return{jsPDF:r}},__vite__mapDeps([3,4])),t=o.value.png({full:!0,bg:F("--b1")}),a=new Image;a.src=t,await new Promise(r=>{a.onload=r});const l=a.width>a.height,c=new e({orientation:l?"landscape":"portrait",unit:"px",format:[a.width,a.height]});c.addImage(t,"PNG",0,0,a.width,a.height),c.save(`${d("campaign")}-web-${Date.now()}.pdf`)};return(e,t)=>{const a=oe("click-outside");return p(),g(le,null,[x.value?(p(),g("div",ue,[n("div",de,[n("a",{href:P.value.back,title:d("back"),class:"flex items-center gap-1 text-link rounded bg-base-100 p-1",tabindex:"0"},[t[4]||(t[4]=n("i",{class:"fa-regular fa-left-to-bracket","aria-hidden":"true"},null,-1)),n("span",{innerHTML:d("back")},null,8,pe)],8,ce),k.creator?(p(),g("div",ge,[k.creator?(p(),g("a",{key:0,href:"#",onClick:t[0]||(t[0]=l=>G()),class:"quick-creator-button btn2 btn-outline btn-sm","data-toggle":"tooltip","data-title":d("qq-keyboard-shortcut"),tabindex:"0"},[t[5]||(t[5]=n("i",{class:"flex-none fa-regular fa-plus","aria-hidden":"true"},null,-1)),n("span",{class:"grow hidden sm:inline-block",innerHTML:d("create")},null,8,fe)],8,me)):b("",!0),n("div",ve,[n("a",{href:"#",onClick:t[1]||(t[1]=ae(l=>v.value=!v.value,["prevent"])),class:"btn2 btn-sm btn-outline"},[t[6]||(t[6]=n("i",{class:"fa-regular fa-download","aria-hidden":"true"},null,-1)),n("span",{innerHTML:d("download")},null,8,we),t[7]||(t[7]=n("i",{class:"fa-solid fa-caret-down","aria-hidden":"true"},null,-1))]),v.value?ne((p(),g("div",be,[n("button",{onClick:t[2]||(t[2]=l=>J()),class:"dropdown-item flex items-center gap-2 px-2 py-1 rounded hover:bg-base-300 whitespace-nowrap text-left"},[t[8]||(t[8]=n("i",{class:"fa-regular fa-image w-6","aria-hidden":"true"},null,-1)),n("span",{innerHTML:d("download-png")},null,8,he)]),n("button",{onClick:t[3]||(t[3]=l=>K()),class:"dropdown-item flex items-center gap-2 px-2 py-1 rounded hover:bg-base-300 whitespace-nowrap text-left"},[t[9]||(t[9]=n("i",{class:"fa-regular fa-file-pdf w-6","aria-hidden":"true"},null,-1)),n("span",{innerHTML:d("download-pdf")},null,8,ye)])])),[[a,()=>v.value=!1]]):b("",!0)])])):b("",!0)])])):b("",!0),x.value?b("",!0):(p(),g("div",ke,[t[10]||(t[10]=n("i",{class:"fa-solid fa-spinner fa-spin","aria-hidden":"true"},null,-1)),L.value?(p(),g("span",xe,"Loading")):E.value?(p(),g("span",_e,"Parsing web")):_.value?(p(),g("span",Ce,"Drawing web")):b("",!0)])),n("div",{ref_key:"cyContainer",ref:T,class:"min-h-screen text-base-content cy-map bg-base-100"},null,512)],64)}}}),B=re({});B.use(se);B.component("connections-web",De);B.mount("#web");

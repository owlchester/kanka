const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/cytoscape-cose-bilkent-DF4CVbNw.js","assets/_commonjsHelpers-CqkleIqs.js","assets/cytoscape-panzoom-CwP9w_A0.js"])))=>i.map(i=>d[i]);
import{d as W,r as l,o as j,L as X,c as m,a as g,f as L,b as y,F as $,q as G}from"./vue.esm-bundler-CSDHRrjm.js";import{_ as T}from"./preload-helper-I4rgV-VL.js";import{t as J}from"./tippy.esm-CnBRltuW.js";const K={key:0,class:"w-full h-screen flex items-center justify-center text-4xl gap-2 absolute bg-base-100 transition-all duration-300 top-0 bottom-0 left-0 right-0 z-900"},Q={key:0},Y={key:1},ee={key:2},te={key:1,class:"fixed top-2 right-2"},oe=["href"],ae=["innerHTML"],ne=W({__name:"Web",props:{api:{},back:{},actionBack:{},premium:{type:Boolean}},setup(O){const h=O,w=l(!1),k=l(!1),x=l(!1),b=l(!1),_=l([]),o=l(null),v=l(null),u=l(null),C=l(),E=l(Array);let f=null;j(async()=>{await F(),await M(),await N(),w.value=!0,document.addEventListener("submit",z,!0),h.premium||window.openDialog("web-premium")}),X(()=>{o.value&&(o.value.destroy(),o.value=null),document.removeEventListener("submit",z,!0)});const P=e=>{x.value=!0,Object.values(e.entities).forEach(t=>{B(t)}),e.nodes.forEach(t=>{A(t)}),x.value=!1},B=e=>{if(_.value.find(a=>a.data.id==e.id))return;const t={group:"nodes",data:{id:e.id,name:e.name,image:e.image,link:e.link,tooltip:e.tooltip}};_.value.push(t),w.value&&o.value&&o.value.add(t)},A=e=>{let t={group:"edges",data:{id:e.id,source:e.source,target:e.target,name:e.text,colour:e.colour,attitude:e.attitude,shape:e.shape,url:e.url}};t.data.colour||(t.data.colour="#777777"),t.data.attitude||(t.data.attitude=0),t.data.attitude=R(t.data.attitude),_.value.push(t)},R=e=>(e+100)/100*2+2,F=async()=>{const{default:e}=await T(async()=>{const{default:c}=await import("./cytoscape.esm-DC-SVX1T.js");return{default:c}},[]),{default:t}=await T(async()=>{const{default:c}=await import("./cytoscape-cose-bilkent-DF4CVbNw.js").then(D=>D.c);return{default:c}},__vite__mapDeps([0,1])),{default:a}=await T(async()=>{const{default:c}=await import("./cytoscape-panzoom-CwP9w_A0.js").then(D=>D.c);return{default:c}},__vite__mapDeps([2,1]));e.use(t),e.use(a);const s=C.value,d=s.parentNode,n=window.getComputedStyle(s),i=window.getComputedStyle(d);o.value=e({container:C.value,style:e.stylesheet().selector("node").css({label:"data(name)","background-image":"data(image)",height:80,width:80,"background-fit":"cover","border-color":i.color,"border-width":3,color:n.color,"text-wrap":"wrap","text-margin-y":"-8px","text-background-opacity":1,"text-background-color":n.backgroundColor,"text-border-color":n.backgroundColor,"text-border-width":3,"text-border-opacity":1}).selector("edge").css({"line-color":"data(colour)","curve-style":"bezier","control-point-step-size":40,"target-arrow-shape":"data(shape)","target-arrow-color":"data(colour)",width:"data(attitude)","text-background-opacity":1,color:n.color,"text-background-color":n.backgroundColor,"text-border-color":n.backgroundColor,"text-border-width":3,"text-border-opacity":1})});const r=.1,p=1.2;o.value.panzoom({maxZoom:p,minZoom:r}),o.value.minZoom(r),o.value.maxZoom(p)},M=async()=>{k.value=!0;const e=await axios.get(h.api);k.value=!1;const t=e.data;P(t)},N=async()=>{o.value&&(b.value=!0,b.value=!0,o.value.add(_.value),o.value.nodes().forEach(function(e){e.connectedEdges().length==0&&U(e)}),V(),H(),await S())},U=e=>{e.hide()},V=()=>{o.value.elements().layout({name:"cose-bilkent",idealEdgeLength:130,nodeDimensionsIncludeLabels:!0}).run()},H=()=>{o.value.on("tap","node",function(e){const t=e.target;Z(t)}),o.value.nodes().on("mouseover",function(e){v.value=o.value.getElementById(e.target.id()),v.value.addClass("node-hover")}),o.value.nodes().on("mouseout",function(){v.value&&(v.value.removeClass("node-hover"),v.value=null)}),o.value.on("tap","edge",function(e){let t=e.target.data().url;t&&window.openDialog("primary-dialog",t)}),o.value.edges().on("mouseover",function(e){u.value=o.value.getElementById(e.target.id()),u.value.style("label",u.value._private.data.name),u.value.style("overlay-opacity",.1)}),o.value.edges().on("mouseout",function(){u.value&&(u.value.style("label",""),u.value.style("overlay-opacity",0),u.value=null)})},S=async()=>{let e=!0;for(;e;)o.value.nodes(":backgrounding").length==0?e=!1:await sleep(200);b.value=!1},Z=e=>{const t=o.value;if(!t)return;const a=t.container();if(!a)return;const s=e.renderedPosition(),d=a.getBoundingClientRect(),n=()=>{const i=d.left+s.x,r=d.top+s.y;return{x:i,y:r,left:i,top:r,right:i,bottom:r,width:0,height:0}};f&&(f.destroy(),f=null),f=J(document.body,{trigger:"manual",getReferenceClientRect:n,theme:"entity-tooltip",placement:"bottom",hideOnClick:!0,allowHTML:!0,interactive:!0,content:"Loading...",appendTo:()=>document.body,onShow(i){const r=String(e.id());if(r in E.value){i.setContent(E.value[r]);return}axios.get(e.data().tooltip).then(p=>{const c=p.data;i.setContent(c),E.value[r]=c}).catch(p=>{i.setContent(`Failed loading tooltip. ${p}`)})}}),f.show()},z=async e=>{const t=e.target;if(t){e.preventDefault();try{const a=(t.method||"POST").toUpperCase(),s=t.action,d=new FormData(t),n=await axios({url:s,method:a,data:d,headers:{"X-Requested-With":"XMLHttpRequest"}});q(n.data),window.closeDialog&&window.closeDialog("primary-dialog")}catch(a){console.error(a)}}},q=async e=>{if(!o.value||!e||!e.id)return;const t=o.value.edges().filter(`[id = "${e.id}"]`);if(!t||t.length===0){console.warn("Updated unknown edge",e.id);return}e.deleted&&t.remove();const a=R(e.attitude??0);if(t.data().target!=e.target.id){B(e.target),await S();const s={group:"edges",data:{...t.data(),name:e.text,target:e.target.id,colour:e.colour||"#777777",attitude:a}};t.remove(),o.value.add(s)}else t.data({...t.data(),name:e.text,colour:e.colour||"#777777",attitude:a})};return(e,t)=>(g(),m($,null,[w.value?L("",!0):(g(),m("div",K,[t[0]||(t[0]=y("i",{class:"fa-solid fa-spinner fa-spin","aria-hidden":"true"},null,-1)),k.value?(g(),m("span",Q,"Loading")):x.value?(g(),m("span",Y,"Parsing web")):b.value?(g(),m("span",ee,"Drawing web")):L("",!0)])),y("div",{ref_key:"cyContainer",ref:C,class:"min-h-screen text-base-content cy-map bg-base-100"},null,512),w.value?(g(),m("div",te,[y("a",{href:h.back,class:"btn2 btn-default z-900"},[t[1]||(t[1]=y("i",{class:"fa-regular fa-arrow-left","aria-hidden":"true"},null,-1)),y("span",{innerHTML:h.actionBack},null,8,ae)],8,oe)])):L("",!0)],64))}}),I=G({});I.component("connections-web",ne);I.mount("#web");

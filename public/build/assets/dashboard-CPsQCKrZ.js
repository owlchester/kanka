import{S as I}from"./sortable.esm-DdTU3J9A.js";import{d as H,o as C,z as B,a as o,c as l,b as s,w as E,v as F,f as k,e as L,p as O,h as f,l as A,F as z,r as K,q as M}from"./vendor-tiptap-BMQcrX0l.js";import{p as N}from"./vue-tippy.esm-browser-DmwBS-cR.js";import{v as T}from"./v-click-outside.umd-Cl-Y_A58.js";import"./_commonjsHelpers-Cpj98o6Y.js";const P={class:"flex gap-6 items-center p-4 md:p-6 justify-between"},U=["innerHTML"],V={class:"max-w-4xl p-4"},j={class:"flex flex-col gap-4 lg:gap-6"},G=["innerHTML"],W={class:"flex flex-col gap-1"},J=["innerHTML"],R=["placeholder"],Q=["innerHTML"],X=["innerHTML"],Y={class:"flex flex-col gap-2"},Z=["innerHTML"],ee=["innerHTML"],te={class:"flex flex-col gap-4"},ne={key:0,class:"fa-regular fa-check-square text-xl","aria-label":"Selected"},se={key:1,class:"fa-regular fa-globe text-xl","aria-hidden":"true"},ae={class:"flex flex-col gap-1"},ie=["innerHTML"],oe=["innerHTML"],le={key:0,class:"fa-regular fa-check-square text-xl","aria-label":"Selected"},re={key:1,class:"fa-regular fa-dice-d20 text-xl","aria-hidden":"true"},de={class:"flex flex-col gap-1"},ce=["innerHTML"],ue=["innerHTML"],pe={key:0,class:"fa-regular fa-check-square text-xl","aria-label":"Selected"},ge={key:1,class:"fa-regular fa-pen-fancy text-xl","aria-hidden":"true"},me={class:"flex flex-col gap-1"},fe=["innerHTML"],he=["innerHTML"],ve=["innerHTML"],xe={class:"flex justify-between w-full gap-4 items-center mt-6"},be=["innerHTML"],we=["innerHTML"],_e={key:1,class:"btn2 btn-primary btn-disabled",disabled:"disabled"},ye=H({__name:"Onboarding",props:{api:{},skip:{},i18n:{},campaign:{}},setup(h){const t=h,e=f(null),i=f(""),a=f(null),r=f(),g=f(!1),u=f(),m=f(!1),b=f(),d=c=>r.value[c]??"unknown",S=()=>{v("x")},w=()=>{window.closeDialog("onboarding-dialog")},v=c=>{axios.post(t.skip,{reason:c}),w()},$=c=>{c.target===e.value&&v("backdrop")},q=()=>{v("skip"),w()},D=()=>{if(m.value)return;m.value=!0;let c={name:i.value,type:u.value};axios.post(t.api,c).then(n=>{n.data.redirect?window.location.href=n.data.redirect:w()}).catch(n=>{n.response.data.message?(b.value=n.response.data.message,a.value.focus(),a.value.scrollIntoView({behavior:"smooth"})):console.error("onboarding saving error",n),m.value=!1})},x=c=>{u.value=c},_=c=>{let n="flex items-center gap-4 rounded-xl border p-2 px-4 hover:border-primary hover:text-primary focus:border-primary focus:text-primary";return u.value!==c?n+" cursor-pointer":n+"border-primary text-primary"},y=(c,n)=>{(c.key==="Enter"||c.key===" ")&&(c.preventDefault(),x(n))};return C(async()=>{r.value=JSON.parse(t.i18n),i.value=t.campaign,g.value=!0,await B(),e.value.showModal()}),(c,n)=>g.value?(o(),l("dialog",{key:0,class:"dialog rounded-2xl bg-base-100 text-base-content",id:"onboarding-dialog",ref_key:"onboardingDialog",ref:e,"aria-modal":"true","aria-labelledby":"modal-card-label",onClick:$,onCancel:n[10]||(n[10]=O(p=>v("esc"),["prevent"]))},[s("header",P,[s("h4",{innerHTML:d("title"),class:"text-lg font-normal"},null,8,U),s("button",{type:"button",class:"text-base-content",onClick:n[0]||(n[0]=p=>S()),title:"Close"},[...n[11]||(n[11]=[s("i",{class:"fa-regular fa-circle-xmark","aria-hidden":"true"},null,-1),s("span",{class:"sr-only"},"Close",-1)])])]),s("article",V,[s("div",j,[s("p",{class:"text-neutral-content",innerHTML:d("intro")},null,8,G),s("div",W,[s("label",{for:"name",innerHTML:d("name")},null,8,J),E(s("input",{type:"text",name:"name",id:"name",ref_key:"nameField",ref:a,class:"","onUpdate:modelValue":n[1]||(n[1]=p=>i.value=p),placeholder:d("name"),"data-1p-ignore":"true"},null,8,R),[[F,i.value]]),s("p",{class:"text-xs text-neutral-content",innerHTML:d("placeholder")},null,8,Q),b.value?(o(),l("p",{key:0,innerHTML:b.value,class:"text-error"},null,8,X)):k("",!0)]),s("div",Y,[s("h3",{innerHTML:d("type-title")},null,8,Z),s("p",{innerHTML:d("type-intro")},null,8,ee),s("div",te,[s("div",{class:L(_("worldbuilding")),onClick:n[2]||(n[2]=p=>x("worldbuilding")),tabindex:"0",onKeydown:n[3]||(n[3]=p=>y(p,"worldbuilding"))},[u.value==="worldbuilding"?(o(),l("i",ne)):(o(),l("i",se)),s("div",ae,[s("span",{class:"text-lg",innerHTML:d("worldbuilding")},null,8,ie),s("p",{class:"text-xs text-neutral-content",innerHTML:d("worldbuilding-description")},null,8,oe)])],34),s("div",{class:L(_("campaign")),onClick:n[4]||(n[4]=p=>x("campaign")),tabindex:"0",onKeydown:n[5]||(n[5]=p=>y(p,"campaign"))},[u.value==="campaign"?(o(),l("i",le)):(o(),l("i",re)),s("div",de,[s("span",{class:"text-lg",innerHTML:d("campaign")},null,8,ce),s("p",{class:"text-xs text-neutral-content",innerHTML:d("campaign-description")},null,8,ue)])],34),s("div",{class:L(_("story")),onClick:n[6]||(n[6]=p=>x("story")),tabindex:"0",onKeydown:n[7]||(n[7]=p=>y(p,"story"))},[u.value==="story"?(o(),l("i",pe)):(o(),l("i",ge)),s("div",me,[s("span",{class:"text-lg",innerHTML:d("story")},null,8,fe),s("p",{class:"text-xs text-neutral-content",innerHTML:d("story-description")},null,8,he)])],34)]),s("p",{class:"text-xs text-neutral-content",innerHTML:d("type-helper")},null,8,ve)])]),s("div",xe,[s("button",{class:"btn2 btn-sm btn-outline",onClick:n[8]||(n[8]=p=>q()),innerHTML:d("skip")},null,8,be),m.value?(o(),l("span",_e,[...n[12]||(n[12]=[s("i",{class:"fa-solid fa-spinner fa-spin","aria-label":"Saving"},null,-1)])])):(o(),l("button",{key:0,class:"btn2 btn-primary",onClick:n[9]||(n[9]=p=>D()),innerHTML:d("continue")},null,8,we))])])],544)):k("",!0)}}),Le={key:0,class:"flex items-center align-middle"},ke={key:1,class:"flex flex-col gap-2"},Me={class:"flex items-center justify-between gap-2 mb-3"},Te=["innerHTML"],He=["innerHTML"],Ce={class:"tasks flex flex-col gap-2 lg:gap-3 xl:gap-4"},Ee={class:"flex items-center gap-2 task"},Se={class:"task-icon"},$e={key:0,class:"fa-regular fa-square-check","aria-label":"Completed"},qe={key:1,class:"fa-regular fa-square","aria-label":"Pending"},De=["href","innerHTML"],Ie=["innerHTML"],Be=H({__name:"GettingStarted",props:{api:{},name:{}},setup(h){const t=h,e=f(!0),i=f([]);C(()=>{axios.get(t.api).then(r=>{i.value=r.data,e.value=!1})});const a=()=>{let r=i.value.length,g=i.value.filter(u=>u.completed).length;return r==g?"":g+" / "+r};return(r,g)=>{const u=A("tippy");return e.value?(o(),l("div",Le,[...g[0]||(g[0]=[s("i",{class:"fa-solid fa-spinner fa-spin","aria-label":"Loading tasks"},null,-1)])])):(o(),l("div",ke,[s("div",Me,[s("span",{class:"widget-title block text-lg",innerHTML:h.name},null,8,Te),s("span",{class:"text-xs text-neutral-content",innerHTML:a()},null,8,He)]),s("div",Ce,[(o(!0),l(z,null,K(i.value,m=>E((o(),l("div",Ee,[s("div",Se,[m.completed?(o(),l("i",$e)):(o(),l("i",qe))]),m.completed?(o(),l("span",{key:1,innerHTML:m.name,class:"line-through"},null,8,Ie)):(o(),l("a",{key:0,href:m.url,innerHTML:m.name},null,8,De))])),[[u,m.helper]])),256))])]))}}});class Fe{constructor(){this.init()}init(){this.initDashboardCalendars(),this.initPreviewExpander(),this.initDashboardAdminUI(),this.initFollow(),this.initOnboarding(),this.initGettingStarted(),this.initLazyLoader()}initLazyLoader(){const t=new IntersectionObserver(e=>{e.forEach(i=>{if(i.isIntersecting){const a=i.target;this.renderWidget(a),t.unobserve(a)}})},{threshold:[0]});document.querySelectorAll("[data-render]")?.forEach(e=>{t.observe(e)})}renderWidget(t){axios.get(t.dataset.render).then(e=>{const i=t.dataset.id;this.renderCalendar(i,e.data)}).catch(e=>console.error(`Error loading widget ${t.dataset.id}:`,e))}renderCalendar(t,e){const i=document.querySelector("#widget-loading-"+t),a=document.querySelector("#widget-body-"+t);i&&i.classList.add("hidden"),a&&(a.innerHTML=e,a.classList.remove("hidden")),window.triggerEvent&&window.triggerEvent()}initDashboardCalendars(){document.addEventListener("click",t=>{const e=t.target.closest(".widget-calendar-switch");if(!e)return;t.preventDefault();const i=e.dataset.url,a=e.dataset.widget,r=document.querySelector("#widget-body-"+a),g=document.querySelector("#widget-loading-"+a);r&&r.classList.add("hidden"),g&&g.classList.remove("hidden"),axios.post(i).then(u=>{this.renderCalendar(a,u.data)}).catch(u=>console.error("Error switching calendar:",u))})}initDashboardAdminUI(){const t=document.getElementById("widgets");t&&this.initSortable(t),document.addEventListener("click",e=>{const i=e.target.closest('[data-img="delete"]');if(!i)return;e.preventDefault();const a=document.querySelector('input[name="'+i.dataset.target+'"]');a&&(a.value=1);const r=i.closest(".preview");r&&r.classList.add("hidden")}),window.onEvent&&window.onEvent(()=>{document.getElementById("summernote-config")&&window.initSummernote&&window.initSummernote()})}initSortable(t){new I(t,{handle:".handle",onEnd:()=>{const e=t.dataset.url,i=new URLSearchParams;document.querySelectorAll('input[name="widgets[]"]').forEach(a=>{i.append(a.name,a.value)}),axios.post(e,i).then(a=>{a.data.success&&a.data.message&&window.showToast&&window.showToast(a.data.message)}).catch(a=>console.error("Error saving order:",a))}})}initFollow(){const t=document.querySelector("#campaign-follow"),e=document.querySelector("#campaign-follow-text");if(!t||!e)return;const i=a=>{e.innerHTML=a?t.dataset.unfollow:t.dataset.follow};i(!!t.dataset.following),t.classList.remove("hidden"),t.addEventListener("click",a=>{a.preventDefault(),t.classList.add("loading"),axios.post(t.dataset.url).then(r=>{t.classList.remove("loading"),i(r.data.following)}).catch(()=>t.classList.remove("loading"))})}initPreviewExpander(){document.addEventListener("click",t=>{const e=t.target.closest(".preview-switch");if(!e)return;t.preventDefault();const i=document.querySelector("#widget-preview-body-"+e.dataset.widget);if(!i)return;const a=e.parentNode.querySelector(".gradient-to-base-100");!i.classList.contains("max-h-52")?(i.classList.add("max-h-52"),e.innerHTML='<i class="fa-solid fa-chevron-down" aria-hidden="true"></i>',a&&a.classList.remove("hidden")):(i.classList.remove("max-h-52"),e.innerHTML='<i class="fa-solid fa-chevron-up" aria-hidden="true"></i>',a&&a.classList.add("hidden"))})}initOnboarding(){if(!document.getElementById("onboarding"))return;const e=M({});e.component("onboarding",ye),e.use(T),e.mount("#onboarding")}initGettingStarted(){if(!document.getElementById("getting-started"))return;const e=M({});e.component("getting-started",Be),e.use(T),e.use(N,{theme:"kanka"}),e.mount("#getting-started")}}new Fe;

import{d as Te,c as t,a as s,e as re,w as U,f as u,b as e,K as Ne,n as I,r as n,z as _l,o as je,v as Ae,u as me,F as A,g as K,L as bl,G as xl,j as kl,i as yl,l as Ml,k as Tl,q as wl}from"./vue.esm-bundler-CSDHRrjm.js";import{v as Ll}from"./v-click-outside.umd-BCtVgRUL.js";import"./_commonjsHelpers-CqkleIqs.js";const Hl={key:1,class:"flex-none w-20 md:w-full h-16 md:h-32"},$l={key:1,class:"w-full h-full flex gap-0.5"},Cl={key:2,class:"w-full h-full flex gap-0.5"},Fl={class:"flex flex-col gap-0.5 w-1/2 h-full"},Pl={key:3,class:"h-full w-full flex items-center justify-center align-middle text-6xl text-neutral-content"},Il={key:3,class:"w-full h-20 md:h-32"},Sl={class:"flex gap-1 md:gap-2 items-center md:p-4 truncate"},Ul={key:0,class:"grow-0 md:hidden"},Bl=["title"],Dl={class:"grow truncate"},El=["innerHTML"],Vl={key:1,class:"hidden md:block grow-0"},Nl=["title"],jl=Te({__name:"Preview",props:{file:{},isBulking:{},i18n:{}},emits:["select"],setup(ee,{emit:le}){const o=le,m=ee,E=()=>m.file.thumbnail!==null,T=f=>"url('"+f+"')",w=()=>{o("select",m.file)},B=()=>{let f="rounded-xl shadow-sm bg-base-100 overflow-hidden sm:w-48 cursor-pointer hover:shadow-lg relative flex flex-row md:flex-col gap-2 md:gap-0";return!m.file.is_selected||!m.isBulking?f+"  ":f+" bg-base-300"},g=()=>{switch(parseInt(m.file.visibility_id)){case 2:return"fa-regular fa-lock";case 3:return"fa-regular fa-user-lock";case 4:return"fa-regular fa-user-secret";case 5:return"fa-regular fa-users";default:return"fa-regular fa-eye"}},S=()=>m.i18n["visibility."+m.file.visibility_id];return(f,$)=>(s(),t("div",{class:re(B()),onClick:w},[f.isBulking?U((s(),t("input",{key:0,type:"checkbox","onUpdate:modelValue":$[0]||($[0]=P=>f.file.is_selected=P),class:"absolute! top-4 left-4"},null,512)),[[Ne,f.file.is_selected]]):u("",!0),f.file.is_folder?(s(),t("div",Hl,[f.file.thumbnails.length===1?(s(),t("div",{key:0,class:"w-full h-full",style:I({backgroundImage:T(f.file.thumbnails[0])})},null,4)):f.file.thumbnails.length===2?(s(),t("div",$l,[e("div",{class:"w-1/2 h-full cover-background",style:I({backgroundImage:T(f.file.thumbnails[0])})},null,4),e("div",{class:"w-1/2 h-full cover-background",style:I({backgroundImage:T(f.file.thumbnails[1])})},null,4)])):f.file.thumbnails.length===3?(s(),t("div",Cl,[e("div",{class:"w-1/2 h-full cover-background",style:I({backgroundImage:T(f.file.thumbnails[0])})},null,4),e("div",Fl,[e("div",{class:"w-full h-1/2 cover-background",style:I({backgroundImage:T(f.file.thumbnails[1])})},null,4),e("div",{class:"w-full h-1/2 cover-background",style:I({backgroundImage:T(f.file.thumbnails[2])})},null,4)])])):(s(),t("div",Pl,$[1]||($[1]=[e("i",{class:"fa-regular fa-folder","aria-hidden":"true"},null,-1)])))])):E()?(s(),t("div",{key:2,class:"flex-none w-20 md:w-full h-16 md:h-32 cover-background",style:I({backgroundImage:T(f.file.thumbnail)})},null,4)):(s(),t("div",Il)),e("div",Sl,[f.file.visibility_id>1?(s(),t("div",Ul,[e("i",{class:re(g()),"aria-hidden":"true",title:S()},null,10,Bl)])):u("",!0),e("div",Dl,[e("span",{innerHTML:f.file.name,class:""},null,8,El)]),f.file.visibility_id>1?(s(),t("div",Vl,[e("i",{class:re(g()),"aria-hidden":"true",title:S()},null,10,Nl)])):u("",!0)])],2))}}),Al={class:"bg-base-100 p-2 md:p-4 rounded flex flex-col gap-2 md:gap-4 md:sticky md:top-24"},zl={key:0,class:"text-2xl flex items-center justify-center h-32"},Rl={key:1,class:"flex flex-col gap-4"},Kl={class:"flex items-center gap-2"},Xl={class:"flex items-center gap-1 grow"},Yl=["innerHTML"],Ol={class:"flex flex-col gap-1"},Wl=["innerHTML"],Gl=["innerHTML"],ql={key:0,class:"flex flex-col gap-1"},Jl={class:"font-extrabold flex gap-1 items-center"},Ql=["innerHTML"],Zl=["value","innerHTML"],ea={key:1,class:"flex flex-col gap-1"},la={class:"grow font-bold flex gap-1 items-center"},aa=["innerHTML"],sa={key:0,class:"fa-solid fa-chevron-up","aria-label":"Hide mentions"},ta={key:1,class:"fa-solid fa-chevron-down","aria-label":"Show mentions"},na={key:0,class:"flex flex-wrap gap-2"},ia=["href"],oa={key:0,class:"fa-regular fa-image","aria-hidden":"true"},ua={key:1,class:"fa-regular fa-pen","aria-hidden":"true"},ra=["innerHTML"],da=["innerHTML"],ca={key:2,class:"grid grid-cols-2 gap-2"},fa=["innerHTML"],va=["innerHTML"],pa=["innerHTML"],ga=["innerHTML"],ha=["innerHTML"],ma=["innerHTML"],_a=["innerHTML"],ba=["href"],xa=["innerHTML"],ka={class:"flex gap-2 items-center justify-between"},ya={key:0,class:"fa-solid fa-spinner fa-spin text-error","aria-label":"Deleting"},Ma=["innerHTML"],Ta=["innerHTML"],wa=["innerHTML"],La={key:3,class:"grow text-right text-neutral-content"},Ha=["innerHTML"],$a={key:3,class:"text-right text-neutral-content flex gap-1 self-end items-center text-xs"},Ca=["innerHTML"],Fa={key:2,class:"flex flex-col gap-4 overflow-hidden"},Pa={key:0,class:"alert alert-warning p-4 flex flex-col gap-2"},Ia=["innerHTML"],Sa={key:1,class:"max-w-32 flex items-center justify-center"},Ua={class:"relative inline-block"},Ba=["src"],Da={class:"flex gap-2 items-center flex-wrap justify-between"},Ea=["innerHTML"],Va=["innerHTML"],Na=Te({__name:"File",props:{file:{},visibilities:{},i18n:{},premium:{},canManage:{}},emits:["updated","deleted","moved","closed"],setup(ee,{emit:le}){const o=ee,m=le,E=n(),T=n(),w=n(!1),B=n(!1),g=n(),S=n(!0),f=n(!1),$=n(!1),P=n(!0),V=n(!1),k=n(),_=n(),C=n();_l(()=>o.file,(r,i)=>{r&&X()}),je(()=>{X()});const x=r=>o.i18n[r]?o.i18n[r]:"_"+r+"_",X=()=>{S.value=!0,w.value=!1,B.value=!1,T.value=o.file.name,g.value=o.file.visibility_id,_.value=o.file.focus_x,C.value=o.file.focus_y,f.value=!1,$.value=!1,V.value=!1,axios.get(o.file.api.show).then(r=>{E.value=r.data.data.mentions,S.value=!1})},Y=()=>{T.value!==o.file.name&&v()},c=()=>{g.value!==o.file.visibility_id&&v()},v=()=>{if(w.value)return;w.value=!0;const r={name:T.value,visibility_id:g.value};axios.post(o.file.api.update,r).then(i=>{o.file.name=T.value,o.file.visibility_id=g.value,o.file.visibility=i.data.data.visibility,w.value=!1,B.value=!0,m("updated",o.file)})},D=()=>{P.value=!P.value},L=()=>E.value.length>0,N=()=>{if(!f.value){if(!$.value){$.value=!0;return}f.value=!0,axios.post(o.file.api.delete,{_method:"delete"}).then(r=>{window.showToast("Removed "+o.file.name),m("deleted",o.file,r.data.used)})}},O=()=>{m("closed")},_e=()=>{V.value=!0},W=()=>{V.value=!1},de=r=>{const i=k.value.naturalWidth,y=k.value.naturalHeight,H=r.clientX-k.value.getBoundingClientRect().left,F=r.clientY-k.value.getBoundingClientRect().top,ae=H/k.value.clientWidth*i,fe=F/k.value.clientHeight*y;_.value=parseInt(String(ae),10),C.value=parseInt(String(fe),10)},G=r=>{if(!_.value||!k.value)return"display: none;";const i=k.value.naturalWidth,y=k.value.naturalHeight,H=_.value/i*100,F=C.value/y*100;return"left: "+H+"%; top: "+F+"%"},q=()=>{_.value=null,C.value=null,z()},ce=()=>{z()},z=()=>{if(w.value)return;w.value=!0,V.value=!1;const r={focus_x:_.value,focus_y:C.value};axios.post(o.file.api.focus,r).then(i=>{w.value=!1,B.value=!0,o.file.focus_x=_.value,o.file.focus_y=C.value,console.log(i.data),o.file.thumbnail=i.data.data.thumbnail,m("updated",o.file)})};return(r,i)=>(s(),t("div",Al,[S.value?(s(),t("div",zl,i[2]||(i[2]=[e("i",{class:"fa-solid fa-spinner fa-spin","aria-label":"Loading"},null,-1)]))):V.value?(s(),t("div",Fa,[o.premium?(s(),t("div",Sa,[e("div",Ua,[e("div",{class:"absolute cursor-pointer text-4xl text-accent",style:I(G()),onClick:q},i[13]||(i[13]=[e("i",{class:"fa-duotone fa-arrow-up-left-from-circle hover:text-error","aria-label":"Focus point"},null,-1)]),4),e("img",{class:"cursor-crosshair",src:o.file.original,alt:"img",ref_key:"focusImage",ref:k,onClick:de},null,8,Ba)])])):(s(),t("div",Pa,[e("p",{innerHTML:x("focus_locked")},null,8,Ia),i[12]||(i[12]=e("a",{href:"https://kanka.io/premium",class:"text-link"},"Learn more",-1))])),e("div",Da,[r.premium?(s(),t("button",{key:0,class:"btn2 btn-primary btn-sm",onClick:ce},[e("span",{innerHTML:x("save")},null,8,Ea)])):u("",!0),e("button",{class:"btn2 btn-ghost btn-sm",onClick:W,innerHTML:x("cancel")},null,8,Va)])])):(s(),t("div",Rl,[e("div",Kl,[e("div",Xl,[i[3]||(i[3]=e("i",{class:"fa-regular fa-clipboard","aria-hidden":"true"},null,-1)),e("span",{class:"font-extrabold",innerHTML:x("details")},null,8,Yl)]),e("div",{class:"cursor-pointer",onClick:O},i[4]||(i[4]=[e("i",{class:"fa-solid fa-xmark","aria-label":"Close"},null,-1)]))]),e("div",Ol,[e("label",{class:"font-extrabold",innerHTML:x("name")},null,8,Wl),r.canManage?U((s(),t("input",{key:0,type:"text",class:"",maxlength:"191","onUpdate:modelValue":i[0]||(i[0]=y=>T.value=y),onChange:Y},null,544)),[[Ae,T.value]]):(s(),t("span",{key:1,innerHTML:T.value},null,8,Gl))]),r.canManage?(s(),t("div",ql,[e("label",Jl,[i[5]||(i[5]=e("i",{class:"fa-regular fa-users","aria-hidden":"true"},null,-1)),e("span",{innerHTML:x("visibility")},null,8,Ql)]),U(e("select",{class:"w-full","onUpdate:modelValue":i[1]||(i[1]=y=>g.value=y),onChange:c},[(s(!0),t(A,null,K(r.visibilities,(y,H)=>(s(),t("option",{value:H,innerHTML:y},null,8,Zl))),256))],544),[[me,g.value]])])):u("",!0),o.file.is_folder?u("",!0):(s(),t("div",ea,[e("div",{class:"flex gap-2 items-center cursor-pointer",onClick:D},[e("div",la,[i[6]||(i[6]=e("i",{class:"fa-regular fa-cubes","aria-hidden":"true"},null,-1)),e("span",{innerHTML:x("used_in")},null,8,aa)]),P.value?(s(),t("i",sa)):(s(),t("i",ta))]),P.value?(s(),t("div",na,[(s(!0),t(A,null,K(E.value,y=>(s(),t("a",{href:y.url,class:"rounded-xl bg-base-200 px-4 py-1 flex gap-1 items-center"},[y.type==="image"?(s(),t("i",oa)):(s(),t("i",ua)),e("span",{class:"truncate",innerHTML:y.name},null,8,ra)],8,ia))),256)),L()?u("",!0):(s(),t("span",{key:0,class:"text-neutral-content",innerHTML:x("unused")},null,8,da))])):u("",!0)])),o.file.is_folder?u("",!0):(s(),t("div",ca,[e("div",{class:"text-neutral-content",innerHTML:x("size")},null,8,fa),e("div",{class:"text-right",innerHTML:r.file.size},null,8,va),e("div",{class:"text-neutral-content",innerHTML:x("uploaded_by")},null,8,pa),e("div",{class:"text-right",innerHTML:r.file.creator},null,8,ga),e("div",{class:"text-neutral-content",innerHTML:x("file_type")},null,8,ha),e("div",{class:"text-right uppercase",innerHTML:r.file.ext},null,8,ma),e("div",{class:"text-neutral-content",innerHTML:x("link")},null,8,_a),e("a",{href:r.file.link,class:"flex gap-1 items-center justify-end text-link",target:"_blank"},[i[7]||(i[7]=e("i",{class:"fa-solid fa-external-link","aria-hidden":"true"},null,-1)),e("span",{innerHTML:x("open")},null,8,xa)],8,ba)])),e("div",ka,[f.value?(s(),t("i",ya)):r.canManage?(s(),t("span",{key:1,role:"button",class:"text-neutral-content hover:text-error-content hover:bg-error flex items-center gap-1 p-2 rounded",onClick:N},[i[8]||(i[8]=e("i",{class:"fa-regular fa-trash-can","aria-hidden":"true"},null,-1)),$.value?(s(),t("span",{key:1,innerHTML:x("confirm")},null,8,Ta)):(s(),t("span",{key:0,innerHTML:x("delete")},null,8,Ma))])):u("",!0),!o.file.is_folder&&r.canManage?(s(),t("button",{key:2,onClick:_e,class:"rounded border p-2 flex gap-1 items-center"},[i[9]||(i[9]=e("i",{class:"fa-regular fa-bullseye","aria-hidden":"true"},null,-1)),e("span",{class:"truncate",innerHTML:x("focus_point")},null,8,wa)])):u("",!0),w.value?(s(),t("div",La,[i[10]||(i[10]=e("i",{class:"fa-solid fa-spinner fa-spin","aria-hidden":"true"},null,-1)),e("span",{innerHTML:x("saving")},null,8,Ha)])):u("",!0)]),B.value?(s(),t("div",$a,[i[11]||(i[11]=e("i",{class:"fa-regular fa-check-double","aria-hidden":"true"},null,-1)),e("span",{innerHTML:x("saved")},null,8,Ca)])):u("",!0)]))]))}}),ja={key:0,class:"text-center text-4xl p-4"},Aa={key:1,class:"flex flex-col gap-4 md:gap-5"},za={class:"flex gap-4 items-end"},Ra={class:"flex flex-col gap-1 grow"},Ka={class:"flex gap-1 items-center"},Xa=["innerHTML"],Ya={class:"flex gap-1 items-center"},Oa=["innerHTML"],Wa=["innerHTML"],Ga=["innerHTML"],qa={class:"bg-base-300 rounded h-2 w-full overflow-hidden transition-all duration-300"},Ja={key:0},Qa=["href","innerHTML"],Za={class:"flex gap-4 flex-wrap sticky top-14 z-50"},es={class:"flex gap-2 grow"},ls={class:"flex gap-0.5"},as={class:"relative"},ss=["innerHTML"],ts={key:0},ns={key:0,class:"border shadow-sm rounded bg-base-100 p-4 absolute right-0 flex flex-col gap-5 w-60"},is={class:"flex gap-2 items-center"},os=["innerHTML"],us={class:"relative"},rs=["innerHTML"],ds={key:0},cs={key:0,class:"border shadow-sm rounded bg-base-100 p-4 absolute right-0 top-full mt-2 flex flex-col gap-1 w-60 z-50"},fs={class:"flex flex-col gap-1 list-none m-0 p-0"},vs={key:0,class:"fa-regular fa-check","aria-hidden":"true"},ps=["innerHTML"],gs={key:0,class:"fa-regular fa-check","aria-hidden":"true"},hs=["innerHTML"],ms={key:0,class:"fa-regular fa-check","aria-hidden":"true"},_s=["innerHTML"],bs={class:"flex gap-2 self-end flex-wrap"},xs=["innerHTML"],ks=["innerHTML"],ys=["innerHTML"],Ms=["innerHTML"],Ts=["innerHTML"],ws=["innerHTML"],Ls=["innerHTML"],Hs=["innerHTML"],$s={key:0,class:"text-center text-4xl p-4"},Cs={key:1,class:"flex flex-col gap-4"},Fs={key:0,class:"flex gap-1 flex-wrap text-xl"},Ps=["innerHTML"],Is={class:"flex gap-1 items-center"},Ss=["onClick","innerHTML"],Us={class:"flex gap-2 flex-row"},Bs={key:0,class:"flex flex-col gap-4 p-2"},Ds={class:"text-center text-xs"},Es=["innerHTML"],Vs={class:"progress h-1 w-full self-end"},Ns={key:0,class:"fixed bottom-0 w-full left-0 right-0 shadow-md md:shadow-none md:relative md:basis-1/4"},js={key:0,class:"text-center text-4xl p-4"},As={class:"flex gap-6 items-center p-4 md:p-6 justify-between"},zs=["innerHTML"],Rs={class:"max-w-4xl flex flex-col gap-2 text-left p-4 md:px-6"},Ks={class:"flex flex-col gap-1 w-full"},Xs=["innerHTML"],Ys={class:"flex flex-col gap-1 w-full"},Os=["innerHTML"],Ws=["value","innerHTML"],Gs={class:"bp-4 md:px-6"},qs={class:""},Js=["innerHTML"],Qs={class:"flex gap-6 items-center p-4 md:p-6 justify-between"},Zs=["innerHTML"],et={class:"max-w-4xl flex flex-col gap-2 text-left p-4 md:px-6"},lt={class:"flex flex-col gap-1 w-full"},at=["innerHTML"],st=["value","innerHTML"],tt={class:"flex flex-col gap-1 w-full"},nt=["innerHTML"],it=["value","innerHTML"],ot={class:"bg-base-200 p-2"},ut={class:""},rt=["innerHTML"],dt=Te({__name:"Gallery",props:{api:{}},setup(ee){const le=ee,o=n(!1),m=n(!1),E=n(),T=n(!1),w=n(!1),B=n(!1),g=n(!1),S=n(!1),f=n(!1),$=n(!1),P=n(!1),V=n(),k=n(),_=n(),C=n(),x=n();n(!1);const X=n(null),Y=n(),c=n([]),v=n([]),D=n([]),L=n(),N=n(),O=n(!0),_e=n(),W=n(!1),de=n(),G=n(),q=n(),ce=n(),z=n(1),r=n(),i=n(),y=n(),H=n(),F=n(),ae=n(),fe=n(),be=n(!1),Le=n(),R=n(),J=n(!1),se=n(null),xe=n(null),He=n(0),Q=n(!1),te=n(!1),ve=n(!1),ne=n(!1),ie=n(!1),pe=n(!0),ke=n(),Z=n(),$e=n(),oe=n(null);let ge=null;je(()=>{axios.get(le.api).then(l=>{o.value=!0,v.value=l.data.files,D.value=l.data.files,_e.value=l.data.url,N.value=l.data.i18n,Y.value=l.data.api.search,E.value=l.data.api.delete,fe.value=l.data.api.update,de.value=l.data.api.create,Le.value=l.data.api.upload,k.value=l.data.next,r.value=l.data.visibilities,i.value=l.data.bulkVisibilities,B.value=l.data.acl.upload,S.value=l.data.acl.premium,f.value=l.data.acl.wyvern,$.value=l.data.acl.elemental,P.value=l.data.acl.manage,ae.value=l.data.folders,ke.value=l.data.space.total,Z.value=l.data.space.used,$e.value=l.data.upgrade}),ge=new IntersectionObserver(l=>{l.forEach(a=>{a.isIntersecting&&qe()})}),oe.value&&ge.observe(oe.value),window.addEventListener("keydown",Ce)}),bl(()=>{ge&&oe.value&&ge.unobserve(oe.value)}),xl(()=>{window.removeEventListener("keydown",Ce)});const Ce=l=>{(l.key==="Escape"||l.key==="Esc")&&(J.value&&sl(),_.value&&(_.value=null),g.value?g.value=null:Q.value&&(Q.value=!1))},p=l=>N.value[l]?N.value[l]:(console.error("Missing trans",l,N),"MISSING"),ze=()=>{g.value=!0},Re=()=>{g.value=!1},Ke=()=>{Pe(y.value),H.value=null,F.value=null},Xe=()=>{let l="grid grid-cols-2 sm:grid-cols-3 md:flex gap-2 sm:gap-3 md:gap-4 md:flex-wrap";return _.value&&(l+=" basis-2/4 md:basis-3/4"),l},Ye=()=>{let l=v.value.filter(a=>a.is_selected).map(a=>a.id);l.length!==0&&(T.value=!0,axios.post(E.value,{images:l}).then(a=>{v.value=v.value.filter(h=>!h.is_selected),O.value&&(D.value=v.value),Z.value=a.data.used,g.value=!1,window.showToast(a.data.toast)}))},Oe=l=>{if(g.value){let a=v.value.find(h=>h.id===l.id);a.is_selected=!a.is_selected;return}if(l.is_folder){Fe(l);return}_.value&&_.value.id===l.id?_.value=null:_.value=l},Fe=l=>{m.value=!0,axios.get(l.open).then(a=>{L.value=l,V.value=a.data.breadcrumbs,v.value=a.data.files,k.value=a.data.next,m.value=!1,O.value=!1})},he=()=>{m.value=!0,v.value=D.value,_.value=null,L.value=null,m.value=!1,O.value=!0,g.value=!1},We=l=>{C.value=l.target.value,X.value&&clearTimeout(X.value),X.value=setTimeout(()=>{Ge()},300)},Ge=()=>{if(x.value!=C.value){if(x.value=C.value,!C.value){c.value.searchParam="",he();return}m.value=!0,c.value.searchParam="term="+C.value;var l="";c.value.searchParam&&(l+=c.value.searchParam+"&"),c.value.sortParam&&(l+=c.value.sortParam+"&"),c.value.toggleParam&&(l+=c.value.toggleParam+"&"),axios.get(Y.value+"/?"+l).then(a=>{De(a.data)})}},qe=()=>{if(!(k.value==null||w.value==!0)){w.value=!0;var l="";c.value.searchParam&&(l+=c.value.searchParam+"&"),c.value.sortParam&&(l+=c.value.sortParam+"&"),c.value.toggleParam&&(l+=c.value.toggleParam+"&"),axios.get(k.value+"&"+l).then(a=>{a.data.files.forEach(h=>{v.value.push(h)}),k.value=a.data.next,w.value=!1})}},Je=()=>{Pe(G.value),ce.value.focus()},Pe=l=>{l.showModal(),l.addEventListener("click",Ie)},Ie=l=>{let a=l.target.getBoundingClientRect();!(a.top<=l.clientY&&l.clientY<=a.top+a.height&&a.left<=l.clientX&&l.clientX<=a.left+a.width)&&l.target.tagName==="DIALOG"&&ue(l.target)},ue=l=>{W.value||(l.removeEventListener("click",Ie),l.close())},Se=()=>{if(W.value)return;let l={};W.value=!0,l.name=q.value,l.visibility_id=z.value,L.value&&(l.folder_id=L.value.id),axios.post(de.value,l).then(a=>{q.value=null,z.value=1,W.value=!1,v.value.unshift(a.data.folder),ae.value[a.data.folder.id]=a.data.folder.name,ue(G.value)})},Qe=()=>{if(be.value)return;let l=v.value.filter(h=>h.is_selected).map(h=>h.id);if(l.length===0)return;be.value=!0;let a={};F.value&&(F.value==="0"?a.folder_home=1:a.folder_id=F.value),H.value&&(a.visibility_id=H.value),a.files=l,axios.post(fe.value,a).then(h=>{be.value=!1,a.folder_home&&(console.log("move home"),v.value.filter(M=>M.is_selected).forEach(M=>{D.value.unshift(M)})),F.value&&(v.value=v.value.filter(b=>!b.is_selected),O.value&&(D.value=D.value.filter(b=>!b.is_selected))),H.value&&v.value.forEach(b=>{l.includes(b.id)&&(b.visibility_id=H.value)}),F.value=null,H.value=null,g.value=!1,D.value.filter(b=>b.is_selected).forEach(b=>{b.is_selected=!1}),window.showToast(h.data.toast),ue(y.value)})},Ze=()=>{R.value.click()},el=async l=>{const a=l.target.files[0],h=l.target.files;if(!h){J.value=!1;return}const d=new FileReader;d.onload=M=>{se.value=M.target.result},d.readAsDataURL(a),J.value=!0,xe.value=axios.CancelToken.source(),R.value.disabled=!0;const b=new FormData;L.value&&b.append("folder_id",L.value.id),Array.from(h).forEach(M=>{b.append("files[]",M)}),axios.post(Le.value,b,{headers:{"Content-Type":"multipart/form-data"},cancelToken:xe.value.token,onUploadProgress:function(M){He.value=Math.round(M.loaded*100/M.total)}}).then(M=>{J.value=!1,R.value.disabled=!1,R.value=null,se.value=null;const hl=j=>j.is_folder,Ve=v.value.map((j,ml)=>hl(j)?ml:-1).filter(j=>j!==-1).pop();M.data.files.forEach(j=>{Ve!==void 0?v.value.splice(Ve+1,0,j):v.value.push(j)}),Z.value=M.data.used}).catch(M=>{console.error(M),J.value=!1,R.value.disabled=!1,se.value=null,axios.isCancel(M)?R.value=null:ll(M)})},ll=l=>{if(!l.response)return;if(l.response.data.error){window.showToast(l.response.data.error,"error");return}if(l.response&&l.response.status===403&&l.response.data.message){window.showToast(p.value.unauthorized,"error");return}Object.keys(l.response.data.errors).forEach(h=>{window.showToast(l.response.data.errors[h][0],"error")})},Ue=()=>{let l=v.value.filter(a=>a.is_selected).length;if(l!==0)return"("+l+")"},al=()=>He.value+"%",sl=()=>{xe.value.cancel("Upload canceled by user.")},tl=l=>{},nl=(l,a)=>{v.value=v.value.filter(h=>h.id!==l.id),_.value=null,l.is_folder&&(l.folder_id||he()),Z.value=a},il=()=>{_.value=null},ol=()=>{if(_.value===L.value){_.value=null;return}_.value=L.value},ul=()=>{Q.value=!Q.value},rl=()=>{ve.value=!ve.value},Be=()=>{Q.value=!1,ve.value=!1},dl=()=>{if(!te.value){c.value.toggleParam="",he();return}console.log("filter"),m.value=!0,c.value.toggleParam="unused=1";var l="";c.value.searchParam&&(l+=c.value.searchParam+"&"),c.value.sortParam&&(l+=c.value.sortParam+"&"),c.value.toggleParam&&(l+=c.value.toggleParam+"&"),axios.get(Y.value+"/?"+l).then(a=>{De(a.data)})},ye=(l="default")=>{l=="asc"?(ie.value=!1,pe.value=!1,ne.value=!0):l=="desc"?(ne.value=!1,pe.value=!1,ie.value=!0):l=="default"&&(ne.value=!1,ie.value=!1,pe.value=!0),m.value=!0,c.value.sortParam="sort="+l;var a="";c.value.searchParam&&(a+=c.value.searchParam+"&"),c.value.sortParam&&(a+=c.value.sortParam+"&"),c.value.toggleParam&&(a+=c.value.toggleParam+"&");let h=Y.value;L.value?.open&&(h=L.value.open),axios.get(h+"/?"+a).then(d=>{cl(d.data)})},cl=l=>{v.value=l.files,k.value=l.next,m.value=!1},De=l=>{v.value=l.files,k.value=l.next,L.value=null,m.value=!1},fl=()=>Ee(Z.value),vl=()=>Ee(ke.value),Ee=l=>l==0?"0":l>1e6?(l/(1024*1024)).toFixed(2)+" GiB":l>1e3?(l/1024).toFixed(2)+" MiB":(l*1).toFixed(2)+" KiB",pl=()=>{let l="rounded h-2 transition-all duration-300",a=Me();return a<60?l+" bg-primary":a<90?l+" bg-orange-400":l+" bg-red-500"},Me=()=>Math.round(Z.value/ke.value*100),gl=()=>se.value!==null;return(l,a)=>{const h=kl("click-outside");return s(),t(A,null,[o.value?(s(),t("div",Aa,[e("div",za,[e("div",Ra,[e("div",Ka,[a[11]||(a[11]=e("i",{class:"fa-regular fa-cloud text-xl","aria-hidden":"true"},null,-1)),e("span",{class:"font-extrabold",innerHTML:p("storage")},null,8,Xa)]),e("div",Ya,[e("span",{innerHTML:fl()},null,8,Oa),e("span",{innerHTML:p("of")},null,8,Wa),e("span",{innerHTML:vl()},null,8,Ga)]),e("div",qa,[e("div",{class:re(pl()),style:I({width:Me()+"%"})},null,6)])]),!S.value||Me()>89&&(f.value||$.value)?(s(),t("div",Ja,[e("a",{href:$e.value,innerHTML:p("upgrade"),class:"btn2 btn-default"},null,8,Qa)])):u("",!0)]),e("div",Za,[e("div",es,[e("div",ls,[e("input",{type:"text",placeholder:"Search",onInput:We},null,32)]),e("div",as,[e("button",{class:"btn2 btn-default btn-sm",onClick:ul},[a[12]||(a[12]=e("i",{class:"fa-regular fa-filter","aria-hidden":"true"},null,-1)),e("span",{innerHTML:p("filters"),class:"hidden md:inline"},null,8,ss),te.value?(s(),t("span",ts,"(1)")):u("",!0)]),Q.value?U((s(),t("div",ns,[e("div",is,[U(e("input",{type:"checkbox","onUpdate:modelValue":a[0]||(a[0]=d=>te.value=d),value:"1",id:"_show_unused",onChange:dl},null,544),[[Ne,te.value]]),e("label",{for:"_show_unused",class:"cursor-pointer",innerHTML:p("filter_only_unused")},null,8,os)])])),[[h,Be]]):u("",!0)]),e("div",us,[e("button",{class:"btn2 btn-default btn-sm",onClick:rl},[a[13]||(a[13]=e("i",{class:"fa-regular fa-arrow-up-arrow-down","aria-hidden":"true"},null,-1)),e("span",{innerHTML:p("sort"),class:"hidden md:inline"},null,8,rs),ne.value||ie.value?(s(),t("span",ds,"(1)")):u("",!0)]),ve.value?U((s(),t("div",cs,[e("ul",fs,[e("li",null,[e("span",{class:"cursor-pointer flex items-center gap-2 px-2 py-2 rounded hover:bg-gray-100 transition",onClick:a[1]||(a[1]=d=>ye("default"))},[pe.value?(s(),t("i",vs)):u("",!0),e("span",{innerHTML:p("sort_default"),class:"inline"},null,8,ps)])]),e("li",null,[e("span",{class:"cursor-pointer flex items-center gap-2 px-2 py-2 rounded hover:bg-gray-100 transition",onClick:a[2]||(a[2]=d=>ye("asc"))},[ne.value?(s(),t("i",gs)):u("",!0),e("span",{innerHTML:p("sort_asc"),class:"inline"},null,8,hs)])]),e("li",null,[e("span",{class:"cursor-pointer flex items-center gap-2 px-2 py-2 rounded hover:bg-gray-100 transition",onClick:a[3]||(a[3]=d=>ye("desc"))},[ie.value?(s(),t("i",ms)):u("",!0),e("span",{innerHTML:p("sort_desc"),class:"inline"},null,8,_s)])])])])),[[h,Be]]):u("",!0)])]),e("div",bs,[!g.value&&L.value?(s(),t("button",{key:0,class:"btn2 btn-default btn-sm",onClick:ol},[a[14]||(a[14]=e("i",{class:"fa-regular fa-clipboard","aria-hidden":"true"},null,-1)),e("span",{innerHTML:p("details")},null,8,xs)])):u("",!0),!g.value&&P.value?(s(),t("button",{key:1,class:"btn2 btn-default btn-sm",onClick:Je},[a[15]||(a[15]=e("i",{class:"fa-regular fa-plus","aria-hidden":"true"},null,-1)),e("span",{innerHTML:p("new_folder")},null,8,ks)])):u("",!0),!g.value&&P.value?(s(),t("button",{key:2,class:"btn2 btn-default btn-sm",onClick:ze},[a[16]||(a[16]=e("i",{class:"fa-regular fa-list-check","aria-hidden":"true"},null,-1)),e("span",{innerHTML:p("select")},null,8,ys)])):u("",!0),g.value?(s(),t("button",{key:3,class:"btn2 btn-primary btn-sm",onClick:Ke},[a[17]||(a[17]=e("i",{class:"fa-regular fa-pencil","aria-hidden":"true"},null,-1)),e("span",{innerHTML:p("update")},null,8,Ms),e("span",{innerHTML:Ue()},null,8,Ts)])):u("",!0),g.value?(s(),t("button",{key:4,class:"btn2 btn-error btn-sm",onClick:Ye},[a[18]||(a[18]=e("i",{class:"fa-regular fa-trash-can","aria-hidden":"true"},null,-1)),e("span",{innerHTML:p("remove")},null,8,ws),e("span",{innerHTML:Ue()},null,8,Ls)])):u("",!0),g.value?(s(),t("button",{key:5,class:"btn2 btn-default btn-sm",onClick:Re},[a[19]||(a[19]=e("i",{class:"fa-solid fa-xmark","aria-hidden":"true"},null,-1)),e("span",{innerHTML:p("cancel")},null,8,Hs)])):u("",!0)])]),m.value?(s(),t("div",$s,a[20]||(a[20]=[e("i",{class:"fa-solid fa-spinner fa-spin","aria-label":"Loading"},null,-1)]))):(s(),t("div",Cs,[L.value?(s(),t("div",Fs,[e("a",{onClick:he,innerHTML:p("home"),class:"text-base-content cursor-pointer"},null,8,Ps),(s(!0),t(A,null,K(V.value,(d,b)=>(s(),t("span",Is,[a[21]||(a[21]=e("i",{class:"fa-solid fa-chevron-right text-base","aria-hidden":"true"},null,-1)),e("a",{onClick:M=>Fe(d),innerHTML:d.name,class:"text-base-content cursor-pointer"},null,8,Ss)]))),256))])):u("",!0),e("div",Us,[e("div",{class:re(Xe())},[B.value&&!te.value?(s(),t("div",{key:0,class:"rounded-xl shadow bg-base-100 overflow-hidden col-span-2 sm:col-span-3 md:w-48 cursor-pointer flex justify-center items-center flex-col gap-4",onClick:Ze},[J.value?gl()?(s(),t("div",{key:1,class:"cover-background w-full h-full flex p-2",style:I({backgroundImage:"url('"+se.value+"')"})},[e("div",Vs,[e("div",{class:"h-1 bg-accent shadow-xs",role:"progressbar","aria-valuenow":"0","aria-valuemin":"0","aria-valuemax":"100",style:I({width:al()})},a[24]||(a[24]=[e("span",{class:"sr-only"},null,-1)]),4)])],4)):u("",!0):(s(),t("div",Bs,[a[23]||(a[23]=e("div",{class:"flex flex-col gap-2 items-center"},[e("i",{class:"fa-regular fa-image text-4xl text-neutral-content","aria-hidden":"true"}),e("span",null,"Upload files")],-1)),e("div",Ds,[a[22]||(a[22]=e("i",{class:"fa-regular fa-info-circle mr-1 text-base","aria-hidden":"true"},null,-1)),e("span",{innerHTML:p("upload_hint"),class:"text-neutral-content"},null,8,Es)])])),e("input",{type:"file",multiple:"",accept:"image/*, .gif, .webp, .woff2",class:"hidden",onChange:el,ref_key:"fileField",ref:R},null,544)])):u("",!0),(s(!0),t(A,null,K(v.value,d=>(s(),yl(jl,{file:d,isBulking:g.value,i18n:N.value,onSelect:b=>Oe(d)},null,8,["file","isBulking","i18n","onSelect"]))),256))],2),_.value?(s(),t("div",Ns,[Ml(Na,{file:_.value,visibilities:r.value,premium:S.value,canManage:P.value,i18n:N.value,onUpdated:tl,onDeleted:nl,onClosed:il},null,8,["file","visibilities","premium","canManage","i18n"])])):u("",!0)])]))])):(s(),t("div",ja,a[10]||(a[10]=[e("i",{class:"fa-solid fa-spinner fa-spin","aria-label":"Loading"},null,-1)]))),e("div",{ref_key:"infiniteScrollTrigger",ref:oe,class:"h-4"},[w.value?(s(),t("div",js,a[25]||(a[25]=[e("i",{class:"fa-solid fa-spinner fa-spin","aria-label":"Loading"},null,-1)]))):u("",!0)],512),o.value?(s(),t("dialog",{key:2,ref_key:"newDialog",ref:G,class:"dialog rounded-2xl text-center bg-base-100 text-base-content"},[e("header",As,[e("h4",{innerHTML:p("new_folder"),class:"text-lg font-normal"},null,8,zs),e("button",{type:"button",class:"text-base-content",onClick:a[4]||(a[4]=d=>ue(G.value)),title:"Close"},a[26]||(a[26]=[e("i",{class:"fa-regular fa-circle-xmark","aria-hidden":"true"},null,-1),e("span",{class:"sr-only"},"Close",-1)]))]),e("article",Rs,[e("div",Ks,[e("label",{innerHTML:p("name")},null,8,Xs),U(e("input",{type:"text",class:"w-full","onUpdate:modelValue":a[5]||(a[5]=d=>q.value=d),ref_key:"folderNameField",ref:ce,onKeyup:Tl(Se,["enter"])},null,544),[[Ae,q.value]])]),e("div",Ys,[e("label",{innerHTML:p("visibility")},null,8,Os),U(e("select",{class:"w-full","onUpdate:modelValue":a[6]||(a[6]=d=>z.value=d)},[(s(!0),t(A,null,K(r.value,(d,b)=>(s(),t("option",{value:b,innerHTML:d},null,8,Ws))),256))],512),[[me,z.value]])])]),e("footer",Gs,[e("menu",qs,[e("button",{type:"submit",class:"btn2 btn-primary",onClick:Se,innerHTML:p("create")},null,8,Js)])])],512)):u("",!0),o.value?(s(),t("dialog",{key:3,ref_key:"updateDialog",ref:y,class:"dialog rounded-2xl text-center bg-base-100 text-base-content"},[e("header",Qs,[e("h4",{innerHTML:p("update"),class:"text-lg font-normal"},null,8,Zs),e("button",{type:"button",class:"text-base-content",onClick:a[7]||(a[7]=d=>ue(y.value)),title:"Close"},a[27]||(a[27]=[e("i",{class:"fa-regular fa-circle-xmark","aria-hidden":"true"},null,-1),e("span",{class:"sr-only"},"Close",-1)]))]),e("article",et,[e("div",lt,[e("label",{innerHTML:p("visibility")},null,8,at),U(e("select",{class:"w-full","onUpdate:modelValue":a[8]||(a[8]=d=>H.value=d)},[(s(!0),t(A,null,K(i.value,(d,b)=>(s(),t("option",{value:b,innerHTML:d},null,8,st))),256))],512),[[me,H.value]])]),e("div",tt,[e("label",{innerHTML:p("folder")},null,8,nt),U(e("select",{class:"w-full","onUpdate:modelValue":a[9]||(a[9]=d=>F.value=d)},[(s(!0),t(A,null,K(ae.value,(d,b)=>(s(),t("option",{value:b,innerHTML:d},null,8,it))),256))],512),[[me,F.value]])])]),e("footer",ot,[e("menu",ut,[e("button",{type:"submit",class:"btn2 btn-primary",onClick:Qe,innerHTML:p("change")},null,8,rt)])])],512)):u("",!0)],64)}}}),we=wl({});we.component("gallery",dt);we.use(Ll);we.mount("#gallery");

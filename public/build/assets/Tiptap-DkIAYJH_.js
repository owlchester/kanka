const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/GalleryDialog-CfkNdZHJ.js","assets/vendor-tiptap-ma1rWYJ-.js","assets/index-D5GkNzM3.js","assets/_plugin-vue_export-helper-DlAUqK2U.js","assets/GalleryDialog-SGgOgWve.css","assets/SourceEditor-CTi5qB8u.js","assets/SourceEditor-BKF0zshA.css"])))=>i.map(i=>d[i]);
import{_ as de}from"./preload-helper-I4rgV-VL.js";import{T as Le,U as Te,V as Me,W as _,X as ie,Y as ve,Z as re,d as O,D as X,a as h,c as v,F as j,r as J,b as s,e as x,g as D,t as se,f as S,h as R,y as B,_ as ye,$ as xe,a0 as we,a1 as ke,a2 as Ce,a3 as oe,a4 as $e,a5 as He,a6 as Ie,w as N,v as Y,p as y,u as b,o as Fe,E as Ae,n as te,B as le,j as Ee,k as U,I as Se,a7 as Re,a8 as De,a9 as Be,aa as Pe,ab as Ue,ac as je,ad as Ke,ae as Oe,af as ze,ag as Ne,ah as Ve,ai as qe,i as ce,s as G,aj as Z,ak as fe,al as We,P as ge}from"./vendor-tiptap-ma1rWYJ-.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{a as Ge}from"./index-D5GkNzM3.js";const Ze=Le.extend({addAttributes(){return{...this.parent?.(),colwidth:{default:null,parseHTML:e=>{const l=e.getAttribute("colwidth");if(l)return l.split(",").map(i=>parseInt(i,10));const n=e.style.width;return n&&n.endsWith("px")?[parseInt(n,10)]:null},renderHTML:e=>e.colwidth?{colwidth:e.colwidth.join(","),style:`width: ${e.colwidth[0]}px`}:{}}}}}),Je=Te.extend({addAttributes(){return{...this.parent?.(),colwidth:{default:null,parseHTML:e=>{const l=e.getAttribute("colwidth");if(l)return l.split(",").map(i=>parseInt(i,10));const n=e.style.width;return n&&n.endsWith("px")?[parseInt(n,10)]:null},renderHTML:e=>e.colwidth?{colwidth:e.colwidth.join(","),style:`width: ${e.colwidth[0]}px`}:{}}}}}),Qe=Me.extend({addAttributes(){return{...this.parent?.(),class:{default:null,parseHTML:e=>e.getAttribute("class"),renderHTML:e=>e.class?{class:e.class}:{}}}},renderHTML({HTMLAttributes:e}){return["table",_(this.options.HTMLAttributes,e),["tbody",0]]}}),Xe=new re("mention"),Ye=ie.create({name:"mention",addOptions(){return{HTMLAttributes:{},renderLabel({options:e,node:l}){return l.attrs.label||l.attrs.name||l.attrs.id},suggestion:{char:"@",pluginKey:Xe,command:({editor:e,range:l,props:n})=>{e.view.state.selection.$to.nodeAfter?.text?.startsWith(" ")&&(l.to+=1);const a=n.section==="entities"?n.mention:n.inject;e.chain().focus().insertContentAt(l,[{type:"text",text:a},{type:"text",text:" "}]).run(),window.getSelection()?.collapseToEnd()},allow:({state:e,range:l})=>{const n=e.doc.resolve(l.from),i=e.schema.nodes[this.name];return!!n.parent.type.contentMatch.matchType(i)}}}},group:"inline",inline:!0,selectable:!0,atom:!0,draggable:!0,addAttributes(){return{id:{default:null,parseHTML:e=>e.getAttribute("data-id"),renderHTML:e=>e.id?{"data-id":e.id}:{}},label:{default:null,parseHTML:e=>e.getAttribute("data-label"),renderHTML:e=>({})},name:{default:null,parseHTML:e=>e.getAttribute("data-name"),renderHTML:e=>e.name?{"data-name":e.name}:{}},mention:{default:null,parseHTML:e=>e.getAttribute("data-mention"),renderHTML:e=>{if(!e.mention)return{};const l=[`${e.mention}`];return e.label&&l.push(e.label),e.config&&l.push(e.config),{"data-mention":`[${l.join("|")}]`}}},image:{default:null,parseHTML:e=>e.getAttribute("data-image"),renderHTML:e=>({})},entity:{default:null,parseHTML:e=>e.getAttribute("data-entity"),renderHTML:e=>({})},url:{default:null,parseHTML:e=>e.getAttribute("data-url"),renderHTML:e=>({})},config:{default:null,parseHTML:e=>e.getAttribute("data-config"),renderHTML:e=>e.config?{"data-config":e.config}:{"data-config":""}}}},parseHTML(){return[{tag:"span[data-mention]"}]},renderHTML({node:e,HTMLAttributes:l}){const n=this.options.renderLabel({options:this.options,node:e}),i=[];if(e.attrs.image&&i.push(["img",{src:e.attrs.image,class:"inline-block w-4 h-4 rounded-full object-cover mr-1 align-middle",alt:n}]),i.push(n),e.attrs.config){const a=e.attrs.config.split("|").find(d=>d.startsWith("alias:"));if(a){const d=a.split(":")[1],c=e.attrs.entity.aliases.find(o=>o.id===parseInt(d));c&&(i.push(["i",{class:"fa-regular fa-masks-theater"}]),i.push(`(${c.name})`))}}return["a",_({"data-type":"mention"},this.options.HTMLAttributes,l),["span",{class:"rounded-xl bg-base-200 hover:bg-base-300 text-base-content px-2 py-0.5 inline-flex items-center gap-1 cursor-pointer"},...i]]},renderText({node:e}){return e.attrs.mention||`[${e.attrs.label}]`},addKeyboardShortcuts(){return{Backspace:()=>this.editor.commands.command(({tr:e,state:l})=>{let n=!1;const{selection:i}=l,{empty:u,anchor:a}=i;return u?(l.doc.nodesBetween(a-1,a,(d,c)=>{if(d.type.name===this.name)return n=!0,e.insertText(this.options.suggestion.char||"",c,c+d.nodeSize),!1}),n):!1})}},addProseMirrorPlugins(){return[ve({editor:this.editor,...this.options.suggestion})]}}),_e={class:"mention-list bg-base-100 shadow-lg rounded-lg z-50 max-h-[300px] overflow-y-auto"},et={class:"section-header px-3 py-1 text-xs font-semibold text-neutral-content/70 bg-base-200/50 flex items-center gap-2"},tt=["onClick"],nt={class:"flex gap-2 items-center"},st={key:0,class:"fa-regular fa-plus text-success","aria-hidden":"true"},lt=["src","alt"],it=["innerHTML"],rt=["innerHTML"],ot=["innerHTML"],at={key:1,class:"px-3 py-2 text-neutral-content text-xs"},ut={key:0},dt={key:1},ct={key:2},ft=O({__name:"MentionList",props:{items:{},command:{type:Function},loading:{type:Boolean},query:{}},setup(e,{expose:l}){const n=e,i=R(0);X(()=>n.items,()=>{i.value=0});const u={entities:{label:"Entities",icon:"fa-regular fa-bookmark"},posts:{label:"Posts",icon:"fa-regular fa-newspaper"},attributes:{label:"Attributes",icon:"fa-regular fa-heart"},new:{label:"Create New",icon:"fa-regular fa-plus"}},a=B(()=>["entities","posts","attributes","new"].map(m=>({key:m,label:u[m].label,icon:u[m].icon,items:n.items.filter(A=>A.section===m)})).filter(m=>m.items.length>0)),d=B(()=>n.query.length<3),c=B(()=>!d.value&&n.loading),o=B(()=>!d.value&&!n.loading&&n.items.length===0),w=({event:L})=>L.key==="ArrowUp"?(M(),!0):L.key==="ArrowDown"?(F(),!0):L.key==="Enter"?(C(),!0):!1,M=()=>{i.value=(i.value+n.items.length-1)%n.items.length},F=()=>{i.value=(i.value+1)%n.items.length},C=()=>{k(i.value)},k=L=>{const m=n.items[L];m&&n.command(m)},H=(L,m)=>{let A=0;for(const T of a.value){if(T.key===L)return A+m;A+=T.items.length}return A};return l({onKeyDown:w}),(L,m)=>(h(),v("div",_e,[e.items.length?(h(!0),v(j,{key:0},J(a.value,A=>(h(),v("div",{key:A.key,class:"mention-section"},[s("div",et,[s("i",{class:x(A.icon),"aria-hidden":"true"},null,2),D(" "+se(A.label),1)]),(h(!0),v(j,null,J(A.items,(T,f)=>(h(),v("button",{key:T.id??`${A.key}-${f}`,onClick:g=>k(H(A.key,f)),class:x(["mention-item flex items-center gap-2 w-full text-left px-3 py-2 hover:bg-base-200 text-xs justify-between cursor-pointer",{"bg-base-200":H(A.key,f)===i.value}])},[s("div",nt,[A.key==="new"?(h(),v("i",st)):T.image?(h(),v("img",{key:1,src:T.image,alt:T.name,loading:"lazy",class:"w-6 h-6 rounded-full object-cover"},null,8,lt)):S("",!0),s("span",{class:"mention-name",innerHTML:T.name},null,8,it)]),T.type?(h(),v("span",{key:0,class:"mention-type text-neutral-content",innerHTML:T.type},null,8,rt)):S("",!0),T.value?(h(),v("span",{key:1,class:"text-neutral-content",innerHTML:T.value},null,8,ot)):S("",!0)],10,tt))),128))]))),128)):(h(),v("div",at,[d.value?(h(),v("span",ut," Type at least 3 characters ")):c.value?(h(),v("span",dt,[...m[0]||(m[0]=[s("i",{class:"fa-solid fa-spinner fa-spin","aria-hidden":"true"},null,-1),D(" Loading... ",-1)])])):o.value?(h(),v("span",ct," No results ")):S("",!0)]))]))}}),gt=ae(ft,[["__scopeId","data-v-d6739cd7"]]),me=(e,l)=>{xe({getBoundingClientRect:()=>Ce(e.view,e.state.selection.from,e.state.selection.to)},l,{placement:"bottom-start",strategy:"absolute",middleware:[we(),ke()]}).then(({x:i,y:u,strategy:a})=>{l.style.width="max-content",l.style.position=a,l.style.left=`${i}px`,l.style.top=`${u}px`})},mt=(e,l)=>{let n=null;return{char:"@",items:async({query:i})=>{if(i.length<3)return[];n&&n.abort(),n=new AbortController;try{const u=new URL(e);u.searchParams.set("q",i);const a=await fetch(u.toString(),{signal:n.signal});if(!a.ok)return[];const d=await a.json(),c=[];return d.entities?.length&&d.entities.forEach(o=>{c.push({id:o.id,name:o.name,image:o.image,url:o.url,aliases:o.aliases,mention:o.mention,type:o.type,section:"entities"})}),d.posts?.length&&d.posts.forEach(o=>{c.push({id:o.id,name:o.name,inject:o.inject,section:"posts"})}),d.attributes?.length&&d.attributes.forEach(o=>{c.push({id:o.id,name:o.name,value:o.value,inject:o.inject,section:"attributes"})}),d.new?.length&&d.new.forEach(o=>{c.push({name:o.name,type:o.type,inject:o.inject,section:"new"})}),c}catch(u){return u.name==="AbortError"?[]:(console.error("Error fetching mentions:",u),[])}},render:()=>{let i;return{onStart:u=>{i=new ye(gt,{props:{items:u.items,command:a=>{l&&a.section==="entities"&&l({id:parseInt(a.id),name:a.name,type:a.type,image:a.image,url:a.url,aliases:a.aliases}),u.command(a)},loading:u.query&&u.query.length>=3,query:u.query||""},editor:u.editor}),u.clientRect&&(i.element.style.position="absolute",document.body.appendChild(i.element),me(u.editor,i.element))},onUpdate(u){const a=u.query&&u.query.length>=3&&u.items.length===0,d=c=>{l&&c.section==="entities"&&l({id:parseInt(c.id),name:c.name,type:c.type,image:c.image,url:c.url,aliases:c.aliases}),u.command(c)};i.updateProps({items:u.items,command:d,loading:a,query:u.query||""}),u.clientRect&&me(u.editor,i.element)},onKeyDown(u){return u.event.key==="Escape"?(i.destroy(),!0):i.ref?.onKeyDown(u)},onExit(){i.destroy()}}}}},pt=new re("mentionParser"),ht=oe.create({name:"mentionParser",addOptions(){return{entities:[]}},addProseMirrorPlugins(){return[new $e({key:pt,appendTransaction:(e,l,n)=>{if(!e.some(o=>o.docChanged))return null;const u="value"in this.options.entities?this.options.entities.value:this.options.entities||[],a=n.tr;let d=!1;const c=/\[([a-zA-Z_]+):(\d+)(?:\|[^\]]+)?\]/g;return n.doc.descendants((o,w)=>{if(o.isText&&o.text){const M=o.text;let F;const C=[];for(;(F=c.exec(M))!==null;){const k=F[0],H=F[1],L=F[2];if(H==="post")continue;const m=`${H}:${L}`;let A,T;const f=k.indexOf("|");if(f!==-1){const g=k.substring(f+1,k.length-1).split("|"),t=[];for(const r of g)r.includes(":")?t.push(r):A||(A=r);t.length>0&&(T=t.join("|"))}C.push({start:w+F.index,end:w+F.index+F[0].length,mention:m,module:H,id:L,customLabel:A,config:T})}for(let k=C.length-1;k>=0;k--){const{start:H,end:L,mention:m,module:A,id:T,customLabel:f,config:g}=C[k],t=a.mapping.map(H),r=a.mapping.map(L);if(a.doc.resolve(t),a.doc.nodeAt(t)?.type.name!=="mention"){const E=n.schema.nodes.mention;if(E){const I=u.find(K=>K.id===parseInt(T));I?I.name:`${A}${T}`;const z=f||"",P=I?.image||null,V=I?.url||null,q=E.create({id:T,name:I?I.name:`${A}:${T}`,label:z,mention:m,image:P,url:V,config:g||null,entity:I});a.replaceWith(t,r,q),d=!0}}}}}),d?a:null}})]}}),bt=new re("slashCommand"),vt=oe.create({name:"slashCommand",addOptions(){return{suggestion:{char:"/",pluginKey:bt,command:({editor:e,range:l,props:n})=>{e.chain().focus().deleteRange(l).run(),n.command(e)}}}},addProseMirrorPlugins(){return[ve({editor:this.editor,...this.options.suggestion})]}}),yt={class:"slash-command-list bg-base-100 shadow-lg rounded-lg z-50 max-h-[300px] overflow-y-auto min-w-[200px]"},xt=["onClick"],wt={class:"w-6 h-6 rounded bg-base-200 flex items-center justify-center"},kt={class:"flex flex-col"},Ct={class:"font-medium text-sm"},Ft={class:"text-xs text-neutral-content"},At={key:1,class:"px-3 py-2 text-neutral-content text-sm"},Lt=O({__name:"SlashCommandList",props:{items:{},command:{type:Function}},setup(e,{expose:l}){const n=e,i=R(0);X(()=>n.items,()=>{i.value=0});const u=({event:w})=>w.key==="ArrowUp"?(a(),!0):w.key==="ArrowDown"?(d(),!0):w.key==="Enter"?(c(),!0):!1,a=()=>{i.value=(i.value+n.items.length-1)%n.items.length},d=()=>{i.value=(i.value+1)%n.items.length},c=()=>{o(i.value)},o=w=>{const M=n.items[w];M&&n.command(M)};return l({onKeyDown:u}),(w,M)=>(h(),v("div",yt,[e.items.length?(h(!0),v(j,{key:0},J(e.items,(F,C)=>(h(),v("button",{key:F.title,onClick:k=>o(C),class:x(["slash-command-item flex items-center gap-2 w-full text-left px-3 py-2 hover:bg-base-300 text-sm cursor-pointer",{"bg-base-300":C===i.value}])},[s("div",wt,[s("i",{class:x([F.icon,"text-xs"]),"aria-hidden":"true"},null,2)]),s("div",kt,[s("span",Ct,se(F.title),1),s("span",Ft,se(F.description),1)])],10,xt))),128)):(h(),v("div",At," No commands found "))]))}}),Tt=ae(Lt,[["__scopeId","data-v-aa19753b"]]),pe=(e,l)=>{xe({getBoundingClientRect:()=>Ce(e.view,e.state.selection.from,e.state.selection.to)},l,{placement:"bottom-start",strategy:"absolute",middleware:[we(),ke()]}).then(({x:i,y:u,strategy:a})=>{l.style.width="max-content",l.style.position=a,l.style.left=`${i}px`,l.style.top=`${u}px`})},Mt=`
  <table class="table table-striped table-bordered" style="width: 200px;">
    <thead>
        <tr>
            <th></th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        <tr>
          <td></td>
          <td></td>
        </tr>
        <tr>
          <td></td>
          <td></td>
        </tr>
    </tbody>
  </table>`,$t=[{title:"Source",description:"Edit raw HTML source",icon:"fa-regular fa-code",command:e=>{window.dispatchEvent(new CustomEvent("tiptap:source-mode"))}},{title:"Gallery",description:"Insert an image from gallery",icon:"fa-regular fa-images",searchTerms:["image","photo","picture","media"],command:e=>{e.commands.openGallery()}},{title:"Insert Media",description:"Upload an image from your device",icon:"fa-regular fa-upload",searchTerms:["image","photo","picture","media","upload","file"],command:e=>{e.commands.uploadMedia()}},{title:"Table",description:"Insert a table",icon:"fa-regular fa-table",command:e=>{e.chain().focus().insertContent(Mt,{parseOptions:{preserveWhitespace:!0}}).run()}},{title:"Heading 1",description:"Huge heading",icon:"fa-regular fa-heading",command:e=>{e.chain().focus().toggleHeading({level:1}).run()}},{title:"Heading 2",description:"Large heading",icon:"fa-regular fa-heading",command:e=>{e.chain().focus().toggleHeading({level:2}).run()}},{title:"Heading 3",description:"Medium heading",icon:"fa-regular fa-heading",command:e=>{e.chain().focus().toggleHeading({level:3}).run()}},{title:"Bullet List",description:"Create a bullet list",icon:"fa-regular fa-list-ul",command:e=>{e.chain().focus().toggleBulletList().run()}},{title:"Numbered List",description:"Create a numbered list",icon:"fa-regular fa-list-ol",command:e=>{e.chain().focus().toggleOrderedList().run()}},{title:"Task List",description:"Create a checklist",icon:"fa-regular fa-square-check",searchTerms:["checkbox","checklist","todo","task"],command:e=>{e.chain().focus().toggleTaskList().run()}},{title:"Quote",description:"Insert a quote block",icon:"fa-regular fa-quote-right",command:e=>{e.chain().focus().toggleBlockquote().run()}},{title:"Code Block",description:"Insert a code block",icon:"fa-regular fa-code",command:e=>{e.chain().focus().toggleCodeBlock().run()}},{title:"Horizontal Rule",description:"Insert a divider",icon:"fa-regular fa-minus",command:e=>{e.chain().focus().setHorizontalRule().run()}}],Ht=()=>({items:({query:e})=>{const l=e.toLowerCase();return $t.filter(n=>n.title.toLowerCase().includes(l)||n.searchTerms?.some(i=>i.includes(l)))},render:()=>{let e;return{onStart:l=>{e=new ye(Tt,{props:{items:l.items,command:l.command},editor:l.editor}),l.clientRect&&(e.element.style.position="absolute",document.body.appendChild(e.element),pe(l.editor,e.element))},onUpdate(l){e.updateProps({items:l.items,command:l.command}),l.clientRect&&pe(l.editor,e.element)},onKeyDown(l){return l.event.key==="Escape"?(e.destroy(),!0):e.ref?.onKeyDown(l)},onExit(){e.destroy()}}}}),It=oe.create({name:"gallery",addOptions(){return{galleryUrl:"",galleryId:""}},addCommands(){return{openGallery:()=>({editor:e})=>{const l=new CustomEvent("tiptap:open-gallery",{detail:{editor:e,galleryUrl:this.options.galleryUrl,galleryId:this.options.galleryId}});return window.dispatchEvent(l),!0},uploadMedia:()=>({editor:e})=>{const l=this.options.galleryUrl,n=document.createElement("input");return n.type="file",n.accept="image/png,image/jpg,image/jpeg,image/gif,image/webp",n.onchange=async()=>{const i=n.files?.[0];if(!i)return;const u=new FormData;u.append("file",i);try{const a=await Ge.post(l,u);a.status===200&&a.data&&e.chain().focus().setImage({src:a.data.src,"data-uuid":a.data.uuid}).run()}catch(a){if(a.response?.status===204||a.response?.data){const d=a.response?.data?.errors||a.response?.data||"Upload failed";window.showToast(d,"error")}else window.showToast("Upload failed","error")}},n.click(),!0}}}}),Et=He.extend({name:"image",addAttributes(){return{src:{default:null},alt:{default:null},title:{default:null},"data-gallery-id":{default:null},class:{default:null,parseHTML:e=>(e.getAttribute("class")||"").split(/\s+/).filter(i=>!["note-float-left","note-float-right","float-left","float-right"].includes(i)).join(" ").trim()||null},width:{default:null,parseHTML:e=>{const n=(e.getAttribute("style")||"").match(/width:\s*(\d+(?:\.\d+)?)px/);if(n)return parseFloat(n[1]);const i=e.getAttribute("width");return i?parseFloat(i):null},renderHTML:()=>({})},height:{default:null,parseHTML:e=>{const n=(e.getAttribute("style")||"").match(/height:\s*(\d+(?:\.\d+)?)px/);if(n)return parseFloat(n[1]);const i=e.getAttribute("height");return i?parseFloat(i):null},renderHTML:()=>({})},widthStyle:{default:null,parseHTML:e=>{const n=(e.getAttribute("style")||"").match(/width:\s*(\d+%)/);return n?n[1]:null},renderHTML:()=>({})},floatStyle:{default:null,parseHTML:e=>{const n=(e.getAttribute("style")||"").match(/float:\s*(left|right)/);if(n)return n[1];const i=e.getAttribute("class")||"";return i.includes("note-float-left")||i.includes("float-left")?"left":i.includes("note-float-right")||i.includes("float-right")?"right":null},renderHTML:()=>({})}}},renderHTML({node:e,HTMLAttributes:l}){const{width:n,height:i,widthStyle:u,floatStyle:a}=e.attrs,d=[];u?d.push(`width: ${u}`):n!=null&&d.push(`width: ${typeof n=="number"?`${n}px`:n}`),!u&&i!=null&&d.push(`height: ${typeof i=="number"?`${i}px`:i}`),a&&(d.push(`float: ${a}`),a==="left"&&d.push("margin-right: 0.5rem"),a==="right"&&d.push("margin-left: 0.5rem"));const c=d.length>0?{style:d.join("; ")}:{};return["img",_(this.options.HTMLAttributes,l,c)]},addCommands(){return{...this.parent?.(),setImageWidth:e=>({commands:l})=>l.updateAttributes("image",{widthStyle:e,width:null,height:null}),setImageFloat:e=>({commands:l})=>l.updateAttributes("image",{floatStyle:e})}},addNodeView(){if(!this.options.resize?.enabled||typeof document>"u")return null;const{directions:e,minWidth:l,minHeight:n,alwaysPreserveAspectRatio:i}=this.options.resize;return({node:u,getPos:a,HTMLAttributes:d,editor:c})=>{const o=document.createElement("img");Object.entries(d).forEach(([C,k])=>{if(k!=null)switch(C){case"width":case"height":break;default:o.setAttribute(C,k);break}}),o.src=d.src;const w=(C,k)=>{const{widthStyle:H,floatStyle:L}=C;H?(k.style.width=H,o.style.width="100%",o.style.height="auto"):k.style.width="",k.style.float=L||"",k.style.marginRight=L==="left"?"0.5rem":"",k.style.marginLeft=L==="right"?"0.5rem":""},M=new Ie({element:o,editor:c,node:u,getPos:a,onResize:(C,k)=>{o.style.width=`${C}px`,o.style.height=`${k}px`},onCommit:(C,k)=>{const H=a();H!==void 0&&this.editor.chain().setNodeSelection(H).updateAttributes(this.name,{width:C,height:k,widthStyle:null}).run()},onUpdate:C=>C.type!==u.type?!1:(w(C.attrs,M.dom),!0),options:{directions:e,min:{width:l,height:n},preserveAspectRatio:i===!0}}),F=M.dom;return F.style.visibility="hidden",F.style.pointerEvents="none",o.onload=()=>{F.style.visibility="",F.style.pointerEvents=""},w(u.attrs,F),M}}}),St=ie.create({name:"iframe",group:"block",atom:!0,addOptions(){return{allowFullscreen:!0,HTMLAttributes:{class:"iframe-wrapper relative overflow-hidden max-w-full h-fit"}}},addAttributes(){return{src:{default:null,parseHTML:e=>e.getAttribute("src")},frameborder:{default:0,parseHTML:e=>e.getAttribute("frameborder")||0},allowfullscreen:{default:this.options.allowFullscreen,parseHTML:e=>e.hasAttribute("allowfullscreen")},width:{default:"100%",parseHTML:e=>e.getAttribute("width")||"100%"},height:{default:315,parseHTML:e=>e.getAttribute("height")||315},allow:{default:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",parseHTML:e=>e.getAttribute("allow")},title:{default:null,parseHTML:e=>e.getAttribute("title")},style:{default:null,parseHTML:e=>e.getAttribute("style")}}},parseHTML(){return[{tag:"iframe"}]},renderHTML({HTMLAttributes:e}){return["div",this.options.HTMLAttributes,["iframe",e]]},addCommands(){return{setIframe:e=>({tr:l,dispatch:n})=>{const{selection:i}=l,u=this.type.create(e);return n&&l.replaceRangeWith(i.from,i.to,u),!0}}}}),Rt=ie.create({name:"div",group:"block",content:"block+",defining:!0,addAttributes(){return{class:{default:null,parseHTML:e=>e.getAttribute("class")},style:{default:null,parseHTML:e=>e.getAttribute("style")}}},parseHTML(){return[{tag:"div",getAttrs:e=>e.parentElement?.getAttribute("data-type")==="taskItem"?!1:{}}]},renderHTML({HTMLAttributes:e}){return["div",_(e),0]}}),Dt={class:"flex items-center gap-2 text-xs text-neutral-content px-2"},Bt=["placeholder"],Pt=["href"],Ut={key:1,class:"text-neutral-content flex items-center gap-1"},jt=O({__name:"MentionBubbleMenu",props:{editor:{},mentions:{}},setup(e,{expose:l}){const n=e,i=R(null),u=R(""),a=R(null),d=R(""),c=R(!1);l({syncLabel:()=>{const f=n.editor.getAttributes("mention");f?.entity&&(u.value=f?.label||"")}});const w=()=>{n.editor.chain().focus().deleteSelection().run()},M=()=>{},F=()=>{let f=u.value.trim();const t=n.editor.getAttributes("mention")?.id,r=n.mentions.find(p=>p.id===parseInt(t));f===r?.name&&(f=""),n.editor.chain().focus().updateAttributes("mention",{label:f}).run(),u.value=""},C=f=>{const g=f.relatedTarget;g&&g.closest(".bubble-menu")||F()},k=f=>{f.key==="Enter"?(f.preventDefault(),F()):f.key==="Escape"&&(f.preventDefault(),u.value="",n.editor.commands.focus())},H=()=>{const f=n.editor.getAttributes("mention");d.value=f?.config||"",c.value=!0,setTimeout(()=>{a.value?.focus(),a.value?.select()},10)},L=()=>{const f=d.value.trim();n.editor.chain().focus().updateAttributes("mention",{config:f||null}).run(),c.value=!1,d.value=""},m=f=>{const g=f.relatedTarget;g&&g.closest(".bubble-menu")||L()},A=()=>{n.editor.chain().focus().updateAttributes("mention",{config:null}).run(),c.value=!1,d.value=""},T=f=>{f.key==="Enter"?(f.preventDefault(),L()):f.key==="Escape"&&(f.preventDefault(),c.value=!1,d.value="",n.editor.commands.focus())};return(f,g)=>(h(),v("div",Dt,[c.value?(h(),v(j,{key:0},[N(s("input",{ref_key:"mentionConfigInput",ref:a,"onUpdate:modelValue":g[0]||(g[0]=t=>d.value=t),type:"text",placeholder:"page:abilities|anchor:#ability-1",class:"p-0 px-1 rounded text-xs outline-none focus:ring-1 focus:ring-primary min-w-[250px]",onBlur:m,onKeydown:T},null,544),[[Y,d.value]]),e.editor.getAttributes("mention").config?(h(),v("button",{key:0,onClick:y(A,["prevent"]),class:"hover:text-warning",title:"Clear config"},[...g[2]||(g[2]=[s("i",{class:"fa-regular fa-times"},null,-1)])])):S("",!0)],64)):(h(),v(j,{key:1},[e.editor.getAttributes("mention").entity?(h(),v(j,{key:0},[N(s("input",{ref_key:"mentionLabelInput",ref:i,"onUpdate:modelValue":g[1]||(g[1]=t=>u.value=t),type:"text",placeholder:e.editor.getAttributes("mention").entity.name,class:"p-0 px-1 rounded text-xs outline-none focus:ring-1 focus:ring-primary min-w-[150px]",onFocus:M,onBlur:C,onKeydown:k},null,40,Bt),[[Y,u.value]]),e.editor.getAttributes("mention").url?(h(),v("a",{key:0,class:"text-link",href:e.editor.getAttributes("mention").url,title:"Go to entity"},[...g[3]||(g[3]=[s("i",{class:"fa-regular fa-external-link-alt","aria-hidden":"true"},null,-1)])],8,Pt)):S("",!0)],64)):(h(),v("span",Ut,[...g[4]||(g[4]=[s("i",{class:"fa-regular fa-exclamation-triangle","aria-hidden":"true"},null,-1),D(" Unknown entity ",-1)])])),s("button",{onClick:y(H,["prevent"]),class:x(["hover:text-primary",{"text-primary":e.editor.getAttributes("mention").config}]),title:"Customize mention"},[...g[5]||(g[5]=[s("i",{class:"fa-regular fa-cog","aria-hidden":"true"},null,-1)])],2),s("button",{onClick:y(w,["prevent"]),class:"hover:text-error",title:"Remove mention"},[...g[6]||(g[6]=[s("i",{class:"fa-regular fa-trash","aria-hidden":"true"},null,-1)])])],64))]))}}),Kt={class:"flex gap-2 items-center text-xs text-neutral-content px-2"},Ot=["href"],zt=O({__name:"LinkBubbleMenu",props:{editor:{}},setup(e){const l=e,n=R(null),i=R("");X(()=>l.editor.getAttributes("link").href,o=>{i.value=o||""},{immediate:!0}),X(()=>l.editor.isActive("link")&&l.editor.state.selection.empty,o=>{o&&setTimeout(()=>n.value?.focus(),10)});const u=()=>{if(!i.value){l.editor.chain().focus().extendMarkRange("link").unsetLink().run();return}let o=i.value;/^https?:\/\//i.test(o)||(o="https://"+o),l.editor.chain().focus().extendMarkRange("link").setLink({href:o}).run()},a=()=>{l.editor.chain().focus().extendMarkRange("link").unsetLink().run()},d=()=>{l.editor.getAttributes("link").href?l.editor.commands.focus():l.editor.chain().focus().extendMarkRange("link").unsetLink().run()},c=o=>{o.key==="Enter"?(o.preventDefault(),u()):o.key==="Escape"&&(o.preventDefault(),d())};return(o,w)=>(h(),v("div",Kt,[N(s("input",{ref_key:"linkInputRef",ref:n,"onUpdate:modelValue":w[0]||(w[0]=M=>i.value=M),type:"text",placeholder:"Enter URL...",class:"p-0 px-1 rounded text-xs outline-none focus:ring-1 focus:ring-primary min-w-[200px]",onKeydown:c},null,544),[[Y,i.value]]),e.editor.isActive("link")?(h(),v("a",{key:0,href:e.editor.getAttributes("link").href,target:"_blank",class:"hover:text-base-content",title:"Open in a new window"},[...w[1]||(w[1]=[s("i",{class:"fa-regular fa-external-link-alt"},null,-1)])],8,Ot)):S("",!0),e.editor.isActive("link")?(h(),v("button",{key:1,onClick:y(a,["prevent"]),class:"hover:text-error",title:"Remove link"},[...w[2]||(w[2]=[s("i",{class:"fa-regular fa-unlink","aria-label":"Removal icon"},null,-1)])])):S("",!0)]))}}),$=e=>{const l="px-2 py-1 rounded-lg hover:bg-base-200 block hover:text-base-content ",n=e?"bg-base-300 border-primary text-base-content":"text-neutral-content ";return l+" "+n},Nt={class:"flex gap-1 items-center text-xs text-neutral-content px-2"},Vt=O({__name:"TableBubbleMenu",props:{editor:{}},setup(e){const l=e,n=()=>{const{selection:t}=l.editor.state,{$from:r}=t;for(let p=r.depth;p>0;p--){const E=r.node(p);if(E.type.name==="table")return{node:E,pos:r.before(p)}}return null},i=()=>(n()?.node.attrs.class||"").split(" ").filter(Boolean),u=t=>i().includes(t),a=B(()=>u("table-bordered")),d=B(()=>u("table-striped")),c=B(()=>u("table-left")),o=B(()=>u("table-right")),w=t=>{const r=n();if(!r)return;t.some(E=>E.startsWith("table-"))&&!t.includes("table")&&t.unshift("table");const{tr:p}=l.editor.state;p.setNodeMarkup(r.pos,void 0,{...r.node.attrs,class:t.join(" ")||null}),l.editor.view.dispatch(p)},M=(t,r=[])=>{const p=i(),E=p.filter(I=>!r.includes(I));p.includes(t)?w(E.filter(I=>I!==t)):w([...E,t])},F=()=>M("table-bordered"),C=()=>M("table-striped"),k=()=>M("table-left",["table-right"]),H=()=>M("table-right",["table-left"]),L=()=>{l.editor.chain().focus().addColumnAfter().run()},m=()=>{l.editor.chain().focus().addRowAfter().run()},A=()=>{l.editor.chain().focus().deleteTable().run()},T=()=>{l.editor.chain().focus().deleteRow().run()},f=()=>{l.editor.chain().focus().deleteColumn().run()},g=()=>{l.editor.chain().focus().toggleHeaderRow().run()};return(t,r)=>(h(),v("div",Nt,[s("button",{onClick:y(L,["prevent"]),class:x(b($)(!1)),title:"Add column"},[...r[0]||(r[0]=[s("i",{class:"fa-regular fa-table-columns","aria-hidden":"true"},null,-1),s("i",{class:"fa-regular fa-plus text-[8px]","aria-hidden":"true"},null,-1)])],2),s("button",{onClick:y(m,["prevent"]),class:x(b($)(!1)),title:"Add row"},[...r[1]||(r[1]=[s("i",{class:"fa-regular fa-table-rows","aria-hidden":"true"},null,-1),s("i",{class:"fa-regular fa-plus text-[8px]","aria-hidden":"true"},null,-1)])],2),s("button",{onClick:y(f,["prevent"]),class:x(b($)(!1)),title:"Delete column"},[...r[2]||(r[2]=[s("i",{class:"fa-regular fa-table-columns","aria-hidden":"true"},null,-1),s("i",{class:"fa-regular fa-minus text-[8px]","aria-hidden":"true"},null,-1)])],2),s("button",{onClick:y(T,["prevent"]),class:x(b($)(!1)),title:"Delete row"},[...r[3]||(r[3]=[s("i",{class:"fa-regular fa-table-rows","aria-hidden":"true"},null,-1),s("i",{class:"fa-regular fa-minus text-[8px]","aria-hidden":"true"},null,-1)])],2),s("button",{onClick:y(g,["prevent"]),class:x(b($)(!1)),title:"Toggle header row"},[...r[4]||(r[4]=[s("i",{class:"fa-regular fa-heading","aria-hidden":"true"},null,-1)])],2),r[10]||(r[10]=s("span",{class:"w-px h-4 bg-base-content/20 mx-1"},null,-1)),s("button",{onClick:y(F,["prevent"]),class:x(b($)(a.value)),title:"Toggle bordered"},[...r[5]||(r[5]=[s("i",{class:"fa-regular fa-border-all","aria-hidden":"true"},null,-1)])],2),s("button",{onClick:y(C,["prevent"]),class:x(b($)(d.value)),title:"Toggle striped"},[...r[6]||(r[6]=[s("i",{class:"fa-regular fa-bars","aria-hidden":"true"},null,-1)])],2),s("button",{onClick:y(k,["prevent"]),class:x(b($)(c.value)),title:"Align left"},[...r[7]||(r[7]=[s("i",{class:"fa-regular fa-align-left","aria-hidden":"true"},null,-1)])],2),s("button",{onClick:y(H,["prevent"]),class:x(b($)(o.value)),title:"Align right"},[...r[8]||(r[8]=[s("i",{class:"fa-regular fa-align-right","aria-hidden":"true"},null,-1)])],2),r[11]||(r[11]=s("span",{class:"w-px h-4 bg-base-content/20 mx-1"},null,-1)),s("button",{onClick:y(A,["prevent"]),class:"hover:text-error px-2 py-1",title:"Delete table"},[...r[9]||(r[9]=[s("i",{class:"fa-regular fa-trash","aria-hidden":"true"},null,-1)])])]))}}),qt={class:"flex gap-1 items-center text-xs text-neutral-content px-2"},Wt={class:"flex items-center gap-0.5 border-r border-base-300 pr-2 mr-1"},Gt={class:"flex items-center gap-0.5 border-r border-base-300 pr-2 mr-1"},Zt=O({__name:"ImageBubbleMenu",props:{editor:{}},setup(e){const l=e,n=c=>{l.editor.commands.setImageWidth(c)},i=c=>{l.editor.commands.setImageFloat(c)},u=()=>{l.editor.chain().focus().deleteSelection().run()},a=()=>l.editor.getAttributes("image").widthStyle||null,d=()=>l.editor.getAttributes("image").floatStyle||null;return(c,o)=>(h(),v("div",qt,[s("div",Wt,[s("button",{onClick:o[0]||(o[0]=y(w=>n("25%"),["prevent"])),class:x(b($)(a()==="25%")),title:"25% width"}," 25% ",2),s("button",{onClick:o[1]||(o[1]=y(w=>n("50%"),["prevent"])),class:x(b($)(a()==="50%")),title:"50% width"}," 50% ",2),s("button",{onClick:o[2]||(o[2]=y(w=>n("100%"),["prevent"])),class:x(b($)(a()==="100%")),title:"100% width"}," 100% ",2),s("button",{onClick:o[3]||(o[3]=y(w=>n(null),["prevent"])),class:x(b($)(a()===null)),title:"Reset width"},[...o[7]||(o[7]=[s("i",{class:"fa-regular fa-undo","aria-hidden":"true"},null,-1)])],2)]),s("div",Gt,[s("button",{onClick:o[4]||(o[4]=y(w=>i("left"),["prevent"])),class:x(b($)(d()==="left")),title:"Float left"},[...o[8]||(o[8]=[s("i",{class:"fa-regular fa-align-left","aria-hidden":"true"},null,-1)])],2),s("button",{onClick:o[5]||(o[5]=y(w=>i("right"),["prevent"])),class:x(b($)(d()==="right")),title:"Float right"},[...o[9]||(o[9]=[s("i",{class:"fa-regular fa-align-right","aria-hidden":"true"},null,-1)])],2),s("button",{onClick:o[6]||(o[6]=y(w=>i(null),["prevent"])),class:x(b($)(d()===null)),title:"No float"},[...o[10]||(o[10]=[s("i",{class:"fa-regular fa-align-justify","aria-hidden":"true"},null,-1)])],2)]),s("button",{onClick:y(u,["prevent"]),class:"hover:text-error px-2 py-1",title:"Delete image"},[...o[11]||(o[11]=[s("i",{class:"fa-regular fa-trash","aria-hidden":"true"},null,-1)])])]))}}),Jt={class:"relative"},Qt=["title"],Xt={class:"absolute top-full left-0 mt-1 bg-base-100 shadow-lg rounded-lg p-3 z-50 w-[220px]"},Yt={key:0,class:"mb-2"},_t={class:"flex flex-wrap gap-1"},en=["onMousedown","title"],tn={class:"mb-2"},nn={class:"grid grid-cols-7 gap-1"},sn=["onMousedown","title"],ln={class:"mb-2"},rn=["onKeydown"],ne="recent_colors",he=10,be=O({__name:"ColorPicker",props:{currentColor:{},icon:{},title:{}},emits:["select"],setup(e,{emit:l}){const n=e,i=l,u=Math.random().toString(36).substring(7),a=R(!1),d=R(""),c=R([]),o=["#000000","#434343","#666666","#999999","#cccccc","#efefef","#ffffff","#FB0300","#FF9900","#FFFF01","#00FF00","#00FFFF","#0000FF","#9900FF","#FB3533","#FFAD33","#FFFF34","#33FF33","#33FFFF","#3333FF","#AD33FF","#FC6866","#FFC266","#FFFF67","#66FF66","#66FFFF","#6666FF","#C266FF","#FD9B99","#FFD699","#FFFF9A","#99FF99","#99FFFF","#9999FF","#D699FF","#FECECC","#FFEBCC","#FFFFCD","#CCFFCC","#CCFFFF","#CCCCFF","#EBCCFF","#FEE1E0","#FFF3E0","#FFFFE1","#E0FFE0","#E0FFFF","#E0E0FF","#F3E0FF","#FFF5F4","#FFF9F4","#FFFFF5","#F4FFF4","#F4FFFF","#F4F4FF","#F9F4FF"],w=()=>document.cookie.split(";").reduce((f,g)=>{const[t,r]=g.split("=").map(p=>p.trim());return t&&r&&(f[t]=decodeURIComponent(r)),f},{}),M=(f,g,t=30)=>{const r=new Date;r.setTime(r.getTime()+t*24*60*60*1e3),document.cookie=`${f}=${encodeURIComponent(g)}; expires=${r.toUTCString()}; path=/`},F=()=>{const f=w();c.value=f[ne]?JSON.parse(f[ne]):[]},C=f=>{c.value=[f,...c.value.filter(g=>g!==f)],c.value.length>he&&(c.value=c.value.slice(0,he)),M(ne,JSON.stringify(c.value))},k=f=>{C(f),i("select",f),a.value=!1},H=()=>{d.value&&/^#[0-9A-Fa-f]{6}$/.test(d.value)&&(k(d.value),d.value="")},L=()=>{i("select",null),a.value=!1},m=f=>{f.detail!==u&&(a.value=!1)},A=()=>{a.value||(window.dispatchEvent(new CustomEvent("colorpicker:close",{detail:u})),F()),a.value=!a.value},T=B(()=>!!n.currentColor);return Fe(()=>{F(),window.addEventListener("colorpicker:close",m)}),Ae(()=>{window.removeEventListener("colorpicker:close",m)}),(f,g)=>(h(),v("div",Jt,[s("button",{onClick:y(A,["prevent"]),class:x([b($)(T.value),"flex items-center gap-0.5"]),title:e.title},[s("i",{class:x(e.icon),"aria-hidden":"true"},null,2),e.currentColor?(h(),v("span",{key:0,class:"w-2 h-2 rounded-full border border-base-300",style:te({backgroundColor:e.currentColor})},null,4)):S("",!0)],10,Qt),N(s("div",Xt,[c.value.length>0?(h(),v("div",Yt,[g[1]||(g[1]=s("div",{class:"text-xs text-neutral-content mb-1"},"Recent",-1)),s("div",_t,[(h(!0),v(j,null,J(c.value,t=>(h(),v("button",{key:t,onMousedown:y(r=>k(t),["prevent"]),class:"w-5 h-5 rounded border border-base-300 hover:scale-110 transition-transform",style:te({backgroundColor:t}),title:t},null,44,en))),128))])])):S("",!0),s("div",tn,[g[2]||(g[2]=s("div",{class:"text-xs text-neutral-content mb-1"},"Colors",-1)),s("div",nn,[(h(),v(j,null,J(o,t=>s("button",{key:t,onMousedown:y(r=>k(t),["prevent"]),class:"w-5 h-5 rounded border border-base-300 hover:scale-110 transition-transform",style:te({backgroundColor:t}),title:t},null,44,sn)),64))])]),s("div",ln,[N(s("input",{"onUpdate:modelValue":g[0]||(g[0]=t=>d.value=t),type:"text",placeholder:"#000000",maxlength:"7",class:"w-full p-1 text-xs rounded border border-base-300 outline-none focus:ring-1 focus:ring-primary",onKeydown:Ee(y(H,["prevent"]),["enter"]),onBlur:H},null,40,rn),[[Y,d.value]])]),s("button",{onMousedown:y(L,["prevent"]),class:"w-full text-xs text-neutral-content hover:text-error py-1 flex items-center justify-center gap-1 cursor-pointer"},[...g[3]||(g[3]=[s("i",{class:"fa-regular fa-eraser","aria-hidden":"true"},null,-1),D(" Remove color ",-1)])],32)],512),[[le,a.value]])]))}}),on={class:"relative"},an={key:0,class:"text-xs"},un=["innerHTML"],dn={key:0,class:"fa-regular fa-check"},cn={key:0,class:"fa-regular fa-check"},fn={key:0,class:"fa-regular fa-check"},gn={key:0,class:"fa-regular fa-check"},mn={key:0,class:"fa-regular fa-check"},pn={key:0,class:"fa-regular fa-check"},hn={class:"flex items-center gap-0.5 border-r border-base-300 pr-2 mr-1"},bn={class:"flex items-center gap-0.5 border-r border-base-300 pr-2 mr-1"},vn={class:"relative"},yn={key:0,class:"fa-regular fa-check"},xn={key:0,class:"fa-regular fa-check"},wn=O({__name:"TextBubbleMenu",props:{editor:{}},emits:["openLink"],setup(e,{emit:l}){const n=e,i=l,u=R(!1),a=R(!1),d=B(()=>n.editor.getAttributes("textStyle").color||null),c=B(()=>n.editor.getAttributes("highlight").color||null),o=g=>{g?n.editor.chain().focus().setColor(g).run():n.editor.chain().focus().unsetColor().run()},w=g=>{g?n.editor.chain().focus().setHighlight({color:g}).run():n.editor.chain().focus().unsetHighlight().run()},M=B(()=>!n.editor||n.editor.isActive("paragraph")?"fa-regular fa-paragraph":"fa-regular fa-heading"),F=()=>n.editor.isActive("heading",{level:1})?"1":n.editor.isActive("heading",{level:2})?"2":n.editor.isActive("heading",{level:3})?"3":n.editor.isActive("heading",{level:4})?"4":n.editor.isActive("heading",{level:5})?"5":0,C=g=>{g===null?n.editor.chain().focus().setParagraph().run():n.editor.chain().focus().toggleHeading({level:g}).run(),u.value=!1},k=()=>{u.value=!u.value},H=()=>{u.value=!1},L=B(()=>n.editor?n.editor.isActive("bulletList")?"fa-regular fa-list-ul":n.editor.isActive("orderedList")?"fa-regular fa-list-ol":"fa-regular fa-list-ul":"fa-regular fa-list-ol"),m=g=>{g==="bullet"?n.editor.chain().focus().toggleBulletList().run():n.editor.chain().focus().toggleOrderedList().run(),a.value=!1},A=()=>{a.value=!a.value},T=()=>{a.value=!1},f=()=>{n.editor.chain().focus().unsetAllMarks().clearNodes().run()};return(g,t)=>(h(),v(j,null,[s("div",on,[s("button",{onClick:y(k,["prevent"]),class:x([b($)(!1),"flex items-center gap-0.5"]),onBlur:H},[s("i",{class:x(M.value)},null,2),e.editor.isActive("heading")?(h(),v("sub",an,[s("span",{innerHTML:F()},null,8,un)])):S("",!0),t[16]||(t[16]=s("i",{class:"fa-regular fa-chevron-down","aria-label":"Toggle paragraph styles"},null,-1))],34),N(s("div",{class:"absolute top-full left-0 mt-1 bg-base-100 shadow-lg rounded-lg py-1 z-50 min-w-[200px]",onMousedown:t[6]||(t[6]=y(()=>{},["prevent"]))},[s("button",{onClick:t[0]||(t[0]=y(r=>C(null),["prevent"])),class:x(["block w-full text-left px-3 py-2 hover:bg-base-200 text-neutral-content text-xs flex items-center justify-between gap-1",{"text-semibold text-base-content":e.editor.isActive("paragraph")}])},[t[17]||(t[17]=D(" Paragraph ",-1)),e.editor.isActive("paragraph")?(h(),v("i",dn)):S("",!0)],2),s("button",{onClick:t[1]||(t[1]=y(r=>C(1),["prevent"])),class:x(["block w-full text-left px-3 py-2 hover:bg-base-200 text-neutral-content flex items-center justify-between gap-1 text-[1.4rem]",{"font-semibold text-base-content":e.editor.isActive("heading",{level:1})}])},[t[18]||(t[18]=D(" Heading 1 ",-1)),e.editor.isActive("heading",{level:1})?(h(),v("i",cn)):S("",!0)],2),s("button",{onClick:t[2]||(t[2]=y(r=>C(2),["prevent"])),class:x(["block w-full text-left px-3 py-2 hover:bg-base-200 text-neutral-content flex items-center justify-between gap-1 text-[1.3rem]",{"font-semibold text-base-content":e.editor.isActive("heading",{level:2})}])},[t[19]||(t[19]=D(" Heading 2 ",-1)),e.editor.isActive("heading",{level:2})?(h(),v("i",fn)):S("",!0)],2),s("button",{onClick:t[3]||(t[3]=y(r=>C(3),["prevent"])),class:x(["block w-full text-left px-3 py-2 hover:bg-base-200 text-neutral-content flex items-center justify-between gap-1 text-[1.2rem]",{"font-semibold text-base-content":e.editor.isActive("heading",{level:3})}])},[t[20]||(t[20]=D(" Heading 3 ",-1)),e.editor.isActive("heading",{level:3})?(h(),v("i",gn)):S("",!0)],2),s("button",{onClick:t[4]||(t[4]=y(r=>C(4),["prevent"])),class:x(["w-full text-left px-3 py-2 hover:bg-base-200 text-neutral-content text-xs flex items-center justify-between gap-1 text[1.1rem]",{"font-semibold text-base-content":e.editor.isActive("heading",{level:4})}])},[t[21]||(t[21]=D(" Heading 4 ",-1)),e.editor.isActive("heading",{level:4})?(h(),v("i",mn)):S("",!0)],2),s("button",{onClick:t[5]||(t[5]=y(r=>C(5),["prevent"])),class:x(["w-full text-left px-3 py-2 hover:bg-base-200 text-neutral-content text-xs flex items-center justify-between gap-1",{"font-semibold text-base-content":e.editor.isActive("heading",{level:5})}])},[t[22]||(t[22]=D(" Heading 5 ",-1)),e.editor.isActive("heading",{level:5})?(h(),v("i",pn)):S("",!0)],2)],544),[[le,u.value]])]),s("button",{onClick:t[7]||(t[7]=y(r=>e.editor.chain().focus().toggleBold().run(),["prevent"])),class:x(b($)(e.editor.isActive("bold")))},[...t[23]||(t[23]=[s("i",{class:"fa-regular fa-bold","aria-label":"Bold"},null,-1)])],2),s("button",{onClick:t[8]||(t[8]=y(r=>e.editor.chain().focus().toggleItalic().run(),["prevent"])),class:x(b($)(e.editor.isActive("italic")))},[...t[24]||(t[24]=[s("i",{class:"fa-regular fa-italic","aria-label":"Italic"},null,-1)])],2),s("button",{onClick:t[9]||(t[9]=y(r=>e.editor.chain().focus().toggleStrike().run(),["prevent"])),class:x(b($)(e.editor.isActive("strike")))},[...t[25]||(t[25]=[s("i",{class:"fa-regular fa-strikethrough","aria-label":"Strikethrough"},null,-1)])],2),s("button",{onClick:t[10]||(t[10]=y(r=>e.editor.chain().focus().toggleUnderline().run(),["prevent"])),class:x(b($)(e.editor.isActive("underline")))},[...t[26]||(t[26]=[s("i",{class:"fa-regular fa-underline","aria-label":"Underline"},null,-1)])],2),s("div",hn,[U(be,{"current-color":d.value,icon:"fa-regular fa-font",title:"Text color",onSelect:o},null,8,["current-color"]),U(be,{"current-color":c.value,icon:"fa-regular fa-fill",title:"Highlight color",onSelect:w},null,8,["current-color"])]),s("div",bn,[s("button",{onClick:t[11]||(t[11]=y(r=>i("openLink"),["prevent"])),class:x(b($)(e.editor.isActive("link")))},[...t[27]||(t[27]=[s("i",{class:"fa-regular fa-link","aria-label":"Link"},null,-1)])],2),s("button",{onClick:t[12]||(t[12]=y(r=>e.editor.chain().focus().toggleBlockquote().run(),["prevent"])),class:x(b($)(e.editor.isActive("blockquote")))},[...t[28]||(t[28]=[s("i",{class:"fa-regular fa-quote-right","aria-label":"Quote"},null,-1)])],2),s("div",vn,[s("button",{onClick:y(A,["prevent"]),class:x([b($)(!1),"flex items-center gap-0.5"]),onBlur:T},[s("i",{class:x(L.value)},null,2),t[29]||(t[29]=s("i",{class:"fa-regular fa-chevron-down","aria-label":"Toggle paragraph styles"},null,-1))],34),N(s("div",{class:"absolute top-full left-0 mt-1 bg-base-100 shadow-lg rounded-lg py-1 z-50 min-w-[200px]",onMousedown:t[15]||(t[15]=y(()=>{},["prevent"]))},[s("button",{onClick:t[13]||(t[13]=y(r=>m("bullet"),["prevent"])),class:x(["block w-full text-left px-3 py-2 hover:bg-base-200 text-neutral-content text-xs flex items-center justify-between gap-1",{"text-semibold text-base-content":e.editor.isActive("bulletList")}])},[t[30]||(t[30]=s("div",{class:"flex gap-1 items-center"},[s("i",{class:"fa-regular fa-list-ul","aria-hidden":"true"}),D(" List ")],-1)),e.editor.isActive("bulletList")?(h(),v("i",yn)):S("",!0)],2),s("button",{onClick:t[14]||(t[14]=y(r=>m("ordered"),["prevent"])),class:x(["block w-full text-left px-3 py-2 hover:bg-base-200 text-neutral-content text-xs flex items-center justify-between gap-1",{"text-semibold text-base-content":e.editor.isActive("orderedList")}])},[t[31]||(t[31]=s("div",{class:"flex gap-1 items-center"},[s("i",{class:"fa-regular fa-list-ol","aria-hidden":"true"}),D(" Numbered list ")],-1)),e.editor.isActive("orderedList")?(h(),v("i",xn)):S("",!0)],2)],544),[[le,a.value]])])]),s("button",{onClick:y(f,["prevent"]),class:x(b($)(!1)),title:"Clear formatting"},[...t[32]||(t[32]=[s("i",{class:"fa-regular fa-paint-roller","aria-label":"Clear formatting"},null,-1)])],2)],64))}}),kn={class:"bubble-menu bg-base-100 shadow rounded-2xl flex gap-0.5 items-center px-2 py-2"},Cn={class:"bubble-menu bg-base-100 shadow rounded-2xl flex gap-0.5 items-center px-2 py-2"},Fn={class:"bubble-menu bg-base-100 shadow rounded-2xl flex gap-0.5 items-center px-2 py-2"},An={class:"bubble-menu bg-base-100 shadow rounded-2xl flex gap-0.5 items-center px-2 py-2"},Ln={class:"bubble-menu bg-base-100 shadow rounded-2xl flex gap-0.5 items-center px-2 py-2"},Tn={key:1,class:"text-neutral-content text-xs mt-2 flex items-center gap-5"},Mn=["name","value"],$n=O({__name:"Tiptap",props:{modelValue:{},content:{},gallery:{},mentions:{},galleryUpload:{},fieldName:{default:"entry"}},setup(e){const l=ge(()=>de(()=>import("./GalleryDialog-CfkNdZHJ.js"),__vite__mapDeps([0,1,2,3,4]))),n=ge(()=>de(()=>import("./SourceEditor-CTi5qB8u.js"),__vite__mapDeps([5,1,3,6]))),i=e,u=Se().uid.toString(),a=R(i.content??i.modelValue??""),d=R([]),c=R(!1),o=R(!1),w=R(!1),M=B(()=>c.value&&!o.value&&m.value?.isEmpty),F=()=>{w.value=!0},C=()=>{m.value?.commands.setContent(a.value),w.value=!1,setTimeout(()=>{m.value?.commands.focus()},50)},k=R(null),H=t=>{d.value.find(p=>p.id===t.id)||d.value.push(t)},L=[je.configure({link:!1,bulletList:!1,orderedList:!1,listItem:!1,listKeymap:!1}),Ke.configure({placeholder:"Start writing..."}),Oe.configure({openOnClick:!1,defaultProtocol:"https",HTMLAttributes:{class:"text-link"}}),ze.configure({taskItem:{nested:!0}}),Qe.configure({resizable:!0,allowTableNodeSelection:!0}),Re,Ze.configure({}),Je.configure({}),vt.configure({suggestion:Ht()}),Et.configure({inline:!0,allowBase64:!1,resize:{enabled:!0,minWidth:20,minHeight:20,alwaysPreserveAspectRatio:!0}}),St,Rt,Ne.configure({persist:!0,HTMLAttributes:{class:"details"}}),De,Be,Pe,Ue,Ve.configure({multicolor:!0})];i.gallery&&L.push(It.configure({galleryUrl:i.gallery,galleryId:u})),i.mentions&&L.push(Ye.configure({HTMLAttributes:{class:"mention"},suggestion:mt(i.mentions,H),renderText({node:t}){const r=t.attrs.mention,p=t.attrs.label,E=t.attrs.id,I=t.attrs.config,z=r?.match(/\[([^:]+):(\d+)/),P=z?z[1]:null;if(P&&E){const V=d.value.find(W=>W.id===parseInt(E)),q=V?V.name:null,K=[`${P}:${E}`];return p&&q&&p!==q&&K.push(p),I&&K.push(I),`[${K.join("|")}]`}return r||`[${p}]`}}),ht.configure({entities:d}));const m=qe({content:a.value,extensions:L,onFocus:()=>{c.value=!0},onBlur:()=>{c.value=!1},onUpdate:({editor:t})=>{a.value=t.getHTML().replace(/<table([^>]*) data-table-class="([^"]+)"([^>]*)>/g,'<table$1 class="$2"$3>'),!o.value&&!t.isEmpty&&(o.value=!0)},onSelectionUpdate:({editor:t})=>{t.isActive("mention")&&k.value?.syncLabel()},editorProps:{clipboardTextSerializer:t=>{let r="";return t.content.forEach(p=>{r+=A(p)}),r},handlePaste:(t,r,p)=>{if(i.galleryUpload){const W=Array.from(r.clipboardData?.items||[]).find(Q=>Q.type.startsWith("image/"));if(W){const Q=W.getAsFile();if(Q){const ue=new FormData;return ue.append("file[]",Q),axios.post(i.galleryUpload,ue).then(ee=>{ee.data?.url&&m.value?.chain().focus().setImage({src:ee.data.url,"data-gallery-id":String(ee.data.id)}).run()}).catch(()=>{window.showToast("Image upload failed","error")}),!0}}}const E=r.clipboardData?.getData("text/plain")||"",I=r.clipboardData?.getData("text/html")||"";if((I||E).match(/<iframe[^>]*src=["']([^"']+)["'][^>]*>/i)||E.includes("<iframe")){const K=I||E;return m.value?.commands.insertContent(K,{parseOptions:{preserveWhitespace:!1}}),!0}const P=E.trim();if(/^https?:\/\/\S+$/i.test(P)&&!I)try{const K=new URL(P);if(/\.(jpe?g|png|gif|webp|svg|bmp|avif|tiff?)$/i.test(K.pathname))return m.value?.chain().focus().setImage({src:P}).run(),!0}catch{}return/\[([a-zA-Z_]+):(\d+)(?:\|[^\]]+)?\]/.test(E)?(m.value?.commands.insertContent(E),!0):!1},handleKeyDown:(t,r)=>(r.ctrlKey||r.metaKey)&&r.key==="k"&&!t.state.selection.empty?(r.preventDefault(),f(),!0):!1}}),A=t=>{if(t.type.name==="mention")return T(t);if(t.isText)return t.text||"";let r="";return t.content&&t.content.forEach(p=>{r+=A(p)}),t.isBlock&&r&&(r+=`
`),r},T=t=>{const r=t.attrs.config,p=t.attrs.id,I=[`${t.attrs.type}:${p}`];return r&&I.push(r),`[${I.join("|")}]`},f=()=>{if(!m.value)return;const t=m.value.getAttributes("link").href||"",{to:r}=m.value.state.selection;m.value.chain().focus().setLink({href:t}).setTextSelection(r).run()},g=t=>{const r=[],p=[],E=/\[([a-zA-Z_]+):(\d+)(?:\|[^\]]+)?\]/g;let I;for(;(I=E.exec(t))!==null;){const z=I[1],P=parseInt(I[2],10);z==="post"?p.includes(P)||p.push(P):r.includes(P)||r.push(P)}return{entityIds:r,postIds:p}};return Fe(()=>{if(window.addEventListener("tiptap:source-mode",F),i.mentions&&i.content){const{entityIds:t,postIds:r}=g(i.content);(t.length>0||r.length>0)&&axios.post(i.mentions,{entities:t,posts:r}).then(p=>{d.value=p.data,m.value?.commands.setContent(i.content)})}}),Ae(()=>{window.removeEventListener("tiptap:source-mode",F),m?.value.destroy()}),(t,r)=>(h(),v(j,null,[w.value?(h(),ce(b(n),{key:0,modelValue:a.value,"onUpdate:modelValue":r[0]||(r[0]=p=>a.value=p),onExit:C},null,8,["modelValue"])):(h(),v(j,{key:1},[b(m)?(h(),v(j,{key:0},[U(b(Z),{editor:b(m),"plugin-key":"mentionBubbleMenu","should-show":({editor:p})=>p.isActive("mention")},{default:G(()=>[s("div",kn,[U(jt,{ref_key:"mentionBubbleRef",ref:k,editor:b(m),mentions:d.value},null,8,["editor","mentions"])])]),_:1},8,["editor","should-show"]),U(b(Z),{editor:b(m),"plugin-key":"linkBubbleMenu","should-show":({editor:p})=>p.isActive("link")&&p.state.selection.empty},{default:G(()=>[s("div",Cn,[U(zt,{editor:b(m)},null,8,["editor"])])]),_:1},8,["editor","should-show"]),U(b(Z),{editor:b(m),"plugin-key":"tableBubbleMenu","should-show":({editor:p})=>p.state.selection instanceof b(fe)},{default:G(()=>[s("div",Fn,[U(Vt,{editor:b(m)},null,8,["editor"])])]),_:1},8,["editor","should-show"]),U(b(Z),{editor:b(m),"plugin-key":"imageBubbleMenu","should-show":({editor:p})=>p.isActive("image")},{default:G(()=>[s("div",An,[U(Zt,{editor:b(m)},null,8,["editor"])])]),_:1},8,["editor","should-show"]),U(b(Z),{editor:b(m),"plugin-key":"textBubbleMenu","should-show":({editor:p})=>!(p.state.selection.empty||p.isActive("mention")||p.state.selection instanceof b(fe)||p.isActive("image"))},{default:G(()=>[s("div",Ln,[U(wn,{editor:b(m),onOpenLink:f},null,8,["editor"])])]),_:1},8,["editor","should-show"])],64)):S("",!0),U(b(We),{editor:b(m)},null,8,["editor"]),M.value?(h(),v("p",Tn,[...r[1]||(r[1]=[s("span",null,[D(" Use "),s("kbd",null,"@"),D(" to reference entities ")],-1),s("span",null,[s("kbd",null,"/"),D(" for commands ")],-1)])])):S("",!0)],64)),s("input",{type:"hidden",name:i.fieldName,value:a.value},null,8,Mn),e.gallery?(h(),ce(b(l),{key:2,"gallery-id":b(u)},null,8,["gallery-id"])):S("",!0)],64))}}),Rn=ae($n,[["__scopeId","data-v-e6d0e275"]]);export{Rn as default};

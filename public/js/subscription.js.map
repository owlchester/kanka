{"version":3,"file":"/js/subscription.js","mappings":"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","sources":["webpack:///./resources/assets/js/subscription.js"],"sourcesContent":["// Strip variables for the page\nvar stripe, elements, card;\n\n// Form status\nvar formSubmit = false;\nvar formSubmitBtn;\n\n// Coupon stuff\nvar couponBtn, couponField, couponSuccess, couponError, couponId;\n\nvar subscribeModal;\n\n$(document).ready(function() {\n    initStripe();\n    initPeriodToggle();\n    subscribeModal = $('#subscribe-confirm');\n    subscribeModal.on('shown.bs.modal', () => {\n        initConfirmListener();\n    });\n});\n\n// Initialize the stripe API\nfunction initStripe() {\n    let token = $('#stripe-token');\n    stripe = Stripe(token.val());\n\n    // Create an instance of Elements.\n    elements = stripe.elements();\n}\n\n// When the modal is opened and loaded, inject stripe if needed and the form validator\nfunction initConfirmListener()\n{\n    formSubmitBtn = $('.subscription-confirm-button');\n\n    let cardSelector = $('#card-element');\n    if (cardSelector.length === 1) {\n        // First time opening the modal, initiate a new card\n        if (!card) {\n            // Custom styling can be passed to options when creating an Element.\n            // (Note that this demo uses a wider set of styles than the guide below.)\n            let style = {\n                base: {\n                    color: '#555555',\n                    fontFamily: '\"Helvetica Neue\", Helvetica, sans-serif',\n                    fontSmoothing: 'antialiased',\n                    fontSize: '14px',\n                    '::placeholder': {\n                        color: '#777777'\n                    }\n                },\n                invalid: {\n                    color: '#fa755a',\n                    iconColor: '#fa755a'\n                }\n            };\n\n            // Create an instance of the card Element.\n            card = elements.create('card', {hidePostalCode: true, style: style});\n        }\n\n        // Add an instance of the card Element into the `card-element` <div>.\n        card.mount('#card-element');\n    }\n\n    $('#subscription-confirm').submit(function (e) {\n        // If we've passed the strip validation, we can go further\n        if (formSubmit) {\n            return true;\n        }\n\n        e.preventDefault();\n        formSubmitBtn.addClass('disabled');\n        formSubmitBtn.find('span').hide();\n        formSubmitBtn.find('.spinner').show();\n\n        let intentToken = $('input[name=\"subscription-intent-token\"]');\n        let errorMessage = $('.alert-danger');\n        errorMessage.hide();\n\n        // If the form already has a payment id, we don't need stripe to add the new one\n        let cardID = $('input[name=\"payment_id\"]');\n        if (cardID.val()) {\n            formSubmit = true;\n            $('#subscription-confirm').submit();\n            return false;\n        }\n\n        stripe.confirmCardSetup(\n            intentToken.val(), {\n                payment_method: {\n                    card: card,\n                    billing_details: {\n                        name: $('input[name=\"card-holder-name\"]').val()\n                    }\n                }\n            }\n        ).then(function (result) {\n            if (result.error) {\n                formSubmitBtn.removeClass('disabled').text(formSubmitBtn.data('text'));\n                errorMessage.text(result.error.message).show();\n                return false;\n            } else {\n                cardID.val(result.setupIntent.payment_method);\n                formSubmit = true;\n                $('#subscription-confirm').submit();\n\n            }\n        }.bind(this));\n    });\n\n    $('.subscription-form').submit(function () {\n        formSubmitBtn.addClass('disabled')\n            .find('span').hide()\n            .parent().find('.spinner').show();\n\n        return true;\n    });\n\n    couponBtn = $('#coupon-check-btn');\n    couponField = $('#coupon-check');\n    couponSuccess = $('#coupon-success');\n    couponError = $('#coupon-invalid');\n    couponId = $('#coupon');\n\n    couponBtn.click(function () {\n        checkCoupon();\n    });\n    couponField.change(function() {\n        checkCoupon();\n    });\n    couponField.focus(function () {\n        formSubmitBtn.addClass('disabled').prop('disabled', true);\n    });\n    couponField.focusout(function () {\n        let coupon = couponField.val();\n        if (!coupon) {\n            formSubmitBtn.removeClass('disabled').prop('disabled', false);\n        }\n    });\n}\n\nfunction checkCoupon() {\n    let coupon = couponField.val();\n    let url = couponField.data('url');\n\n    couponBtn.prop('disabled', true)\n        .find('.check').hide()\n        .parent().find('.spinner').show();\n\n    if (!coupon) {\n        formSubmitBtn.removeClass('disabled').prop('disabled', false);\n    }\n\n    $.ajax({\n        url: url + '?coupon=' + coupon,\n        context: this\n    }).done(function (result) {\n        couponBtn\n            .prop('disabled', false)\n            .find('.check').show()\n            .parent().find('.spinner').hide();\n\n        formSubmitBtn.removeClass('disabled').prop('disabled', false);\n\n        if (!result.valid) {\n            couponSuccess.hide();\n            couponError.show();\n            couponId.val('');\n            subscribeModal.removeClass('valid-coupon');\n\n            return;\n        }\n\n        couponError.hide();\n        couponSuccess.html(result.discount).show();\n        couponId.val(result.coupon);\n        subscribeModal.addClass('valid-coupon');\n    });\n}\n\nfunction initPeriodToggle() {\n    $('input[name=\"period\"]').change(function () {\n        let box = $('#pricing-overview');\n        console.log('checked?', this.checked);\n        if (this.checked) {\n            box.removeClass('period-month').addClass('period-year');\n        } else {\n            box.removeClass('period-year').addClass('period-month');\n        }\n    });\n}\n"],"names":["stripe","elements","card","formSubmit","formSubmitBtn","couponBtn","couponField","couponSuccess","couponError","couponId","subscribeModal","$","document","ready","initStripe","initPeriodToggle","on","initConfirmListener","token","Stripe","val","cardSelector","length","style","base","color","fontFamily","fontSmoothing","fontSize","invalid","iconColor","create","hidePostalCode","mount","submit","e","preventDefault","addClass","find","hide","show","intentToken","errorMessage","cardID","confirmCardSetup","payment_method","billing_details","name","then","result","error","removeClass","text","data","message","setupIntent","bind","parent","click","checkCoupon","change","focus","prop","focusout","coupon","url","ajax","context","done","valid","html","discount","box","console","log","checked"],"sourceRoot":""}